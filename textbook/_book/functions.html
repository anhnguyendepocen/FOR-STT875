<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Functions and Programming | R Programming for Data Sciences</title>
  <meta name="description" content="7 Functions and Programming | R Programming for Data Sciences" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Functions and Programming | R Programming for Data Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Functions and Programming | R Programming for Data Sciences" />
  
  
  

<meta name="author" content="Andrew O. Finley, Jeffrey W. Doser, Vince Melfi" />


<meta name="date" content="2020-05-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data2.html">
<link rel="next" href="stats.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet/leaflet.js"></script>
<link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="1" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1</b> Data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data.html"><a href="data.html#baby-crawling-data"><i class="fa fa-check"></i><b>1.1</b> Baby Crawling Data</a></li>
<li class="chapter" data-level="1.2" data-path="data.html"><a href="data.html#world-bank-data"><i class="fa fa-check"></i><b>1.2</b> World Bank Data</a></li>
<li class="chapter" data-level="1.3" data-path="data.html"><a href="data.html#email-data"><i class="fa fa-check"></i><b>1.3</b> Email Data</a></li>
<li class="chapter" data-level="1.4" data-path="data.html"><a href="data.html#handwritten-digit-recognition"><i class="fa fa-check"></i><b>1.4</b> Handwritten Digit Recognition</a></li>
<li class="chapter" data-level="1.5" data-path="data.html"><a href="data.html#looking-forward"><i class="fa fa-check"></i><b>1.5</b> Looking Forward</a></li>
<li class="chapter" data-level="1.6" data-path="data.html"><a href="data.html#how-to-learn-the-most-important-section-in-this-book"><i class="fa fa-check"></i><b>1.6</b> How to learn (The most important section in this book!)</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>2</b> Introduction to R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>2.1</b> Obtaining and Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>2.2</b> Obtaining and Installing RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#using-r-and-rstudio"><i class="fa fa-check"></i><b>2.3</b> Using R and RStudio</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#r-as-a-calculator"><i class="fa fa-check"></i><b>2.3.1</b> R as a Calculator</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#dec"><i class="fa fa-check"></i><b>2.3.2</b> Basic descriptive statistics and graphics in R</a></li>
<li class="chapter" data-level="2.3.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#an-initial-tour-of-rstudio"><i class="fa fa-check"></i><b>2.3.3</b> An Initial Tour of RStudio</a></li>
<li class="chapter" data-level="2.3.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#practice-problem"><i class="fa fa-check"></i><b>2.3.4</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#getting-help"><i class="fa fa-check"></i><b>2.4</b> Getting Help</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#workspace-working-directory-and-keeping-organized"><i class="fa fa-check"></i><b>2.5</b> Workspace, Working Directory, and Keeping Organized</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#quality-of-r-code"><i class="fa fa-check"></i><b>2.6</b> Quality of R code</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#naming-files"><i class="fa fa-check"></i><b>2.6.1</b> Naming Files</a></li>
<li class="chapter" data-level="2.6.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#naming-variables"><i class="fa fa-check"></i><b>2.6.2</b> Naming Variables</a></li>
<li class="chapter" data-level="2.6.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#syntax"><i class="fa fa-check"></i><b>2.6.3</b> Syntax</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html"><i class="fa fa-check"></i><b>3</b> Scripts and R Markdown</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#scripts-in-r"><i class="fa fa-check"></i><b>3.1</b> Scripts in R</a></li>
<li class="chapter" data-level="3.2" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#r-markdown"><i class="fa fa-check"></i><b>3.2</b> R Markdown</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#creating-and-processing-r-markdown-documents"><i class="fa fa-check"></i><b>3.2.1</b> Creating and processing R Markdown documents</a></li>
<li class="chapter" data-level="3.2.2" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#text-lists-and-headers"><i class="fa fa-check"></i><b>3.2.2</b> Text: Lists and Headers</a></li>
<li class="chapter" data-level="3.2.3" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#code-chunks"><i class="fa fa-check"></i><b>3.2.3</b> Code Chunks</a></li>
<li class="chapter" data-level="3.2.4" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#output-formats-other-than-html"><i class="fa fa-check"></i><b>3.2.4</b> Output formats other than HTML</a></li>
<li class="chapter" data-level="3.2.5" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#latex-knitr-and-bookdown"><i class="fa fa-check"></i><b>3.2.5</b> LaTeX, <code>knitr</code>, and <code>bookdown</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#exercises"><i class="fa fa-check"></i><b>3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structures.html"><a href="structures.html"><i class="fa fa-check"></i><b>4</b> Data Structures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="structures.html"><a href="structures.html#vector"><i class="fa fa-check"></i><b>4.1</b> Vectors</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="structures.html"><a href="structures.html#types-conversion-coercion"><i class="fa fa-check"></i><b>4.1.1</b> Types, Conversion, Coercion</a></li>
<li class="chapter" data-level="4.1.2" data-path="structures.html"><a href="structures.html#accessing-specific-elements-of-vectors"><i class="fa fa-check"></i><b>4.1.2</b> Accessing Specific Elements of Vectors</a></li>
<li class="chapter" data-level="4.1.3" data-path="structures.html"><a href="structures.html#practice-problem-1"><i class="fa fa-check"></i><b>4.1.3</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="structures.html"><a href="structures.html#factors"><i class="fa fa-check"></i><b>4.2</b> Factors</a></li>
<li class="chapter" data-level="4.3" data-path="structures.html"><a href="structures.html#names-of-objects-in-r"><i class="fa fa-check"></i><b>4.3</b> Names of Objects in R</a></li>
<li class="chapter" data-level="4.4" data-path="structures.html"><a href="structures.html#missing-data-infinity-etc."><i class="fa fa-check"></i><b>4.4</b> Missing Data, Infinity, etc.</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="structures.html"><a href="structures.html#practice-problem-2"><i class="fa fa-check"></i><b>4.4.1</b> Practice Problem</a></li>
<li class="chapter" data-level="4.4.2" data-path="structures.html"><a href="structures.html#infinity-and-nan"><i class="fa fa-check"></i><b>4.4.2</b> Infinity and NaN</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="structures.html"><a href="structures.html#dataFrames"><i class="fa fa-check"></i><b>4.5</b> Data Frames</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="structures.html"><a href="structures.html#accessing-specific-elements-of-data-frames"><i class="fa fa-check"></i><b>4.5.1</b> Accessing Specific Elements of Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="structures.html"><a href="structures.html#lists"><i class="fa fa-check"></i><b>4.6</b> Lists</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="structures.html"><a href="structures.html#accessing-specific-elements-of-lists"><i class="fa fa-check"></i><b>4.6.1</b> Accessing Specific Elements of Lists</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="structures.html"><a href="structures.html#subsetting"><i class="fa fa-check"></i><b>4.7</b> Subsetting with Logical Vectors</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="structures.html"><a href="structures.html#modifying-or-creating-objects-via-subsetting"><i class="fa fa-check"></i><b>4.7.1</b> Modifying or Creating Objects via Subsetting</a></li>
<li class="chapter" data-level="4.7.2" data-path="structures.html"><a href="structures.html#logical-subsetting-and-data-frames"><i class="fa fa-check"></i><b>4.7.2</b> Logical Subsetting and Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="structures.html"><a href="structures.html#patterned-data"><i class="fa fa-check"></i><b>4.8</b> Patterned Data</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="structures.html"><a href="structures.html#practice-problem-3"><i class="fa fa-check"></i><b>4.8.1</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="structures.html"><a href="structures.html#exercises-1"><i class="fa fa-check"></i><b>4.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html"><i class="fa fa-check"></i><b>5</b> Graphics in R Part 1: <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#scatter-plots"><i class="fa fa-check"></i><b>5.1</b> Scatter Plots</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#structure-of-a-typical-ggplot"><i class="fa fa-check"></i><b>5.1.1</b> Structure of a Typical <code>ggplot</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#adding-lines-to-a-scatter-plot"><i class="fa fa-check"></i><b>5.1.2</b> Adding lines to a scatter plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#labels-axes-text-etc."><i class="fa fa-check"></i><b>5.2</b> Labels, Axes, Text, etc.</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#labels"><i class="fa fa-check"></i><b>5.2.1</b> Labels</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#customizing-axes"><i class="fa fa-check"></i><b>5.3</b> Customizing Axes</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#text-point-size-and-color"><i class="fa fa-check"></i><b>5.3.1</b> Text, Point Size, and Color</a></li>
<li class="chapter" data-level="5.3.2" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#practice-problem-4"><i class="fa fa-check"></i><b>5.3.2</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#other-types-of-graphics"><i class="fa fa-check"></i><b>5.4</b> Other Types of Graphics</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#histograms"><i class="fa fa-check"></i><b>5.4.1</b> Histograms</a></li>
<li class="chapter" data-level="5.4.2" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#boxplots"><i class="fa fa-check"></i><b>5.4.2</b> Boxplots</a></li>
<li class="chapter" data-level="5.4.3" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#bar-graphs"><i class="fa fa-check"></i><b>5.4.3</b> Bar Graphs</a></li>
<li class="chapter" data-level="5.4.4" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#graphs-of-functions"><i class="fa fa-check"></i><b>5.4.4</b> Graphs of Functions</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#themes"><i class="fa fa-check"></i><b>5.5</b> Themes</a></li>
<li class="chapter" data-level="5.6" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#saving-graphics"><i class="fa fa-check"></i><b>5.6</b> Saving Graphics</a></li>
<li class="chapter" data-level="5.7" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#more-resources"><i class="fa fa-check"></i><b>5.7</b> More Resources</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#practice-problem-5"><i class="fa fa-check"></i><b>5.7.1</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="graphics-in-r-part-1-ggplot2.html"><a href="graphics-in-r-part-1-ggplot2.html#exercises-2"><i class="fa fa-check"></i><b>5.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data2.html"><a href="data2.html"><i class="fa fa-check"></i><b>6</b> Working with Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data2.html"><a href="data2.html#reading-data-into-r"><i class="fa fa-check"></i><b>6.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="6.2" data-path="data2.html"><a href="data2.html#reading-data-with-missing-observations"><i class="fa fa-check"></i><b>6.2</b> Reading Data with Missing Observations</a></li>
<li class="chapter" data-level="6.3" data-path="data2.html"><a href="data2.html#summarizing-data-frames"><i class="fa fa-check"></i><b>6.3</b> Summarizing Data Frames</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data2.html"><a href="data2.html#column-and-row-summaries"><i class="fa fa-check"></i><b>6.3.1</b> Column (and Row) Summaries</a></li>
<li class="chapter" data-level="6.3.2" data-path="data2.html"><a href="data2.html#apply"><i class="fa fa-check"></i><b>6.3.2</b> The <code>apply()</code> Function</a></li>
<li class="chapter" data-level="6.3.3" data-path="data2.html"><a href="data2.html#practice-problems"><i class="fa fa-check"></i><b>6.3.3</b> Practice Problems</a></li>
<li class="chapter" data-level="6.3.4" data-path="data2.html"><a href="data2.html#saving-typing-using-with"><i class="fa fa-check"></i><b>6.3.4</b> Saving Typing Using <code>with()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data2.html"><a href="data2.html#transforming-a-data-frame"><i class="fa fa-check"></i><b>6.4</b> Transforming a Data Frame</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data2.html"><a href="data2.html#adding-variables"><i class="fa fa-check"></i><b>6.4.1</b> Adding Variables</a></li>
<li class="chapter" data-level="6.4.2" data-path="data2.html"><a href="data2.html#removing-variables"><i class="fa fa-check"></i><b>6.4.2</b> Removing Variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="data2.html"><a href="data2.html#practice-problem-6"><i class="fa fa-check"></i><b>6.4.3</b> Practice Problem</a></li>
<li class="chapter" data-level="6.4.4" data-path="data2.html"><a href="data2.html#transforming-variables"><i class="fa fa-check"></i><b>6.4.4</b> Transforming Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data2.html"><a href="data2.html#rearranging-variables"><i class="fa fa-check"></i><b>6.5</b> Rearranging Variables</a></li>
<li class="chapter" data-level="6.6" data-path="data2.html"><a href="data2.html#reshaping-data"><i class="fa fa-check"></i><b>6.6</b> Reshaping Data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data2.html"><a href="data2.html#tidyr"><i class="fa fa-check"></i><b>6.6.1</b> <code>tidyr</code></a></li>
<li class="chapter" data-level="6.6.2" data-path="data2.html"><a href="data2.html#practice-problem-7"><i class="fa fa-check"></i><b>6.6.2</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data2.html"><a href="data2.html#dplyr"><i class="fa fa-check"></i><b>6.7</b> Manipulating Data with <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="data2.html"><a href="data2.html#improved-data-frames"><i class="fa fa-check"></i><b>6.7.1</b> Improved Data Frames</a></li>
<li class="chapter" data-level="6.7.2" data-path="data2.html"><a href="data2.html#filtering-data-by-row"><i class="fa fa-check"></i><b>6.7.2</b> Filtering Data by Row</a></li>
<li class="chapter" data-level="6.7.3" data-path="data2.html"><a href="data2.html#selecting-variables-by-column"><i class="fa fa-check"></i><b>6.7.3</b> Selecting variables by column</a></li>
<li class="chapter" data-level="6.7.4" data-path="data2.html"><a href="data2.html#practice-problem-8"><i class="fa fa-check"></i><b>6.7.4</b> Practice Problem</a></li>
<li class="chapter" data-level="6.7.5" data-path="data2.html"><a href="data2.html#pipes"><i class="fa fa-check"></i><b>6.7.5</b> Pipes</a></li>
<li class="chapter" data-level="6.7.6" data-path="data2.html"><a href="data2.html#arranging-data-by-row"><i class="fa fa-check"></i><b>6.7.6</b> Arranging Data by Row</a></li>
<li class="chapter" data-level="6.7.7" data-path="data2.html"><a href="data2.html#practice-problem-9"><i class="fa fa-check"></i><b>6.7.7</b> Practice Problem</a></li>
<li class="chapter" data-level="6.7.8" data-path="data2.html"><a href="data2.html#renaming-variables"><i class="fa fa-check"></i><b>6.7.8</b> Renaming Variables</a></li>
<li class="chapter" data-level="6.7.9" data-path="data2.html"><a href="data2.html#data-summaries-and-grouping"><i class="fa fa-check"></i><b>6.7.9</b> Data Summaries and Grouping</a></li>
<li class="chapter" data-level="6.7.10" data-path="data2.html"><a href="data2.html#creating-new-variables"><i class="fa fa-check"></i><b>6.7.10</b> Creating New Variables</a></li>
<li class="chapter" data-level="6.7.11" data-path="data2.html"><a href="data2.html#practice-problem-10"><i class="fa fa-check"></i><b>6.7.11</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="data2.html"><a href="data2.html#exercises-3"><i class="fa fa-check"></i><b>6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>7</b> Functions and Programming</a>
<ul>
<li class="chapter" data-level="7.1" data-path="functions.html"><a href="functions.html#r-functions"><i class="fa fa-check"></i><b>7.1</b> R Functions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="functions.html"><a href="functions.html#practice-problem-11"><i class="fa fa-check"></i><b>7.1.1</b> Practice Problem</a></li>
<li class="chapter" data-level="7.1.2" data-path="functions.html"><a href="functions.html#creating-functions"><i class="fa fa-check"></i><b>7.1.2</b> Creating Functions</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="functions.html"><a href="functions.html#programming-conditional-statements"><i class="fa fa-check"></i><b>7.2</b> Programming: Conditional Statements</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="functions.html"><a href="functions.html#comparison-and-logical-operators"><i class="fa fa-check"></i><b>7.2.1</b> Comparison and Logical Operators</a></li>
<li class="chapter" data-level="7.2.2" data-path="functions.html"><a href="functions.html#if-else-statements"><i class="fa fa-check"></i><b>7.2.2</b> If else statements</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="functions.html"><a href="functions.html#arith"><i class="fa fa-check"></i><b>7.3</b> Computer Arithmetic</a></li>
<li class="chapter" data-level="7.4" data-path="functions.html"><a href="functions.html#loops"><i class="fa fa-check"></i><b>7.4</b> Loops</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="functions.html"><a href="functions.html#a-repeat-loop"><i class="fa fa-check"></i><b>7.4.1</b> A Repeat Loop</a></li>
<li class="chapter" data-level="7.4.2" data-path="functions.html"><a href="functions.html#a-while-loop"><i class="fa fa-check"></i><b>7.4.2</b> A While Loop</a></li>
<li class="chapter" data-level="7.4.3" data-path="functions.html"><a href="functions.html#a-for-loop"><i class="fa fa-check"></i><b>7.4.3</b> A For Loop</a></li>
<li class="chapter" data-level="7.4.4" data-path="functions.html"><a href="functions.html#practice-problem-12"><i class="fa fa-check"></i><b>7.4.4</b> Practice Problem</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="functions.html"><a href="functions.html#efficiency-considerations"><i class="fa fa-check"></i><b>7.5</b> Efficiency Considerations</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="functions.html"><a href="functions.html#growing-objects"><i class="fa fa-check"></i><b>7.5.1</b> Growing Objects</a></li>
<li class="chapter" data-level="7.5.2" data-path="functions.html"><a href="functions.html#vectorization"><i class="fa fa-check"></i><b>7.5.2</b> Vectorization</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="functions.html"><a href="functions.html#more-on-functions"><i class="fa fa-check"></i><b>7.6</b> More on Functions</a></li>
<li class="chapter" data-level="7.7" data-path="functions.html"><a href="functions.html#calling-functions"><i class="fa fa-check"></i><b>7.7</b> Calling Functions</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="functions.html"><a href="functions.html#the-...-argument"><i class="fa fa-check"></i><b>7.7.1</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="7.7.2" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>7.7.2</b> Lazy Evaluation</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="functions.html"><a href="functions.html#exercises-4"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
<li class="chapter" data-level="7.9" data-path="functions.html"><a href="functions.html#overview"><i class="fa fa-check"></i><b>7.9</b> Overview</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="functions.html"><a href="functions.html#some-spatial-data-packages"><i class="fa fa-check"></i><b>7.9.1</b> Some Spatial Data Packages</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="functions.html"><a href="functions.html#motivating-data"><i class="fa fa-check"></i><b>7.10</b> Motivating Data</a></li>
<li class="chapter" data-level="7.11" data-path="functions.html"><a href="functions.html#reading-spatial-data-into-r"><i class="fa fa-check"></i><b>7.11</b> Reading Spatial Data into R</a></li>
<li class="chapter" data-level="7.12" data-path="functions.html"><a href="functions.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>7.12</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="7.13" data-path="functions.html"><a href="functions.html#ggmap"><i class="fa fa-check"></i><b>7.13</b> Illustration using <code>ggmap</code></a></li>
<li class="chapter" data-level="7.14" data-path="functions.html"><a href="functions.html#illustration-using-leaflet"><i class="fa fa-check"></i><b>7.14</b> Illustration using <code>leaflet</code></a></li>
<li class="chapter" data-level="7.15" data-path="functions.html"><a href="functions.html#subsetting-spatial-data"><i class="fa fa-check"></i><b>7.15</b> Subsetting Spatial Data</a>
<ul>
<li class="chapter" data-level="7.15.1" data-path="functions.html"><a href="functions.html#fetching-and-cropping-data-using-raster"><i class="fa fa-check"></i><b>7.15.1</b> Fetching and Cropping Data using <code>raster</code></a></li>
<li class="chapter" data-level="7.15.2" data-path="functions.html"><a href="functions.html#logical-index-and-name-subsetting"><i class="fa fa-check"></i><b>7.15.2</b> Logical, Index, and Name Subsetting</a></li>
<li class="chapter" data-level="7.15.3" data-path="functions.html"><a href="functions.html#spatial-subsetting-and-overlay"><i class="fa fa-check"></i><b>7.15.3</b> Spatial Subsetting and Overlay</a></li>
<li class="chapter" data-level="7.15.4" data-path="functions.html"><a href="functions.html#spatial-aggregation"><i class="fa fa-check"></i><b>7.15.4</b> Spatial Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="7.16" data-path="functions.html"><a href="functions.html#where-to-go-from-here"><i class="fa fa-check"></i><b>7.16</b> Where to go from here</a></li>
<li class="chapter" data-level="7.17" data-path="functions.html"><a href="functions.html#exercises-5"><i class="fa fa-check"></i><b>7.17</b> Exercises</a></li>
<li class="chapter" data-level="7.18" data-path="functions.html"><a href="functions.html#running-a-simple-shiny-app"><i class="fa fa-check"></i><b>7.18</b> Running a Simple Shiny App</a></li>
<li class="chapter" data-level="7.19" data-path="functions.html"><a href="functions.html#adding-user-input"><i class="fa fa-check"></i><b>7.19</b> Adding User Input</a></li>
<li class="chapter" data-level="7.20" data-path="functions.html"><a href="functions.html#adding-output"><i class="fa fa-check"></i><b>7.20</b> Adding Output</a>
<ul>
<li class="chapter" data-level="7.20.1" data-path="functions.html"><a href="functions.html#interactive-server-logic"><i class="fa fa-check"></i><b>7.20.1</b> Interactive Server Logic</a></li>
<li class="chapter" data-level="7.20.2" data-path="functions.html"><a href="functions.html#interactive-user-interface"><i class="fa fa-check"></i><b>7.20.2</b> Interactive User Interface</a></li>
</ul></li>
<li class="chapter" data-level="7.21" data-path="functions.html"><a href="functions.html#more-advanced-shiny-app-michigan-campgrounds"><i class="fa fa-check"></i><b>7.21</b> More Advanced Shiny App: Michigan Campgrounds</a>
<ul>
<li class="chapter" data-level="7.21.1" data-path="functions.html"><a href="functions.html#michigan-campgrounds-ui"><i class="fa fa-check"></i><b>7.21.1</b> Michigan Campgrounds UI</a></li>
<li class="chapter" data-level="7.21.2" data-path="functions.html"><a href="functions.html#michigan-campgrounds-server-logic"><i class="fa fa-check"></i><b>7.21.2</b> Michigan Campgrounds Server Logic</a></li>
</ul></li>
<li class="chapter" data-level="7.22" data-path="functions.html"><a href="functions.html#adding-leaflet-to-shiny"><i class="fa fa-check"></i><b>7.22</b> Adding Leaflet to Shiny</a></li>
<li class="chapter" data-level="7.23" data-path="functions.html"><a href="functions.html#why-use-shiny"><i class="fa fa-check"></i><b>7.23</b> Why use Shiny?</a></li>
<li class="chapter" data-level="7.24" data-path="functions.html"><a href="functions.html#exercises-6"><i class="fa fa-check"></i><b>7.24</b> Exercises</a></li>
<li class="chapter" data-level="7.25" data-path="functions.html"><a href="functions.html#logistic-regression"><i class="fa fa-check"></i><b>7.25</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="7.25.1" data-path="functions.html"><a href="functions.html#adding-predictors"><i class="fa fa-check"></i><b>7.25.1</b> Adding Predictors</a></li>
<li class="chapter" data-level="7.25.2" data-path="functions.html"><a href="functions.html#more-than-two-classes"><i class="fa fa-check"></i><b>7.25.2</b> More than Two Classes</a></li>
</ul></li>
<li class="chapter" data-level="7.26" data-path="functions.html"><a href="functions.html#nearest-neighbor-methods"><i class="fa fa-check"></i><b>7.26</b> Nearest Neighbor Methods</a>
<ul>
<li class="chapter" data-level="7.26.1" data-path="functions.html"><a href="functions.html#knn-and-the-diabetes-data"><i class="fa fa-check"></i><b>7.26.1</b> kNN and the Diabetes Data</a></li>
<li class="chapter" data-level="7.26.2" data-path="functions.html"><a href="functions.html#practice-problem-13"><i class="fa fa-check"></i><b>7.26.2</b> Practice Problem</a></li>
<li class="chapter" data-level="7.26.3" data-path="functions.html"><a href="functions.html#knn-and-the-iris-data"><i class="fa fa-check"></i><b>7.26.3</b> kNN and the iris Data</a></li>
</ul></li>
<li class="chapter" data-level="7.27" data-path="functions.html"><a href="functions.html#exercises-7"><i class="fa fa-check"></i><b>7.27</b> Exercises</a></li>
<li class="chapter" data-level="7.28" data-path="functions.html"><a href="functions.html#reading-text-data-into-r"><i class="fa fa-check"></i><b>7.28</b> Reading Text Data into R</a></li>
<li class="chapter" data-level="7.29" data-path="functions.html"><a href="functions.html#the-paste-function"><i class="fa fa-check"></i><b>7.29</b> The <code>paste</code> Function</a></li>
<li class="chapter" data-level="7.30" data-path="functions.html"><a href="functions.html#more-string-processing-functions"><i class="fa fa-check"></i><b>7.30</b> More String Processing Functions</a>
<ul>
<li class="chapter" data-level="7.30.1" data-path="functions.html"><a href="functions.html#tolower-and-toupper"><i class="fa fa-check"></i><b>7.30.1</b> <code>tolower</code> and <code>toupper</code></a></li>
<li class="chapter" data-level="7.30.2" data-path="functions.html"><a href="functions.html#nchar-and-strsplit"><i class="fa fa-check"></i><b>7.30.2</b> <code>nchar</code> and <code>strsplit</code></a></li>
<li class="chapter" data-level="7.30.3" data-path="functions.html"><a href="functions.html#practice-problem-14"><i class="fa fa-check"></i><b>7.30.3</b> Practice Problem</a></li>
<li class="chapter" data-level="7.30.4" data-path="functions.html"><a href="functions.html#nchar-again"><i class="fa fa-check"></i><b>7.30.4</b> <code>nchar</code> Again</a></li>
<li class="chapter" data-level="7.30.5" data-path="functions.html"><a href="functions.html#practice-problem-15"><i class="fa fa-check"></i><b>7.30.5</b> Practice Problem</a></li>
<li class="chapter" data-level="7.30.6" data-path="functions.html"><a href="functions.html#substr-and-strtrim"><i class="fa fa-check"></i><b>7.30.6</b> <code>substr</code> and <code>strtrim</code></a></li>
<li class="chapter" data-level="7.30.7" data-path="functions.html"><a href="functions.html#grep-and-related-functions"><i class="fa fa-check"></i><b>7.30.7</b> <code>grep</code> and Related Functions</a></li>
</ul></li>
<li class="chapter" data-level="7.31" data-path="functions.html"><a href="functions.html#exercises-8"><i class="fa fa-check"></i><b>7.31</b> Exercises</a></li>
<li class="chapter" data-level="7.32" data-path="functions.html"><a href="functions.html#getting-started-with-rcpp"><i class="fa fa-check"></i><b>7.32</b> Getting Started with Rcpp</a>
<ul>
<li class="chapter" data-level="7.32.1" data-path="functions.html"><a href="functions.html#installation"><i class="fa fa-check"></i><b>7.32.1</b> Installation</a></li>
<li class="chapter" data-level="7.32.2" data-path="functions.html"><a href="functions.html#the-simplest-c-example"><i class="fa fa-check"></i><b>7.32.2</b> The Simplest C++ Example</a></li>
</ul></li>
<li class="chapter" data-level="7.33" data-path="functions.html"><a href="functions.html#using-rcpp"><i class="fa fa-check"></i><b>7.33</b> Using Rcpp</a>
<ul>
<li class="chapter" data-level="7.33.1" data-path="functions.html"><a href="functions.html#exporting-c-functions"><i class="fa fa-check"></i><b>7.33.1</b> Exporting C++ Functions</a></li>
<li class="chapter" data-level="7.33.2" data-path="functions.html"><a href="functions.html#inline-c-code"><i class="fa fa-check"></i><b>7.33.2</b> Inline C++ Code</a></li>
</ul></li>
<li class="chapter" data-level="7.34" data-path="functions.html"><a href="functions.html#the-rcpp-interface"><i class="fa fa-check"></i><b>7.34</b> The Rcpp Interface</a></li>
<li class="chapter" data-level="7.35" data-path="functions.html"><a href="functions.html#no-input-and-scalar-output"><i class="fa fa-check"></i><b>7.35</b> No input and scalar output</a>
<ul>
<li class="chapter" data-level="7.35.1" data-path="functions.html"><a href="functions.html#scalar-input-and-scalar-output"><i class="fa fa-check"></i><b>7.35.1</b> Scalar input and scalar output</a></li>
<li class="chapter" data-level="7.35.2" data-path="functions.html"><a href="functions.html#vector-input-and-scalar-output"><i class="fa fa-check"></i><b>7.35.2</b> Vector input and scalar output</a></li>
<li class="chapter" data-level="7.35.3" data-path="functions.html"><a href="functions.html#vector-input-and-vector-output"><i class="fa fa-check"></i><b>7.35.3</b> Vector input and vector output</a></li>
<li class="chapter" data-level="7.35.4" data-path="functions.html"><a href="functions.html#matrix-input-and-vector-output"><i class="fa fa-check"></i><b>7.35.4</b> Matrix input and vector output</a></li>
<li class="chapter" data-level="7.35.5" data-path="functions.html"><a href="functions.html#matrix-input-and-matrix-output"><i class="fa fa-check"></i><b>7.35.5</b> Matrix input and matrix output</a></li>
</ul></li>
<li class="chapter" data-level="7.36" data-path="functions.html"><a href="functions.html#exercises-9"><i class="fa fa-check"></i><b>7.36</b> Exercises</a></li>
<li class="chapter" data-level="7.37" data-path="functions.html"><a href="functions.html#sql-and-database-structure"><i class="fa fa-check"></i><b>7.37</b> SQL and Database Structure</a>
<ul>
<li class="chapter" data-level="7.37.1" data-path="functions.html"><a href="functions.html#sql"><i class="fa fa-check"></i><b>7.37.1</b> SQL</a></li>
</ul></li>
<li class="chapter" data-level="7.38" data-path="functions.html"><a href="functions.html#difficulties-of-working-with-large-datasets"><i class="fa fa-check"></i><b>7.38</b> Difficulties of Working with Large Datasets</a></li>
<li class="chapter" data-level="7.39" data-path="functions.html"><a href="functions.html#using-dplyr-to-query-the-database"><i class="fa fa-check"></i><b>7.39</b> Using <code>dplyr</code> to Query the Database</a>
<ul>
<li class="chapter" data-level="7.39.1" data-path="functions.html"><a href="functions.html#example-with-rsqlite"><i class="fa fa-check"></i><b>7.39.1</b> Example with RSQLite</a></li>
<li class="chapter" data-level="7.39.2" data-path="functions.html"><a href="functions.html#dbplot"><i class="fa fa-check"></i><b>7.39.2</b> <code>dbplot</code></a></li>
<li class="chapter" data-level="7.39.3" data-path="functions.html"><a href="functions.html#using-google-bigquery"><i class="fa fa-check"></i><b>7.39.3</b> Using Google BigQuery</a></li>
</ul></li>
<li class="chapter" data-level="7.40" data-path="functions.html"><a href="functions.html#changing-records-in-the-database"><i class="fa fa-check"></i><b>7.40</b> Changing Records in the Database</a></li>
<li class="chapter" data-level="7.41" data-path="functions.html"><a href="functions.html#r-studio-connections-pane"><i class="fa fa-check"></i><b>7.41</b> R Studio Connections Pane</a></li>
<li class="chapter" data-level="7.42" data-path="functions.html"><a href="functions.html#further-resources"><i class="fa fa-check"></i><b>7.42</b> Further Resources</a></li>
<li class="chapter" data-level="7.43" data-path="functions.html"><a href="functions.html#exercises-10"><i class="fa fa-check"></i><b>7.43</b> Exercises</a></li>
<li class="chapter" data-level="7.44" data-path="functions.html"><a href="functions.html#introduction-to-digital-signal-processing"><i class="fa fa-check"></i><b>7.44</b> Introduction to Digital Signal Processing</a>
<ul>
<li class="chapter" data-level="7.44.1" data-path="functions.html"><a href="functions.html#sinusoidal-signals"><i class="fa fa-check"></i><b>7.44.1</b> Sinusoidal Signals</a></li>
</ul></li>
<li class="chapter" data-level="7.45" data-path="functions.html"><a href="functions.html#noise-and-filters"><i class="fa fa-check"></i><b>7.45</b> Noise and Filters</a></li>
<li class="chapter" data-level="7.46" data-path="functions.html"><a href="functions.html#fourier-transforms-and-spectrograms"><i class="fa fa-check"></i><b>7.46</b> Fourier Transforms and Spectrograms</a></li>
<li class="chapter" data-level="7.47" data-path="functions.html"><a href="functions.html#exercises-11"><i class="fa fa-check"></i><b>7.47</b> Exercises</a></li>
<li class="chapter" data-level="7.48" data-path="functions.html"><a href="functions.html#scatter-plots-1"><i class="fa fa-check"></i><b>7.48</b> Scatter Plots</a>
<ul>
<li class="chapter" data-level="7.48.1" data-path="functions.html"><a href="functions.html#adding-lines-to-a-scatter-plot-1"><i class="fa fa-check"></i><b>7.48.1</b> Adding lines to a scatter plot</a></li>
</ul></li>
<li class="chapter" data-level="7.49" data-path="functions.html"><a href="functions.html#labels-axes-text-etc.-1"><i class="fa fa-check"></i><b>7.49</b> Labels, Axes, Text, etc.</a>
<ul>
<li class="chapter" data-level="7.49.1" data-path="functions.html"><a href="functions.html#labels-1"><i class="fa fa-check"></i><b>7.49.1</b> Labels</a></li>
</ul></li>
<li class="chapter" data-level="7.50" data-path="functions.html"><a href="functions.html#customizing-axes-1"><i class="fa fa-check"></i><b>7.50</b> Customizing Axes</a>
<ul>
<li class="chapter" data-level="7.50.1" data-path="functions.html"><a href="functions.html#text-point-size-and-color-1"><i class="fa fa-check"></i><b>7.50.1</b> Text, Point Size, and Color</a></li>
</ul></li>
<li class="chapter" data-level="7.51" data-path="functions.html"><a href="functions.html#other-types-of-graphics-1"><i class="fa fa-check"></i><b>7.51</b> Other Types of Graphics</a>
<ul>
<li class="chapter" data-level="7.51.1" data-path="functions.html"><a href="functions.html#histograms-1"><i class="fa fa-check"></i><b>7.51.1</b> Histograms</a></li>
<li class="chapter" data-level="7.51.2" data-path="functions.html"><a href="functions.html#boxplots-1"><i class="fa fa-check"></i><b>7.51.2</b> Boxplots</a></li>
<li class="chapter" data-level="7.51.3" data-path="functions.html"><a href="functions.html#bar-graphs-1"><i class="fa fa-check"></i><b>7.51.3</b> Bar Graphs</a></li>
<li class="chapter" data-level="7.51.4" data-path="functions.html"><a href="functions.html#graphs-of-functions-1"><i class="fa fa-check"></i><b>7.51.4</b> Graphs of Functions</a></li>
</ul></li>
<li class="chapter" data-level="7.52" data-path="functions.html"><a href="functions.html#saving-graphics-1"><i class="fa fa-check"></i><b>7.52</b> Saving Graphics</a></li>
<li class="chapter" data-level="7.53" data-path="functions.html"><a href="functions.html#a-summary-of-useful-graphics-functions-and-arguments"><i class="fa fa-check"></i><b>7.53</b> A Summary of Useful <code>graphics</code> Functions and Arguments</a>
<ul>
<li class="chapter" data-level="7.53.1" data-path="functions.html"><a href="functions.html#practice-problem-16"><i class="fa fa-check"></i><b>7.53.1</b> Practice Problem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="stats.html"><a href="stats.html"><i class="fa fa-check"></i><b>8</b> Basic Statistics in <code>R</code></a>
<ul>
<li class="chapter" data-level="8.1" data-path="stats.html"><a href="stats.html#basics-of-linear-models"><i class="fa fa-check"></i><b>8.1</b> Basics of Linear Models</a></li>
<li class="chapter" data-level="8.2" data-path="stats.html"><a href="stats.html#one-way-analysis-of-variance-anova"><i class="fa fa-check"></i><b>8.2</b> One-Way Analysis of Variance (ANOVA)</a></li>
<li class="chapter" data-level="8.3" data-path="stats.html"><a href="stats.html#two-way-analyis-of-variance-anova"><i class="fa fa-check"></i><b>8.3</b> Two-Way Analyis of Variance (ANOVA)</a></li>
<li class="chapter" data-level="8.4" data-path="stats.html"><a href="stats.html#simple-linear-regression"><i class="fa fa-check"></i><b>8.4</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="8.5" data-path="stats.html"><a href="stats.html#multiple-linear-regression"><i class="fa fa-check"></i><b>8.5</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="8.6" data-path="stats.html"><a href="stats.html#regresion-diagnostics-and-model-selection"><i class="fa fa-check"></i><b>8.6</b> Regresion Diagnostics and Model Selection</a></li>
<li class="chapter" data-level="8.7" data-path="stats.html"><a href="stats.html#basic-linear-mixed-model"><i class="fa fa-check"></i><b>8.7</b> Basic Linear Mixed Model</a></li>
<li class="chapter" data-level="8.8" data-path="stats.html"><a href="stats.html#repeated-measures-design"><i class="fa fa-check"></i><b>8.8</b> Repeated Measures Design</a></li>
<li class="chapter" data-level="8.9" data-path="stats.html"><a href="stats.html#some-other-basic-statistical-tools"><i class="fa fa-check"></i><b>8.9</b> Some Other Basic Statistical Tools</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Programming for Data Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Functions and Programming</h1>
<p>We have been working with a wide variety of R functions, from simple functions such as <code>mean()</code> and <code>sd()</code> to more complex functions such as <code>ggplot()</code> and <code>apply()</code>. Gaining a better understanding of existing functions and the ability to write your own functions dramatically increases what we can do with R. Learning about R’s programming capabilities is an important step in gaining facility with functions.</p>
<div id="r-functions" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> R Functions</h2>
<p>Data on the yield (pounds per acre) of two types of corn seeds (regular and kiln dried) were collected. Each of the 11 plots of land was split into two subplots, and one of the subplots was planted in regular corn while the other was planted in kiln dried corn. These data were analyzed in a famous paper authored by William Gosset. Here are the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="functions.html#cb540-1"></a><span class="op">&gt;</span><span class="st"> </span>u.corn =<span class="st"> &quot;https://www.finley-lab.com/files/data/corn.csv&quot;</span></span>
<span id="cb540-2"><a href="functions.html#cb540-2"></a><span class="op">&gt;</span><span class="st"> </span>corn =<span class="st"> </span><span class="kw">read.csv</span>(u.corn, <span class="dt">header=</span><span class="ot">TRUE</span>)</span>
<span id="cb540-3"><a href="functions.html#cb540-3"></a><span class="op">&gt;</span><span class="st"> </span>corn</span></code></pre></div>
<pre><code>   regular kiln_dried
1     1903       2009
2     1935       1915
3     1910       2011
4     2496       2463
5     2108       2180
6     1961       1925
7     2060       2122
8     1444       1482
9     1612       1542
10    1316       1443
11    1511       1535</code></pre>
<p>A paired t test, or a confidence interval for the mean difference, may be used to assess the difference in yield between the two varieties. Of course R has a function <code>t.test</code> that performs a paired t test and computes a confidence interval, but we will perform the test without using that function. We will focus for now on testing the hypotheses <span class="math inline">\(H_0\colon \mu_d = 0\)</span> versus <span class="math inline">\(H_a\colon \mu_d \neq 0\)</span> and on a two-sided confidence interval for <span class="math inline">\(\mu_d\)</span>. Here <span class="math inline">\(\mu_d\)</span> represents the population mean difference.</p>
<p>The paired <span class="math inline">\(t\)</span> statistic is defined by
<span class="math display">\[\begin{equation}
t = \frac{\overline d}{S_d/\sqrt{n}}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\overline d\)</span> is the mean of the differences, <span class="math inline">\(S_d\)</span> is the standard deviation of the differences, and <span class="math inline">\(n\)</span> is the sample size. The p-value is twice the area to the right of <span class="math inline">\(|t_{\text{obs}}|\)</span>, where <span class="math inline">\(t_{\text{obs}}\)</span> is the observed <span class="math inline">\(t\)</span> statistic, and a confidence interval is given by
<span class="math display">\[\begin{equation}
\overline d \pm t^* (S_d/\sqrt{n}).
\end{equation}\]</span></p>
<p>Here <span class="math inline">\(t^*\)</span> is an appropriate quantile of a <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(n-1\)</span> degrees of freedom.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="functions.html#cb542-1"></a><span class="op">&gt;</span><span class="st"> </span>dbar &lt;-<span class="st"> </span><span class="kw">mean</span>(corn<span class="op">$</span>kiln_dried <span class="op">-</span><span class="st"> </span>corn<span class="op">$</span>regular)</span>
<span id="cb542-2"><a href="functions.html#cb542-2"></a><span class="op">&gt;</span><span class="st"> </span>n &lt;-<span class="st"> </span><span class="kw">length</span>(corn<span class="op">$</span>regular)</span>
<span id="cb542-3"><a href="functions.html#cb542-3"></a><span class="op">&gt;</span><span class="st"> </span>S_d &lt;-<span class="st"> </span><span class="kw">sd</span>(corn<span class="op">$</span>kiln_dried <span class="op">-</span><span class="st"> </span>corn<span class="op">$</span>regular)</span>
<span id="cb542-4"><a href="functions.html#cb542-4"></a><span class="op">&gt;</span><span class="st"> </span>t_obs &lt;-<span class="st"> </span>dbar<span class="op">/</span>(S_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb542-5"><a href="functions.html#cb542-5"></a><span class="op">&gt;</span><span class="st"> </span>t_obs</span></code></pre></div>
<pre><code>[1] 1.69</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="functions.html#cb544-1"></a><span class="op">&gt;</span><span class="st"> </span>pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(t_obs), n<span class="dv">-1</span>))</span>
<span id="cb544-2"><a href="functions.html#cb544-2"></a><span class="op">&gt;</span><span class="st"> </span>pval</span></code></pre></div>
<pre><code>[1] 0.1218</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="functions.html#cb546-1"></a><span class="op">&gt;</span><span class="st"> </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, n<span class="dv">-1</span>)<span class="op">*</span>(S_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb546-2"><a href="functions.html#cb546-2"></a><span class="op">&gt;</span><span class="st"> </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb546-3"><a href="functions.html#cb546-3"></a><span class="op">&gt;</span><span class="st"> </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb546-4"><a href="functions.html#cb546-4"></a><span class="op">&gt;</span><span class="st"> </span>lcl</span></code></pre></div>
<pre><code>[1] -10.73</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="functions.html#cb548-1"></a><span class="op">&gt;</span><span class="st"> </span>ucl</span></code></pre></div>
<pre><code>[1] 78.18</code></pre>
<p>With a few lines of R code we have calculated the t statistic, the p-value, and the confidence interval. Since paired t tests are pretty common, however, it would be helpful to automate this procedure. One obvious reason is to save time and effort, but another important reason is to avoid mistakes. It would be easy to make a mistake (e.g., using <span class="math inline">\(n\)</span> instead of <span class="math inline">\(n-1\)</span> as the degrees of freedom) when repeating the above computations.</p>
<p>Here is a first basic function which automates the computation.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="functions.html#cb550-1"></a><span class="op">&gt;</span><span class="st"> </span>paired_t &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2){</span>
<span id="cb550-2"><a href="functions.html#cb550-2"></a><span class="op">+</span><span class="st">     </span>n &lt;-<span class="st"> </span><span class="kw">length</span>(x1)</span>
<span id="cb550-3"><a href="functions.html#cb550-3"></a><span class="op">+</span><span class="st">     </span>dbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb550-4"><a href="functions.html#cb550-4"></a><span class="op">+</span><span class="st">     </span>s_d &lt;-<span class="st"> </span><span class="kw">sd</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb550-5"><a href="functions.html#cb550-5"></a><span class="op">+</span><span class="st">     </span>tstat &lt;-<span class="st"> </span>dbar<span class="op">/</span>(s_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb550-6"><a href="functions.html#cb550-6"></a><span class="op">+</span><span class="st">     </span>pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tstat), n<span class="dv">-1</span>))</span>
<span id="cb550-7"><a href="functions.html#cb550-7"></a><span class="op">+</span><span class="st">     </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb550-8"><a href="functions.html#cb550-8"></a><span class="op">+</span><span class="st">     </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb550-9"><a href="functions.html#cb550-9"></a><span class="op">+</span><span class="st">     </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb550-10"><a href="functions.html#cb550-10"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">tstat =</span> tstat, <span class="dt">pval =</span> pval, <span class="dt">lcl=</span>lcl, <span class="dt">ucl=</span>ucl))</span>
<span id="cb550-11"><a href="functions.html#cb550-11"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<p>And here is the function in action</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="functions.html#cb551-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(<span class="dt">x1 =</span> corn<span class="op">$</span>kiln_dried, <span class="dt">x2 =</span> corn<span class="op">$</span>regular)</span></code></pre></div>
<pre><code>$tstat
[1] 1.69

$pval
[1] 0.1218

$lcl
[1] -10.73

$ucl
[1] 78.18</code></pre>
<p>An explanation and comments on the function are in order.</p>
<ul>
<li><code>paired_t &lt;- function(x1, x2)</code> assigns a function of two variables, <code>x1</code> and <code>x2</code>, to an R object called <code>paired_t</code>.</li>
<li>The <em>compound expression</em>, i.e., the code that makes up the body of the function, is enclosed in curly braces <code>{}</code>.</li>
<li><code>return(list(tstat = tstat, pval = pval, lcl=lcl, ucl=ucl))</code> indicates the object(s) returned by the function. In this case the function returns a list with four components.</li>
<li>The body of the function basically mimics the computations required to compute the t statistic, the p-value, and the confidence interval.</li>
<li>Several objects such as <code>n</code> and <code>dbar</code> are created in the body of the function. These objects are NOT available outside the function. We will discuss this further when we cover environments and scope in R.</li>
</ul>
<p>Our function has automated the basic calculations. But it is still somewhat limited in usefulness. For example, it only computes a 95% confidence interval, while a user may want a different confidence level. And the function only performs a two-sided test, while a user may want a one-sided procedure. We modify the function slightly to allow the user to specify the confidence level next.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="functions.html#cb553-1"></a><span class="op">&gt;</span><span class="st"> </span>paired_t &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2, <span class="dt">cl =</span> <span class="fl">0.95</span>){</span>
<span id="cb553-2"><a href="functions.html#cb553-2"></a><span class="op">+</span><span class="st">     </span>n &lt;-<span class="st"> </span><span class="kw">length</span>(x1)</span>
<span id="cb553-3"><a href="functions.html#cb553-3"></a><span class="op">+</span><span class="st">     </span>dbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb553-4"><a href="functions.html#cb553-4"></a><span class="op">+</span><span class="st">     </span>s_d &lt;-<span class="st"> </span><span class="kw">sd</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb553-5"><a href="functions.html#cb553-5"></a><span class="op">+</span><span class="st">     </span>tstat &lt;-<span class="st"> </span>dbar<span class="op">/</span>(s_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb553-6"><a href="functions.html#cb553-6"></a><span class="op">+</span><span class="st">     </span>pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tstat), n<span class="dv">-1</span>))</span>
<span id="cb553-7"><a href="functions.html#cb553-7"></a><span class="op">+</span><span class="st">     </span>pctile &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>cl)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb553-8"><a href="functions.html#cb553-8"></a><span class="op">+</span><span class="st">     </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(pctile, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb553-9"><a href="functions.html#cb553-9"></a><span class="op">+</span><span class="st">     </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb553-10"><a href="functions.html#cb553-10"></a><span class="op">+</span><span class="st">     </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb553-11"><a href="functions.html#cb553-11"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">tstat =</span> tstat, <span class="dt">pval =</span> pval, <span class="dt">lcl =</span> lcl, <span class="dt">ucl=</span>ucl))</span>
<span id="cb553-12"><a href="functions.html#cb553-12"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="functions.html#cb554-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(corn<span class="op">$</span>kiln_dried, corn<span class="op">$</span>regular)</span></code></pre></div>
<pre><code>$tstat
[1] 1.69

$pval
[1] 0.1218

$lcl
[1] -10.73

$ucl
[1] 78.18</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="functions.html#cb556-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(corn<span class="op">$</span>kiln_dried, corn<span class="op">$</span>regular, <span class="dt">cl =</span> <span class="fl">0.99</span>)</span></code></pre></div>
<pre><code>$tstat
[1] 1.69

$pval
[1] 0.1218

$lcl
[1] -29.5

$ucl
[1] 96.96</code></pre>
<p>Two things to note. First, arguments do not have to be named. So</p>
<pre><code>paired_t(corn$kiln_dried, corn$regular)</code></pre>
<p>and</p>
<pre><code>paired_t(x1 = corn$kiln_dried, x2 = corn$regular)</code></pre>
<p>are equivalent. But we need to be careful if we do not name arguments because then we have to know the ordering of the arguments in the function declaration.</p>
<p>Second, in the declaration of the function, the third argument <code>cl</code> was given a default value of <code>0.95</code>. If a user does not specify a value for <code>cl</code> it will silently be set to <code>0.95</code>. But of course a user can override this, as we did in</p>
<pre><code>paired_t(corn$kiln_dried, corn$regular, cl = 0.99)</code></pre>
<div id="practice-problem-11" class="section level3" number="7.1.1">
<h3 number="7.1.1"><span class="header-section-number">7.1.1</span> Practice Problem</h3>
<p>Like all things in R, getting the hang of writing functions just requires practice. Create a simple function called <code>FtoK</code> that is given a temperature in Farenheit and converts it to Kelvin using the following formula</p>
<p><span class="math display">\[
K = (F - 32) * \frac{5}{9} + 273.15
\]</span></p>
<p>You should get the following if your function is correct</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="functions.html#cb561-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">FtoK</span>(<span class="dv">80</span>)</span></code></pre></div>
<pre><code>[1] 299.8</code></pre>
</div>
<div id="creating-functions" class="section level3" number="7.1.2">
<h3 number="7.1.2"><span class="header-section-number">7.1.2</span> Creating Functions</h3>
<p>Creating very short functions at the command prompt is a reasonable strategy. For longer functions, one option is to write the function in a script and then submit the whole function. Or a function can be written in any text editor, saved as a plain text file (possibly with a <code>.r</code> extension), and then read into R using the <code>source()</code> function.</p>
</div>
</div>
<div id="programming-conditional-statements" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> Programming: Conditional Statements</h2>
<p>The <code>paired_t</code> function is somewhat useful, but could be improved in several ways. For example, consider the following:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="functions.html#cb563-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>Warning in x1 - x2: longer object length is not a
multiple of shorter object length

Warning in x1 - x2: longer object length is not a
multiple of shorter object length</code></pre>
<pre><code>$tstat
[1] 1

$pval
[1] 0.3739

$lcl
[1] -1.421

$ucl
[1] 3.021</code></pre>
<p>The user specified data had different numbers of observations in <code>x1</code> and <code>x2</code>, which of course can’t be data tested by a paired t test. Rather than stopping and letting the user know that this is a problem, the function continued and produced meaningless output.</p>
<p>Also, the function as written only allows testing against a two-sided alternative hypothesis, and it would be good to allow one-sided alternatives.</p>
<p>First we will address some checks on arguments specified by the user. For this we will use an <code>if()</code> function and a <code>stop()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="functions.html#cb566-1"></a><span class="op">&gt;</span><span class="st"> </span>paired_t &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2, <span class="dt">cl =</span> <span class="fl">0.95</span>){</span>
<span id="cb566-2"><a href="functions.html#cb566-2"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(<span class="kw">length</span>(x1) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(x2)){</span>
<span id="cb566-3"><a href="functions.html#cb566-3"></a><span class="op">+</span><span class="st">         </span><span class="kw">stop</span>(<span class="st">&quot;The input vectors  must have the same length&quot;</span>)</span>
<span id="cb566-4"><a href="functions.html#cb566-4"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb566-5"><a href="functions.html#cb566-5"></a><span class="op">+</span><span class="st">     </span>n &lt;-<span class="st"> </span><span class="kw">length</span>(x1)</span>
<span id="cb566-6"><a href="functions.html#cb566-6"></a><span class="op">+</span><span class="st">     </span>dbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb566-7"><a href="functions.html#cb566-7"></a><span class="op">+</span><span class="st">     </span>s_d &lt;-<span class="st"> </span><span class="kw">sd</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb566-8"><a href="functions.html#cb566-8"></a><span class="op">+</span><span class="st">     </span>tstat &lt;-<span class="st"> </span>dbar<span class="op">/</span>(s_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb566-9"><a href="functions.html#cb566-9"></a><span class="op">+</span><span class="st">     </span>pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tstat), n<span class="dv">-1</span>))</span>
<span id="cb566-10"><a href="functions.html#cb566-10"></a><span class="op">+</span><span class="st">     </span>pctile &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>cl)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb566-11"><a href="functions.html#cb566-11"></a><span class="op">+</span><span class="st">     </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(pctile, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb566-12"><a href="functions.html#cb566-12"></a><span class="op">+</span><span class="st">     </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb566-13"><a href="functions.html#cb566-13"></a><span class="op">+</span><span class="st">     </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb566-14"><a href="functions.html#cb566-14"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">tstat =</span> tstat, <span class="dt">pval =</span> pval, <span class="dt">lcl =</span> lcl, <span class="dt">ucl=</span>ucl))</span>
<span id="cb566-15"><a href="functions.html#cb566-15"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb566-16"><a href="functions.html#cb566-16"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>Error in paired_t(1:5, 1:4): The input vectors  must have the same length</code></pre>
<p>The argument to the <code>if()</code> function is evaluated. If the argument returns <code>TRUE</code> the ensuing code is executed. Otherwise, the ensuing code is skipped and the rest of the function is evaluated. If a <code>stop()</code> function is executed, the function is exited and the argument of <code>stop()</code> is printed.</p>
<p>To better understand and use <code>if()</code> statements, we need to understand comparison operators and logical operators.</p>
<div id="comparison-and-logical-operators" class="section level3" number="7.2.1">
<h3 number="7.2.1"><span class="header-section-number">7.2.1</span> Comparison and Logical Operators</h3>
<p>We have made use of some of the comparison operators in R. These include</p>
<ul>
<li>Equal: <code>==</code></li>
<li>Not equal: <code>!=</code></li>
<li>Greater than: <code>&gt;</code></li>
<li>Less than: <code>&lt;</code></li>
<li>Greater than or equal to: <code>&gt;=</code></li>
<li>Less than or equal to: <code>&lt;=</code></li>
</ul>
<p>Special care needs to be taken with the <code>==</code> and <code>!=</code> operators because of how numbers are represented on computers, see Section <a href="functions.html#arith"><strong>??</strong></a>.</p>
<p>There are also three logical operators, with two variants of the “and” operator and the “or” operator.</p>
<ul>
<li>and: Either <code>&amp;</code> or <code>&amp;&amp;</code></li>
<li>or: Either <code>|</code> or <code>||</code></li>
<li>not: <code>!</code></li>
</ul>
<p>The “double” operators <code>&amp;&amp;</code> and <code>||</code> just examine the first element of the two vectors, whereas the “single” operators <code>&amp;</code> and <code>|</code> compare element by element.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="functions.html#cb568-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>) <span class="op">||</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="functions.html#cb570-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>) <span class="op">|</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>[1]  TRUE  TRUE FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="functions.html#cb572-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="functions.html#cb574-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>) <span class="op">&amp;</span><span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
<p>We can use the logical operators to check whether a user-specified confidence level is between 0 and 1.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="functions.html#cb576-1"></a><span class="op">&gt;</span><span class="st"> </span>paired_t &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2, <span class="dt">cl =</span> <span class="fl">0.95</span>){</span>
<span id="cb576-2"><a href="functions.html#cb576-2"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(<span class="kw">length</span>(x1) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(x2)){</span>
<span id="cb576-3"><a href="functions.html#cb576-3"></a><span class="op">+</span><span class="st">         </span><span class="kw">stop</span>(<span class="st">&quot;The input vectors  must have the same length&quot;</span>)</span>
<span id="cb576-4"><a href="functions.html#cb576-4"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb576-5"><a href="functions.html#cb576-5"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(cl <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>cl <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb576-6"><a href="functions.html#cb576-6"></a><span class="op">+</span><span class="st">         </span><span class="kw">stop</span>(<span class="st">&quot;The confidence level must be between 0 and 1&quot;</span>)</span>
<span id="cb576-7"><a href="functions.html#cb576-7"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb576-8"><a href="functions.html#cb576-8"></a><span class="op">+</span><span class="st">     </span>n &lt;-<span class="st"> </span><span class="kw">length</span>(x1)</span>
<span id="cb576-9"><a href="functions.html#cb576-9"></a><span class="op">+</span><span class="st">     </span>dbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb576-10"><a href="functions.html#cb576-10"></a><span class="op">+</span><span class="st">     </span>s_d &lt;-<span class="st"> </span><span class="kw">sd</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb576-11"><a href="functions.html#cb576-11"></a><span class="op">+</span><span class="st">     </span>tstat &lt;-<span class="st"> </span>dbar<span class="op">/</span>(s_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb576-12"><a href="functions.html#cb576-12"></a><span class="op">+</span><span class="st">     </span>pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tstat), n<span class="dv">-1</span>))</span>
<span id="cb576-13"><a href="functions.html#cb576-13"></a><span class="op">+</span><span class="st">     </span>pctile &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>cl)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb576-14"><a href="functions.html#cb576-14"></a><span class="op">+</span><span class="st">     </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(pctile, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb576-15"><a href="functions.html#cb576-15"></a><span class="op">+</span><span class="st">     </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb576-16"><a href="functions.html#cb576-16"></a><span class="op">+</span><span class="st">     </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb576-17"><a href="functions.html#cb576-17"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">tstat =</span> tstat, <span class="dt">pval =</span> pval, <span class="dt">lcl =</span> lcl, <span class="dt">ucl=</span>ucl))</span>
<span id="cb576-18"><a href="functions.html#cb576-18"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb576-19"><a href="functions.html#cb576-19"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">cl=</span><span class="dv">15</span>)</span></code></pre></div>
<pre><code>Error in paired_t(1:5, 2:6, cl = 15): The confidence level must be between 0 and 1</code></pre>
</div>
<div id="if-else-statements" class="section level3" number="7.2.2">
<h3 number="7.2.2"><span class="header-section-number">7.2.2</span> If else statements</h3>
<p>The <code>if()</code> statement we have used so far has the form</p>
<pre><code>if (condition) {
  expression
}</code></pre>
<p>Often we want to evaluate one expression if the condition is true, and evaluate a different expression if the condition is false. That is accomplished by the <code>if else</code> statement. Here we determine whether a number is positive, negative, or zero.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="functions.html#cb579-1"></a><span class="op">&gt;</span><span class="st"> </span>Sign &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb579-2"><a href="functions.html#cb579-2"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb579-3"><a href="functions.html#cb579-3"></a><span class="op">+</span><span class="st">         </span><span class="kw">print</span>(<span class="st">&quot;the number is negative&quot;</span>)</span>
<span id="cb579-4"><a href="functions.html#cb579-4"></a><span class="op">+</span><span class="st">     </span>}<span class="cf">else</span> <span class="cf">if</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb579-5"><a href="functions.html#cb579-5"></a><span class="op">+</span><span class="st">         </span><span class="kw">print</span>(<span class="st">&quot;the number is positive&quot;</span>)</span>
<span id="cb579-6"><a href="functions.html#cb579-6"></a><span class="op">+</span><span class="st">     </span>}<span class="cf">else</span>{</span>
<span id="cb579-7"><a href="functions.html#cb579-7"></a><span class="op">+</span><span class="st">         </span><span class="kw">print</span>(<span class="st">&quot;the number is zero&quot;</span>)</span>
<span id="cb579-8"><a href="functions.html#cb579-8"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb579-9"><a href="functions.html#cb579-9"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb579-10"><a href="functions.html#cb579-10"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">Sign</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>[1] &quot;the number is positive&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="functions.html#cb581-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">Sign</span>(<span class="op">-</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>[1] &quot;the number is negative&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="functions.html#cb583-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">Sign</span>(<span class="dv">0</span>)</span></code></pre></div>
<pre><code>[1] &quot;the number is zero&quot;</code></pre>
<p>Notice the “different expression” for the first <code>if</code> statement was itself an <code>if</code> statement.</p>
<p>Next we modify the <code>paired_t</code> function to allow two-sided and one-sided alternatives.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="functions.html#cb585-1"></a><span class="op">&gt;</span><span class="st"> </span>paired_t &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2, <span class="dt">cl =</span> <span class="fl">0.95</span>, <span class="dt">alternative=</span><span class="st">&quot;not.equal&quot;</span>){</span>
<span id="cb585-2"><a href="functions.html#cb585-2"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(<span class="kw">length</span>(x1) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(x2)){</span>
<span id="cb585-3"><a href="functions.html#cb585-3"></a><span class="op">+</span><span class="st">         </span><span class="kw">stop</span>(<span class="st">&quot;The input vectors must be of the same length&quot;</span>)</span>
<span id="cb585-4"><a href="functions.html#cb585-4"></a><span class="op">+</span><span class="st">         </span>}</span>
<span id="cb585-5"><a href="functions.html#cb585-5"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(cl <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>cl <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb585-6"><a href="functions.html#cb585-6"></a><span class="op">+</span><span class="st">         </span><span class="kw">stop</span>(<span class="st">&quot;The confidence level must be between 0 and 1&quot;</span>)</span>
<span id="cb585-7"><a href="functions.html#cb585-7"></a><span class="op">+</span><span class="st">         </span>}</span>
<span id="cb585-8"><a href="functions.html#cb585-8"></a><span class="op">+</span><span class="st">     </span>n &lt;-<span class="st"> </span><span class="kw">length</span>(x1)</span>
<span id="cb585-9"><a href="functions.html#cb585-9"></a><span class="op">+</span><span class="st">     </span>dbar &lt;-<span class="st"> </span><span class="kw">mean</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb585-10"><a href="functions.html#cb585-10"></a><span class="op">+</span><span class="st">     </span>s_d &lt;-<span class="st"> </span><span class="kw">sd</span>(x1 <span class="op">-</span><span class="st"> </span>x2)</span>
<span id="cb585-11"><a href="functions.html#cb585-11"></a><span class="op">+</span><span class="st">     </span>tstat &lt;-<span class="st"> </span>dbar<span class="op">/</span>(s_d<span class="op">/</span><span class="kw">sqrt</span>(n))</span>
<span id="cb585-12"><a href="functions.html#cb585-12"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(alternative <span class="op">==</span><span class="st"> &quot;not.equal&quot;</span>){</span>
<span id="cb585-13"><a href="functions.html#cb585-13"></a><span class="op">+</span><span class="st">         </span>pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(tstat), n<span class="dv">-1</span>))</span>
<span id="cb585-14"><a href="functions.html#cb585-14"></a><span class="op">+</span><span class="st">         </span>pctile &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>cl)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb585-15"><a href="functions.html#cb585-15"></a><span class="op">+</span><span class="st">         </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(pctile, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb585-16"><a href="functions.html#cb585-16"></a><span class="op">+</span><span class="st">         </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb585-17"><a href="functions.html#cb585-17"></a><span class="op">+</span><span class="st">         </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb585-18"><a href="functions.html#cb585-18"></a><span class="op">+</span><span class="st">     </span>}<span class="cf">else</span> <span class="cf">if</span>(alternative <span class="op">==</span><span class="st"> &quot;greater&quot;</span>){</span>
<span id="cb585-19"><a href="functions.html#cb585-19"></a><span class="op">+</span><span class="st">         </span>pval &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(tstat, n<span class="dv">-1</span>)</span>
<span id="cb585-20"><a href="functions.html#cb585-20"></a><span class="op">+</span><span class="st">         </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(cl, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb585-21"><a href="functions.html#cb585-21"></a><span class="op">+</span><span class="st">         </span>lcl &lt;-<span class="st"> </span>dbar <span class="op">-</span><span class="st"> </span>margin</span>
<span id="cb585-22"><a href="functions.html#cb585-22"></a><span class="op">+</span><span class="st">         </span>ucl &lt;-<span class="st"> </span><span class="ot">Inf</span></span>
<span id="cb585-23"><a href="functions.html#cb585-23"></a><span class="op">+</span><span class="st">     </span>} <span class="cf">else</span> <span class="cf">if</span>(alternative <span class="op">==</span><span class="st"> &quot;less&quot;</span>){</span>
<span id="cb585-24"><a href="functions.html#cb585-24"></a><span class="op">+</span><span class="st">         </span>pval &lt;-<span class="st"> </span><span class="kw">pt</span>(tstat, n<span class="dv">-1</span>)</span>
<span id="cb585-25"><a href="functions.html#cb585-25"></a><span class="op">+</span><span class="st">         </span>margin &lt;-<span class="st"> </span><span class="kw">qt</span>(cl, n<span class="dv">-1</span>)<span class="op">*</span>s_d<span class="op">/</span><span class="kw">sqrt</span>(n)</span>
<span id="cb585-26"><a href="functions.html#cb585-26"></a><span class="op">+</span><span class="st">         </span>lcl &lt;-<span class="st"> </span><span class="op">-</span><span class="ot">Inf</span></span>
<span id="cb585-27"><a href="functions.html#cb585-27"></a><span class="op">+</span><span class="st">         </span>ucl &lt;-<span class="st"> </span>dbar <span class="op">+</span><span class="st"> </span>margin</span>
<span id="cb585-28"><a href="functions.html#cb585-28"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb585-29"><a href="functions.html#cb585-29"></a><span class="op">+</span><span class="st">     </span></span>
<span id="cb585-30"><a href="functions.html#cb585-30"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">tstat =</span> tstat, <span class="dt">pval =</span> pval, <span class="dt">lcl=</span>lcl, <span class="dt">ucl=</span>ucl))</span>
<span id="cb585-31"><a href="functions.html#cb585-31"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb585-32"><a href="functions.html#cb585-32"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(corn<span class="op">$</span>kiln_dried, corn<span class="op">$</span>regular)</span></code></pre></div>
<pre><code>$tstat
[1] 1.69

$pval
[1] 0.1218

$lcl
[1] -10.73

$ucl
[1] 78.18</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="functions.html#cb587-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(corn<span class="op">$</span>kiln_dried, corn<span class="op">$</span>regular, <span class="dt">alternative =</span> <span class="st">&quot;less&quot;</span>)</span></code></pre></div>
<pre><code>$tstat
[1] 1.69

$pval
[1] 0.9391

$lcl
[1] -Inf

$ucl
[1] 69.89</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="functions.html#cb589-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paired_t</span>(corn<span class="op">$</span>kiln_dried, corn<span class="op">$</span>regular, <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span></code></pre></div>
<pre><code>$tstat
[1] 1.69

$pval
[1] 0.06091

$lcl
[1] -2.434

$ucl
[1] Inf</code></pre>
</div>
</div>
<div id="arith" class="section level2" number="7.3">
<h2 number="7.3"><span class="header-section-number">7.3</span> Computer Arithmetic</h2>
<p>Like most software, R does not perform exact arithmetic. Rather, R follows the IEEE 754 floating point standards. This can have profound effects on how computational algorithms are implemented, but is also important when considering things like comparisons.</p>
<p>Note first that computer arithmetic does not follow some of the rules of ordinary arithmetic. For example, it is not associative.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="functions.html#cb591-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">^-</span><span class="dv">30</span></span></code></pre></div>
<pre><code>[1] 0.0000000009313</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="functions.html#cb593-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span><span class="op">^-</span><span class="dv">30</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span><span class="op">^</span><span class="dv">30</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span><span class="dv">30</span>)</span></code></pre></div>
<pre><code>[1] 0.0000000009313</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="functions.html#cb595-1"></a><span class="op">&gt;</span><span class="st"> </span>(<span class="dv">2</span><span class="op">^-</span><span class="dv">30</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span><span class="dv">30</span>) <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">^</span><span class="dv">30</span></span></code></pre></div>
<pre><code>[1] 0</code></pre>
<p>Computer arithmetic is not exact.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="functions.html#cb597-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">-</span><span class="st"> </span><span class="fl">1.4</span></span></code></pre></div>
<pre><code>[1] 0.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="functions.html#cb599-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">-</span><span class="st"> </span><span class="fl">1.4</span> <span class="op">==</span><span class="st"> </span><span class="fl">0.1</span></span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="functions.html#cb601-1"></a><span class="op">&gt;</span><span class="st"> </span>(<span class="fl">1.5</span> <span class="op">-</span><span class="st"> </span><span class="fl">1.4</span>) <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span></span></code></pre></div>
<pre><code>[1] 0.00000000000000008327</code></pre>
<p>So for example an <code>if</code> statement that uses an equality test may not give the expected answer. One way to avoid this problem is to test “near equality” using <code>all.equal()</code>. The function takes as arguments two objects to be compared, and a tolerance. If the objects are within the tolerance of each other, the function returns <code>TRUE</code>. The tolerance has a default value of about <span class="math inline">\(1.5\times 10^{-8}\)</span>, which works well in many cases.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="functions.html#cb603-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">all.equal</span>((<span class="fl">1.5</span> <span class="op">-</span><span class="st"> </span><span class="fl">1.4</span>), <span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
</div>
<div id="loops" class="section level2" number="7.4">
<h2 number="7.4"><span class="header-section-number">7.4</span> Loops</h2>
<p>Loops are an important component of any programming language, including R. Vectorized calculations and functions such as <code>apply()</code> make loops a bit less central to R than to many other languages, but an understanding of the three looping structures in R is still quite important.</p>
<p>We will investigate loops in the context of computing what is sometimes called the “machine epsilon.” Because of the inexact representation of numbers in R (and other languages) sometimes R cannot distinguish between the numbers <code>1</code> and <code>|1 + x|</code> for small values of <code>x</code>. The smallest value of <code>x</code> such that <code>1</code> and <code>|1+x|</code> are not declared equal is the machine epsilon.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="functions.html#cb605-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span><span class="op">+</span><span class="dv">10</span><span class="op">^-</span><span class="dv">4</span></span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="functions.html#cb607-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">50</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>Clearly the machine epsilon is somewhere between <span class="math inline">\(10^{-4}\)</span> and <span class="math inline">\(10^{-50}\)</span>. How can we find its value exactly? Since floating point numbers use a binary representation, we know that the machine epsilon will be equal to <span class="math inline">\(1/2^k\)</span> for some value of <span class="math inline">\(k\)</span>. So to find the machine epsilon, we can keep testing whether <span class="math inline">\(1\)</span> and <span class="math inline">\(1+1/2^k\)</span> are equal, until we find a value <span class="math inline">\(k\)</span> where the two are equal. Then the machine epsilon will be <span class="math inline">\(1/2^{k-1}\)</span>, since it is the smallest value for which the two are NOT equal.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="functions.html#cb609-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span></span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="functions.html#cb611-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="functions.html#cb613-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">^</span><span class="dv">3</span></span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<p>Testing by hand like this gets tedious quickly. A loop can automate the process. We will do this with two R loop types, <code>repeat</code> and <code>while</code>.</p>
<div id="a-repeat-loop" class="section level3" number="7.4.1">
<h3 number="7.4.1"><span class="header-section-number">7.4.1</span> A Repeat Loop</h3>
<p>A <code>repeat</code> loop just repeats a given expression over and over again until a <code>break</code> statement is encountered.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="functions.html#cb615-1"></a><span class="op">&gt;</span><span class="st"> </span>k &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb615-2"><a href="functions.html#cb615-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">repeat</span>{</span>
<span id="cb615-3"><a href="functions.html#cb615-3"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">^</span>k){</span>
<span id="cb615-4"><a href="functions.html#cb615-4"></a><span class="op">+</span><span class="st">         </span><span class="cf">break</span></span>
<span id="cb615-5"><a href="functions.html#cb615-5"></a><span class="op">+</span><span class="st">     </span>}<span class="cf">else</span>{</span>
<span id="cb615-6"><a href="functions.html#cb615-6"></a><span class="op">+</span><span class="st">         </span>k &lt;-<span class="st"> </span>k<span class="op">+</span><span class="dv">1</span></span>
<span id="cb615-7"><a href="functions.html#cb615-7"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb615-8"><a href="functions.html#cb615-8"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb615-9"><a href="functions.html#cb615-9"></a><span class="op">&gt;</span><span class="st"> </span>k</span></code></pre></div>
<pre><code>[1] 53</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="functions.html#cb617-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">^</span>(k<span class="dv">-1</span>)</span></code></pre></div>
<pre><code>[1] 0.000000000000000222</code></pre>
<p>This code initializes <code>k</code> at 1. The body of the loop initially checks whether <span class="math inline">\(1\)</span> and <span class="math inline">\(1+1/2^k\)</span> are equal. If they are equal, the <code>break</code> statement is executed and control is transferred outside the loop. If they are not equal, <code>k</code> is increased by 1, and we return to the beginning of the top of the body of the loop.</p>
</div>
<div id="a-while-loop" class="section level3" number="7.4.2">
<h3 number="7.4.2"><span class="header-section-number">7.4.2</span> A While Loop</h3>
<p>A <code>while</code> loop has the form</p>
<pre><code>while (condition) {
  expression
}</code></pre>
<p>As long as the <code>condition</code> is <code>TRUE</code> the <code>expression</code> is evaluated. Once the <code>condition</code> is <code>FALSE</code> control is transferred outside the loop.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="functions.html#cb620-1"></a><span class="op">&gt;</span><span class="st"> </span>k &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb620-2"><a href="functions.html#cb620-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">while</span>(<span class="dv">1</span> <span class="op">!=</span><span class="st"> </span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">^</span>k){</span>
<span id="cb620-3"><a href="functions.html#cb620-3"></a><span class="op">+</span><span class="st">     </span>k &lt;-<span class="st"> </span>k<span class="op">+</span><span class="dv">1</span> </span>
<span id="cb620-4"><a href="functions.html#cb620-4"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb620-5"><a href="functions.html#cb620-5"></a><span class="op">&gt;</span><span class="st"> </span>k</span></code></pre></div>
<pre><code>[1] 53</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="functions.html#cb622-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">^</span>(k<span class="dv">-1</span>)</span></code></pre></div>
<pre><code>[1] 0.000000000000000222</code></pre>
</div>
<div id="a-for-loop" class="section level3" number="7.4.3">
<h3 number="7.4.3"><span class="header-section-number">7.4.3</span> A For Loop</h3>
<p>A <code>for</code> loop has the form</p>
<pre><code>for (variable in vector) {
  expression
}</code></pre>
<p>The <code>for</code> loop sets the <code>variable</code> equal to each element of the <code>vector</code> in succession, and evaluates the <code>expression</code> each time. Here are two different ways to use a <code>for</code> loop to calculate the sum of the elements in a vector.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="functions.html#cb625-1"></a><span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb625-2"><a href="functions.html#cb625-2"></a><span class="op">&gt;</span><span class="st"> </span>S &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb625-3"><a href="functions.html#cb625-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)){</span>
<span id="cb625-4"><a href="functions.html#cb625-4"></a><span class="op">+</span><span class="st">     </span>S &lt;-<span class="st"> </span>S <span class="op">+</span><span class="st"> </span>x[i]</span>
<span id="cb625-5"><a href="functions.html#cb625-5"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb625-6"><a href="functions.html#cb625-6"></a><span class="op">&gt;</span><span class="st"> </span>S</span></code></pre></div>
<pre><code>[1] 55</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="functions.html#cb627-1"></a><span class="op">&gt;</span><span class="st"> </span>S =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb627-2"><a href="functions.html#cb627-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">for</span>(value <span class="cf">in</span> x){</span>
<span id="cb627-3"><a href="functions.html#cb627-3"></a><span class="op">+</span><span class="st">   </span>S =<span class="st"> </span>S <span class="op">+</span><span class="st"> </span>value</span>
<span id="cb627-4"><a href="functions.html#cb627-4"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb627-5"><a href="functions.html#cb627-5"></a><span class="op">&gt;</span><span class="st"> </span>S</span></code></pre></div>
<pre><code>[1] 55</code></pre>
<p>In the first case we loop over the positions of the vector elements, while in the second case we loop over the elements themselves.</p>
</div>
<div id="practice-problem-12" class="section level3" number="7.4.4">
<h3 number="7.4.4"><span class="header-section-number">7.4.4</span> Practice Problem</h3>
<p>Often when students initially learn about <code>if()</code> statements and <code>for()</code> loops, they use them more often than is necessary, leading to over complications and often slower, less sophisticated code. Many simple <code>if()</code> statements can be accomplished using logical subsetting and vectorization. Using the ideas you used above, and what you learned in Chapters <a href="structures.html#structures"><strong>??</strong></a> and <a href="data2.html#data2"><strong>??</strong></a>, we can use logical subsetting to replace the simplest of <code>if()</code> statements. Rewrite the following <code>if()</code> statement and <code>for()</code> loop using logical subsetting.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="functions.html#cb629-1"></a><span class="op">&gt;</span><span class="st"> </span>a &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb629-2"><a href="functions.html#cb629-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(a)) {</span>
<span id="cb629-3"><a href="functions.html#cb629-3"></a><span class="op">&gt;</span><span class="st">   </span><span class="cf">if</span> (a[i] <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb629-4"><a href="functions.html#cb629-4"></a><span class="op">&gt;</span><span class="st">     </span>a[i] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb629-5"><a href="functions.html#cb629-5"></a><span class="op">&gt;</span><span class="st">   </span>}</span>
<span id="cb629-6"><a href="functions.html#cb629-6"></a><span class="op">&gt;</span><span class="st"> </span>}</span></code></pre></div>
</div>
</div>
<div id="efficiency-considerations" class="section level2" number="7.5">
<h2 number="7.5"><span class="header-section-number">7.5</span> Efficiency Considerations</h2>
<p>In many contexts R and modern computers are fast enough that the user does not need to worry about writing efficient code. There are a few simple ways to write efficient code that are easy enough, and provide enough speed-up, that they are worth following as often as possible. The R function <code>system.time()</code> reports how long a set of R code takes to execute, and we will use this function to compare different ways to accomplish objectives in R.</p>
<div id="growing-objects" class="section level3" number="7.5.1">
<h3 number="7.5.1"><span class="header-section-number">7.5.1</span> Growing Objects</h3>
<p>Consider two ways to create a sequence of integers from 1 to n, implemented in functions <code>f1</code> and <code>f2</code>.</p>
<ol style="list-style-type: decimal">
<li>Start with a zero-length vector, and let it grow:</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="functions.html#cb630-1"></a><span class="op">&gt;</span><span class="st"> </span>f1 &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb630-2"><a href="functions.html#cb630-2"></a><span class="op">+</span><span class="st">     </span>x &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb630-3"><a href="functions.html#cb630-3"></a><span class="op">+</span><span class="st">     </span><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</span>
<span id="cb630-4"><a href="functions.html#cb630-4"></a><span class="op">+</span><span class="st">         </span>x &lt;-<span class="st"> </span><span class="kw">c</span>(x,i)</span>
<span id="cb630-5"><a href="functions.html#cb630-5"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb630-6"><a href="functions.html#cb630-6"></a><span class="op">+</span><span class="st">     </span>x</span>
<span id="cb630-7"><a href="functions.html#cb630-7"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Start with a vector of length <span class="math inline">\(n\)</span> and fill in the values:</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="functions.html#cb631-1"></a><span class="op">&gt;</span><span class="st"> </span>f2 &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb631-2"><a href="functions.html#cb631-2"></a><span class="op">+</span><span class="st">     </span>x &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</span>
<span id="cb631-3"><a href="functions.html#cb631-3"></a><span class="op">+</span><span class="st">     </span><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</span>
<span id="cb631-4"><a href="functions.html#cb631-4"></a><span class="op">+</span><span class="st">         </span>x[i] &lt;-<span class="st"> </span>i</span>
<span id="cb631-5"><a href="functions.html#cb631-5"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb631-6"><a href="functions.html#cb631-6"></a><span class="op">+</span><span class="st">     </span>x</span>
<span id="cb631-7"><a href="functions.html#cb631-7"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<p>Here are the two functions in action, with <span class="math inline">\(n = 100000\)</span>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="functions.html#cb632-1"></a><span class="op">&gt;</span><span class="st"> </span>n &lt;-<span class="st"> </span><span class="dv">100000</span></span>
<span id="cb632-2"><a href="functions.html#cb632-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="kw">f1</span>(n))</span></code></pre></div>
<pre><code>   user  system elapsed 
 11.393   0.036  11.432 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="functions.html#cb634-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="kw">f2</span>(n))</span></code></pre></div>
<pre><code>   user  system elapsed 
  0.014   0.000   0.015 </code></pre>
<p>It is <em>much</em> more efficient to start with a full-length vector and then fill in values.<a href="references.html#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a></p>
<p>Of course another way to create a vector of integers from 1 to n is to use <code>1:n</code>. Let’s see how fast this is.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="functions.html#cb636-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="dv">1</span><span class="op">:</span>n)</span></code></pre></div>
<pre><code>   user  system elapsed 
      0       0       0 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="functions.html#cb638-1"></a><span class="op">&gt;</span><span class="st"> </span>n &lt;-<span class="st"> </span><span class="dv">1000000</span></span>
<span id="cb638-2"><a href="functions.html#cb638-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="dv">1</span><span class="op">:</span>n)      </span></code></pre></div>
<pre><code>   user  system elapsed 
      0       0       0 </code></pre>
<p>For <span class="math inline">\(n=100000\)</span> this is so fast the system time is very close to zero. Even when <span class="math inline">\(n\)</span> is 1000000 the time is very small. So another important lesson is to use built-in R functions whenever possible, since they have had substantial development focused on efficiency, correctness, etc.</p>
</div>
<div id="vectorization" class="section level3" number="7.5.2">
<h3 number="7.5.2"><span class="header-section-number">7.5.2</span> Vectorization</h3>
<p>Next consider calculating the sum of the squared entries in each column of a matrix. For example with the matrix <span class="math inline">\(M\)</span>,</p>
<p><span class="math display">\[
M = \left(\begin{array}{ccc}
1 &amp; 2 &amp; 3 \\
4 &amp; 5 &amp; 6
\end{array}\right),
\]</span></p>
<p>the sums would be <span class="math inline">\(1^2 + 4^2 = 17\)</span>, <span class="math inline">\(2^2 + 5^2 = 29\)</span>, and <span class="math inline">\(3^2 + 6^2 = 45\)</span>.
One possibility is to have an outer loop that traverses the columns and an inner loop that traverses the rows within a column, squaring the entries and adding them together.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="functions.html#cb640-1"></a><span class="op">&gt;</span><span class="st"> </span>test_matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</span>
<span id="cb640-2"><a href="functions.html#cb640-2"></a><span class="op">&gt;</span><span class="st"> </span>test_matrix</span></code></pre></div>
<pre><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="functions.html#cb642-1"></a><span class="op">&gt;</span><span class="st"> </span>ss1 &lt;-<span class="st"> </span><span class="cf">function</span>(M){</span>
<span id="cb642-2"><a href="functions.html#cb642-2"></a><span class="op">+</span><span class="st">     </span>n &lt;-<span class="st"> </span><span class="kw">dim</span>(M)[<span class="dv">1</span>]</span>
<span id="cb642-3"><a href="functions.html#cb642-3"></a><span class="op">+</span><span class="st">     </span>m &lt;-<span class="st"> </span><span class="kw">dim</span>(M)[<span class="dv">2</span>]</span>
<span id="cb642-4"><a href="functions.html#cb642-4"></a><span class="op">+</span><span class="st">     </span>out &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>,m)</span>
<span id="cb642-5"><a href="functions.html#cb642-5"></a><span class="op">+</span><span class="st">     </span><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb642-6"><a href="functions.html#cb642-6"></a><span class="op">+</span><span class="st">         </span><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n){</span>
<span id="cb642-7"><a href="functions.html#cb642-7"></a><span class="op">+</span><span class="st">             </span>out[j] &lt;-<span class="st"> </span>out[j] <span class="op">+</span><span class="st"> </span>M[i,j]<span class="op">^</span><span class="dv">2</span></span>
<span id="cb642-8"><a href="functions.html#cb642-8"></a><span class="op">+</span><span class="st">         </span>} </span>
<span id="cb642-9"><a href="functions.html#cb642-9"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb642-10"><a href="functions.html#cb642-10"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(out)</span>
<span id="cb642-11"><a href="functions.html#cb642-11"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb642-12"><a href="functions.html#cb642-12"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ss1</span>(test_matrix)</span></code></pre></div>
<pre><code>[1] 17 29 45</code></pre>
<p>Another possibility eliminates the inner loop, using the <code>sum()</code> function to compute the sum of the squared entries in the column directly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="functions.html#cb644-1"></a><span class="op">&gt;</span><span class="st"> </span>ss2 &lt;-<span class="st"> </span><span class="cf">function</span>(M){</span>
<span id="cb644-2"><a href="functions.html#cb644-2"></a><span class="op">+</span><span class="st">     </span>m &lt;-<span class="st"> </span><span class="kw">dim</span>(M)[<span class="dv">2</span>]</span>
<span id="cb644-3"><a href="functions.html#cb644-3"></a><span class="op">+</span><span class="st">     </span>out &lt;-<span class="st"> </span><span class="kw">numeric</span>(m)</span>
<span id="cb644-4"><a href="functions.html#cb644-4"></a><span class="op">+</span><span class="st">     </span><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>m){</span>
<span id="cb644-5"><a href="functions.html#cb644-5"></a><span class="op">+</span><span class="st">         </span>out[j] &lt;-<span class="st"> </span><span class="kw">sum</span>(M[,j]<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb644-6"><a href="functions.html#cb644-6"></a><span class="op">+</span><span class="st">     </span>}</span>
<span id="cb644-7"><a href="functions.html#cb644-7"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(out) </span>
<span id="cb644-8"><a href="functions.html#cb644-8"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb644-9"><a href="functions.html#cb644-9"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ss2</span>(test_matrix)</span></code></pre></div>
<pre><code>[1] 17 29 45</code></pre>
<p>A third possibility uses the <code>colSums()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="functions.html#cb646-1"></a><span class="op">&gt;</span><span class="st"> </span>ss3 &lt;-<span class="st"> </span><span class="cf">function</span>(M){</span>
<span id="cb646-2"><a href="functions.html#cb646-2"></a><span class="op">+</span><span class="st">     </span>out &lt;-<span class="st"> </span><span class="kw">colSums</span>(M<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb646-3"><a href="functions.html#cb646-3"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(out)</span>
<span id="cb646-4"><a href="functions.html#cb646-4"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb646-5"><a href="functions.html#cb646-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ss3</span>(test_matrix)</span></code></pre></div>
<pre><code>[1] 17 29 45</code></pre>
<p>Here is a speed comparison, using a <span class="math inline">\(1000\times 10000\)</span> matrix.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="functions.html#cb648-1"></a><span class="op">&gt;</span><span class="st"> </span>mm &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10000000</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">1000</span>)</span>
<span id="cb648-2"><a href="functions.html#cb648-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="kw">ss1</span>(mm))</span></code></pre></div>
<pre><code>   user  system elapsed 
  2.454   0.000   2.454 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="functions.html#cb650-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="kw">ss2</span>(mm))</span></code></pre></div>
<pre><code>   user  system elapsed 
  0.080   0.016   0.096 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="functions.html#cb652-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">system.time</span>(<span class="kw">ss3</span>(mm))</span></code></pre></div>
<pre><code>   user  system elapsed 
  0.128   0.024   0.152 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="functions.html#cb654-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">rm</span>(mm)</span></code></pre></div>
</div>
</div>
<div id="more-on-functions" class="section level2" number="7.6">
<h2 number="7.6"><span class="header-section-number">7.6</span> More on Functions</h2>
<p>Understanding functions deeply requires a careful study of R’s scoping rules, as well as a good understanding of environments in R. That’s beyond the scope of this book, but we will briefly discuss some issues that are most salient. For a more in-depth treatment, see “Advanced R” by Hadley Wickham, especially the chapters on functions and environments.</p>
</div>
<div id="calling-functions" class="section level2" number="7.7">
<h2 number="7.7"><span class="header-section-number">7.7</span> Calling Functions</h2>
<p>When using a function, the functions arguments can be specified in three ways:</p>
<ol style="list-style-type: decimal">
<li>By the full name of the argument.</li>
<li>By the position of the argument.</li>
<li>By a partial name of the argument.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="functions.html#cb655-1"></a><span class="op">&gt;</span><span class="st"> </span>tmp_function &lt;-<span class="st"> </span><span class="cf">function</span>(first.arg, second.arg, third.arg, fourth.arg){</span>
<span id="cb655-2"><a href="functions.html#cb655-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">c</span>(first.arg, second.arg, third.arg, fourth.arg))</span>
<span id="cb655-3"><a href="functions.html#cb655-3"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb655-4"><a href="functions.html#cb655-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tmp_function</span>(<span class="dv">34</span>, <span class="dv">15</span>, <span class="dt">third.arg =</span> <span class="dv">11</span>, <span class="dt">fou =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>[1] 34 15 11 99</code></pre>
<p>Positional matching of arguments is convenient, but should be used carefully, and probably limited to the first few, and most commonly used, arguments in a function. Partial does have pitfalls. A partially specified argument must unambiguously match exactly one argument—a requirement that’s not met below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="functions.html#cb657-1"></a><span class="op">&gt;</span><span class="st"> </span>tmp_function &lt;-<span class="st"> </span><span class="cf">function</span>(first.arg, fourth.arg){</span>
<span id="cb657-2"><a href="functions.html#cb657-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(<span class="kw">c</span>(first.arg, fourth.arg))</span>
<span id="cb657-3"><a href="functions.html#cb657-3"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb657-4"><a href="functions.html#cb657-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tmp_function</span>(<span class="dv">1</span>, <span class="dt">f=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>Error in tmp_function(1, f = 2): argument 2 matches multiple formal arguments</code></pre>
<div id="the-...-argument" class="section level3" number="7.7.1">
<h3 number="7.7.1"><span class="header-section-number">7.7.1</span> The <code>...</code> argument</h3>
<p>In defining a function, a special argument denoted by <code>...</code> can be used. Sometimes this is called the “ellipsis” argument, sometimes the “three dot” argument, sometimes the “dot dot dot” argument, etc. The R language definition <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-lang.html</a> describes the argument in this way:</p>
<blockquote>
<p>The special type of argument `…’ can contain any number of supplied arguments. It is used for a variety of purposes. It allows you to write a function that takes an arbitrary number of arguments. It can be used to absorb some arguments into an intermediate function which can then be extracted by functions called subsequently.</p>
</blockquote>
<p>Consider for example the <code>sum()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="functions.html#cb659-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sum</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>[1] 15</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="functions.html#cb661-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sum</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">90</span>))</span></code></pre></div>
<pre><code>[1] 112</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="functions.html#cb663-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sum</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">90</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>[1] 118</code></pre>
<p>Think about writing such a function. There is no way to predict in advance the number of arguments a user might specify. So the function is defined with <code>...</code> as the first argument:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb665-1"><a href="functions.html#cb665-1"></a><span class="op">&gt;</span><span class="st"> </span>sum</span></code></pre></div>
<pre><code>function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</code></pre>
<p>This is true of many commonly-used functions in R such as <code>c()</code> among others.</p>
<p>Next, consider a function that calls another function in its body. For example, suppose that a collaborator always supplies comma delimited files that have five lines of description, followed by a line containing variable names, followed by the data. You are tired of having to specify <code>skip = 5</code>, <code>header = TRUE</code>, and <code>sep = ","</code> to <code>read.table()</code> and want to create a function <code>my.read()</code> which uses these as defaults.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="functions.html#cb667-1"></a><span class="op">&gt;</span><span class="st"> </span>my.read &lt;-<span class="st"> </span><span class="cf">function</span>(file, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">skip =</span> <span class="dv">5</span>, ...){</span>
<span id="cb667-2"><a href="functions.html#cb667-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">read.table</span>(<span class="dt">file =</span> file, <span class="dt">header =</span> header, <span class="dt">sep =</span> sep, <span class="dt">skip =</span> skip, ...)</span>
<span id="cb667-3"><a href="functions.html#cb667-3"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<p>The <code>...</code> in the definition of <code>my.read()</code> allows the user to specify other arguments, for example, <code>stringsAsFactors = FALSE</code>. These will be passed on to the <code>read.table()</code> function. In fact, that is how <code>read.csv()</code> is defined.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="functions.html#cb668-1"></a><span class="op">&gt;</span><span class="st"> </span>read.csv</span></code></pre></div>
<pre><code>function (file, header = TRUE, sep = &quot;,&quot;, quote = &quot;\&quot;&quot;, dec = &quot;.&quot;, 
    fill = TRUE, comment.char = &quot;&quot;, ...) 
read.table(file = file, header = header, sep = sep, quote = quote, 
    dec = dec, fill = fill, comment.char = comment.char, ...)
&lt;bytecode: 0x55aa277c09d0&gt;
&lt;environment: namespace:utils&gt;</code></pre>
</div>
<div id="lazy-evaluation" class="section level3" number="7.7.2">
<h3 number="7.7.2"><span class="header-section-number">7.7.2</span> Lazy Evaluation</h3>
<p>Arguments to R functions are not evaluated until they are needed, sometimes called <em>lazy</em> evaluation.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="functions.html#cb670-1"></a><span class="op">&gt;</span><span class="st"> </span>f &lt;-<span class="st"> </span><span class="cf">function</span>(a,b){</span>
<span id="cb670-2"><a href="functions.html#cb670-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">print</span>(a<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb670-3"><a href="functions.html#cb670-3"></a><span class="op">+</span><span class="st">     </span><span class="kw">print</span>(a<span class="op">^</span><span class="dv">3</span>)</span>
<span id="cb670-4"><a href="functions.html#cb670-4"></a><span class="op">+</span><span class="st">     </span><span class="kw">print</span>(a<span class="op">*</span>b)</span>
<span id="cb670-5"><a href="functions.html#cb670-5"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb670-6"><a href="functions.html#cb670-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">f</span>(<span class="dt">a=</span><span class="dv">3</span>, <span class="dt">b=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 9
[1] 27
[1] 6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="functions.html#cb672-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">f</span>(<span class="dt">a=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>[1] 9
[1] 27</code></pre>
<pre><code>Error in print(a * b): argument &quot;b&quot; is missing, with no default</code></pre>
<p>The first call specified both of the arguments <code>a</code> and <code>b</code>, and produced the expected output. In the second call the argument <code>b</code> was not specified. Since it was not needed until the third <code>print</code> statement, R happily executed the first two <code>print</code> statements, and only reported an error in the third statement, when <code>b</code> was needed to compute <code>a*b</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="functions.html#cb675-1"></a><span class="op">&gt;</span><span class="st"> </span>f &lt;-<span class="st"> </span><span class="cf">function</span>(a,<span class="dt">b =</span> a<span class="op">^</span><span class="dv">3</span>){</span>
<span id="cb675-2"><a href="functions.html#cb675-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">return</span>(a<span class="op">*</span>b)</span>
<span id="cb675-3"><a href="functions.html#cb675-3"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb675-4"><a href="functions.html#cb675-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">f</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="functions.html#cb677-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">f</span>(<span class="dv">2</span>,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>[1] 20</code></pre>
<p>In the first call, since <code>b</code> was not specified, it was computed as <code>a^3</code>. In the second call, <code>b</code> was specified, and the specified value was used.</p>
</div>
</div>
<div id="exercises-4" class="section level2" number="7.8">
<h2 number="7.8"><span class="header-section-number">7.8</span> Exercises</h2>
<p><strong>Exercise 10</strong> Learning objectives: translate statistical notation into coded functions; learn about tools for checking validity of function arguments; practice writing functions that return multiple objects.</p>

<p>_# Spatial Data Visualization and Analysis {#sp}</p>
</div>
<div id="overview" class="section level2" number="7.9">
<h2 number="7.9"><span class="header-section-number">7.9</span> Overview</h2>
<p>Recall, a data structure is a format for organizing and storing data. The structure is designed so that data can be accessed and worked with in specific ways. Statistical software and programming languages have methods (or functions) designed to operate on different kinds of data structures.</p>
<p>This chapter focuses on spatial data structures and some of the R functions that work with these data. Spatial data comprise values associated with locations, such as temperature data at a given latitude, longitude, and perhaps elevation. Spatial data are typically organized into <strong>vector</strong> or <strong>raster</strong> data types. (See Figure <a href="functions.html#fig:raster">12</a>).</p>
<ul>
<li>Vector data represent features such as discrete points, lines, and polygons.</li>
<li>Raster data represent surfaces as a rectangular matrix of square cells or pixels.</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:raster"></span>
<img src="../figures/Raster_vector_tikz.png" alt="Raster/Vector Comparison [@imageRaster]" width="100%" />
<p class="caption">
FIGURE 12: Raster/Vector Comparison <span class="citation">(Wegmann <a href="references.html#ref-imageRaster" role="doc-biblioref">2010</a>)</span>
</p>
</div>
<p>Whether or not you use vector or raster data depends on the type of problem, the type of maps you need, and the data source. Each data structure has strengths and weaknesses in terms of functionality and representation. As you gain more experience working with spatial data, you will be able to determine which structure to use for a particular application.</p>
<p>There is a large set of R packages available for working with spatial (and space-time) data. These packages are described in the <a href="https://CRAN.R-project.org/view=Spatial">Cran Task View: Analysis of Spatial Data</a>. The CRAN task view attempts to organize the various packages into categories, such as <em>Handling spatial data</em>, <em>Reading and writing spatial data</em>, <em>Visualization</em>, and <em>Disease mapping and areal data analysis</em>, so users can quickly identify package options given their project needs.</p>
<p>Exploring the extent of the excellent spatial data tools available in R is beyond the scope of this book. Rather, we would point you to subject texts like <em>Applied Spatial Data Analysis with R</em> by <span class="citation">Bivand, Pebesma, and Gomez-Rubio (<a href="references.html#ref-Bivand13" role="doc-biblioref">2013</a>)</span> (available for free via the MSU library system), and numerous online tutorials on pretty much any aspect of spatial data analysis with R. These tools make R a full-blown <a href="https://en.wikipedia.org/wiki/Geographic_information_system">Geographic Information System</a> (GIS) capable of spatial data manipulation and analysis on par with commercial GIS systems such as <a href="http://www.esri.com/arcgis/about-arcgis">ESRI’s ArcGIS</a>.</p>
<div id="some-spatial-data-packages" class="section level3" number="7.9.1">
<h3 number="7.9.1"><span class="header-section-number">7.9.1</span> Some Spatial Data Packages</h3>
<p>This chapter will focus on a few R packages for manipulating and visualizing spatial data. Specifically we will touch on the following packages</p>
<ul>
<li><code>sp</code>: spatial data structures and methods</li>
<li><code>rgdal</code>: interface to the C/C<code>++</code> spatial data Geospatial Data Abstraction Library</li>
<li><code>ggmap</code>: extends <code>ggplot2</code> language to handle spatial data</li>
<li><code>leaflet</code>: generates dynamic online maps</li>
</ul>
</div>
</div>
<div id="motivating-data" class="section level2" number="7.10">
<h2 number="7.10"><span class="header-section-number">7.10</span> Motivating Data</h2>
<p>We motivate the topics introduced in this chapter using some forestry data from the <a href="https://www.nrs.fs.fed.us/ef/locations/me/penobscot%7D%7BPenobscot%20Experimental%20Forest">Penobscot Experimental Forest</a> (PEF) located in Maine. The PEF is a long-term experimental forest that is used to understand the effects of silviculture (i.e., science of tending trees) treatments on forest growth and composition. The PEF is divided into non-overlapping management units that receive different harvesting treatments. Within each management unit is a series of observation point locations (called forest inventory plots) where forest variables have been measured. Ultimately, we want to summarize the inventory plots measurements by management unit and map the results.</p>
</div>
<div id="reading-spatial-data-into-r" class="section level2" number="7.11">
<h2 number="7.11"><span class="header-section-number">7.11</span> Reading Spatial Data into R</h2>
<p>Spatial data come in a variety of file formats. Examples of popular vector file formats for points, lines, and polygons, include ESRI’s <a href="https://en.wikipedia.org/wiki/Shapefile">shapefile</a> and open standard <a href="https://en.wikipedia.org/wiki/GeoJSON">GeoJSON</a>. Common raster file formats include <a href="https://en.wikipedia.org/wiki/GeoTIFF">GeoTIFF</a> and <a href="https://en.wikipedia.org/wiki/NetCDF">netCDF</a><a href="references.html#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a>.</p>
<p>The <code>rgdal</code> function <code>readOGR</code> will read a large variety of vector data file formats (there is also a <code>writeOGR()</code> for writing vector data files). Raster data file formats can be read using the <code>rgdal</code> function <code>readGDAL</code> (yup, also a <code>writeGDAL()</code>) or read functions in the <code>raster</code> package. All of these functions automatically cast the data into an appropriate R spatial data object (i.e., data structure), which are defined in the <code>sp</code> or <code>raster</code> packages. Table <a href="functions.html#tab:spatialObjs">4</a> provides an abbreviated list of these R spatial objects<a href="references.html#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a>. The <em>Without attributes </em>column gives the <code>sp</code> package’s spatial data object classes for points, lines, polygons, and raster pixels that do not have data associated with the spatial objects (i.e., without attributes in GIS speak). <code>DataFrame</code> is appended to the object class name once data, in the form of variables, are added to the spatial object.</p>
<table>
<caption><span id="tab:spatialObjs">TABLE 4: </span>An abbreviated list of <code>sp</code> and <code>raster</code> data objects and associated classes for the fundamental spatial data types</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">Without Attributes</th>
<th align="left">With Attributes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Polygons</td>
<td align="left">SpatialPolygons</td>
<td align="left">SpatialPolygonsDataFrame</td>
</tr>
<tr class="even">
<td>Points</td>
<td align="left">SpatialPoints</td>
<td align="left">SpatialPointsDataFrame</td>
</tr>
<tr class="odd">
<td>Lines</td>
<td align="left">SpatialLines</td>
<td align="left">SpatialLinesDataFrame</td>
</tr>
<tr class="even">
<td>Raster</td>
<td align="left">SpatialGrid</td>
<td align="left">SpatialGridDataFrame</td>
</tr>
<tr class="odd">
<td>Raster</td>
<td align="left">SpatialPixels</td>
<td align="left">SpatialPixelsDataFrame</td>
</tr>
<tr class="even">
<td>Raster</td>
<td align="left"></td>
<td align="left">RasterLayer</td>
</tr>
<tr class="odd">
<td>Raster</td>
<td align="left"></td>
<td align="left">RasterBrick</td>
</tr>
<tr class="even">
<td>Raster</td>
<td align="left"></td>
<td align="left">RasterStack</td>
</tr>
</tbody>
</table>
<p>You can create your own spatial data objects in R. Below, for example, we create a <code>SpatialPoints</code> object consisting of four points. Then add some data to the points to make it a <code>SpatialPointsDataFrame</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="functions.html#cb679-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(sp)</span>
<span id="cb679-2"><a href="functions.html#cb679-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb679-3"><a href="functions.html#cb679-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb679-4"><a href="functions.html#cb679-4"></a><span class="er">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb679-5"><a href="functions.html#cb679-5"></a><span class="op">&gt;</span><span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)</span>
<span id="cb679-6"><a href="functions.html#cb679-6"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb679-7"><a href="functions.html#cb679-7"></a><span class="er">&gt;</span><span class="st"> </span>coords &lt;-<span class="st"> </span><span class="kw">cbind</span>(x, y)</span>
<span id="cb679-8"><a href="functions.html#cb679-8"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb679-9"><a href="functions.html#cb679-9"></a><span class="er">&gt;</span><span class="st"> </span>sp.pts &lt;-<span class="st"> </span><span class="kw">SpatialPoints</span>(coords)</span>
<span id="cb679-10"><a href="functions.html#cb679-10"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb679-11"><a href="functions.html#cb679-11"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">class</span>(sp.pts)</span></code></pre></div>
<pre><code>[1] &quot;SpatialPoints&quot;
attr(,&quot;package&quot;)
[1] &quot;sp&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="functions.html#cb681-1"></a><span class="op">&gt;</span><span class="st"> </span>some.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">var.1 =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>), <span class="dt">var.2 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb681-2"><a href="functions.html#cb681-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb681-3"><a href="functions.html#cb681-3"></a><span class="er">&gt;</span><span class="st"> </span>sp.pts.df &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(sp.pts, some.data)</span>
<span id="cb681-4"><a href="functions.html#cb681-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb681-5"><a href="functions.html#cb681-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">class</span>(sp.pts.df)</span></code></pre></div>
<pre><code>[1] &quot;SpatialPointsDataFrame&quot;
attr(,&quot;package&quot;)
[1] &quot;sp&quot;</code></pre>
<p>If, for example, you already have a data frame that includes the spatial coordinate columns and other variables, then you can promote it to a <code>SpatialPointsDataFrame</code> by indicating which columns contain point coordinates. You can extract or access the data frame associated with the spatial object using <code>@data</code>. You can also access individual variables directly from the spatial object using <code>$</code> or by name or column number to the right of the comma in <code>[,]</code> (analogues to accessing variables in a data frame).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="functions.html#cb683-1"></a><span class="op">&gt;</span><span class="st"> </span>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>), <span class="dt">var.1 =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>), <span class="dt">var.2 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb683-2"><a href="functions.html#cb683-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">class</span>(df)</span></code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="functions.html#cb685-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co">#promote to a SpatialPointsDataFrame</span></span>
<span id="cb685-2"><a href="functions.html#cb685-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">coordinates</span>(df) &lt;-<span class="st"> </span><span class="er">~</span>x<span class="op">+</span>y</span>
<span id="cb685-3"><a href="functions.html#cb685-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb685-4"><a href="functions.html#cb685-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">class</span>(df)</span></code></pre></div>
<pre><code>[1] &quot;SpatialPointsDataFrame&quot;
attr(,&quot;package&quot;)
[1] &quot;sp&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="functions.html#cb687-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co">#access entire data frame</span></span>
<span id="cb687-2"><a href="functions.html#cb687-2"></a><span class="er">&gt;</span><span class="st"> </span>df<span class="op">@</span>data</span></code></pre></div>
<pre><code>  var.1 var.2
1     a     1
2     b     2
3     c     3
4     d     4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="functions.html#cb689-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">class</span>(df<span class="op">@</span>data)</span></code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="functions.html#cb691-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co">#access columns directly</span></span>
<span id="cb691-2"><a href="functions.html#cb691-2"></a><span class="er">&gt;</span><span class="st"> </span>df<span class="op">$</span>var<span class="fl">.1</span></span></code></pre></div>
<pre><code>[1] a b c d
Levels: a b c d</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="functions.html#cb693-1"></a><span class="op">&gt;</span><span class="st"> </span>df[,<span class="kw">c</span>(<span class="st">&quot;var.1&quot;</span>,<span class="st">&quot;var.2&quot;</span>)]</span></code></pre></div>
<pre><code>  coordinates var.1 var.2
1      (3, 2)     a     1
2      (2, 5)     b     2
3      (5, 6)     c     3
4      (6, 7)     d     4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="functions.html#cb695-1"></a><span class="op">&gt;</span><span class="st"> </span>df[,<span class="dv">2</span>]</span></code></pre></div>
<pre><code>  coordinates var.2
1      (3, 2)     1
2      (2, 5)     2
3      (5, 6)     3
4      (6, 7)     4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="functions.html#cb697-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co">#get the bounding box</span></span>
<span id="cb697-2"><a href="functions.html#cb697-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">bbox</span>(df)</span></code></pre></div>
<pre><code>  min max
x   2   6
y   2   7</code></pre>
<p>Here, the data frame <code>df</code> is promoted to a <code>SpatialPointsDataFrame</code> by indicating the column names that hold the longitude and latitude (i.e., <code>x</code> and <code>y</code> respectively) using the <code>coordinates</code> function. Here too, the <code>@data</code> is used to retrieve the data frame associated with the points. We also illustrate how variables can be accessed directly from the spatial object. The <code>bbox</code> function is used to return the bounding box that is defined by the spatial extent of the point coordinates. The other spatial objects noted in Table <a href="functions.html#tab:spatialObjs">4</a> can be created, and their data accessed, in a similar way<a href="references.html#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a>.</p>
<p>More than often we find ourselves reading existing spatial data files into R. The code below uses the <code>downloader</code> package to download all of the PEF data we’ll use in this chapter. The data are compressed in a single zip file, which is then extracted into the working directory using the <code>unzip</code> function. A look into the PEF directory using <code>list.files</code> shows nine files<a href="references.html#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a>. Those named <code>MU-bounds.*</code> comprise the shapefile that holds the PEF’s management unit boundaries in the form of polygons. Like other spatial data file formats, shapefiles are made up of several different files (with different file extensions) that are linked together to form a spatial data object. The <code>plots.csv</code> file holds the spatial coordinates and other information about the PEF’s forest inventory plots. The <code>roads.*</code> shapefile holds roads and trails in and around the PEF.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="functions.html#cb699-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(downloader)</span>
<span id="cb699-2"><a href="functions.html#cb699-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb699-3"><a href="functions.html#cb699-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">download</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/PEF.zip&quot;</span>, </span>
<span id="cb699-4"><a href="functions.html#cb699-4"></a><span class="op">+</span><span class="st">          </span><span class="dt">destfile=</span><span class="st">&quot;./PEF.zip&quot;</span>, <span class="dt">mode=</span><span class="st">&quot;wb&quot;</span>) </span>
<span id="cb699-5"><a href="functions.html#cb699-5"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb699-6"><a href="functions.html#cb699-6"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">unzip</span>(<span class="st">&quot;PEF.zip&quot;</span>, <span class="dt">exdir =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb699-7"><a href="functions.html#cb699-7"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb699-8"><a href="functions.html#cb699-8"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;PEF&quot;</span>)</span></code></pre></div>
<pre><code> [1] &quot;MU-bounds.dbf&quot; &quot;MU-bounds.prj&quot; &quot;MU-bounds.qpj&quot;
 [4] &quot;MU-bounds.shp&quot; &quot;MU-bounds.shx&quot; &quot;plots.csv&quot;    
 [7] &quot;plots.dbf&quot;     &quot;plots.prj&quot;     &quot;plots.qpj&quot;    
[10] &quot;plots.shp&quot;     &quot;plots.shx&quot;     &quot;roads.dbf&quot;    
[13] &quot;roads.prj&quot;     &quot;roads.shp&quot;     &quot;roads.shx&quot;    </code></pre>
<p>Next we read the MU-bounds shapefile into R using <code>readOGR()</code><a href="references.html#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a> and explore the resulting <code>mu</code> object. Notice that when we read a shapefile into R, we do not include a file extension with the shapefile name because a shapefile is always composed of multiple files.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="functions.html#cb701-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(rgdal)</span></code></pre></div>
<pre><code>rgdal: version: 1.4-4, (SVN revision 833)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20
 Path to GDAL shared files: /usr/share/gdal/2.2
 GDAL binary built with GEOS: TRUE 
 Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.3-1 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="functions.html#cb703-1"></a><span class="op">&gt;</span><span class="st"> </span>mu &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;PEF&quot;</span>, <span class="st">&quot;MU-bounds&quot;</span>)</span></code></pre></div>
<pre><code>OGR data source with driver: ESRI Shapefile 
Source: &quot;/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/PEF&quot;, layer: &quot;MU-bounds&quot;
with 40 features
It has 1 fields</code></pre>
<p>When called, the <code>readOGR</code> function provides a bit of information about the object being read in. Here, we see that it read the MU-bounds shapefile from PEF directory and the shapefile had 40 features (i.e., polygons) and 1 field (i.e., field is synonymous with column or variable in the data frame).</p>
<p>You can think of the resulting <code>mu</code> object as a data frame where each row corresponds to a polygon and each column holds information about the polygon<a href="references.html#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a>. More specifically, the <code>mu</code> object is a <code>SpatialPolygonsDataFrame</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="functions.html#cb705-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">class</span>(mu)</span></code></pre></div>
<pre><code>[1] &quot;SpatialPolygonsDataFrame&quot;
attr(,&quot;package&quot;)
[1] &quot;sp&quot;</code></pre>
<p>As illustrated using the made-up point data in the example above, you can access the data frame associated with the polygons using <code>@data</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="functions.html#cb707-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">class</span>(mu<span class="op">@</span>data)</span></code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="functions.html#cb709-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">dim</span>(mu<span class="op">@</span>data)</span></code></pre></div>
<pre><code>[1] 40  1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="functions.html#cb711-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(mu<span class="op">@</span>data)</span></code></pre></div>
<pre><code>  mu_id
0   C15
1   C17
2   C16
3   C27
4   U18
5   U31</code></pre>
<p>Above, a call to <code>class()</code> confirms we have accessed the data frame, <code>dim()</code> shows there are 40 rows (one row for each polygon) and one column, and <code>head()</code> shows the first six values of the column named <code>mu_id</code>. The <code>mu_id</code> values are unique identifiers for each management unit polygon across the PEF.</p>
</div>
<div id="coordinate-reference-systems" class="section level2" number="7.12">
<h2 number="7.12"><span class="header-section-number">7.12</span> Coordinate Reference Systems</h2>
<p>One of the more challenging aspects of working with spatial data is getting used to the idea of a coordinate reference system. A <em>coordinate reference system</em> (CRS) is a system that uses one or more numbers, or coordinates, to uniquely determine the position of a point or other geometric element (e.g., line, polygon, raster). For spatial data, there are two common coordinate systems:</p>
<ol style="list-style-type: decimal">
<li>Spherical coordinate system, such as latitude-longitude, often referred to as a <em>geographic coordinate system</em>.</li>
<li>Projected coordinate system based on a map projection, which is a systematic transformation of the latitudes and longitudes that aims to minimize distortion occurring from projecting maps of the earth’s spherical surface onto a two-dimensional Cartesian coordinate plane. Projected coordinate systems are sometimes referred to as <em>map projections</em>.</li>
</ol>
<p>There are numerous map projections<a href="references.html#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a>. One of the more frustrating parts of working with spatial data is that it seems like each data source you find offers its data in a different map projection and hence you spend a great deal of time <em>reprojecting</em> (i.e., transforming from one CRS to another) data into a common CRS such that they overlay correctly. Reprojecting is accomplished using the <code>sp</code> package’s <code>spTransform</code> function as demonstrated in Section <a href="functions.html#ggmap"><strong>??</strong></a>.</p>
<p>In R, a spatial object’s CRS is accessed via the <code>sp</code> package <code>proj4string</code> function. The code below shows the current projection of <code>mu</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="functions.html#cb713-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">proj4string</span>(mu)</span></code></pre></div>
<pre><code>[1] &quot;+proj=utm +zone=19 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0&quot;</code></pre>
<p>The cryptic looking string returned by <code>proj4string()</code> is a set of directives understood by the <a href="http://proj4.org/">proj.4</a> C library, which is part of <code>sp</code>, and used to map geographic longitude and latitude coordinates into the projected Cartesian coordinates. This CRS tells us the <code>mu</code> object is in <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">Universal Transverse Mercator (UTM)</a> zone 19 coordinate system.<a href="references.html#fn45" class="footnote-ref" id="fnref45"><sup>45</sup></a></p>
</div>
<div id="ggmap" class="section level2" number="7.13">
<h2 number="7.13"><span class="header-section-number">7.13</span> Illustration using <code>ggmap</code></h2>
<p>Let’s begin by making a map of PEF management unit boundaries over top of a satellite image using the <code>ggmap</code> package. Given an address, location, or bounding box, the <code>ggmap</code> package’s <code>get_map</code> function will query Google Maps, OpenStreetMap, Stamen Maps, or Naver Map servers for a user-specified map type. The <code>get_map</code> function requires the location or bounding box coordinates be in a geographic coordinate system (i.e., latitude-longitude). This means we need to reproject <code>mu</code> from UTM zone 19 to latitude-longitude geographic coordinates, which is defined by the <code>'"proj=longlat +datum=WGS84"'</code> proj.4 string. As seen below, the first argument in <code>spTransform</code> function is the spatial object to reproject and the second argument is a CRS object created by passing a proj.4 string into the <code>CRS</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="functions.html#cb715-1"></a><span class="op">&gt;</span><span class="st"> </span>mu &lt;-<span class="st"> </span><span class="kw">spTransform</span>(mu, <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>))</span>
<span id="cb715-2"><a href="functions.html#cb715-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">proj4string</span>(mu)</span></code></pre></div>
<pre><code>[1] &quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;</code></pre>
<p>Unfortunately, we cannot just feed the <code>SpatialPolygonsDataFrame</code> <code>mu</code> into <code>ggplot</code> (perhaps some day soon this will possible). Rather, we need to first convert the <code>SpatialPolygonsDataFrame</code> into a specially formatted data frame using the <code>fortify</code> function that is part of the <code>ggplot2</code> package<a href="references.html#fn46" class="footnote-ref" id="fnref46"><sup>46</sup></a>. The <code>fortify</code> function will also need a unique identifier for each polygon specified using the <code>region</code> argument, which for <code>mu</code> is the <code>mu_id</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="functions.html#cb717-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggmap)</span>
<span id="cb717-2"><a href="functions.html#cb717-2"></a><span class="op">&gt;</span><span class="st"> </span>mu.f &lt;-<span class="st"> </span><span class="kw">fortify</span>(mu, <span class="dt">region=</span><span class="st">&quot;mu_id&quot;</span>)</span>
<span id="cb717-3"><a href="functions.html#cb717-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(mu.f)</span></code></pre></div>
<pre><code>    long   lat order  hole piece  id group
1 -68.62 44.86     1 FALSE     1 C12 C12.1
2 -68.62 44.86     2 FALSE     1 C12 C12.1
3 -68.62 44.86     3 FALSE     1 C12 C12.1
4 -68.62 44.86     4 FALSE     1 C12 C12.1
5 -68.62 44.86     5 FALSE     1 C12 C12.1
6 -68.62 44.86     6 FALSE     1 C12 C12.1</code></pre>
<p>Notice the <code>id</code> column in the fortified version of <code>mu</code> holds each polygon’s <code>mu_id</code> value (this will be important later when we link data to the polygons).</p>
<p>Next, we query the satellite imagery used to underlay the management units (we’ll generally refer to this underlying map as the basemap). As of October 2018, Google requires you to set up a Google API account to download imagery. This is free, but it does require a credit card to obtain the API Key that is required to make the <code>ggmap</code> package work. Here I provide you with an API key for a project I created for this class that should allow you to run the following function if you desire. If you are interested in obtaining your own API key, see the page <a href="https://developers.google.com/maps/documentation/geocoding/get-api-key">here</a> for learning about how to use Google maps web services.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="functions.html#cb719-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">register_google</span>(<span class="dt">key =</span> <span class="st">&quot;AIzaSyBPAwSY5x8vQqlnG-QwiCAWQW12U3CTLZY&quot;</span>)</span>
<span id="cb719-2"><a href="functions.html#cb719-2"></a><span class="op">&gt;</span><span class="st"> </span>mu.bbox &lt;-<span class="st"> </span><span class="kw">bbox</span>(mu)</span>
<span id="cb719-3"><a href="functions.html#cb719-3"></a><span class="op">&gt;</span><span class="st"> </span>mu.centroid &lt;-<span class="st"> </span><span class="kw">apply</span>(mu.bbox, <span class="dv">1</span>, mean)</span>
<span id="cb719-4"><a href="functions.html#cb719-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb719-5"><a href="functions.html#cb719-5"></a><span class="er">&gt;</span><span class="st"> </span>basemap &lt;-<span class="st"> </span><span class="kw">get_map</span>(<span class="dt">location=</span>mu.centroid, <span class="dt">zoom=</span><span class="dv">14</span>, <span class="dt">maptype =</span> <span class="st">&quot;satellite&quot;</span>, <span class="dt">source =</span> <span class="st">&quot;google&quot;</span>)</span>
<span id="cb719-6"><a href="functions.html#cb719-6"></a><span class="op">&gt;</span><span class="st">                                     </span></span>
<span id="cb719-7"><a href="functions.html#cb719-7"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span><span class="st"> </span></span>
<span id="cb719-8"><a href="functions.html#cb719-8"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group=</span>group), </span>
<span id="cb719-9"><a href="functions.html#cb719-9"></a><span class="op">+</span><span class="st">                  </span><span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-200-1.png" width="672" />
While the call to <code>get_map</code> can use a bounding box (<code>mu.bbox</code> in code above) to define the <code>basemap</code> extent, I’ve found that it’s easier to pass it a center point location (<code>mu.centroid</code> note the use of the <code>apply</code> function to find the mean in the easting and northing extents) and <code>zoom</code> value to extract the desired extent. The resulting map looks pretty good! Take a look at the <code>get_map</code> function manual page and try different options for <code>maptype</code> (e.g., <code>maptype="terrain"</code>).</p>
<p>Next we’ll add the forest inventory plots to the map. Begin by reading in the PEF forest inventory plot data held in “plots.csv”. Recall, foresters have measured forest variables at a set of locations (i.e., inventory plots) within each management unit. The following statement reads these data and displays the resulting data frame structure.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="functions.html#cb720-1"></a><span class="op">&gt;</span><span class="st"> </span>plots &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;PEF/plots.csv&quot;</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</span>
<span id="cb720-2"><a href="functions.html#cb720-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(plots)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   451 obs. of  8 variables:
 $ mu_id           : chr  &quot;U10&quot; &quot;U10&quot; &quot;U10&quot; &quot;U10&quot; ...
 $ plot            : int  11 13 21 22 23 24 31 32 33 34 ...
 $ easting         : num  529699 529777 529774 529814 529850 ...
 $ northing        : num  4966333 4966471 4966265 4966336 4966402 ...
 $ biomass_mg_ha   : num  96.3 115.7 121.6 72 122.3 ...
 $ stems_ha        : int  5453 2629 3385 7742 7980 10047 5039 5831 2505 7325 ...
 $ diameter_cm     : num  4.8 6.9 6.1 3.1 4.7 1.6 4.1 5.2 5.7 3.3 ...
 $ basal_area_m2_ha: num  22 23.2 23 16.1 29.2 19.1 14.1 27.4 21.6 15 ...</code></pre>
<p>In <code>plots</code> each row is a forest inventory plot and columns are:</p>
<ul>
<li><code>mu_id</code> identifies the management unit within which the plot is located</li>
<li><code>plot</code> unique plot number within the management unit</li>
<li><code>easting</code> longitude coordinate in UTM zone 19</li>
<li><code>northing</code> latitude coordinate in UTM zone 19</li>
<li><code>biomass_mg_ha</code> tree biomass in metric ton (per hectare basis)</li>
<li><code>stocking_stems_ha</code> number of tree (per hectare basis)</li>
<li><code>diameter_cm</code> average tree diameter measured 130 cm up the tree trunk</li>
<li><code>basal_area_m2_ha</code> total cross-sectional area at 130 cm up the tree trunk (per hectare basis)</li>
</ul>
<p>There is nothing inherently spatial about this data structure—it is simply a data frame. We make <code>plots</code> into a spatial object by identifying which columns hold the coordinates. This is done below using the <code>coordinates</code> function, which promotes the <code>plots</code> data frame to a <code>SpatialPointsDataFrame</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="functions.html#cb722-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">coordinates</span>(plots) &lt;-<span class="st"> </span><span class="er">~</span>easting<span class="op">+</span>northing</span>
<span id="cb722-2"><a href="functions.html#cb722-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">class</span>(plots)</span></code></pre></div>
<pre><code>[1] &quot;SpatialPointsDataFrame&quot;
attr(,&quot;package&quot;)
[1] &quot;sp&quot;</code></pre>
<p>Although <code>plots</code> is now a <code>SpatialPointsDataFrame</code>, it does not know to which CRS the coordinates belong; hence, the <code>NA</code> when <code>proj4string(plots)</code> is called below. As noted in the <code>plots</code> file description above, <code>easting</code> and <code>northing</code> are in UTM zone 19. This CRS is set using the second call to <code>proj4string</code> below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="functions.html#cb724-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">proj4string</span>(plots)</span></code></pre></div>
<pre><code>[1] NA</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="functions.html#cb726-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">proj4string</span>(plots) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+proj=utm +zone=19 +datum=NAD83 +units=m </span></span>
<span id="cb726-2"><a href="functions.html#cb726-2"></a><span class="st">+                              +no_defs +ellps=GRS80 +towgs84=0,0,0&quot;</span>)                   </span></code></pre></div>
<p>Now let’s reproject <code>plots</code> to share a common CRS with <code>mu</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="functions.html#cb727-1"></a><span class="op">&gt;</span><span class="st"> </span>plots &lt;-<span class="st"> </span><span class="kw">spTransform</span>(plots, <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>))</span></code></pre></div>
<p>Note, because <code>mu</code> is already in the projection we want for <code>plots</code>, we could have replaced the second argument in the <code>spTransform</code> call above with <code>proj4string(mu)</code> and saved some typing.</p>
<p>We’re now ready to add the forest inventory plots to the existing basemap with management units. Specifically, let’s map the <code>biomass_mg_ha</code> variable to show changes in biomass across the forest. No need to fortify <code>plots</code>, <code>ggplot</code> is happy to take <code>geom_point</code>’s <code>data</code> argument as a data frame (although we do need to convert <code>plots</code> from a <code>SpatialPointsDataFrame</code> to a data frame using the <code>as.data.frame</code> function). Check out the <code>scale_color_gradient</code> function in your favorite <code>ggplot2</code> reference to understand how the color scale is set.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="functions.html#cb728-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb728-2"><a href="functions.html#cb728-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group=</span>group), </span>
<span id="cb728-3"><a href="functions.html#cb728-3"></a><span class="op">+</span><span class="st">                  </span><span class="dt">fill=</span><span class="ot">NA</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></span>
<span id="cb728-4"><a href="functions.html#cb728-4"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">as.data.frame</span>(plots), </span>
<span id="cb728-5"><a href="functions.html#cb728-5"></a><span class="op">+</span><span class="st">                </span><span class="kw">aes</span>(<span class="dt">x =</span> easting, <span class="dt">y =</span> northing, <span class="dt">color=</span>biomass_mg_ha)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb728-6"><a href="functions.html#cb728-6"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_color_gradient</span>(<span class="dt">low=</span><span class="st">&quot;white&quot;</span>, <span class="dt">high=</span><span class="st">&quot;darkblue&quot;</span>) <span class="op">+</span></span>
<span id="cb728-7"><a href="functions.html#cb728-7"></a><span class="op">+</span><span class="st">     </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;Biomass (mg/ha)&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-205-1.png" width="672" /></p>
<p>There is something subtle and easy to miss in the code above. Notice the <code>aes</code> function arguments in <code>geom_points</code> take geographic longitude and latitude, <code>x</code> and <code>y</code> respectively, from the <code>points</code> data frame (but recall <code>easting</code> and <code>northing</code> were in UTM zone 19). This works because we applied <code>spTransform</code> to reproject the <code>points</code> <code>SpatialPointsDataFrame</code> to geographic coordinates. <code>sp</code> then replaces the values in <code>easting</code> and <code>northing</code> columns with the reprojected coordinate values when converting a <code>SpatialPointsDataFrame</code> to a data frame via <code>as.data.frame()</code>.</p>
<p>Foresters use the inventory plot measurements to estimate forest variables within management units, e.g., the average or total management unit biomass. Next we’ll make a plot with management unit polygons colored by average <code>biomass_mg_ha</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="functions.html#cb729-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.bio &lt;-<span class="st"> </span>plots<span class="op">@</span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(mu_id) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb729-2"><a href="functions.html#cb729-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">summarize</span>(<span class="dt">biomass_mu =</span> <span class="kw">mean</span>(biomass_mg_ha))</span>
<span id="cb729-3"><a href="functions.html#cb729-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(mu.bio)</span></code></pre></div>
<pre><code># A tibble: 33 x 2
   mu_id biomass_mu
   &lt;chr&gt;      &lt;dbl&gt;
 1 C12        124. 
 2 C15         49.9
 3 C16        128. 
 4 C17        112. 
 5 C20        121. 
 6 C21        134. 
 7 C22         65.2
 8 C23A       108. 
 9 C23B       153. 
10 C24        126. 
# … with 23 more rows</code></pre>
<p>Recall from Section <a href="data2.html#pipes"><strong>??</strong></a> this one-liner can be read as “get the data frame from <code>plots</code>’s <code>SpatialPointsDataFrame</code> <em>then</em> group by management unit <em>then</em> make a new variable called <code>biomass_mu</code> that is the average of <code>biomass_mg_ha</code> and assign it to the <code>mu.bio</code> tibble.”</p>
<p>The management unit specific <code>biomass_mu</code> can now be joined to the <code>mu</code> polygons using the common <code>mu_id</code> value. Remember when we created the fortified version of <code>mu</code> called <code>mu.f</code>? The <code>fortify</code> function <code>region</code> argument was <code>mu_id</code> which is the <code>id</code> variable in the resulting <code>mu.f</code>. This <code>id</code> variable in <code>mu.f</code> can be linked to the <code>mu_id</code> variable in <code>mu.bio</code> using <code>dplyr</code>’s <code>left_join</code> function as illustrated below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="functions.html#cb731-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(mu.f, <span class="dt">n=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>    long   lat order  hole piece  id group
1 -68.62 44.86     1 FALSE     1 C12 C12.1
2 -68.62 44.86     2 FALSE     1 C12 C12.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="functions.html#cb733-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.f &lt;-<span class="st"> </span><span class="kw">left_join</span>(mu.f, mu.bio, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;id&#39;</span> =<span class="st"> &#39;mu_id&#39;</span>))</span>
<span id="cb733-2"><a href="functions.html#cb733-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb733-3"><a href="functions.html#cb733-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">head</span>(mu.f, <span class="dt">n=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>    long   lat order  hole piece  id group biomass_mu
1 -68.62 44.86     1 FALSE     1 C12 C12.1      123.7
2 -68.62 44.86     2 FALSE     1 C12 C12.1      123.7</code></pre>
<p>The calls to <code>head()</code> show the first few rows of <code>mu.f</code> pre- and post-join. After the join, <code>mu.f</code> includes <code>biomass_mu</code>, which is used used below for <code>geom_polygon</code>’s <code>fill</code> argument to color the polygons accordingly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="functions.html#cb735-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb735-2"><a href="functions.html#cb735-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, </span>
<span id="cb735-3"><a href="functions.html#cb735-3"></a><span class="op">+</span><span class="st">                                 </span><span class="dt">group=</span>group, <span class="dt">fill=</span>biomass_mu), </span>
<span id="cb735-4"><a href="functions.html#cb735-4"></a><span class="op">+</span><span class="st">                  </span><span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></span>
<span id="cb735-5"><a href="functions.html#cb735-5"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;white&quot;</span>, <span class="dt">high=</span><span class="st">&quot;darkblue&quot;</span>, </span>
<span id="cb735-6"><a href="functions.html#cb735-6"></a><span class="op">+</span><span class="st">                         </span><span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></span>
<span id="cb735-7"><a href="functions.html#cb735-7"></a><span class="op">+</span><span class="st">     </span><span class="kw">labs</span>(<span class="dt">fill=</span><span class="st">&quot;Biomass (mg/ha)&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<p>Let’s add the roads and some more descriptive labels as a finishing touch. The roads data include a variable called <code>type</code> that identifies the road type. To color roads by type in the map, we need to join the <code>roads</code> data frame with the fortified roads <code>roads.f</code> using the common variable <code>id</code> as a road segment specific identifier. Then <code>geom_path</code>’s <code>color</code> argument gets this <code>type</code> variable as a factor to create road-specific color. The default coloring of the roads blends in too much with the polygon colors, so we manually set the road colors using the <code>scale_color_brewer</code> function. The <code>palette</code> argument in this function accepts a set of key words, e.g., <code>"Dark2"</code>, that specify sets of diverging colors chosen to make map object difference optimally distinct (see, the manual page for <code>scale_color_brewer</code>, <a href="http://colorbrewer2.org" class="uri">http://colorbrewer2.org</a>, and blog <a href="https://www.r-bloggers.com/r-using-rcolorbrewer-to-colour-your-figures-in-r">here</a>.)<a href="references.html#fn47" class="footnote-ref" id="fnref47"><sup>47</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="functions.html#cb736-1"></a><span class="op">&gt;</span><span class="st"> </span>roads &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;PEF&quot;</span>, <span class="st">&quot;roads&quot;</span>)</span></code></pre></div>
<pre><code>OGR data source with driver: ESRI Shapefile 
Source: &quot;/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/PEF&quot;, layer: &quot;roads&quot;
with 33 features
It has 2 fields</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="functions.html#cb738-1"></a><span class="op">&gt;</span><span class="st"> </span>roads &lt;-<span class="st"> </span><span class="kw">spTransform</span>(roads, <span class="kw">proj4string</span>(mu))</span>
<span id="cb738-2"><a href="functions.html#cb738-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb738-3"><a href="functions.html#cb738-3"></a><span class="er">&gt;</span><span class="st"> </span>roads.f &lt;-<span class="st"> </span><span class="kw">fortify</span>(roads, <span class="dt">region=</span><span class="st">&quot;id&quot;</span>)</span>
<span id="cb738-4"><a href="functions.html#cb738-4"></a><span class="op">&gt;</span><span class="st"> </span>roads.f &lt;-<span class="st"> </span><span class="kw">left_join</span>(roads.f, roads<span class="op">@</span>data, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;id&#39;</span> =<span class="st"> &#39;id&#39;</span>))</span></code></pre></div>
<pre><code>Warning: Column `id` joining character vector and
factor, coercing into character vector</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="functions.html#cb740-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb740-2"><a href="functions.html#cb740-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group=</span>group, </span>
<span id="cb740-3"><a href="functions.html#cb740-3"></a><span class="op">+</span><span class="st">                                 </span><span class="dt">fill=</span>biomass_mu), </span>
<span id="cb740-4"><a href="functions.html#cb740-4"></a><span class="op">+</span><span class="st">                  </span><span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></span>
<span id="cb740-5"><a href="functions.html#cb740-5"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_path</span>(<span class="dt">data=</span>roads.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, </span>
<span id="cb740-6"><a href="functions.html#cb740-6"></a><span class="op">+</span><span class="st">                                 </span><span class="dt">group=</span>group, <span class="dt">color=</span><span class="kw">factor</span>(type))) <span class="op">+</span></span>
<span id="cb740-7"><a href="functions.html#cb740-7"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;white&quot;</span>, <span class="dt">high=</span><span class="st">&quot;darkblue&quot;</span>, </span>
<span id="cb740-8"><a href="functions.html#cb740-8"></a><span class="op">+</span><span class="st">                         </span><span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></span>
<span id="cb740-9"><a href="functions.html#cb740-9"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Dark2&quot;</span>) <span class="op">+</span></span>
<span id="cb740-10"><a href="functions.html#cb740-10"></a><span class="op">+</span><span class="st">     </span><span class="kw">labs</span>(<span class="dt">fill=</span><span class="st">&quot;Biomass (mg/ha)&quot;</span>, <span class="dt">color=</span><span class="st">&quot;Road type&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Longitude&quot;</span>, </span>
<span id="cb740-11"><a href="functions.html#cb740-11"></a><span class="op">+</span><span class="st">          </span><span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>, <span class="dt">title=</span><span class="st">&quot;PEF forest biomass&quot;</span>)</span></code></pre></div>
<pre><code>Warning: Removed 616 rows containing missing values
(geom_path).</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-209-1.png" width="672" /></p>
<p>The second, and more cryptic, of the two warnings from this code occurs because some of the roads extend beyond the range of the map axes and are removed (nothing to worry about).</p>
</div>
<div id="illustration-using-leaflet" class="section level2" number="7.14">
<h2 number="7.14"><span class="header-section-number">7.14</span> Illustration using <code>leaflet</code></h2>
<p>Leaflet is one of the most popular open-source JavaScript libraries for interactive maps. As noted on the official <a href="https://rstudio.github.io/leaflet">R leaflet website</a>, it’s used by websites ranging from <em>The New York Times</em> and <em>The Washington Post</em> to GitHub and Flickr, as well as by GIS specialists like OpenStreetMap, Mapbox, and CartoDB.</p>
<p>The <a href="https://rstudio.github.io/leaflet">R leaflet website</a> is an excellent resource to learn leaflet basics, and should serve as a reference to gain a better understanding of the topics we briefly explore below.</p>
<p>You create a leaflet map using these basic steps:</p>
<ol style="list-style-type: decimal">
<li>Create a map by calling <code>leaflet()</code></li>
<li>Add data layers to the map using layer functions such as, <code>addTiles()</code>, <code>addMarkers()</code>, <code>addPolygons()</code>, <code>addCircleMarkers()</code>, <code>addPolylines()</code>, <code>addRasterImage()</code> and other <code>add...</code> functions</li>
<li>Repeat step 2 to add more layers to the map</li>
<li>Print the map to display it</li>
</ol>
<p>Here’s a brief example.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="functions.html#cb742-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(leaflet)</span>
<span id="cb742-2"><a href="functions.html#cb742-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb742-3"><a href="functions.html#cb742-3"></a><span class="er">&gt;</span><span class="st"> </span>m &lt;-<span class="st"> </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb742-4"><a href="functions.html#cb742-4"></a><span class="op">+</span><span class="st">       </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Add default OpenStreetMap map tiles</span></span>
<span id="cb742-5"><a href="functions.html#cb742-5"></a><span class="op">+</span><span class="st">       </span><span class="kw">addMarkers</span>(<span class="dt">lng=</span><span class="op">-</span><span class="fl">84.482004</span>, <span class="dt">lat=</span><span class="fl">42.727516</span>, </span>
<span id="cb742-6"><a href="functions.html#cb742-6"></a><span class="op">+</span><span class="st">                  </span><span class="dt">popup=</span><span class="st">&quot;&lt;b&gt;Here I am!&lt;/b&gt;&quot;</span>) <span class="co"># Add a clickable marker</span></span>
<span id="cb742-7"><a href="functions.html#cb742-7"></a><span class="op">&gt;</span><span class="st"> </span>m  <span class="co"># Print the map</span></span></code></pre></div>
<div id="htmlwidget-3892c55f1e170df1695a" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-3892c55f1e170df1695a">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[42.727516,-84.482004,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"<b>Here I am!<\/b>",null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[42.727516,42.727516],"lng":[-84.482004,-84.482004]}},"evals":[],"jsHooks":[]}</script>
<p>There are a couple things to note in the code. First, we use the pipe operator <code>%&gt;%</code> just like in <code>dplyr</code> functions. Second, the <code>popup</code> argument in <code>addMarkers()</code> takes standard HTML and clicking on the marker makes the text popup. Third, the html version of this text provides the full interactive, dynamic map, so we encourage you to read and interact with the html version of this textbook for this section. The PDF document will simply display a static version of this map and will not do justice to how awesome <code>leaflet</code> truly is!</p>
<p>As seen in the <code>leaflet()</code> call above, the various <code>add...</code> functions can take longitude (i.e., <code>lng</code>) and latitude (i.e., <code>lat</code>). Alternatively, these functions can extract the necessary spatial information from <code>sp</code> objects, e.g., Table <a href="functions.html#tab:spatialObjs">4</a>, when passed to the data argument (which greatly simplifies life compared with map making using <code>ggmap</code>).</p>
</div>
<div id="subsetting-spatial-data" class="section level2" number="7.15">
<h2 number="7.15"><span class="header-section-number">7.15</span> Subsetting Spatial Data</h2>
<p>You can imagine that we might want to subset spatial objects to map specific points, lines, or polygons that meet some criteria, or perhaps extract values from polygons or raster surfaces at a set of points or geographic extent. These, and similar types, of operations are easy in R (as long as all spatial objects are in a common CRS). Recall from Chapter <a href="structures.html#structures"><strong>??</strong></a> how handy it is to subset data structures, e.g., vectors and data frames, using the <code>[]</code> operator and logical vectors? Well it’s just as easy to subset spatial objects, thanks to the authors of <code>sp</code>, <code>raster</code>, and other spatial data packages.</p>
<div id="fetching-and-cropping-data-using-raster" class="section level3" number="7.15.1">
<h3 number="7.15.1"><span class="header-section-number">7.15.1</span> Fetching and Cropping Data using <code>raster</code></h3>
<p>In order to motivate our exploration of spatial data subsetting and to illustrate some useful functionality of the <code>raster</code> package, let’s download some elevation data for the PEF. The <code>raster</code> package has a rich set of functions for manipulating raster data as well as functions for downloading data from open source repositories. We’ll focus on the package’s <code>getData</code> function, which, given a location in geographic longitude and latitude or location name, will download data from <a href="http://www.gadm.org/%7D%7BGlobal%20Administrative%20Boundaries">GADM</a>, <a href="https://www2.jpl.nasa.gov/srtm/%7D%7BShuttle%20Radar%20Topography%20Mission">Shuttle Radar Topography Mission</a>, <a href="http://www.worldclim.org/">Global Climate Data</a>, and other sources commonly used in spatial data applications.</p>
<p>Let’s download SRTM surface elevation data for the PEF, check the resulting object’s class and CRS, and display it using the <code>raster</code> package’s <code>image</code> function along with the PEF forest inventory plots.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="functions.html#cb743-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(raster)</span>
<span id="cb743-2"><a href="functions.html#cb743-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb743-3"><a href="functions.html#cb743-3"></a><span class="er">&gt;</span><span class="st"> </span>pef.centroid &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(plots) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb743-4"><a href="functions.html#cb743-4"></a><span class="op">+</span><span class="st">     </span><span class="kw">summarize</span>(<span class="dt">mu.x =</span> <span class="kw">mean</span>(easting), <span class="dt">mu.y =</span> <span class="kw">mean</span>(northing))</span>
<span id="cb743-5"><a href="functions.html#cb743-5"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb743-6"><a href="functions.html#cb743-6"></a><span class="er">&gt;</span><span class="st"> </span>srtm &lt;-<span class="st"> </span><span class="kw">getData</span>(<span class="st">&quot;SRTM&quot;</span>, <span class="dt">lon =</span> pef.centroid[, <span class="dv">1</span>], <span class="dt">lat =</span> pef.centroid[, <span class="dv">2</span>])</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="functions.html#cb744-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">class</span>(srtm)</span></code></pre></div>
<pre><code>[1] &quot;RasterLayer&quot;
attr(,&quot;package&quot;)
[1] &quot;raster&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="functions.html#cb746-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">proj4string</span>(srtm)</span></code></pre></div>
<pre><code>[1] &quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="functions.html#cb748-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">image</span>(srtm)</span>
<span id="cb748-2"><a href="functions.html#cb748-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(plots, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-213-1.png" width="672" /></p>
<p>A few things to notice in the code above. First the <code>getData</code> function needs the longitude <code>lon</code> and latitude <code>lat</code> to identify which SRTM raster tile to return (SRTM data come in large raster tiles that cover the globe). As usual, look at the <code>getData</code> function documentation for a description of the arguments. To estimate the PEF’s centroid coordinate, we averaged the forest inventory plots’ latitude and longitude then assigned the result to <code>pef.centroid</code> (for fun, I used the <code>apply</code> function to do the same task when creating <code>mu.centroid</code> earlier in the chapter). Second, <code>srtm</code> is in a longitude latitude geographic CRS (same as our other PEF data). Finally, the image shows SRTM elevation along the coast of Maine, the PEF plots are those tiny specks of black in the northwest quadrant, and the white region of the image is the Atlantic Ocean.</p>
<p>Okay, this is a start, but it would be good to crop the SRTM image to the PEF’s extent. This is done using <code>raster</code>’s <code>crop</code> function. This function can use many different kinds of spatial objects in the second argument to calculate the extent at which to crop the object in the first argument. Here, I set <code>mu</code> as the second argument and save the resulting SRTM subset over the larger tile (the <code>srtm</code> object).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="functions.html#cb749-1"></a><span class="op">&gt;</span><span class="st"> </span>srtm &lt;-<span class="st"> </span><span class="kw">crop</span>(srtm, mu)</span>
<span id="cb749-2"><a href="functions.html#cb749-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb749-3"><a href="functions.html#cb749-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">image</span>(srtm)</span>
<span id="cb749-4"><a href="functions.html#cb749-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(mu, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-214-1.png" width="672" /></p>
<p>The <code>crop</code> is in effect doing a spatial subsetting of the raster data. We’ll return to the <code>srtm</code> data and explore different kinds of subsetting in the subsequent sections.</p>
</div>
<div id="logical-index-and-name-subsetting" class="section level3" number="7.15.2">
<h3 number="7.15.2"><span class="header-section-number">7.15.2</span> Logical, Index, and Name Subsetting</h3>
<p>As promised, we can subset spatial objects using the <code>[]</code> operator and a logical, index, or name vector. The key is that <code>sp</code> objects behave like data frames, see Section <a href="structures.html#dataFrames"><strong>??</strong></a>. A logical or index vector to the left of the comma in <code>[,]</code> accesses points, lines, polygons, or pixels. Similarly, a logical, index, or name vector to the right of the comma accesses variables.</p>
<p>For example, say we want to map forest inventory plots with more than 10,000 stems per hectare, <code>stems_ha</code> (the <code>min()</code> was added below to double check that the subset worked correctly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="functions.html#cb750-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">min</span>(plots<span class="op">$</span>stems_ha)</span></code></pre></div>
<pre><code>[1] 119</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="functions.html#cb752-1"></a><span class="op">&gt;</span><span class="st"> </span>plots<span class="fl">.10</span>k &lt;-<span class="st"> </span>plots[plots<span class="op">$</span>stems_ha <span class="op">&gt;</span><span class="st"> </span><span class="dv">10000</span>,]</span>
<span id="cb752-2"><a href="functions.html#cb752-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb752-3"><a href="functions.html#cb752-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">min</span>(plots<span class="fl">.10</span>k<span class="op">$</span>stems_ha)     </span></code></pre></div>
<pre><code>[1] 10008</code></pre>
<p>You can also add new variables to the spatial objects.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="functions.html#cb754-1"></a><span class="op">&gt;</span><span class="st"> </span>plots<span class="op">$</span>diameter_in &lt;-<span class="st"> </span>plots<span class="op">$</span>diameter_cm<span class="op">/</span><span class="fl">2.54</span></span>
<span id="cb754-2"><a href="functions.html#cb754-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb754-3"><a href="functions.html#cb754-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">head</span>(plots)</span></code></pre></div>
<pre><code>  mu_id plot biomass_mg_ha stems_ha diameter_cm
1   U10   11         96.35     5453         4.8
2   U10   13        115.70     2629         6.9
3   U10   21        121.58     3385         6.1
4   U10   22         71.97     7742         3.1
5   U10   23        122.26     7980         4.7
6   U10   24         85.85    10047         1.6
  basal_area_m2_ha diameter_in
1             22.0      1.8898
2             23.2      2.7165
3             23.0      2.4016
4             16.1      1.2205
5             29.2      1.8504
6             19.1      0.6299</code></pre>
</div>
<div id="spatial-subsetting-and-overlay" class="section level3" number="7.15.3">
<h3 number="7.15.3"><span class="header-section-number">7.15.3</span> Spatial Subsetting and Overlay</h3>
<p>A spatial overlay retrieves the indexes or variables from object <span class="math inline">\(A\)</span> using the location of object <span class="math inline">\(B\)</span>. With some spatial objects this operation can be done using the <code>[]</code> operator. For example, say we want to select and map all management units in <code>mu</code>, i.e., <span class="math inline">\(A\)</span>, that contain plots with more than 10,000 stems per ha, i.e., <span class="math inline">\(B\)</span>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="functions.html#cb756-1"></a><span class="op">&gt;</span><span class="st"> </span>mu<span class="fl">.10</span>k &lt;-<span class="st"> </span>mu[plots<span class="fl">.10</span>k,]<span class="co">## A[B,]</span></span>
<span id="cb756-2"><a href="functions.html#cb756-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb756-3"><a href="functions.html#cb756-3"></a><span class="er">&gt;</span><span class="st"> </span>mu<span class="fl">.10</span>k.f &lt;-<span class="st"> </span><span class="kw">fortify</span>(mu<span class="fl">.10</span>k, <span class="dt">region=</span><span class="st">&quot;mu_id&quot;</span>)</span>
<span id="cb756-4"><a href="functions.html#cb756-4"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb756-5"><a href="functions.html#cb756-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb756-6"><a href="functions.html#cb756-6"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu<span class="fl">.10</span>k.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group=</span>group), <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></span>
<span id="cb756-7"><a href="functions.html#cb756-7"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">as.data.frame</span>(plots<span class="fl">.10</span>k), <span class="kw">aes</span>(<span class="dt">x =</span> easting, <span class="dt">y =</span> northing), <span class="dt">color=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-217-1.png" width="672" /></p>
<p>More generally, however, the <code>over</code> function offers consistent overlay operations for <code>sp</code> objects and can return either indexes or variables from object <span class="math inline">\(A\)</span> given locations from object <span class="math inline">\(B\)</span>, i.e., <code>over(B, A)</code> or, equivalently, <code>B%over%A</code>. The code below duplicates the result from the preceding example using <code>over</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="functions.html#cb757-1"></a><span class="op">&gt;</span><span class="st"> </span>mu<span class="fl">.10</span>k &lt;-<span class="st"> </span>mu[mu<span class="op">$</span>mu_id <span class="op">%in%</span><span class="st"> </span><span class="kw">unique</span>(<span class="kw">over</span>(plots<span class="fl">.10</span>k, mu)<span class="op">$</span>mu_id),]</span></code></pre></div>
<p>Yes, this requires more code but <code>over</code> provides a more flexible and general purpose function for overlays on the variety of <code>sp</code> objects. Let’s unpack this one-liner into its five steps.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="functions.html#cb758-1"></a><span class="op">&gt;</span><span class="st"> </span>i &lt;-<span class="st"> </span><span class="kw">over</span>(plots<span class="fl">.10</span>k, mu)</span>
<span id="cb758-2"><a href="functions.html#cb758-2"></a><span class="op">&gt;</span><span class="st"> </span>ii &lt;-<span class="st"> </span>i<span class="op">$</span>mu_id</span>
<span id="cb758-3"><a href="functions.html#cb758-3"></a><span class="op">&gt;</span><span class="st"> </span>iii &lt;-<span class="st"> </span><span class="kw">unique</span>(ii)</span>
<span id="cb758-4"><a href="functions.html#cb758-4"></a><span class="op">&gt;</span><span class="st"> </span>iv &lt;-<span class="st"> </span>mu<span class="op">$</span>mu_id <span class="op">%in%</span><span class="st"> </span>iii</span>
<span id="cb758-5"><a href="functions.html#cb758-5"></a><span class="op">&gt;</span><span class="st"> </span>v &lt;-<span class="st"> </span>mu[iv,]</span></code></pre></div>
<ol style="list-style-type: lower-roman">
<li>The <code>over</code> function returns variables for <code>mu</code>’s polygons that coincide with the <code>nrow(plots.10k@data)</code> points in <code>plots.10k</code>. No points fall outside the polygons and the polygons do not overlap, so i should be a data frame with <code>nrow(plots.10k@data)</code> rows. If polygons did overlap and a point fell within the overlap region, then variables for the coinciding polygons are returned.</li>
<li>Select the unique <code>mu</code> identifier <code>mu_id</code> (this step is actually not necessary here because <code>mu</code> only has one variable).</li>
<li>Because some management units contain multiple plots there will be repeat values of <code>mu_id</code> in ii, so apply the <code>unique</code> function to get rid of duplicates.</li>
<li>Use the <code>%in%</code> operator to create a logical vector that identifies which polygons should be in the final map.</li>
<li>Subset <code>mu</code> using the logical vector created in iv.</li>
</ol>
<p>Now let’s do something similar using the <code>srtm</code> elevation raster. Say we want to map elevation along trails, winter roads, and gravel roads across the PEF. We could subset <code>srtm</code> using the <code>roads</code> <code>SpatialLinesDataFrame</code>; however, mapping the resulting pixel values along the road segments using <code>ggmap</code> requires a bit more massaging. So, to simplify things for this example, <code>roads</code> is first coerced into a <code>SpatialPointsDataFrame</code> called <code>roads.pts</code> that is used to extract spatially coinciding <code>srtm</code> pixel values which themselves are coerced from <code>raster</code>’s <code>RasterLayer</code> to <code>sp</code>’s <code>SpatialPixelsDataFrame</code> called <code>srtm.sp</code> so that we can use the <code>over</code> function. We also choose a different basemap just for fun.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="functions.html#cb759-1"></a><span class="op">&gt;</span><span class="st"> </span>hikes &lt;-<span class="st"> </span>roads[roads<span class="op">$</span>type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Trail&quot;</span>, <span class="st">&quot;Winter&quot;</span>, <span class="st">&quot;Gravel&quot;</span>),]</span>
<span id="cb759-2"><a href="functions.html#cb759-2"></a><span class="op">&gt;</span><span class="st">  </span></span>
<span id="cb759-3"><a href="functions.html#cb759-3"></a><span class="er">&gt;</span><span class="st"> </span>hikes.pts &lt;-<span class="st"> </span><span class="kw">as</span>(hikes, <span class="st">&quot;SpatialPointsDataFrame&quot;</span>)</span>
<span id="cb759-4"><a href="functions.html#cb759-4"></a><span class="op">&gt;</span><span class="st"> </span>srtm.sp &lt;-<span class="st"> </span><span class="kw">as</span>(srtm, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb759-5"><a href="functions.html#cb759-5"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb759-6"><a href="functions.html#cb759-6"></a><span class="er">&gt;</span><span class="st"> </span>hikes.pts<span class="op">$</span>srtm &lt;-<span class="st"> </span><span class="kw">over</span>(hikes.pts, srtm.sp)</span>
<span id="cb759-7"><a href="functions.html#cb759-7"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb759-8"><a href="functions.html#cb759-8"></a><span class="er">&gt;</span><span class="st"> </span>basemap &lt;-<span class="st"> </span><span class="kw">get_map</span>(<span class="dt">location=</span>mu.centroid, <span class="dt">zoom=</span><span class="dv">14</span>, <span class="dt">maptype =</span> <span class="st">&quot;terrain&quot;</span>, <span class="dt">source =</span> <span class="st">&quot;google&quot;</span>)</span>
<span id="cb759-9"><a href="functions.html#cb759-9"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb759-10"><a href="functions.html#cb759-10"></a><span class="er">&gt;</span><span class="st"> </span>color.vals &lt;-<span class="st"> </span>srtm<span class="op">@</span>data<span class="op">@</span>values[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(hikes.pts)]</span>
<span id="cb759-11"><a href="functions.html#cb759-11"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb759-12"><a href="functions.html#cb759-12"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb759-13"><a href="functions.html#cb759-13"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_point</span>(<span class="dt">data=</span><span class="kw">as.data.frame</span>(hikes.pts),</span>
<span id="cb759-14"><a href="functions.html#cb759-14"></a><span class="op">+</span><span class="st">                </span><span class="kw">aes</span>(<span class="dt">x =</span> coords.x1, <span class="dt">y =</span> coords.x2, <span class="dt">color =</span> color.vals)) <span class="op">+</span></span>
<span id="cb759-15"><a href="functions.html#cb759-15"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_color_gradient</span>(<span class="dt">low=</span><span class="st">&quot;green&quot;</span>, <span class="dt">high=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb759-16"><a href="functions.html#cb759-16"></a><span class="op">+</span><span class="st">     </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;Hiking trail elevation</span><span class="ch">\n</span><span class="st">(m above sea level)&quot;</span>,</span>
<span id="cb759-17"><a href="functions.html#cb759-17"></a><span class="op">+</span><span class="st">          </span><span class="dt">xlab=</span><span class="st">&quot;Longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>)</span></code></pre></div>
<pre><code>Warning: Removed 483 rows containing missing values
(geom_point).</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-220-1.png" width="672" /></p>
<p>In the call to <code>geom_point</code> above, <code>coords.x1</code> <code>coords.x2</code> are the default names given to longitude and latitude, respectively, when <code>sp</code> coerces <code>hikes</code> to <code>hikes.pts</code>. These points represent the vertices along line segments. I create the vector <code>color.vals</code> that contains the values from <code>srtm</code> that I use in the map argument <code>color</code>.</p>
<p>Overlay operations involving lines and polygons over polygons require the <code>rgeos</code> package which provides an interface to the <a href="https://trac.osgeo.org/geos/">Geometry Engine - Open Source</a> (GEOS) <code>C++</code> library for topology operations on geometries. We’ll leave it to you to explore these capabilities.</p>
</div>
<div id="spatial-aggregation" class="section level3" number="7.15.4">
<h3 number="7.15.4"><span class="header-section-number">7.15.4</span> Spatial Aggregation</h3>
<p>We have seen aggregation operations before when using <code>dplyr</code>’s <code>summarize</code> function. The <code>summarize</code> function is particularly powerful when combined with <code>group_by()</code>, which can apply a function specified in <code>summarize()</code> to a variable partitioned using a grouping variable. The <code>aggregate</code> function in <code>sp</code> works in a similar manner, except groups are delineated by the spatial extent of a thematic variable. In fact, the work we did to create <code>mu.bio</code> using <code>dplyr</code> functions can be accomplished with <code>aggregate()</code>. Using <code>aggregate()</code> will, however, require a slightly different approach for joining the derived average <code>biomass_mg_ha</code> to the fortified <code>mu</code>. This is because the <code>aggregate</code> function will apply the user specified function to all variables in the input object, which, in our case, results in an <code>NA</code> for the linking variable <code>mu_id</code> as demonstrated below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="functions.html#cb761-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.ag &lt;-<span class="st"> </span><span class="kw">aggregate</span>(plots[,<span class="kw">c</span>(<span class="st">&quot;mu_id&quot;</span>,<span class="st">&quot;biomass_mg_ha&quot;</span>)], <span class="dt">by=</span>mu, <span class="dt">FUN=</span>mean)</span>
<span id="cb761-2"><a href="functions.html#cb761-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb761-3"><a href="functions.html#cb761-3"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">head</span>(mu.ag<span class="op">@</span>data, <span class="dt">n=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>  mu_id biomass_mg_ha
0  &lt;NA&gt;         49.86
1  &lt;NA&gt;        112.17</code></pre>
<p>With <code>mu_id</code> rendered useless, we do not have a variable that uniquely identifies each polygon for use in <code>fortify</code>’s <code>region</code> argument; hence no way to subsequently join the unfortified and fortified versions of <code>mu.bio.ag</code>. Here’s the work around. If the <code>region</code> is not specified, <code>fortify()</code> uses an internal unique polygon ID that is part of the <code>sp</code> data object and accessed via <code>row.names()</code><a href="references.html#fn48" class="footnote-ref" id="fnref48"><sup>48</sup></a> So, the trick is to add this unique polygon ID to the <code>aggregate()</code> output prior to calling <code>fortify()</code> as demonstrated below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="functions.html#cb763-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.ag<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">row.names</span>(mu.ag)</span>
<span id="cb763-2"><a href="functions.html#cb763-2"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb763-3"><a href="functions.html#cb763-3"></a><span class="er">&gt;</span><span class="st"> </span>mu.ag.f &lt;-<span class="st"> </span><span class="kw">fortify</span>(mu.ag)</span></code></pre></div>
<pre><code>Regions defined for each Polygons</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="functions.html#cb765-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.ag.f &lt;-<span class="st"> </span><span class="kw">left_join</span>(mu.ag.f, mu.ag<span class="op">@</span>data)</span></code></pre></div>
<pre><code>Joining, by = &quot;id&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="functions.html#cb767-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb767-2"><a href="functions.html#cb767-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu.ag.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, </span>
<span id="cb767-3"><a href="functions.html#cb767-3"></a><span class="op">+</span><span class="st">                                 </span><span class="dt">group=</span>group, <span class="dt">fill=</span>biomass_mg_ha), </span>
<span id="cb767-4"><a href="functions.html#cb767-4"></a><span class="op">+</span><span class="st">                  </span><span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></span>
<span id="cb767-5"><a href="functions.html#cb767-5"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;white&quot;</span>, <span class="dt">high=</span><span class="st">&quot;darkblue&quot;</span>, </span>
<span id="cb767-6"><a href="functions.html#cb767-6"></a><span class="op">+</span><span class="st">                         </span><span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></span>
<span id="cb767-7"><a href="functions.html#cb767-7"></a><span class="op">+</span><span class="st">     </span><span class="kw">labs</span>(<span class="dt">fill=</span><span class="st">&quot;Biomass (mg/ha)&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-222-1.png" width="672" /></p>
<p>The <code>aggregate()</code> function will work with all <code>sp</code> objects. For example let’s map the variance of pixel values in <code>srtm.sp</code> by management unit. Notice that <code>aggregate()</code> is happy to take a user-specified function for <code>FUN</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="functions.html#cb768-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.srtm &lt;-<span class="st"> </span><span class="kw">aggregate</span>(srtm.sp, <span class="dt">by=</span>mu,</span>
<span id="cb768-2"><a href="functions.html#cb768-2"></a><span class="op">+</span><span class="st">                      </span><span class="dt">FUN=</span><span class="cf">function</span>(x){<span class="kw">sqrt</span>(<span class="kw">var</span>(x))})</span>
<span id="cb768-3"><a href="functions.html#cb768-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb768-4"><a href="functions.html#cb768-4"></a><span class="er">&gt;</span><span class="st"> </span>mu.srtm<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">row.names</span>(mu.srtm)</span>
<span id="cb768-5"><a href="functions.html#cb768-5"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb768-6"><a href="functions.html#cb768-6"></a><span class="er">&gt;</span><span class="st"> </span>mu.srtm.f &lt;-<span class="st"> </span><span class="kw">fortify</span>(mu.srtm)</span></code></pre></div>
<pre><code>Regions defined for each Polygons</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="functions.html#cb770-1"></a><span class="op">&gt;</span><span class="st"> </span>mu.srtm.f &lt;-<span class="st"> </span><span class="kw">left_join</span>(mu.srtm.f, mu.srtm<span class="op">@</span>data)</span></code></pre></div>
<pre><code>Joining, by = &quot;id&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="functions.html#cb772-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggmap</span>(basemap) <span class="op">+</span></span>
<span id="cb772-2"><a href="functions.html#cb772-2"></a><span class="op">+</span><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>mu.srtm.f, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group=</span>group, </span>
<span id="cb772-3"><a href="functions.html#cb772-3"></a><span class="op">+</span><span class="st">                                      </span><span class="dt">fill=</span>srtm_<span class="dv">23</span>_<span class="dv">04</span>), </span>
<span id="cb772-4"><a href="functions.html#cb772-4"></a><span class="op">+</span><span class="st">                  </span><span class="dt">size=</span><span class="fl">0.2</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></span>
<span id="cb772-5"><a href="functions.html#cb772-5"></a><span class="op">+</span><span class="st">     </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low=</span><span class="st">&quot;green&quot;</span>, <span class="dt">high=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb772-6"><a href="functions.html#cb772-6"></a><span class="op">+</span><span class="st">         </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Elevation standard deviation</span><span class="ch">\n</span><span class="st">(m above sea level)&quot;</span>, </span>
<span id="cb772-7"><a href="functions.html#cb772-7"></a><span class="op">+</span><span class="st">          </span><span class="dt">xlab=</span><span class="st">&quot;Longitude&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Latitude&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-223-1.png" width="672" /></p>
</div>
</div>
<div id="where-to-go-from-here" class="section level2" number="7.16">
<h2 number="7.16"><span class="header-section-number">7.16</span> Where to go from here</h2>
<p>This chapter just scratches the surface of R’s spatial data manipulation and visualization capabilities. The basic ideas we presented here should allow you to take a deeper look into <code>sp</code>, <code>rgdal</code>, <code>rgeos</code>, <code>ggmap</code>, <code>leaflet</code>, and a myriad of other excellent user-contributed R spatial data packages. A good place to start is with Edzer Pebesma’s excellent vignette on the use of the map overlay and spatial aggregation, available <a href="https://cran.r-project.org/web/packages/sp/vignettes/over.pdf">here</a>, as well as <em>Applied Spatial Data Analysis with R</em> by .</p>
</div>
<div id="exercises-5" class="section level2" number="7.17">
<h2 number="7.17"><span class="header-section-number">7.17</span> Exercises</h2>
<p><strong>Exercise Spatial Data</strong> Learning objectives: practice loading and reprojecting spatial data; analyze spatial data; create leaflet maps to convey analysis results; interpret analysis results.</p>

<p>_# Shiny: Interactive Web Apps in R</p>
<p><a href="https://shiny.rstudio.com/">Shiny</a> is a framework that turns R code and figures into interactive web applications. Let’s start out by looking at a built-in example Shiny app.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="functions.html#cb773-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(shiny)</span>
<span id="cb773-2"><a href="functions.html#cb773-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">runExample</span>(<span class="st">&quot;01_hello&quot;</span>)</span></code></pre></div>
<p>In the bottom panel of the resulting Shiny app (Figure <a href="functions.html#fig:hello">13</a>), we can see the R script that is essential to running any Shiny app: <code>app.R</code>. Take a minute to explore how the app works and how the script code is structured. The first part of the script (<code>ui &lt;-</code>) defines the app’s user interface (UI) using directives that partition the resulting web page and placement of input and output elements. The second part of the script defines a function called <code>server</code> with arguments <code>input</code> and <code>output</code>. This function provides the logic required to run the app (in this case, to draw the histogram of the Old Faithful Geyser Data). Third, <code>ui</code> and <code>server</code> are passed to a function called <code>shinyApp</code> which creates the application.<a href="references.html#fn49" class="footnote-ref" id="fnref49"><sup>49</sup></a></p>
<div class="figure"><span id="fig:hello"></span>
<img src="../../for875-19/figures/hello_shiny.png" alt="Hello Shiny example app" width="100%" />
<p class="caption">
FIGURE 13: Hello Shiny example app
</p>
</div>
<p>All of the example code and data for the remainder of this chapter can be accessed using the following code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="functions.html#cb774-1"></a><span class="kw">library</span>(downloader)</span>
<span id="cb774-2"><a href="functions.html#cb774-2"></a></span>
<span id="cb774-3"><a href="functions.html#cb774-3"></a><span class="kw">download</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/shiny_chapter_code.zip&quot;</span>, </span>
<span id="cb774-4"><a href="functions.html#cb774-4"></a>         <span class="dt">destfile=</span><span class="st">&quot;./shiny_chapter_code.zip&quot;</span>, <span class="dt">mode=</span><span class="st">&quot;wb&quot;</span>)</span>
<span id="cb774-5"><a href="functions.html#cb774-5"></a></span>
<span id="cb774-6"><a href="functions.html#cb774-6"></a><span class="kw">unzip</span>(<span class="st">&quot;shiny_chapter_code.zip&quot;</span>, <span class="dt">exdir =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
</div>
<div id="running-a-simple-shiny-app" class="section level2" number="7.18">
<h2 number="7.18"><span class="header-section-number">7.18</span> Running a Simple Shiny App</h2>
<p>Shiny apps allow users to interact with a data set. Let’s say we have access to a dummy data set <code>name_list.csv</code>. Begin by taking a quick look at what this CSV file contains.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="functions.html#cb775-1"></a>namesDF &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/name_list.csv&quot;</span>, </span>
<span id="cb775-2"><a href="functions.html#cb775-2"></a>                    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb775-3"><a href="functions.html#cb775-3"></a><span class="kw">str</span>(namesDF)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   200 obs. of  4 variables:
 $ First: chr  &quot;Sarah&quot; &quot;Boris&quot; &quot;Jessica&quot; &quot;Diane&quot; ...
 $ Last : chr  &quot;Poole&quot; &quot;Dowd&quot; &quot;Wilkins&quot; &quot;Murray&quot; ...
 $ Age  : int  15 52 12 58 56 4 14 0 28 27 ...
 $ Sex  : chr  &quot;F&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; ...</code></pre>
<p>Given the <code>namesDF</code> data, our goal over the next few sections is to develop a Shiny application that allows users to explore age distributions for males and females. We begin by defining a very basic Shiny application script upon which we can build the desired functionality. The script file that defines this basic application is called <code>app.R</code> and is provided in the code block below called “version 1”. Follow the subsequent steps to create and run this Shiny app (note these steps are already done for you in the “ShinyPractice” directory in “shiny_chapter_code.zip”, but you might want to do it yourself):</p>
<ol style="list-style-type: decimal">
<li>Create a new directory called “ShinyPractice”.</li>
<li>In the “ShinyPractice” directory, create a blank R script called <code>app.R</code>.</li>
<li>Copy the code in “app.R version 1” into <code>app.R</code>.</li>
<li>Run the Shiny app from RStudio. There are two ways to do this: 1) use the RStudio button (See Figure <a href="functions.html#fig:fig1">14</a>) or; 2) type the function <code>runApp()</code> in the RStudio console.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="functions.html#cb777-1"></a><span class="co"># app.R version 1</span></span>
<span id="cb777-2"><a href="functions.html#cb777-2"></a></span>
<span id="cb777-3"><a href="functions.html#cb777-3"></a><span class="kw">library</span>(shiny)</span>
<span id="cb777-4"><a href="functions.html#cb777-4"></a></span>
<span id="cb777-5"><a href="functions.html#cb777-5"></a>names.df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/name_list.csv&quot;</span>)</span>
<span id="cb777-6"><a href="functions.html#cb777-6"></a></span>
<span id="cb777-7"><a href="functions.html#cb777-7"></a><span class="co"># Define UI</span></span>
<span id="cb777-8"><a href="functions.html#cb777-8"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb777-9"><a href="functions.html#cb777-9"></a>  </span>
<span id="cb777-10"><a href="functions.html#cb777-10"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Random Names Analysis&quot;</span>),</span>
<span id="cb777-11"><a href="functions.html#cb777-11"></a>  </span>
<span id="cb777-12"><a href="functions.html#cb777-12"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb777-13"><a href="functions.html#cb777-13"></a>    </span>
<span id="cb777-14"><a href="functions.html#cb777-14"></a>    <span class="kw">sidebarPanel</span>(<span class="st">&quot;our inputs will be here&quot;</span>),</span>
<span id="cb777-15"><a href="functions.html#cb777-15"></a>    </span>
<span id="cb777-16"><a href="functions.html#cb777-16"></a>    <span class="kw">mainPanel</span>(<span class="st">&quot;our output will appear here&quot;</span>)</span>
<span id="cb777-17"><a href="functions.html#cb777-17"></a>  )</span>
<span id="cb777-18"><a href="functions.html#cb777-18"></a>)</span>
<span id="cb777-19"><a href="functions.html#cb777-19"></a></span>
<span id="cb777-20"><a href="functions.html#cb777-20"></a><span class="co"># Define server logic</span></span>
<span id="cb777-21"><a href="functions.html#cb777-21"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb777-22"><a href="functions.html#cb777-22"></a></span>
<span id="cb777-23"><a href="functions.html#cb777-23"></a><span class="co"># Create Shiny app</span></span>
<span id="cb777-24"><a href="functions.html#cb777-24"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<div class="figure"><span id="fig:fig1"></span>
<img src="../figures/RStudio_runApp.png" alt="Running a Shiny app locally" width="100%" />
<p class="caption">
FIGURE 14: Running a Shiny app locally
</p>
</div>
<p>If everything compiles correctly, you should get a window that looks like Figure <a href="functions.html#fig:fig2">15</a>. There are a few things to notice. First, we read in the CSV file at the beginning of the <code>app.R</code> script so that these data can be accessed in subsquent development steps (although we don’t use it yet in this initial application). Second, our Shiny app is not interactive yet because there is no way for a user to input any data—the page is view-only. Third, the function <code>function(input,output) {}</code> in <code>app.R</code> does not include any code, reflecting that we are not yet using any user inputs or creating any outputs.</p>
<div class="figure"><span id="fig:fig2"></span>
<img src="../figures/appSimple.png" alt="Your first Shiny app" width="100%" />
<p class="caption">
FIGURE 15: Your first Shiny app
</p>
</div>
</div>
<div id="adding-user-input" class="section level2" number="7.19">
<h2 number="7.19"><span class="header-section-number">7.19</span> Adding User Input</h2>
<p>Shiny package widgets are used to collect user provided inputs (visit the <a href="https://shiny.rstudio.com/gallery/widget-gallery.html">Shiny Widget Gallery</a> to get a sense of the different kinds of input dialogues). In the subsequent development we’ll use slider bars, dropdown menus, and check boxes. All widget functions, at minimum, include an <code>inputId</code> and <code>label</code> argument. The character string assigned to the <code>inputId</code> argument will be the variable name used to access the value(s) selected or provided by the user. This variable name is used in the application development and not seen by the user. The character string assigned to the <code>label</code> argument appears in the UI above the given input widget and serves to provide a user-friendly description of the desired input.</p>
<p>Building on the “version 1” code, we add a dropdown menu to the script’s UI portion using the <code>selectInput</code> function to the “version 2” code below. Update <code>app.R</code> and rerun the application. What is our <code>inputId</code> for the dropdown menu? What is our <code>label</code>? Can you see where the <code>label</code> is displayed in the app when you rerun it?</p>
<p>Look at the structure of the <code>choices</code> argument in <code>selectInput</code>. It’s a vector of options in the form <code>"name" = "value"</code> where the <code>name</code> is what the user sees, and the <code>value</code> is what is returned to the server logic function of the <code>app.R</code> file.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="functions.html#cb778-1"></a><span class="co"># app.R version 2</span></span>
<span id="cb778-2"><a href="functions.html#cb778-2"></a></span>
<span id="cb778-3"><a href="functions.html#cb778-3"></a><span class="kw">library</span>(shiny)</span>
<span id="cb778-4"><a href="functions.html#cb778-4"></a></span>
<span id="cb778-5"><a href="functions.html#cb778-5"></a>names.df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/name_list.csv&quot;</span>)</span>
<span id="cb778-6"><a href="functions.html#cb778-6"></a></span>
<span id="cb778-7"><a href="functions.html#cb778-7"></a><span class="co"># Define UI</span></span>
<span id="cb778-8"><a href="functions.html#cb778-8"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb778-9"><a href="functions.html#cb778-9"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Random Names Age Analysis&quot;</span>),</span>
<span id="cb778-10"><a href="functions.html#cb778-10"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb778-11"><a href="functions.html#cb778-11"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb778-12"><a href="functions.html#cb778-12"></a>      <span class="co"># Dropdown selection for Male/Female</span></span>
<span id="cb778-13"><a href="functions.html#cb778-13"></a>      <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;sexInput&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Sex:&quot;</span>,</span>
<span id="cb778-14"><a href="functions.html#cb778-14"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span> =<span class="st"> &quot;F&quot;</span>, </span>
<span id="cb778-15"><a href="functions.html#cb778-15"></a>                              <span class="st">&quot;Male&quot;</span> =<span class="st"> &quot;M&quot;</span>, </span>
<span id="cb778-16"><a href="functions.html#cb778-16"></a>                              <span class="st">&quot;Both&quot;</span> =<span class="st"> &quot;B&quot;</span>))</span>
<span id="cb778-17"><a href="functions.html#cb778-17"></a>    ),</span>
<span id="cb778-18"><a href="functions.html#cb778-18"></a>    <span class="kw">mainPanel</span>(<span class="st">&quot;our output will appear here&quot;</span>)</span>
<span id="cb778-19"><a href="functions.html#cb778-19"></a>  )</span>
<span id="cb778-20"><a href="functions.html#cb778-20"></a>)</span>
<span id="cb778-21"><a href="functions.html#cb778-21"></a></span>
<span id="cb778-22"><a href="functions.html#cb778-22"></a><span class="co"># Define server logic</span></span>
<span id="cb778-23"><a href="functions.html#cb778-23"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb778-24"><a href="functions.html#cb778-24"></a></span>
<span id="cb778-25"><a href="functions.html#cb778-25"></a><span class="co"># Create Shiny app</span></span>
<span id="cb778-26"><a href="functions.html#cb778-26"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
</div>
<div id="adding-output" class="section level2" number="7.20">
<h2 number="7.20"><span class="header-section-number">7.20</span> Adding Output</h2>
<p>Now that we’ve included the user input dialog, let’s make the application truly interactive by changing the output depending on user input. This is accomplished by modifying the server logic portion of the script. Our goal is to plot an age distribution histogram in the main panel given the sex selected by the user.</p>
<div id="interactive-server-logic" class="section level3" number="7.20.1">
<h3 number="7.20.1"><span class="header-section-number">7.20.1</span> Interactive Server Logic</h3>
<p>Server logic is defined by two arguments: <code>input</code> and <code>output</code>. These objects are both list-like, so they can contain multiple other objects. We already know from the user input part of the <code>app.R</code> script that we have an input component called <code>sexInput</code>, which can be accessed in the reactive portion of the server logic by calling <code>input$sexInput</code> (notice the use of the <code>$</code> to access the input value associated with <code>sexInput</code>). In “version 3” of the application, we use the information held in <code>input$sexInput</code> to subset <code>names.df</code> then create a histogram of <code>names.df$Age</code>. This histogram graphic is included as an element in the <code>output</code> object and ultimately made available in the UI portion of the script by referencing its name <code>histogram</code>.</p>
<p>Reactive portions of our <code>app.R</code> script’s server logic are inside the server function. We create reactive outputs using Shiny’s functions like <code>renderPlot</code>.<a href="references.html#fn50" class="footnote-ref" id="fnref50"><sup>50</sup></a> Obviously, <code>renderPlot</code> renders the contents of the function into a plot object; this is then stored in the <code>output</code> list wherever we assign it (in this case, <code>output$histogram</code>). Notice the contents of the <code>renderPlot</code> function are contained not only by regular parentheses, but also by curly brackets (just one more piece of syntax to keep track of).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="functions.html#cb779-1"></a><span class="co"># app.R version 3</span></span>
<span id="cb779-2"><a href="functions.html#cb779-2"></a></span>
<span id="cb779-3"><a href="functions.html#cb779-3"></a><span class="kw">library</span>(shiny)</span>
<span id="cb779-4"><a href="functions.html#cb779-4"></a></span>
<span id="cb779-5"><a href="functions.html#cb779-5"></a>names.df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/name_list.csv&quot;</span>)</span>
<span id="cb779-6"><a href="functions.html#cb779-6"></a></span>
<span id="cb779-7"><a href="functions.html#cb779-7"></a><span class="co"># Define UI</span></span>
<span id="cb779-8"><a href="functions.html#cb779-8"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb779-9"><a href="functions.html#cb779-9"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Random Names Age Analysis&quot;</span>),</span>
<span id="cb779-10"><a href="functions.html#cb779-10"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb779-11"><a href="functions.html#cb779-11"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb779-12"><a href="functions.html#cb779-12"></a>      <span class="co"># Dropdown selection for Male/Female</span></span>
<span id="cb779-13"><a href="functions.html#cb779-13"></a>      <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;sexInput&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Sex:&quot;</span>,</span>
<span id="cb779-14"><a href="functions.html#cb779-14"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span> =<span class="st"> &quot;F&quot;</span>, </span>
<span id="cb779-15"><a href="functions.html#cb779-15"></a>                              <span class="st">&quot;Male&quot;</span> =<span class="st"> &quot;M&quot;</span>, </span>
<span id="cb779-16"><a href="functions.html#cb779-16"></a>                              <span class="st">&quot;Both&quot;</span> =<span class="st"> &quot;B&quot;</span>))</span>
<span id="cb779-17"><a href="functions.html#cb779-17"></a>    ),</span>
<span id="cb779-18"><a href="functions.html#cb779-18"></a>    <span class="kw">mainPanel</span>(<span class="st">&quot;our output will appear here&quot;</span>)</span>
<span id="cb779-19"><a href="functions.html#cb779-19"></a>  )</span>
<span id="cb779-20"><a href="functions.html#cb779-20"></a>)</span>
<span id="cb779-21"><a href="functions.html#cb779-21"></a></span>
<span id="cb779-22"><a href="functions.html#cb779-22"></a><span class="co"># Define server logic</span></span>
<span id="cb779-23"><a href="functions.html#cb779-23"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb779-24"><a href="functions.html#cb779-24"></a></span>
<span id="cb779-25"><a href="functions.html#cb779-25"></a>  output<span class="op">$</span>histogram &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb779-26"><a href="functions.html#cb779-26"></a>    </span>
<span id="cb779-27"><a href="functions.html#cb779-27"></a>    <span class="cf">if</span>(input<span class="op">$</span>sexInput <span class="op">!=</span><span class="st"> &quot;B&quot;</span>){</span>
<span id="cb779-28"><a href="functions.html#cb779-28"></a>      subset.names.df &lt;-<span class="st"> </span><span class="kw">subset</span>(names.df, Sex <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>sexInput)</span>
<span id="cb779-29"><a href="functions.html#cb779-29"></a>    } <span class="cf">else</span> {</span>
<span id="cb779-30"><a href="functions.html#cb779-30"></a>      subset.names.df &lt;-<span class="st"> </span>names.df</span>
<span id="cb779-31"><a href="functions.html#cb779-31"></a>    }</span>
<span id="cb779-32"><a href="functions.html#cb779-32"></a>    </span>
<span id="cb779-33"><a href="functions.html#cb779-33"></a>    ages &lt;-<span class="st"> </span>subset.names.df<span class="op">$</span>Age</span>
<span id="cb779-34"><a href="functions.html#cb779-34"></a>    </span>
<span id="cb779-35"><a href="functions.html#cb779-35"></a>    <span class="co"># draw the histogram with the specified 20 bins</span></span>
<span id="cb779-36"><a href="functions.html#cb779-36"></a>    <span class="kw">hist</span>(ages, <span class="dt">col =</span> <span class="st">&#39;darkgray&#39;</span>, <span class="dt">border =</span> <span class="st">&#39;white&#39;</span>)</span>
<span id="cb779-37"><a href="functions.html#cb779-37"></a>  })</span>
<span id="cb779-38"><a href="functions.html#cb779-38"></a></span>
<span id="cb779-39"><a href="functions.html#cb779-39"></a>}</span>
<span id="cb779-40"><a href="functions.html#cb779-40"></a></span>
<span id="cb779-41"><a href="functions.html#cb779-41"></a><span class="co"># Create Shiny app</span></span>
<span id="cb779-42"><a href="functions.html#cb779-42"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p>Update your <code>app.R</code> server logic function to match the code above. Rerun the application. Note the appearance of the app doesn’t change because we have not updated the UI portion with the resulting histogram.</p>
</div>
<div id="interactive-user-interface" class="section level3" number="7.20.2">
<h3 number="7.20.2"><span class="header-section-number">7.20.2</span> Interactive User Interface</h3>
<p>Now we update the UI part of <code>app.R</code> to make the app interactive. In the “version 4” code below, the <code>plotOutput("histogram")</code> function in <code>ui</code> accesses the <code>histogram</code> component of the <code>output</code> list and plots it in the main panel. Copy the code below and rerun the application. You have now created your first Shiny app!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="functions.html#cb780-1"></a><span class="co"># app.R version 4</span></span>
<span id="cb780-2"><a href="functions.html#cb780-2"></a></span>
<span id="cb780-3"><a href="functions.html#cb780-3"></a><span class="kw">library</span>(shiny)</span>
<span id="cb780-4"><a href="functions.html#cb780-4"></a></span>
<span id="cb780-5"><a href="functions.html#cb780-5"></a>names.df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://www.finley-lab.com/files/data/name_list.csv&quot;</span>)</span>
<span id="cb780-6"><a href="functions.html#cb780-6"></a></span>
<span id="cb780-7"><a href="functions.html#cb780-7"></a><span class="co"># Define UI</span></span>
<span id="cb780-8"><a href="functions.html#cb780-8"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb780-9"><a href="functions.html#cb780-9"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Random Names Age Analysis&quot;</span>),</span>
<span id="cb780-10"><a href="functions.html#cb780-10"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb780-11"><a href="functions.html#cb780-11"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb780-12"><a href="functions.html#cb780-12"></a>      <span class="co"># Dropdown selection for Male/Female</span></span>
<span id="cb780-13"><a href="functions.html#cb780-13"></a>      <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;sexInput&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Sex:&quot;</span>,</span>
<span id="cb780-14"><a href="functions.html#cb780-14"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span> =<span class="st"> &quot;F&quot;</span>, </span>
<span id="cb780-15"><a href="functions.html#cb780-15"></a>                              <span class="st">&quot;Male&quot;</span> =<span class="st"> &quot;M&quot;</span>, </span>
<span id="cb780-16"><a href="functions.html#cb780-16"></a>                              <span class="st">&quot;Both&quot;</span> =<span class="st"> &quot;B&quot;</span>))</span>
<span id="cb780-17"><a href="functions.html#cb780-17"></a>    ),</span>
<span id="cb780-18"><a href="functions.html#cb780-18"></a>    <span class="kw">mainPanel</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;histogram&quot;</span>))</span>
<span id="cb780-19"><a href="functions.html#cb780-19"></a>  )</span>
<span id="cb780-20"><a href="functions.html#cb780-20"></a>)</span>
<span id="cb780-21"><a href="functions.html#cb780-21"></a></span>
<span id="cb780-22"><a href="functions.html#cb780-22"></a><span class="co"># Define server logic</span></span>
<span id="cb780-23"><a href="functions.html#cb780-23"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb780-24"><a href="functions.html#cb780-24"></a></span>
<span id="cb780-25"><a href="functions.html#cb780-25"></a>  output<span class="op">$</span>histogram &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb780-26"><a href="functions.html#cb780-26"></a></span>
<span id="cb780-27"><a href="functions.html#cb780-27"></a>    <span class="cf">if</span>(input<span class="op">$</span>sexInput <span class="op">!=</span><span class="st"> &quot;B&quot;</span>){</span>
<span id="cb780-28"><a href="functions.html#cb780-28"></a>      subset.names.df &lt;-<span class="st"> </span><span class="kw">subset</span>(names.df, Sex <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>sexInput)</span>
<span id="cb780-29"><a href="functions.html#cb780-29"></a>    } <span class="cf">else</span> {</span>
<span id="cb780-30"><a href="functions.html#cb780-30"></a>      subset.names.df &lt;-<span class="st"> </span>names.df</span>
<span id="cb780-31"><a href="functions.html#cb780-31"></a>    }</span>
<span id="cb780-32"><a href="functions.html#cb780-32"></a>    </span>
<span id="cb780-33"><a href="functions.html#cb780-33"></a>    ages &lt;-<span class="st"> </span>subset.names.df<span class="op">$</span>Age</span>
<span id="cb780-34"><a href="functions.html#cb780-34"></a>    </span>
<span id="cb780-35"><a href="functions.html#cb780-35"></a>    <span class="co"># draw the histogram with the specified 20 bins</span></span>
<span id="cb780-36"><a href="functions.html#cb780-36"></a>    <span class="kw">hist</span>(ages, <span class="dt">col =</span> <span class="st">&#39;darkgray&#39;</span>, <span class="dt">border =</span> <span class="st">&#39;white&#39;</span>)</span>
<span id="cb780-37"><a href="functions.html#cb780-37"></a>  })</span>
<span id="cb780-38"><a href="functions.html#cb780-38"></a></span>
<span id="cb780-39"><a href="functions.html#cb780-39"></a>}</span>
<span id="cb780-40"><a href="functions.html#cb780-40"></a></span>
<span id="cb780-41"><a href="functions.html#cb780-41"></a><span class="co"># Create Shiny app</span></span>
<span id="cb780-42"><a href="functions.html#cb780-42"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
</div>
</div>
<div id="more-advanced-shiny-app-michigan-campgrounds" class="section level2" number="7.21">
<h2 number="7.21"><span class="header-section-number">7.21</span> More Advanced Shiny App: Michigan Campgrounds</h2>
<p>The Michigan Department of Natural Resources (DNR) has made substantial investments in open-sourcing its data via the <a href="http://gis-midnr.opendata.arcgis.com/datasets/">Michigan DNR’s open data</a> initiative. We’ll use some of these data to motivate our next Shiny application. Specifically we’ll work with the DNR State Park Campgrounds data available <a href="https://www.finley-lab.com/files/data/Michigan_State_Park_Campgrounds.csv">here</a> as a CSV file.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="functions.html#cb781-1"></a><span class="op">&gt;</span><span class="st"> </span>u &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/Michigan_State_Park_Campgrounds.csv&quot;</span></span>
<span id="cb781-2"><a href="functions.html#cb781-2"></a><span class="op">&gt;</span><span class="st"> </span>sites &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb781-3"><a href="functions.html#cb781-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(sites)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   151 obs. of  19 variables:
 $ X          : num  -84.4 -84.4 -83.8 -83.8 -83.8 ...
 $ Y          : num  42.9 42.9 42.5 42.5 42.5 ...
 $ OBJECTID   : int  10330 10331 5986 5987 5988 5989 5990 5991 5992 5993 ...
 $ Type       : chr  &quot;Campground&quot; &quot;Campground&quot; &quot;Campground&quot; &quot;Campground&quot; ...
 $ Detail_Type: chr  &quot;State Park&quot; &quot;State Park&quot; &quot;State Park&quot; &quot;State Park&quot; ...
 $ DISTRICT   : chr  &quot;Rose Lake&quot; &quot;Rose Lake&quot; &quot;Rose Lake&quot; &quot;Rose Lake&quot; ...
 $ COUNTY     : chr  &quot;Clinton&quot; &quot;Clinton&quot; &quot;Livingston&quot; &quot;Livingston&quot; ...
 $ FACILITY   : chr  &quot;Sleepy Hollow State Park&quot; &quot;Sleepy Hollow State Park&quot; &quot;Brighton Recreation Area&quot; &quot;Brighton Recreation Area&quot; ...
 $ Camp_type  : chr  &quot;Modern&quot; &quot;Organizational&quot; &quot;Modern&quot; &quot;Organizational&quot; ...
 $ TOTAL_SITE : int  203 1 144 10 25 25 219 75 2 297 ...
 $ ADA_SITES  : int  0 0 0 0 0 0 0 3 0 13 ...
 $ name       : chr  &quot;Sleepy Hollow State Park  &quot; &quot;Sleepy Hollow State Park  &quot; &quot;Brighton Recreation Area Bishop Lake&quot; &quot;Brighton Recreation Area  &quot; ...
 $ Ownership  : chr  &quot;State&quot; &quot;State&quot; &quot;State&quot; &quot;State&quot; ...
 $ Management : chr  &quot;DNR&quot; &quot;DNR&quot; &quot;DNR&quot; &quot;DNR&quot; ...
 $ Surface    : chr  &quot;Dirt&quot; &quot;Dirt&quot; &quot;Dirt&quot; &quot;Dirt&quot; ...
 $ Use_       : chr  &quot;Recreation&quot; &quot;Recreation&quot; &quot;Recreation&quot; &quot;Recreation&quot; ...
 $ Condition  : chr  &quot;Unknown&quot; &quot;Unknown&quot; &quot;Unknown&quot; &quot;Unknown&quot; ...
 $ Lat        : num  42.9 42.9 42.5 42.5 42.5 ...
 $ Long       : num  -84.4 -84.4 -83.8 -83.8 -83.8 ...</code></pre>
<p>We see that Michigan has 151 state park campgrounds, and our data frame contains 19 variables. Let’s create a Shiny app UI in which the user selects desired campground specifications, and the app displays the list of resulting campgrounds and their location on a map. The complete Shiny <code>app.R</code> is provided in the “CampsitesMI” directory in “shiny_chapter_code.zip.” Start out by running the application to see how it works. Examine the example code and how it relates to the application that you are running. The following sections detail each of the app’s components.</p>
<div id="michigan-campgrounds-ui" class="section level3" number="7.21.1">
<h3 number="7.21.1"><span class="header-section-number">7.21.1</span> Michigan Campgrounds UI</h3>
<p>First, let’s look at the structure of the page. Similar to our first application, we again use a <code>fluidPage</code> layout with title panel and sidebar. The sidebar contains a sidebar panel and a main panel. Our sidebar panel has three user input widgets:</p>
<ul>
<li><code>sliderInput</code>: Allows user to specify a range of campsites desired in their campground. Since the maximum number of campsites in any Michigan state park campground is 411, 420 was chosen as the maximum.</li>
<li><code>selectInput</code>: Allows user to select what type of campsites they want. To get the entire list of camp types, we used the data frame, <code>sites</code>, loaded at the beginning of the script.</li>
<li><code>checkboxInput</code>: Allows the user to see only campgrounds with ADA sites available.</li>
</ul>
<table>
<caption><span id="tab:els">TABLE 5: </span>Interactive elements</caption>
<thead>
<tr class="header">
<th align="left">Element ID</th>
<th align="left">Description</th>
<th align="left">Function to Create</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">input$rangeNum</td>
<td align="left">desired range of campsite quantity</td>
<td align="left">sliderInput</td>
</tr>
<tr class="even">
<td align="left">input$type</td>
<td align="left">desired campsite type</td>
<td align="left">selectInput</td>
</tr>
<tr class="odd">
<td align="left">input$ada</td>
<td align="left">desired ADA site availability</td>
<td align="left">checkboxInput</td>
</tr>
<tr class="even">
<td align="left">output$plot1</td>
<td align="left">map with campground markers</td>
<td align="left">renderPlot</td>
</tr>
<tr class="odd">
<td align="left">output$text1</td>
<td align="left">HTML-formatted list of campgrounds</td>
<td align="left">renderText</td>
</tr>
</tbody>
</table>
<p>Table <a href="functions.html#tab:els">5</a> provides a list of the various input and output elements. Take your time and track how the app defines then uses each input and output.</p>
</div>
<div id="michigan-campgrounds-server-logic" class="section level3" number="7.21.2">
<h3 number="7.21.2"><span class="header-section-number">7.21.2</span> Michigan Campgrounds Server Logic</h3>
<p>In creating our <code>server</code> variable, we have two functions that fill in our output elements:</p>
<ul>
<li><code>renderText</code>: Creates a character string of HTML code to print the bulleted list of available sites.</li>
<li><code>renderPlot</code>: Creates a <code>ggplot2</code> map of Michigan with campground markers.</li>
</ul>
<p>Note that both of these functions contain identical subsetting of the <code>sites</code> data frame into the smaller <code>sites1</code> data frame (see below). As you can see from the code, we use the three inputs from the application to subset the data: <code>rangeNum</code> from the slider widget, <code>type</code> from the dropdown menu, and <code>ada</code> from the checkbox.</p>
<p>This repeated code can be avoided using Shiny’s reactive expressions. These expressions will update in value whenever the widget input values change. See <a href="https://shiny.rstudio.com/tutorial/written-tutorial/lesson6/">here</a> for more information. The use of reactive expressions is beyond the scope of this chapter, but it is an important concept to be familiar with if you plan to regularly create Shiny applications.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="functions.html#cb783-1"></a>sites1 &lt;-<span class="st"> </span><span class="kw">subset</span>(sites, </span>
<span id="cb783-2"><a href="functions.html#cb783-2"></a>                  TOTAL_SITE <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>rangeNum[<span class="dv">1</span>] <span class="op">&amp;</span><span class="st">  </span></span>
<span id="cb783-3"><a href="functions.html#cb783-3"></a><span class="st">                  </span>TOTAL_SITE <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>rangeNum[<span class="dv">2</span>] <span class="op">&amp;</span><span class="st">  </span></span>
<span id="cb783-4"><a href="functions.html#cb783-4"></a><span class="st">                  </span>Camp_type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>type <span class="op">&amp;</span><span class="st">   </span></span>
<span id="cb783-5"><a href="functions.html#cb783-5"></a><span class="st">                  </span><span class="cf">if</span>(input<span class="op">$</span>ada){ ADA_SITES <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> } <span class="cf">else</span> {ADA_SITES <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>}</span>
<span id="cb783-6"><a href="functions.html#cb783-6"></a>                )</span></code></pre></div>
</div>
</div>
<div id="adding-leaflet-to-shiny" class="section level2" number="7.22">
<h2 number="7.22"><span class="header-section-number">7.22</span> Adding Leaflet to Shiny</h2>
<p><a href="https://rstudio.github.io/leaflet">Leaflet</a> can be easily incorporated in Shiny apps (See Chapter <a href="#sp"><strong>??</strong></a> of this text to learn more about spatial data). In the Michigan Campgrounds example code, we used <code>plotOutput</code> and <code>renderPlot</code> to put a plot widget in our Shiny app. Similarly, in this code, we will use <code>leafletOutput</code> and <code>renderLeaflet</code> to add Leaflet widgets to our app. Run the Shiny app in the <code>CampsitesMI_Leaflet</code> directory. What are the differences between the plot widget in this app and the plot widget in the previous app (using <code>ggplot2</code>)?</p>
<p>Our code inside <code>renderLeaflet</code> is displayed below. As a reminder from our previous use of Leaflet, we can use the <code>magrittr</code> package’s pipe operator, <code>%&gt;%</code>, to add properties to our Leaflet plot.
In the <code>addCircleMarkers</code> function, you can see that we used the <code>mapply</code> function to apply HTML code to each of the markers. The HTML code simply prints the site name and number of sites within each marker label. The <code>else</code> statement serves the purpsose that if our subset, <code>sites1</code>, is empty, we render a map centered on Lansing, MI.</p>
<p>}</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="functions.html#cb784-1"></a><span class="co"># renderLeaflet function from app.R</span></span>
<span id="cb784-2"><a href="functions.html#cb784-2"></a></span>
<span id="cb784-3"><a href="functions.html#cb784-3"></a>output<span class="op">$</span>plot1 &lt;-<span class="st"> </span><span class="kw">renderLeaflet</span>({</span>
<span id="cb784-4"><a href="functions.html#cb784-4"></a>    <span class="co"># create a subset of campsites based on inputs</span></span>
<span id="cb784-5"><a href="functions.html#cb784-5"></a>    sites1 &lt;-<span class="st"> </span><span class="kw">subset</span>(sites, </span>
<span id="cb784-6"><a href="functions.html#cb784-6"></a>                    TOTAL_SITE <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>rangeNum[<span class="dv">1</span>] <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb784-7"><a href="functions.html#cb784-7"></a><span class="st">                      </span>TOTAL_SITE <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>rangeNum[<span class="dv">2</span>] <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb784-8"><a href="functions.html#cb784-8"></a><span class="st">                      </span>Camp_type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>type <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb784-9"><a href="functions.html#cb784-9"></a><span class="st">                      </span><span class="cf">if</span>(input<span class="op">$</span>ada){ ADA_SITES <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> } <span class="cf">else</span> {ADA_SITES <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>})</span>
<span id="cb784-10"><a href="functions.html#cb784-10"></a>    </span>
<span id="cb784-11"><a href="functions.html#cb784-11"></a>    <span class="cf">if</span>(<span class="kw">nrow</span>(sites1) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb784-12"><a href="functions.html#cb784-12"></a>      <span class="kw">leaflet</span>(sites1) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addTiles</span>()  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb784-13"><a href="functions.html#cb784-13"></a><span class="st">        </span><span class="kw">addCircleMarkers</span>(<span class="dt">lng =</span> <span class="op">~</span>Long, <span class="dt">lat =</span> <span class="op">~</span>Lat, </span>
<span id="cb784-14"><a href="functions.html#cb784-14"></a>                         <span class="dt">radius =</span> <span class="dv">5</span>,</span>
<span id="cb784-15"><a href="functions.html#cb784-15"></a>                         <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb784-16"><a href="functions.html#cb784-16"></a>                         <span class="dt">label =</span> <span class="kw">mapply</span>(<span class="cf">function</span>(x,y) {</span>
<span id="cb784-17"><a href="functions.html#cb784-17"></a>                           <span class="kw">HTML</span>(<span class="kw">sprintf</span>(<span class="st">&#39;&lt;em&gt;%s&lt;/em&gt;&lt;br&gt;%s site(s)&#39;</span>, </span>
<span id="cb784-18"><a href="functions.html#cb784-18"></a>                                        <span class="kw">htmlEscape</span>(x), </span>
<span id="cb784-19"><a href="functions.html#cb784-19"></a>                                        <span class="kw">htmlEscape</span>(y)))}, </span>
<span id="cb784-20"><a href="functions.html#cb784-20"></a>                           sites1<span class="op">$</span>FACILITY, sites1<span class="op">$</span>TOTAL_SITE</span>
<span id="cb784-21"><a href="functions.html#cb784-21"></a>                           )</span>
<span id="cb784-22"><a href="functions.html#cb784-22"></a>                         )</span>
<span id="cb784-23"><a href="functions.html#cb784-23"></a>    } <span class="cf">else</span> {</span>
<span id="cb784-24"><a href="functions.html#cb784-24"></a>        <span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb784-25"><a href="functions.html#cb784-25"></a><span class="st">        </span><span class="kw">setView</span>( <span class="fl">-84.5555</span>, <span class="fl">42.7325</span>,   <span class="dt">zoom =</span> <span class="dv">7</span>)</span>
<span id="cb784-26"><a href="functions.html#cb784-26"></a>    }</span>
<span id="cb784-27"><a href="functions.html#cb784-27"></a>    </span>
<span id="cb784-28"><a href="functions.html#cb784-28"></a>  })</span></code></pre></div>
</div>
<div id="why-use-shiny" class="section level2" number="7.23">
<h2 number="7.23"><span class="header-section-number">7.23</span> Why use Shiny?</h2>
<p>In this chapter, we learned what a Shiny app is, what it’s components are, how to run the app, and how to incorporate Leaflet plots. We can also host these apps online on our own server or the <a href="https://www.shinyapps.io/">shinyapps.io</a> server, which can be accessed directly from RStudio. Hosting our apps on a server allows anyone with internet access to interact with our widgets.</p>
<p>The shinyapps.io server allows free hosting of apps within the monthly limits of 5 applications and 25 active hours. Paid plans are also available. A user guide to deploying your application on shinyapps.io is available <a href="http://docs.rstudio.com/shinyapps.io/index.html">here</a>. Set up a free account and impress your friends by sending them links to your Shiny apps! In addition to hosting your applications, here are a few more things to discover with Shiny:</p>
<ul>
<li><a href="https://shiny.rstudio.com/tutorial/%7D">Dive deeper</a> into development by working through the RStudio Shiny tutorial series.</li>
<li><a href="https://shiny.rstudio.com/articles/css.html">Incorporate</a> CSS stylesheets to make your apps fancier.</li>
<li><a href="https://shiny.rstudio.com/articles/single-file.html">Explore</a> the single-file Shiny app structure.</li>
</ul>
</div>
<div id="exercises-6" class="section level2" number="7.24">
<h2 number="7.24"><span class="header-section-number">7.24</span> Exercises</h2>
<p><strong>Exercise Shiny</strong> Learning objectives: practice updating <code>ggplot2</code> plot aesthetics; modify Shiny HTML output; add an interactive Shiny element.</p>

<p>_# Classification</p>
<p>Classification problems are quite common. For example a spam filter is asked to classify incoming messages into spam or non-spam, based on factors such as the sender’s address, the subject of the message, the contents of the message, and so on. As another example, a doctor diagnosing a patient into one of four possible diagnoses based on symptoms, blood tests, and medical history is another form of classification. Or a bank may want to determine (prior to giving a loan) whether an applicant for a loan will default on the loan, again based on several variables such as income, financial history, etc.</p>
<p>Classification methods are both extremely useful and an active area of research in statistics. In this chapter we will learn about two common, and somewhat different, classification methods, logistic regression and <span class="math inline">\(k\)</span> nearest neighbors. A very good introduction to classification and many other “Statistical Learning” methods is <span class="citation">James et al. (<a href="references.html#ref-JamesEtAl" role="doc-biblioref">2014</a>)</span>. The abbreviated treatment in this chapter draws from <span class="citation">James et al. (<a href="references.html#ref-JamesEtAl" role="doc-biblioref">2014</a>)</span>.</p>
</div>
<div id="logistic-regression" class="section level2" number="7.25">
<h2 number="7.25"><span class="header-section-number">7.25</span> Logistic Regression</h2>
<p>Logistic regression is widely used to relate a categorical response variable to one or more (continuous or categorical) predictors. Initially we will consider the simplest case where the response <span class="math inline">\(Y\)</span> has only two possible values (we’ll assume the values are <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>) and where there is only one continuous predictor <span class="math inline">\(X\)</span>. We would like to predict the value of <span class="math inline">\(Y\)</span> based on the value of the predictor <span class="math inline">\(X\)</span>. Let <span class="math inline">\(p(X) = P(Y = 1 | X)\)</span>.<a href="references.html#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a>. We will model <span class="math inline">\(p(X)\)</span> with the <em>logistic function</em>, which takes values between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>, which is of course appropriate for modeling a probability:</p>
<p><span class="math display">\[
p(X) = \frac{e^{\beta_0 + \beta_1 X}}{1 + e^{\beta_0 + \beta_1 X}}.
\]</span></p>
<p>A graph of this function when <span class="math inline">\(\beta_0=0\)</span> and <span class="math inline">\(\beta_1 = 1\)</span> shows the characteristic shape.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="functions.html#cb785-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</span>
<span id="cb785-2"><a href="functions.html#cb785-2"></a><span class="op">&gt;</span><span class="st"> </span>logistic &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(x))}</span>
<span id="cb785-3"><a href="functions.html#cb785-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>)), <span class="kw">aes</span>(x)) <span class="op">+</span></span>
<span id="cb785-4"><a href="functions.html#cb785-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> logistic)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-234-1.png" width="672" /></p>
<p>To make this more concrete, we will consider a data set on a population of women who were over 21 years of age, lived near Phoenix, Arizona, and were of Pima Indian heritage. The data included diabetes status (yes or no) and seven possible predictor variables such as age, number of pregnancies, body mass index, etc. The original data are from the National Institute of Diabetes and Digestive and Kidney Diseases. These data were cleaned and are available in the <code>MASS</code> package in R. In the package the data frame <code>Pima.tr</code> contains 200 randomly selected cases from the full data set, which we will use to find a classifier. The data frame <code>Pima.te</code> contains the remaining 332 cases, which we will use to test the classifier on new data.<a href="references.html#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="functions.html#cb786-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(MASS)</span>
<span id="cb786-2"><a href="functions.html#cb786-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(Pima.tr)</span></code></pre></div>
<pre><code>  npreg glu bp skin  bmi   ped age type
1     5  86 68   28 30.2 0.364  24   No
2     7 195 70   33 25.1 0.163  55  Yes
3     5  77 82   41 35.8 0.156  35   No
4     0 165 76   43 47.9 0.259  26   No
5     0 107 60   25 26.4 0.133  23   No
6     5  97 76   27 35.6 0.378  52  Yes</code></pre>
<p>It will be more convenient to code the presence or absence of diabetes by 1 and 0, so we first create another column in the data frame with this coding:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="functions.html#cb788-1"></a><span class="op">&gt;</span><span class="st"> </span>Pima.tr<span class="op">$</span>diabetes &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">dim</span>(Pima.tr)[<span class="dv">1</span>])</span>
<span id="cb788-2"><a href="functions.html#cb788-2"></a><span class="op">&gt;</span><span class="st"> </span>Pima.tr<span class="op">$</span>diabetes[Pima.tr<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb788-3"><a href="functions.html#cb788-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(Pima.tr)</span></code></pre></div>
<pre><code>  npreg glu bp skin  bmi   ped age type diabetes
1     5  86 68   28 30.2 0.364  24   No        0
2     7 195 70   33 25.1 0.163  55  Yes        1
3     5  77 82   41 35.8 0.156  35   No        0
4     0 165 76   43 47.9 0.259  26   No        0
5     0 107 60   25 26.4 0.133  23   No        0
6     5  97 76   27 35.6 0.378  52  Yes        1</code></pre>
<p>We will begin with <code>glu</code> as a predictor, and of course <code>type</code> as the response. So we want to find the values <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> which provide the best fit for the model</p>
<p><span class="math display">\[
P(\text{yes} | \text{glu}) = \frac{e^{\beta_0 + \beta_1 (\text{glu})}}{1 + e^{\beta_0 + \beta_1 (\text{glu})}}
\]</span></p>
<p>Usually maximum likelihood methods are used to fit the model.</p>
<p>In R we will use the function <code>glm</code> to fit logistic regression models. The <code>glm</code> function fits a wide variety of models. To specify the logistic regression model we specify <code>family = binomial</code> as an argument to <code>glm</code>. We also must specify the predictor and response variables via the model formula, which in our case will be <code>diabetes ~ glu</code> to indicate that <code>diabetes</code> (i.e., <code>type</code> recoded) is the response and <code>glu</code> is the predictor; also we specify the data frame, which in our case is <code>Pima.tr</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="functions.html#cb790-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.lr1 &lt;-<span class="st"> </span><span class="kw">glm</span>(diabetes <span class="op">~</span><span class="st"> </span>glu, <span class="dt">data =</span> Pima.tr, <span class="dt">family =</span> binomial)</span>
<span id="cb790-2"><a href="functions.html#cb790-2"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.lr1</span></code></pre></div>
<pre><code>
Call:  glm(formula = diabetes ~ glu, family = binomial, data = Pima.tr)

Coefficients:
(Intercept)          glu  
    -5.5036       0.0378  

Degrees of Freedom: 199 Total (i.e. Null);  198 Residual
Null Deviance:      256 
Residual Deviance: 207  AIC: 211</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="functions.html#cb792-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(diabetes.lr1)</span></code></pre></div>
<pre><code>
Call:
glm(formula = diabetes ~ glu, family = binomial, data = Pima.tr)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-1.971  -0.779  -0.529   0.849   2.263  

Coefficients:
            Estimate Std. Error z value       Pr(&gt;|z|)
(Intercept) -5.50364    0.83608   -6.58 0.000000000046
glu          0.03778    0.00628    6.02 0.000000001756
               
(Intercept) ***
glu         ***
---
Signif. codes:  
0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 256.41  on 199  degrees of freedom
Residual deviance: 207.37  on 198  degrees of freedom
AIC: 211.4

Number of Fisher Scoring iterations: 4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="functions.html#cb794-1"></a><span class="op">&gt;</span><span class="st"> </span>beta0.lr<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">coef</span>(diabetes.lr1)[<span class="dv">1</span>]</span>
<span id="cb794-2"><a href="functions.html#cb794-2"></a><span class="op">&gt;</span><span class="st"> </span>beta1.lr<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">coef</span>(diabetes.lr1)[<span class="dv">2</span>]</span>
<span id="cb794-3"><a href="functions.html#cb794-3"></a><span class="op">&gt;</span><span class="st"> </span>beta0.lr<span class="fl">.1</span></span></code></pre></div>
<pre><code>(Intercept) 
     -5.504 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="functions.html#cb796-1"></a><span class="op">&gt;</span><span class="st"> </span>beta1.lr<span class="fl">.1</span></span></code></pre></div>
<pre><code>    glu 
0.03778 </code></pre>
<p>The coefficients <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are approximately -5.504 and
0.038, respectively. So for example we can estimate the probability that a woman in this population whose glucose level is 150 would be diabetic as</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="functions.html#cb798-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">5.504</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.038</span><span class="op">*</span><span class="dv">150</span>)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="fl">5.504</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.038</span><span class="op">*</span><span class="dv">150</span>))</span></code></pre></div>
<pre><code>[1] 0.5488</code></pre>
<p>We can plot the fitted probabilities along with the data “by hand”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="functions.html#cb800-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.logistic<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb800-2"><a href="functions.html#cb800-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">exp</span>(beta0.lr<span class="fl">.1</span><span class="op">+</span><span class="st"> </span>beta1.lr<span class="fl">.1</span><span class="op">*</span>x)<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(beta0.lr<span class="fl">.1</span><span class="op">+</span><span class="st"> </span></span>
<span id="cb800-3"><a href="functions.html#cb800-3"></a><span class="op">+</span><span class="st">                                            </span>beta1.lr<span class="fl">.1</span><span class="op">*</span>x))</span>
<span id="cb800-4"><a href="functions.html#cb800-4"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb800-5"><a href="functions.html#cb800-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(Pima.tr, <span class="kw">aes</span>(<span class="dt">x =</span> glu, <span class="dt">y =</span> diabetes)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb800-6"><a href="functions.html#cb800-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> diabetes.logistic<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-239-1.png" width="672" /></p>
<p>The <code>ggplot2</code> package also provides a way to do this more directly, using <code>stat_smooth</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="functions.html#cb801-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(Pima.tr, <span class="kw">aes</span>(<span class="dt">x =</span> glu, <span class="dt">y =</span> diabetes)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb801-2"><a href="functions.html#cb801-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb801-3"><a href="functions.html#cb801-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, </span>
<span id="cb801-4"><a href="functions.html#cb801-4"></a><span class="op">+</span><span class="st">               </span><span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>), <span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-240-1.png" width="672" /></p>
<p>From these graphics we can see that although glucose level and diabetes are related, there are many women with high glucose levels who are not diabetic, and many with low glucose levels who are diabetic, so likely adding other predictors to the model will help.</p>
<p>Next let’s see how the model does in predicting diabetes status in the data we did not use for fitting the model. We will predict diabetes for anyone whose glucose level leads to a model-based probability greater than <span class="math inline">\(1/2\)</span>. First we use the <code>predict</code> function to compute the probabilities, and then use these to make predictions.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="functions.html#cb802-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(Pima.te)</span></code></pre></div>
<pre><code>  npreg glu bp skin  bmi   ped age type
1     6 148 72   35 33.6 0.627  50  Yes
2     1  85 66   29 26.6 0.351  31   No
3     1  89 66   23 28.1 0.167  21   No
4     3  78 50   32 31.0 0.248  26  Yes
5     2 197 70   45 30.5 0.158  53  Yes
6     5 166 72   19 25.8 0.587  51  Yes</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="functions.html#cb804-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.probs<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(diabetes.lr1, Pima.te, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb804-2"><a href="functions.html#cb804-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(diabetes.probs<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>      1       2       3       4       5       6 
0.52207 0.09179 0.10519 0.07199 0.87433 0.68319 </code></pre>
<p>The <code>predict</code> function (with <code>type = "response"</code> specified) provides <span class="math inline">\(p(x) = P(Y = 1 | X = x)\)</span> for all the <span class="math inline">\(x\)</span> values in a data frame. In this case we specified the data frame <code>Pima.te</code> since we want to know how the model does in predicting diabetes in a new population, i.e., in a population that wasn’t used to “train” the model.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="functions.html#cb806-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.predict<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;No&quot;</span>, <span class="kw">dim</span>(Pima.te)[<span class="dv">1</span>])</span>
<span id="cb806-2"><a href="functions.html#cb806-2"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.predict<span class="fl">.1</span>[diabetes.probs<span class="fl">.1</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>] &lt;-<span class="st"> &quot;Yes&quot;</span></span>
<span id="cb806-3"><a href="functions.html#cb806-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(diabetes.predict<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>[1] &quot;Yes&quot; &quot;No&quot;  &quot;No&quot;  &quot;No&quot;  &quot;Yes&quot; &quot;Yes&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="functions.html#cb808-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(diabetes.predict<span class="fl">.1</span>, Pima.te<span class="op">$</span>type)</span></code></pre></div>
<pre><code>                  
diabetes.predict.1  No Yes
               No  206  58
               Yes  17  51</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="functions.html#cb810-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(diabetes.predict<span class="fl">.1</span>[diabetes.predict<span class="fl">.1</span> <span class="op">==</span><span class="st"> </span>Pima.te<span class="op">$</span>type])<span class="op">/</span></span>
<span id="cb810-2"><a href="functions.html#cb810-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">dim</span>(Pima.te)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>[1] 0.7741</code></pre>
<p>The table (sometimes called a <em>confusion matrix</em>) has the predictions of the model in the rows, so for example we see that the model predicts that <span class="math inline">\(206 + 58 = 264\)</span> of the women will not be diabetic, and that <span class="math inline">\(17+51 = 68\)</span> of the women will be diabetic. More interesting of course are the cells themselves. For example, of the <span class="math inline">\(206 + 17 = 223\)</span> women who are not diabetic in <code>Pima.te</code>, the model correctly classifies 206, and misclassifies 17. A classifier that predicted perfectly for the test data would have zeros off the diagonal.</p>
<div id="adding-predictors" class="section level3" number="7.25.1">
<h3 number="7.25.1"><span class="header-section-number">7.25.1</span> Adding Predictors</h3>
<p>If we have <span class="math inline">\(p\)</span> predictors <span class="math inline">\(X = (X_1, \dots, X_p)\)</span>, the logistic model becomes</p>
<p><span class="math display">\[
p(X) = p(X) = \frac{e^{\beta_0 + \beta_1 X + \dots + \beta_p X_p}}{1 + e^{\beta_0 + \beta_1 X + \dots + \beta_p X_p}}.
\]</span></p>
<p>Although there is a lot more notation to keep track of, the basic ideas are the same as they were for the one predictor model. We will next see how adding <code>bmi</code>, the body mass index, affects predictions of diabetes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="functions.html#cb812-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.lr2 &lt;-<span class="st"> </span><span class="kw">glm</span>(diabetes <span class="op">~</span><span class="st"> </span>glu <span class="op">+</span><span class="st"> </span>bmi, </span>
<span id="cb812-2"><a href="functions.html#cb812-2"></a><span class="op">+</span><span class="st">                     </span><span class="dt">data =</span> Pima.tr, <span class="dt">family =</span> binomial)</span>
<span id="cb812-3"><a href="functions.html#cb812-3"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.lr2</span></code></pre></div>
<pre><code>
Call:  glm(formula = diabetes ~ glu + bmi, family = binomial, data = Pima.tr)

Coefficients:
(Intercept)          glu          bmi  
    -8.2161       0.0357       0.0900  

Degrees of Freedom: 199 Total (i.e. Null);  197 Residual
Null Deviance:      256 
Residual Deviance: 198  AIC: 204</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="functions.html#cb814-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(diabetes.lr2)</span></code></pre></div>
<pre><code>
Call:
glm(formula = diabetes ~ glu + bmi, family = binomial, data = Pima.tr)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-2.058  -0.757  -0.431   0.801   2.249  

Coefficients:
            Estimate Std. Error z value     Pr(&gt;|z|)
(Intercept) -8.21611    1.34697   -6.10 0.0000000011
glu          0.03572    0.00631    5.66 0.0000000152
bmi          0.09002    0.03127    2.88        0.004
               
(Intercept) ***
glu         ***
bmi         ** 
---
Signif. codes:  
0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 256.41  on 199  degrees of freedom
Residual deviance: 198.47  on 197  degrees of freedom
AIC: 204.5

Number of Fisher Scoring iterations: 4</code></pre>
<p>Now we look at predictions from this model.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="functions.html#cb816-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.probs<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(diabetes.lr2, Pima.te, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb816-2"><a href="functions.html#cb816-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(diabetes.probs<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>      1       2       3       4       5       6 
0.52359 0.05810 0.07530 0.06662 0.82713 0.50879 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="functions.html#cb818-1"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.predict<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;No&quot;</span>, <span class="kw">dim</span>(Pima.te)[<span class="dv">1</span>])</span>
<span id="cb818-2"><a href="functions.html#cb818-2"></a><span class="op">&gt;</span><span class="st"> </span>diabetes.predict<span class="fl">.2</span>[diabetes.probs<span class="fl">.2</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>] &lt;-<span class="st"> &quot;Yes&quot;</span></span>
<span id="cb818-3"><a href="functions.html#cb818-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(diabetes.predict<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>[1] &quot;Yes&quot; &quot;No&quot;  &quot;No&quot;  &quot;No&quot;  &quot;Yes&quot; &quot;Yes&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="functions.html#cb820-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(diabetes.predict<span class="fl">.2</span>, Pima.te<span class="op">$</span>type)</span></code></pre></div>
<pre><code>                  
diabetes.predict.2  No Yes
               No  204  54
               Yes  19  55</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="functions.html#cb822-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(diabetes.predict<span class="fl">.2</span>[diabetes.predict<span class="fl">.2</span> <span class="op">==</span><span class="st"> </span>Pima.te<span class="op">$</span>type])<span class="op">/</span></span>
<span id="cb822-2"><a href="functions.html#cb822-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">dim</span>(Pima.te)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>[1] 0.7801</code></pre>
<p>Adding <code>bmi</code> as a predictor did not improve the predictions by very much!</p>
<p>Let <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> represent glucose and bmi levels. We classify a subject as “diabetic” if the fitted <span class="math inline">\(p(X)\)</span> is greater than <span class="math inline">\(0.5\)</span>, i.e., if the fitted probability of diabetes is greater than the fitted probability of not diabetes. The boundary for our decision is where these two fitted probabilities are equal, i.e., where</p>
<p><span class="math display">\[
\frac{P(Y = 1 | (x_1, x_2))}{P(Y = 0 | (x_1, x_2))} = \frac{P(Y = 1 | (x_1, x_2))}{1 - P(Y = 1 | (x_1, x_2))}  = 1.
\]</span></p>
<p>Writing these out in terms of the logistic regression model, taking logarithms, and performing some algebra leads to the following (linear!) decision boundary:</p>
<p><span class="math display">\[
x_2 = -\frac{\beta_0}{\beta_2} - \frac{\beta_1}{\beta_2} x_1.
\]</span></p>
<p>The diabetes training data along with the decision boundary are plotted below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="functions.html#cb824-1"></a><span class="op">&gt;</span><span class="st"> </span>lr.int &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">coef</span>(diabetes.lr2)[<span class="dv">1</span>]<span class="op">/</span><span class="kw">coef</span>(diabetes.lr2)[<span class="dv">3</span>]</span>
<span id="cb824-2"><a href="functions.html#cb824-2"></a><span class="op">&gt;</span><span class="st"> </span>lr.slope &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">coef</span>(diabetes.lr2)[<span class="dv">2</span>]<span class="op">/</span><span class="kw">coef</span>(diabetes.lr2)[<span class="dv">3</span>]</span>
<span id="cb824-3"><a href="functions.html#cb824-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(Pima.tr, <span class="kw">aes</span>(<span class="dt">x =</span> glu, <span class="dt">y =</span> bmi)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb824-4"><a href="functions.html#cb824-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> type)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb824-5"><a href="functions.html#cb824-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> lr.int, <span class="dt">slope =</span> lr.slope)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-245-1.png" width="672" /></p>
</div>
<div id="more-than-two-classes" class="section level3" number="7.25.2">
<h3 number="7.25.2"><span class="header-section-number">7.25.2</span> More than Two Classes</h3>
<p>Logistic regression methods also are applicable to classification contexts where there are more than two classes. Consider for example Fisher’s iris data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="functions.html#cb825-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(iris)</span>
<span id="cb825-2"><a href="functions.html#cb825-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(iris)</span></code></pre></div>
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width
1          5.1         3.5          1.4         0.2
2          4.9         3.0          1.4         0.2
3          4.7         3.2          1.3         0.2
4          4.6         3.1          1.5         0.2
5          5.0         3.6          1.4         0.2
6          5.4         3.9          1.7         0.4
  Species
1  setosa
2  setosa
3  setosa
4  setosa
5  setosa
6  setosa</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="functions.html#cb827-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(iris)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   150 obs. of  5 variables:
 $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
 $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="functions.html#cb829-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb829-2"><a href="functions.html#cb829-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Species))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="functions.html#cb830-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb830-2"><a href="functions.html#cb830-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Species))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-2.png" width="672" /></p>
<p>Here the potential predictors are sepal width, sepal length, petal width, and petal length. The goal is to find a classifier that will yield the correct species. From the scatter plots it should be pretty clear that a model with petal length and petal width as predictors would classify the data well. Although in a sense this is too easy, these data do a good job of illustrating logistic regression with more than two classes.</p>
<p>Before doing that we randomly choose 75 of the 150 rows of the data frame to be the training sample, with the other 75 being the test sample.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="functions.html#cb831-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb831-2"><a href="functions.html#cb831-2"></a><span class="op">&gt;</span><span class="st"> </span>selected &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">150</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="dv">75</span>)</span>
<span id="cb831-3"><a href="functions.html#cb831-3"></a><span class="op">&gt;</span><span class="st"> </span>iris.train &lt;-<span class="st"> </span>iris[selected,]</span>
<span id="cb831-4"><a href="functions.html#cb831-4"></a><span class="op">&gt;</span><span class="st"> </span>iris.test &lt;-<span class="st"> </span>iris[<span class="op">-</span>selected,]</span></code></pre></div>
<p>There are several packages which implement logistic regression for data with more than two classes. We will use the <code>VGAM</code> package. The function <code>vglm</code> within <code>VGAM</code> implements logistic regression (and much more).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="functions.html#cb832-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(VGAM)</span>
<span id="cb832-2"><a href="functions.html#cb832-2"></a><span class="op">&gt;</span><span class="st"> </span>iris.lr &lt;-<span class="st"> </span><span class="kw">vglm</span>(Species <span class="op">~</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Petal.Length, </span>
<span id="cb832-3"><a href="functions.html#cb832-3"></a><span class="op">+</span><span class="st">                 </span><span class="dt">data =</span> iris.train, <span class="dt">family =</span> multinomial)</span>
<span id="cb832-4"><a href="functions.html#cb832-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(iris.lr)</span></code></pre></div>
<pre><code>
Call:
vglm(formula = Species ~ Petal.Width + Petal.Length, family = multinomial, 
    data = iris.train)

Pearson residuals:
                           Min           1Q
log(mu[,1]/mu[,3]) -0.00000181 -0.000000246
log(mu[,2]/mu[,3]) -1.26528143 -0.000122333
                         Median          3Q       Max
log(mu[,1]/mu[,3]) 0.0000000436 0.000000063 0.0000164
log(mu[,2]/mu[,3]) 0.0000006634 0.002992883 2.4706594

Coefficients: 
               Estimate Std. Error z value Pr(&gt;|z|)
(Intercept):1    118.95    9260.55      NA       NA
(Intercept):2     63.51      34.00      NA       NA
Petal.Width:1    -27.34   14731.81       0        1
Petal.Width:2    -14.55       7.47      NA       NA
Petal.Length:1   -26.61    6453.20       0        1
Petal.Length:2    -8.24       5.59      NA       NA

Names of linear predictors: log(mu[,1]/mu[,3]), 
log(mu[,2]/mu[,3])

Residual deviance: 8.682 on 144 degrees of freedom

Log-likelihood: -4.341 on 144 degrees of freedom

Number of Fisher scoring iterations: 21 

Warning: Hauck-Donner effect detected in the following estimate(s):
&#39;(Intercept):1&#39;, &#39;(Intercept):2&#39;, &#39;Petal.Width:2&#39;, &#39;Petal.Length:2&#39;


Reference group is level  3  of the response</code></pre>
<p>Notice that the family is specified as <code>multinomial</code> rather than <code>binomial</code> since we have more than two classes. When run with these data, the <code>vglm</code> function returns several (about 20) warnings. These occur mainly because the classes are so easily separated, and are suppressed above.</p>
<p>Next we compute the probabilities for the test data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="functions.html#cb834-1"></a><span class="op">&gt;</span><span class="st"> </span>iris.probs &lt;-<span class="st"> </span><span class="kw">predict</span>(iris.lr, iris.test[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb834-2"><a href="functions.html#cb834-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(iris.probs)</span></code></pre></div>
<pre><code>   setosa           versicolor
4       1 0.000000000010035925
5       1 0.000000000001598575
9       1 0.000000000001598575
11      1 0.000000000010035925
12      1 0.000000000063005974
14      1 0.000000000000001799
                                     virginica
4  0.00000000000000000000000000000001129030771
5  0.00000000000000000000000000000000078877050
9  0.00000000000000000000000000000000078877050
11 0.00000000000000000000000000000001129030771
12 0.00000000000000000000000000000016160727116
14 0.00000000000000000000000000000000000001748</code></pre>
<p>At least for the first six cases, one probability is close to one and the other two are close to zero, reflecting the fact that this is an easy classification problem. Next we extract the actual predictions. For these, we want to choose the highest probability in each row. The <code>which.max</code> function makes this easy. Before applying this to the fitted probabilities, we illustrate its use. Take notice that <code>which.max()</code> returns the position of the highest probability, and not the actualy highest probability itself.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="functions.html#cb836-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">which.max</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>[1] 5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="functions.html#cb838-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">which.max</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">20</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span></code></pre></div>
<pre><code>[1] 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="functions.html#cb840-1"></a><span class="op">&gt;</span><span class="st"> </span>class.predictions &lt;-<span class="st"> </span><span class="kw">apply</span>(iris.probs, <span class="dv">1</span>, which.max)</span>
<span id="cb840-2"><a href="functions.html#cb840-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(class.predictions)</span></code></pre></div>
<pre><code> 4  5  9 11 12 14 
 1  1  1  1  1  1 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="functions.html#cb842-1"></a><span class="op">&gt;</span><span class="st"> </span>class.predictions[class.predictions <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)[<span class="dv">1</span>]</span>
<span id="cb842-2"><a href="functions.html#cb842-2"></a><span class="op">&gt;</span><span class="st"> </span>class.predictions[class.predictions <span class="op">==</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)[<span class="dv">2</span>]</span>
<span id="cb842-3"><a href="functions.html#cb842-3"></a><span class="op">&gt;</span><span class="st"> </span>class.predictions[class.predictions <span class="op">==</span><span class="st"> </span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)[<span class="dv">3</span>]</span>
<span id="cb842-4"><a href="functions.html#cb842-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(class.predictions)</span></code></pre></div>
<pre><code>       4        5        9       11       12       14 
&quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; </code></pre>
<p>Next we create the confusion matrix.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="functions.html#cb844-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(class.predictions, iris.test<span class="op">$</span>Species)</span></code></pre></div>
<pre><code>                 
class.predictions setosa versicolor virginica
       setosa         26          0         0
       versicolor      0         19         1
       virginica       0          2        27</code></pre>
</div>
</div>
<div id="nearest-neighbor-methods" class="section level2" number="7.26">
<h2 number="7.26"><span class="header-section-number">7.26</span> Nearest Neighbor Methods</h2>
<p>Nearest neighbor methods provide a rather different way to construct classifiers, and have strengths (minimal assumptions, flexible decision boundaries) and weaknesses (computational burden, lack of interpretability) compared to logistic regression models.</p>
<p>In principle the idea is simple. Recall that the training set will have both <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values known, while the test set will have only <span class="math inline">\(x\)</span> values known. Begin by choosing a positive integer <span class="math inline">\(k\)</span> which will specify the number of neighbors to use in classification. To classify a point <span class="math inline">\(x\)</span> in the training set, find the <span class="math inline">\(k\)</span> closest <span class="math inline">\(x\)</span> values in the training set, and choose the class which has the highest representation among the <span class="math inline">\(k\)</span> points. The algorithm is called kNN for “k Nearest Neighbors”.</p>
<p>For example, suppose that <span class="math inline">\(k=10\)</span> and the 10 nearest neighbors to a training <span class="math inline">\(x\)</span> have classes <span class="math inline">\(1, 1, 3, 2, 3, 3, 3, 2, 3, 2\)</span>. Since there are five 3s, three 2s, and two 1s, the training point is assigned to class 3. Suppose that for another <span class="math inline">\(x\)</span> the 10 nearest neighbors have classes <span class="math inline">\(1,1,1,2,3,1,3,3,3,2\)</span>. In this case there are four 1s and four 3s, so there is a tie for the lead. The nearest neighbor algorithm then will choose between 1 and 3 at random.</p>
<p>Although in principle kNN is simple, some issues arise. First, how should <span class="math inline">\(k\)</span> be chosen? There is not an easy answer, but it can help to think of the extreme values for <span class="math inline">\(k\)</span>.</p>
<p>The largest possible <span class="math inline">\(k\)</span> is the number of observations in the training set. For example suppose that the training set has <span class="math inline">\(10\)</span> observations, with classes <span class="math inline">\(1, 1, 1, 2, 2, 2, 3, 3, 3, 3\)</span>. Then for any point in the test set, the <span class="math inline">\(k=10\)</span> nearest neighbors will include ALL of the points in the training set, and hence every point in the test set will be classified in class 3. This classifier has low (zero) variance, but probably has high bias.</p>
<p>The smallest possible <span class="math inline">\(k\)</span> is 1. In this case, each point in the test set is put in the same class as its nearest neighbor in the training set. This may lead to a very non-smooth and high variance classifier, but the bias will tend to be small.</p>
<p>A second issue that is relatively easy to deal with concerns the scales on which the <span class="math inline">\(x\)</span> values are measured. If for example one <span class="math inline">\(x\)</span> variable has a range from 2 to 4, while another has a range from 2000 to 4000, the distance between the test and training data will be dominated by the second variable. The solution that is typically used is to standardize all the variables (rescale them so that their mean is 0 and their standard deviation is 1).</p>
<p>These and other issues are discussed in the literature on kNN, but we won’t pursue them further.</p>
<p>There are at least three R packages which implement kNN, including <code>class</code>, <code>kknn</code>, and <code>RWeka</code>. We will use <code>class</code> below.</p>
<p>An example from <span class="citation">Hastie, Tibshirani, and Friedman (<a href="references.html#ref-hastieESL" role="doc-biblioref">2009</a>)</span> will be used to give a better sense of the role of <span class="math inline">\(k\)</span> in the kNN algorithm. The example uses simulated data and shows the decision boundaries for kNN with <span class="math inline">\(k=15\)</span> and <span class="math inline">\(k=1\)</span>.<a href="references.html#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a>. Although the R code used to draw the displays is given below, focus mainly on the graphics produced, and what they tell us about kNN.</p>
<p>First the data are read into R and graphed. The predictors <code>x1</code> and <code>x2</code>, while not standardized, have very similar standard deviations, so we will not standardize these data before applying kNN.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="functions.html#cb846-1"></a><span class="op">&gt;</span><span class="st"> </span>u.knn &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/knnExample.csv&quot;</span></span>
<span id="cb846-2"><a href="functions.html#cb846-2"></a><span class="op">&gt;</span><span class="st"> </span>knnExample &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.knn, <span class="dt">header=</span><span class="ot">TRUE</span>)</span>
<span id="cb846-3"><a href="functions.html#cb846-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(knnExample)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   200 obs. of  3 variables:
 $ x1   : num  2.5261 0.367 0.7682 0.6934 -0.0198 ...
 $ x2   : num  0.3211 0.0315 0.7175 0.7772 0.8673 ...
 $ class: int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="functions.html#cb848-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> knnExample, <span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb848-2"><a href="functions.html#cb848-2"></a><span class="op">+</span><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="kw">as.factor</span>(class))) <span class="op">+</span></span>
<span id="cb848-3"><a href="functions.html#cb848-3"></a><span class="op">+</span><span class="st">    </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-252-1.png" width="672" /></p>
<p>Next a large set of test data is created using the <code>expand.grid</code> function, which creates a data frame with all possible combinations of the arguments. First a simple example to illustrate the function, then the actual creation of the training set. The test set covers the range of the <code>x1</code> and <code>x2</code> values in the training set.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="functions.html#cb849-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="fl">3.4</span>,<span class="dv">2</span>))</span></code></pre></div>
<pre><code>  x   y
1 1 5.0
2 2 5.0
3 1 3.4
4 2 3.4
5 1 2.0
6 2 2.0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="functions.html#cb851-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">min</span>(knnExample<span class="op">$</span>x1)</span></code></pre></div>
<pre><code>[1] -2.521</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="functions.html#cb853-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(knnExample<span class="op">$</span>x1)</span></code></pre></div>
<pre><code>[1] 4.171</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="functions.html#cb855-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">min</span>(knnExample<span class="op">$</span>x2)</span></code></pre></div>
<pre><code>[1] -2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="functions.html#cb857-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(knnExample<span class="op">$</span>x2)</span></code></pre></div>
<pre><code>[1] 2.856</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="functions.html#cb859-1"></a><span class="op">&gt;</span><span class="st"> </span>x.test &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">x1 =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, <span class="dt">by=</span><span class="fl">0.1</span>), <span class="dt">x2 =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="fl">2.9</span>, <span class="dt">by=</span><span class="fl">0.1</span>))</span></code></pre></div>
<p>Next the kNN with <span class="math inline">\(k=15\)</span> is fit. Notice that the first argument gives the <span class="math inline">\(x\)</span> values in the training set, the next argument gives the <span class="math inline">\(x\)</span> values in the test set, the third argument gives the <span class="math inline">\(y\)</span> values (labels) from the training set. The fourth argument gives <span class="math inline">\(k\)</span>, and the fifth argument asks for the function to return the probabilities of membership (that is, the proportion of the nearest neighbors which were in the majority class) as well as the class assignments.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="functions.html#cb860-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(class)</span>
<span id="cb860-2"><a href="functions.html#cb860-2"></a><span class="op">&gt;</span><span class="st"> </span>Example_knn &lt;-<span class="st"> </span><span class="kw">knn</span>(knnExample[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], x.test, knnExample[,<span class="dv">3</span>], <span class="dt">k =</span> <span class="dv">15</span>, <span class="dt">prob =</span> <span class="ot">TRUE</span>)</span>
<span id="cb860-3"><a href="functions.html#cb860-3"></a><span class="op">&gt;</span><span class="st"> </span>prob &lt;-<span class="st"> </span><span class="kw">attr</span>(Example_knn, <span class="st">&quot;prob&quot;</span>)</span>
<span id="cb860-4"><a href="functions.html#cb860-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(prob)</span></code></pre></div>
<pre><code>[1] 0.6667 0.6667 0.6667 0.7333 0.7333 0.7333</code></pre>
<p>Next the graphs are created. This is somewhat complex, since we want to plot the test data colored by the class they were assigned to by the kNN classifier as background, the training data (using a different symbol), and the decision boundary.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="functions.html#cb862-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb862-2"><a href="functions.html#cb862-2"></a><span class="op">&gt;</span><span class="st"> </span>df1 &lt;-<span class="st"> </span><span class="kw">mutate</span>(x.test, <span class="dt">prob =</span> prob, <span class="dt">class =</span> <span class="dv">0</span>,  <span class="dt">prob_cls =</span> <span class="kw">ifelse</span>(Example_knn <span class="op">==</span><span class="st"> </span>class, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb862-3"><a href="functions.html#cb862-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(df1)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   3450 obs. of  5 variables:
 $ x1      : num  -2.6 -2.5 -2.4 -2.3 -2.2 -2.1 -2 -1.9 -1.8 -1.7 ...
 $ x2      : num  -2 -2 -2 -2 -2 -2 -2 -2 -2 -2 ...
 $ prob    : num  0.667 0.667 0.667 0.733 0.733 ...
 $ class   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ prob_cls: num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="functions.html#cb864-1"></a><span class="op">&gt;</span><span class="st"> </span>df2 &lt;-<span class="st"> </span><span class="kw">mutate</span>(x.test, <span class="dt">prob =</span> prob, <span class="dt">class =</span> <span class="dv">1</span>,  <span class="dt">prob_cls =</span> <span class="kw">ifelse</span>(Example_knn <span class="op">==</span><span class="st"> </span>class, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb864-2"><a href="functions.html#cb864-2"></a><span class="op">&gt;</span><span class="st"> </span>bigdf &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df1, df2)</span>
<span id="cb864-3"><a href="functions.html#cb864-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb864-4"><a href="functions.html#cb864-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">names</span>(knnExample)</span></code></pre></div>
<pre><code>[1] &quot;x1&quot;    &quot;x2&quot;    &quot;class&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="functions.html#cb866-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(bigdf) <span class="op">+</span><span class="st"> </span></span>
<span id="cb866-2"><a href="functions.html#cb866-2"></a><span class="op">+</span><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x1, <span class="dt">y =</span>x2, <span class="dt">col=</span>class), <span class="dt">data =</span> <span class="kw">mutate</span>(x.test, <span class="dt">class =</span> Example_knn), <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb866-3"><a href="functions.html#cb866-3"></a><span class="op">+</span><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2, <span class="dt">col =</span> <span class="kw">as.factor</span>(class)), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">data =</span> knnExample) <span class="op">+</span><span class="st"> </span></span>
<span id="cb866-4"><a href="functions.html#cb866-4"></a><span class="op">+</span><span class="st">    </span><span class="kw">geom_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2, <span class="dt">z =</span> prob_cls, <span class="dt">group =</span> <span class="kw">as.factor</span>(class), <span class="dt">color =</span> <span class="kw">as.factor</span>(class)), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">bins =</span> <span class="dv">1</span>, <span class="dt">data =</span> bigdf) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-255-1.png" width="672" /></p>
<p>Next we graph the decision boundary of kNN with <span class="math inline">\(k=1\)</span>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="functions.html#cb867-1"></a><span class="op">&gt;</span><span class="st"> </span>Example_knn &lt;-<span class="st"> </span><span class="kw">knn</span>(knnExample[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], x.test, knnExample[,<span class="dv">3</span>], <span class="dt">k =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="ot">TRUE</span>)</span>
<span id="cb867-2"><a href="functions.html#cb867-2"></a><span class="op">&gt;</span><span class="st"> </span>prob &lt;-<span class="st"> </span><span class="kw">attr</span>(Example_knn, <span class="st">&quot;prob&quot;</span>)</span>
<span id="cb867-3"><a href="functions.html#cb867-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(prob)</span></code></pre></div>
<pre><code>[1] 1 1 1 1 1 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="functions.html#cb869-1"></a><span class="op">&gt;</span><span class="st"> </span>df1 &lt;-<span class="st"> </span><span class="kw">mutate</span>(x.test, <span class="dt">prob =</span> prob, <span class="dt">class =</span> <span class="dv">0</span>,  <span class="dt">prob_cls =</span> <span class="kw">ifelse</span>(Example_knn <span class="op">==</span><span class="st"> </span>class, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb869-2"><a href="functions.html#cb869-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(df1)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   3450 obs. of  5 variables:
 $ x1      : num  -2.6 -2.5 -2.4 -2.3 -2.2 -2.1 -2 -1.9 -1.8 -1.7 ...
 $ x2      : num  -2 -2 -2 -2 -2 -2 -2 -2 -2 -2 ...
 $ prob    : num  1 1 1 1 1 1 1 1 1 1 ...
 $ class   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ prob_cls: num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="functions.html#cb871-1"></a><span class="op">&gt;</span><span class="st"> </span>df2 &lt;-<span class="st"> </span><span class="kw">mutate</span>(x.test, <span class="dt">prob =</span> prob, <span class="dt">class =</span> <span class="dv">1</span>,  <span class="dt">prob_cls =</span> <span class="kw">ifelse</span>(Example_knn <span class="op">==</span><span class="st"> </span>class, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb871-2"><a href="functions.html#cb871-2"></a><span class="op">&gt;</span><span class="st"> </span>bigdf &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df1, df2)</span>
<span id="cb871-3"><a href="functions.html#cb871-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb871-4"><a href="functions.html#cb871-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(bigdf) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2, <span class="dt">col =</span> class), <span class="dt">data =</span> <span class="kw">mutate</span>(x.test, <span class="dt">class =</span> Example_knn), <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2, <span class="dt">col =</span> <span class="kw">as.factor</span>(class)), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">data =</span> knnExample) <span class="op">+</span><span class="st"> </span><span class="kw">geom_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> x2, <span class="dt">z =</span> prob_cls, <span class="dt">group =</span> <span class="kw">as.factor</span>(class), <span class="dt">color =</span> <span class="kw">as.factor</span>(class)), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">bins =</span> <span class="dv">1</span>, <span class="dt">data =</span> bigdf) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-256-1.png" width="672" /></p>
<div id="knn-and-the-diabetes-data" class="section level3" number="7.26.1">
<h3 number="7.26.1"><span class="header-section-number">7.26.1</span> kNN and the Diabetes Data</h3>
<p>Next kNN is applied to the diabetes data. We will use the same predictors, <code>glu</code> and <code>bmi</code> that were used in the logistic regression example. Since the scales of the predictor variables are substantially different, they are standardized first. The value <span class="math inline">\(k=15\)</span> is chosen for kNN.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="functions.html#cb872-1"></a><span class="op">&gt;</span><span class="st"> </span>Pima.tr[,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">scale</span>(Pima.tr[,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>], <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb872-2"><a href="functions.html#cb872-2"></a><span class="op">&gt;</span><span class="st"> </span>Pima.te[,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">scale</span>(Pima.te[,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>], <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb872-3"><a href="functions.html#cb872-3"></a><span class="op">&gt;</span><span class="st"> </span>knn_Pima &lt;-<span class="st"> </span><span class="kw">knn</span>(Pima.tr[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)], Pima.te[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)], Pima.tr[,<span class="dv">8</span>], <span class="dt">k =</span> <span class="dv">15</span>, <span class="dt">prob=</span><span class="ot">TRUE</span>)</span>
<span id="cb872-4"><a href="functions.html#cb872-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(knn_Pima, Pima.te[,<span class="dv">8</span>])</span></code></pre></div>
<pre><code>        
knn_Pima  No Yes
     No  206  55
     Yes  17  54</code></pre>
<p>At least in terms of the confusion matrix, kNN with <span class="math inline">\(k=15\)</span> performed about as well as logistic regression for these data.</p>
</div>
<div id="practice-problem-13" class="section level3" number="7.26.2">
<h3 number="7.26.2"><span class="header-section-number">7.26.2</span> Practice Problem</h3>
<p>Produce a figure that displays how the number of false positives produced from the kNN classifier for the diabetes data set changes for all integer values of <span class="math inline">\(k\)</span> from 1 to 40. Use this graph to justify whether or not <span class="math inline">\(k = 15\)</span> was a valid choice for the number of neighbors.</p>
</div>
<div id="knn-and-the-iris-data" class="section level3" number="7.26.3">
<h3 number="7.26.3"><span class="header-section-number">7.26.3</span> kNN and the iris Data</h3>
<p>Now kNN is used to classify the iris data. As before we use petal length and width as predictors. The scales of the two predictors are not particularly different, so we won’t standardize the predictors. Unsurprisingly kNN does well in classifying the test set for a wide variety of <span class="math inline">\(k\)</span> values.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="functions.html#cb874-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sd</span>(iris.train<span class="op">$</span>Petal.Width)</span></code></pre></div>
<pre><code>[1] 0.7286</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="functions.html#cb876-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sd</span>(iris.train<span class="op">$</span>Petal.Length) </span></code></pre></div>
<pre><code>[1] 1.672</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="functions.html#cb878-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(iris.train)</span></code></pre></div>
<pre><code>    Sepal.Length Sepal.Width Petal.Length Petal.Width
144          6.8         3.2          5.9         2.3
140          6.9         3.1          5.4         2.1
36           5.0         3.2          1.2         0.2
38           4.9         3.6          1.4         0.1
58           4.9         2.4          3.3         1.0
50           5.0         3.3          1.4         0.2
       Species
144  virginica
140  virginica
36      setosa
38      setosa
58  versicolor
50      setosa</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="functions.html#cb880-1"></a><span class="op">&gt;</span><span class="st"> </span>knn_iris &lt;-<span class="st"> </span><span class="kw">knn</span>(iris.train[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], iris.test[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], iris.train[,<span class="dv">5</span>], <span class="dt">k=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="ot">TRUE</span>)</span>
<span id="cb880-2"><a href="functions.html#cb880-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(knn_iris, iris.test[,<span class="dv">5</span>])</span></code></pre></div>
<pre><code>            
knn_iris     setosa versicolor virginica
  setosa         26          0         0
  versicolor      0         20         1
  virginica       0          1        27</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="functions.html#cb882-1"></a><span class="op">&gt;</span><span class="st"> </span>knn_iris &lt;-<span class="st"> </span><span class="kw">knn</span>(iris.train[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], iris.test[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], iris.train[,<span class="dv">5</span>], <span class="dt">k=</span><span class="dv">3</span>, <span class="dt">prob=</span><span class="ot">TRUE</span>)</span>
<span id="cb882-2"><a href="functions.html#cb882-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(knn_iris, iris.test[,<span class="dv">5</span>])</span></code></pre></div>
<pre><code>            
knn_iris     setosa versicolor virginica
  setosa         26          0         0
  versicolor      0         19         1
  virginica       0          2        27</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="functions.html#cb884-1"></a><span class="op">&gt;</span><span class="st"> </span>knn_iris &lt;-<span class="st"> </span><span class="kw">knn</span>(iris.train[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], iris.test[,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)], iris.train[,<span class="dv">5</span>], <span class="dt">k=</span><span class="dv">15</span>, <span class="dt">prob=</span><span class="ot">TRUE</span>)</span>
<span id="cb884-2"><a href="functions.html#cb884-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(knn_iris, iris.test[,<span class="dv">5</span>])</span></code></pre></div>
<pre><code>            
knn_iris     setosa versicolor virginica
  setosa         26          0         0
  versicolor      0         19         1
  virginica       0          2        27</code></pre>
</div>
</div>
<div id="exercises-7" class="section level2" number="7.27">
<h2 number="7.27"><span class="header-section-number">7.27</span> Exercises</h2>
<p><strong>Exercise Classification</strong> Learning objectives: explore the logistic regression classification method; apply the kNN classification method; create confusion matrices to compare classification methods; plot classified data.</p>

<p>_# Text Data {#xml}</p>
<p>Many applications require the ability to manipulate and process text data. For example, an email spam filter takes as its input various features of email such as the sender, words in the subject, words in the body, the number and types of attachments, and so on. The filter then tries to build a classifier which can correctly classify a message as spam or not spam (aka ham). As another example, some works of literature, such as some of Shakespeare’s plays or some of the Federalist papers, have disputed authorship. By analyzing word use across many documents, researchers try to determine the author of the disputed work.</p>
<p>Working with text data requires functions that will, for example, concatenate and split text strings, modify strings (e.g., converting to lower-case or removing vowels), count the number of characters in a string, and so on. In addition to being useful in such contexts, string manipulation is helpful more generally in R—for example, to effectively construct titles for graphics.</p>
<p>As with most tasks, there are a variety of ways to accomplish these text processing tasks in R. The <code>base</code> R package has functions which work with and modify text strings. Another useful package which approaches these tasks in a slightly different way is <code>stringr</code>. As with graphics, we will focus mainly on one package to avoid confusion. In this case we will focus on the base R string processing functions, but will emphasize that <code>stringr</code> is also worth knowing.</p>
<p>The application to analyzing <em>Moby Dick</em> below comes from the book <em>{Text Analysis with R for Students of Literature</em> by Matthew L. Jockers.</p>
</div>
<div id="reading-text-data-into-r" class="section level2" number="7.28">
<h2 number="7.28"><span class="header-section-number">7.28</span> Reading Text Data into R</h2>
<p>Often text data will not be in a rectangular format that is suitable for reading into a data frame. For example, an email used to help train a spam filter, or literary texts used to help determine authorship of a novel are certainly not of this form. Often when working with text data we want to read the whole text object into a single R vector. In this case either the <code>scan</code> function or the <code>readLines</code> function are useful. The <code>readLines</code> function is typically more efficient, but <code>scan</code> is much more flexible.</p>
<p>As an example, consider the following email message and a plain text version of the novel <em>Moby Dick</em> by Herman Melville, the beginning of which is displayed subsequently.</p>
<pre><code>From safety33o@l11.newnamedns.com  Fri Aug 23 11:03:37 2002
Return-Path: &lt;safety33o@l11.newnamedns.com&gt;
Delivered-To: zzzz@localhost.example.com
Received: from localhost (localhost [127.0.0.1])
    by phobos.labs.example.com (Postfix) with ESMTP id 5AC994415F
    for &lt;zzzz@localhost&gt;; Fri, 23 Aug 2002 06:02:59 -0400 (EDT)
Received: from mail.webnote.net [193.120.211.219]
    by localhost with POP3 (fetchmail-5.9.0)
    for zzzz@localhost (single-drop); Fri, 23 Aug 2002 11:02:59 +0100 (IST)
Received: from l11.newnamedns.com ([64.25.38.81])
    by webnote.net (8.9.3/8.9.3) with ESMTP id KAA09379
    for &lt;zzzz@example.com&gt;; Fri, 23 Aug 2002 10:18:03 +0100
From: safety33o@l11.newnamedns.com
Date: Fri, 23 Aug 2002 02:16:25 -0400
Message-Id: &lt;200208230616.g7N6GOR28438@l11.newnamedns.com&gt;
To: kxzzzzgxlrah@l11.newnamedns.com
Reply-To: safety33o@l11.newnamedns.com
Subject: ADV: Lowest life insurance rates available!                                                   
moode

Lowest rates available for term life insurance! Take a moment 
and fill out our online form 
to see the low rate you qualify for. 
Save up to 70% from regular rates! Smokers accepted! 
http://www.newnamedns.com/termlife/ 
          
Representing quality nationwide carriers. Act now!</code></pre>
<pre><code>The Project Gutenberg EBook of Moby Dick; or The Whale, by Herman Melville

This eBook is for the use of anyone anywhere at no cost and with
almost no restrictions whatsoever.  You may copy it, give it away or
re-use it under the terms of the Project Gutenberg License included
with this eBook or online at www.gutenberg.org


Title: Moby Dick; or The Whale

Author: Herman Melville

Last Updated: January 3, 2009
Posting Date: December 25, 2008 [EBook #2701]
Release Date: June, 2001

Language: English


*** START OF THIS PROJECT GUTENBERG EBOOK MOBY DICK; OR THE WHALE ***




Produced by Daniel Lazarus and Jonesey





MOBY DICK; OR THE WHALE

By Herman Melville</code></pre>
<p>The email message is available at <a href="https://www.finley-lab.com/files/data/email1.txt" class="uri">https://www.finley-lab.com/files/data/email1.txt</a> while the novel is available at <a href="https://www.finley-lab.com/files/data/mobydick.txt" class="uri">https://www.finley-lab.com/files/data/mobydick.txt</a>. We will read these into R using <code>scan</code>.</p>
<p>First, we read in the email message. The <code>scan</code> function has several possible arguments. For now the important arguments are the file to be read (the argument is named <code>file</code>), the type of data in the file (the argument is named <code>what</code>), and how the fields in the file are separated (the argument is named <code>sep</code>). To illustrate the <code>sep</code> argument, the file will be read into R once with <code>sep = ""</code> indicating that the separator is whitespace, and once with <code>sep = "\n"</code> indicating that the separator is the newline character, i.e., each field in the file is a line.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="functions.html#cb888-1"></a><span class="op">&gt;</span><span class="st"> </span>u.email &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/email1.txt&quot;</span></span>
<span id="cb888-2"><a href="functions.html#cb888-2"></a><span class="op">&gt;</span><span class="st"> </span>email1 &lt;-<span class="st"> </span><span class="kw">scan</span>(u.email, <span class="dt">what =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb888-3"><a href="functions.html#cb888-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(email1)</span></code></pre></div>
<pre><code>[1] 133</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="functions.html#cb890-1"></a><span class="op">&gt;</span><span class="st"> </span>email1[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code> [1] &quot;From&quot;                          
 [2] &quot;safety33o@l11.newnamedns.com&quot;  
 [3] &quot;Fri&quot;                           
 [4] &quot;Aug&quot;                           
 [5] &quot;23&quot;                            
 [6] &quot;11:03:37&quot;                      
 [7] &quot;2002&quot;                          
 [8] &quot;Return-Path:&quot;                  
 [9] &quot;&lt;safety33o@l11.newnamedns.com&gt;&quot;
[10] &quot;Delivered-To:&quot;                 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="functions.html#cb892-1"></a><span class="op">&gt;</span><span class="st"> </span>email1 &lt;-<span class="st"> </span><span class="kw">scan</span>(u.email, <span class="dt">what =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb892-2"><a href="functions.html#cb892-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(email1)</span></code></pre></div>
<pre><code>[1] 26</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="functions.html#cb894-1"></a><span class="op">&gt;</span><span class="st"> </span>email1[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code> [1] &quot;From safety33o@l11.newnamedns.com  Fri Aug 23 11:03:37 2002&quot;              
 [2] &quot;Return-Path: &lt;safety33o@l11.newnamedns.com&gt;&quot;                              
 [3] &quot;Delivered-To: zzzz@localhost.example.com&quot;                                 
 [4] &quot;Received: from localhost (localhost [127.0.0.1])&quot;                         
 [5] &quot;\tby phobos.labs.example.com (Postfix) with ESMTP id 5AC994415F&quot;          
 [6] &quot;\tfor &lt;zzzz@localhost&gt;; Fri, 23 Aug 2002 06:02:59 -0400 (EDT)&quot;            
 [7] &quot;Received: from mail.webnote.net [193.120.211.219]&quot;                        
 [8] &quot;\tby localhost with POP3 (fetchmail-5.9.0)&quot;                               
 [9] &quot;\tfor zzzz@localhost (single-drop); Fri, 23 Aug 2002 11:02:59 +0100 (IST)&quot;
[10] &quot;Received: from l11.newnamedns.com ([64.25.38.81])&quot;                        </code></pre>
<p>Note that when <code>sep = ""</code> was specified, every time whitespace was encountered R moved to a new element of the vector <code>email1</code>, and this vector ultimately contained 133 elements. When <code>sep = "\n"</code> was specified, all the text before a newline was put into one element of the vector, which ended up with 26 elements.</p>
<p>The <code>scan</code> function is quite flexible. In fact, <code>read.table</code> uses <code>scan</code> to actually read in the data. Read the help file for <code>scan</code> if more information is desired.</p>
<p>Next <em>Moby Dick</em> is read in line by line.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="functions.html#cb896-1"></a><span class="op">&gt;</span><span class="st"> </span>u.moby &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/mobydick.txt&quot;</span></span>
<span id="cb896-2"><a href="functions.html#cb896-2"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span><span class="kw">scan</span>(u.moby, <span class="dt">what =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb896-3"><a href="functions.html#cb896-3"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick[<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>]</span></code></pre></div>
<pre><code> [1] &quot;The Project Gutenberg EBook of Moby Dick; or The Whale, by Herman Melville&quot;
 [2] &quot;This eBook is for the use of anyone anywhere at no cost and with&quot;          
 [3] &quot;almost no restrictions whatsoever.  You may copy it, give it away or&quot;      
 [4] &quot;re-use it under the terms of the Project Gutenberg License included&quot;       
 [5] &quot;with this eBook or online at www.gutenberg.org&quot;                            
 [6] &quot;Title: Moby Dick; or The Whale&quot;                                            
 [7] &quot;Author: Herman Melville&quot;                                                   
 [8] &quot;Last Updated: January 3, 2009&quot;                                             
 [9] &quot;Posting Date: December 25, 2008 [EBook #2701]&quot;                             
[10] &quot;Release Date: June, 2001&quot;                                                  
[11] &quot;Language: English&quot;                                                         
[12] &quot;*** START OF THIS PROJECT GUTENBERG EBOOK MOBY DICK; OR THE WHALE ***&quot;     
[13] &quot;Produced by Daniel Lazarus and Jonesey&quot;                                    
[14] &quot;MOBY DICK; OR THE WHALE&quot;                                                   
[15] &quot;By Herman Melville&quot;                                                        
[16] &quot;Original Transcriber&#39;s Notes:&quot;                                             
[17] &quot;This text is a combination of etexts, one from the now-defunct ERIS&quot;       
[18] &quot;project at Virginia Tech and one from Project Gutenberg&#39;s archives. The&quot;   
[19] &quot;proofreaders of this version are indebted to The University of Adelaide&quot;   
[20] &quot;Library for preserving the Virginia Tech version. The resulting etext&quot;     
[21] &quot;was compared with a public domain hard copy version of the text.&quot;          
[22] &quot;In chapters 24, 89, and 90, we substituted a capital L for the symbol&quot;     
[23] &quot;for the British pound, a unit of currency.&quot;                                
[24] &quot;ETYMOLOGY.&quot;                                                                
[25] &quot;(Supplied by a Late Consumptive Usher to a Grammar School)&quot;                </code></pre>
<p>You will notice that the <code>scan</code> function ignored blank lines in the file. If it is important to preserve blank lines, the argument <code>blank.lines.skip = FALSE</code> can be supplied to <code>scan</code>.</p>
<p>The file containing the novel contains some introductory and closing text that is not part of the original novel. If we are interested in Melville’s writing, we should remove this text. By inspection we can discover that the novel’s text begins at position 408 and ends at position 18576.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="functions.html#cb898-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span>moby_dick[<span class="dv">408</span><span class="op">:</span><span class="dv">18576</span>]</span>
<span id="cb898-2"><a href="functions.html#cb898-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(moby_dick)</span></code></pre></div>
<pre><code>[1] 18169</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="functions.html#cb900-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>[1] &quot;CHAPTER 1. Loomings.&quot;                                                    
[2] &quot;Call me Ishmael. Some years ago--never mind how long precisely--having&quot;  
[3] &quot;little or no money in my purse, and nothing particular to interest me on&quot;
[4] &quot;shore, I thought I would sail about a little and see the watery part of&quot; </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="functions.html#cb902-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick[<span class="dv">18165</span><span class="op">:</span><span class="dv">18169</span>]</span></code></pre></div>
<pre><code>[1] &quot;they glided by as if with padlocks on their mouths; the savage sea-hawks&quot;
[2] &quot;sailed with sheathed beaks. On the second day, a sail drew near, nearer,&quot;
[3] &quot;and picked me up at last. It was the devious-cruising Rachel, that in&quot;   
[4] &quot;her retracing search after her missing children, only found another&quot;     
[5] &quot;orphan.&quot;                                                                 </code></pre>
</div>
<div id="the-paste-function" class="section level2" number="7.29">
<h2 number="7.29"><span class="header-section-number">7.29</span> The <code>paste</code> Function</h2>
<p>The <code>paste</code> function concatenates vectors after (if necessary) converting the vectors to character.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="functions.html#cb904-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Homer Simpson&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;Bart Simpson&#39;s&quot;</span>, <span class="st">&quot;father&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;Homer Simpson is Bart Simpson&#39;s father&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="functions.html#cb906-1"></a><span class="op">&gt;</span><span class="st"> </span>n &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb906-2"><a href="functions.html#cb906-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;The value of n is&quot;</span>, n)</span></code></pre></div>
<pre><code>[1] &quot;The value of n is 10&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="functions.html#cb908-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;pig&quot;</span>, <span class="st">&quot;dog&quot;</span>), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>[1] &quot;pig 3&quot; &quot;dog 3&quot;</code></pre>
<p>By default the <code>paste</code> function separates the input vectors with a space. But other separators can be specified.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="functions.html#cb910-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;mail&quot;</span>, <span class="st">&quot;google&quot;</span>, <span class="st">&quot;com&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;mail.google.com&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="functions.html#cb912-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;and&quot;</span>, <span class="st">&quot;or&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;and/or&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="functions.html#cb914-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;horse&quot;</span>, <span class="st">&quot;human&quot;</span>, <span class="st">&quot;elephant&quot;</span>), <span class="st">&quot;food&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;dog food&quot;      &quot;cat food&quot;      &quot;horse food&quot;   
[4] &quot;human food&quot;    &quot;elephant food&quot;</code></pre>
<p>Sometimes we want to take a character vector with <span class="math inline">\(n\)</span> elements and create a character vector with only one element, which contains all <span class="math inline">\(n\)</span> character strings. Setting the <code>collapse</code> argument to something other than the default <code>NULL</code> tells R we want to do this, and allows specification of the separator in the collapsed vector.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="functions.html#cb916-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;five&quot;</span>), </span>
<span id="cb916-2"><a href="functions.html#cb916-2"></a><span class="op">+</span><span class="st">       </span><span class="kw">c</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;seven&quot;</span>, <span class="st">&quot;eight&quot;</span>, <span class="st">&quot;nine&quot;</span>, <span class="st">&quot;ten&quot;</span>))</span></code></pre></div>
<pre><code>[1] &quot;one six&quot;     &quot;two seven&quot;   &quot;three eight&quot;
[4] &quot;four nine&quot;   &quot;five ten&quot;   </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="functions.html#cb918-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;five&quot;</span>), </span>
<span id="cb918-2"><a href="functions.html#cb918-2"></a><span class="op">+</span><span class="st">       </span><span class="kw">c</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;seven&quot;</span>, <span class="st">&quot;eight&quot;</span>, <span class="st">&quot;nine&quot;</span>, <span class="st">&quot;ten&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;one six.two seven.three eight.four nine.five ten&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="functions.html#cb920-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;five&quot;</span>),  </span>
<span id="cb920-2"><a href="functions.html#cb920-2"></a><span class="op">+</span><span class="st">       </span><span class="kw">c</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;seven&quot;</span>, <span class="st">&quot;eight&quot;</span>, <span class="st">&quot;nine&quot;</span>, <span class="st">&quot;ten&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;&amp;&amp;&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;one six&amp;&amp;two seven&amp;&amp;three eight&amp;&amp;four nine&amp;&amp;five ten&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="functions.html#cb922-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;five&quot;</span>),</span>
<span id="cb922-2"><a href="functions.html#cb922-2"></a><span class="op">+</span><span class="st">       </span><span class="kw">c</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;seven&quot;</span>, <span class="st">&quot;eight&quot;</span>, <span class="st">&quot;nine&quot;</span>, <span class="st">&quot;ten&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;one six two seven three eight four nine five ten&quot;</code></pre>
<p>In the example above by default <code>paste</code> created a vector with five elements, each containing one input string from the first input vector and one from the second vector, pasted together. When a non <code>NULL</code> argument was specified for <code>collapse</code>, the vector created had one element, with the pasted strings separated by that argument.<a href="references.html#fn54" class="footnote-ref" id="fnref54"><sup>54</sup></a></p>
<p>Also don’t forget that R “recycles” values from vectors if two or more different length vectors are provided as input.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="functions.html#cb924-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code> [1] &quot;a1&quot;  &quot;b2&quot;  &quot;a3&quot;  &quot;b4&quot;  &quot;a5&quot;  &quot;b6&quot;  &quot;a7&quot;  &quot;b8&quot; 
 [9] &quot;a9&quot;  &quot;b10&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="functions.html#cb926-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>[1] &quot;a1&quot; &quot;b2&quot; &quot;a3&quot; &quot;b4&quot; &quot;a5&quot; &quot;b6&quot; &quot;a7&quot; &quot;b8&quot; &quot;a9&quot;</code></pre>
<p>Next, consider writing a function which simulates repeatedly tossing a coin <span class="math inline">\(n\)</span> times, counting the number of HEADS out of the <span class="math inline">\(n\)</span> tosses. For the first five repetitions of <span class="math inline">\(n\)</span> tosses, the function will print out the number of HEADS (for example if there are 7 HEADS in the <span class="math inline">\(n=10\)</span> tosses the function prints “The number of HEADS out of 10 tosses is 7.” The function returns a histogram of the number of HEADS, with a title stating “Number of HEADS in ?? tosses” where ?? is replaced by the number of tosses. The <code>paste</code> function will help greatly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="functions.html#cb928-1"></a><span class="op">&gt;</span><span class="st"> </span>coin_toss &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n=</span><span class="dv">10</span>, <span class="dt">iter =</span> <span class="dv">500</span>){</span>
<span id="cb928-2"><a href="functions.html#cb928-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">require</span>(ggplot2)</span>
<span id="cb928-3"><a href="functions.html#cb928-3"></a><span class="op">+</span><span class="st">   </span>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">numheads =</span> <span class="kw">numeric</span>(iter))</span>
<span id="cb928-4"><a href="functions.html#cb928-4"></a><span class="op">+</span><span class="st">   </span><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>iter) {</span>
<span id="cb928-5"><a href="functions.html#cb928-5"></a><span class="op">+</span><span class="st">     </span>df<span class="op">$</span>numheads[i] &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dv">1</span>, n, <span class="fl">0.5</span>)</span>
<span id="cb928-6"><a href="functions.html#cb928-6"></a><span class="op">+</span><span class="st">     </span><span class="cf">if</span>(i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>) {</span>
<span id="cb928-7"><a href="functions.html#cb928-7"></a><span class="op">+</span><span class="st">       </span><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;The number of HEADS out of&quot;</span>, n, <span class="st">&quot;tosses is&quot;</span>, df<span class="op">$</span>numheads[i]))}</span>
<span id="cb928-8"><a href="functions.html#cb928-8"></a><span class="op">+</span><span class="st">   </span>}</span>
<span id="cb928-9"><a href="functions.html#cb928-9"></a><span class="op">+</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> numheads)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb928-10"><a href="functions.html#cb928-10"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb928-11"><a href="functions.html#cb928-11"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of HEADS in&quot;</span>, n, <span class="st">&quot;tosses&quot;</span>))</span>
<span id="cb928-12"><a href="functions.html#cb928-12"></a><span class="op">+</span><span class="st"> </span>}</span>
<span id="cb928-13"><a href="functions.html#cb928-13"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">coin_toss</span>()</span></code></pre></div>
<pre><code>[1] &quot;The number of HEADS out of 10 tosses is 5&quot;
[1] &quot;The number of HEADS out of 10 tosses is 3&quot;
[1] &quot;The number of HEADS out of 10 tosses is 6&quot;
[1] &quot;The number of HEADS out of 10 tosses is 5&quot;
[1] &quot;The number of HEADS out of 10 tosses is 8&quot;</code></pre>
<p><img src="bookdown_files/figure-html/cointoss-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="functions.html#cb930-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">coin_toss</span>(<span class="dt">n =</span> <span class="dv">25</span>, <span class="dt">iter=</span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>[1] &quot;The number of HEADS out of 25 tosses is 11&quot;
[1] &quot;The number of HEADS out of 25 tosses is 13&quot;
[1] &quot;The number of HEADS out of 25 tosses is 11&quot;
[1] &quot;The number of HEADS out of 25 tosses is 16&quot;
[1] &quot;The number of HEADS out of 25 tosses is 17&quot;</code></pre>
<p><img src="bookdown_files/figure-html/cointoss-2.png" width="672" /></p>
<p>Let’s now return to the object <code>moby_dick</code> that contains the text of the novel. If we want to analyze word choice, word frequency, etc., it would be helpful to form a vector in which each element is a word from the novel. One way to do this is to first paste the current version of the <code>moby_dick</code> variable into a new version which is one long vector with the lines pasted together. To illustrate, we will first do this with a much smaller object that shares the structure of <code>moby_dick</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="functions.html#cb932-1"></a><span class="op">&gt;</span><span class="st"> </span>small_novel &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;First line&quot;</span>, <span class="st">&quot;Second somewhat longer line&quot;</span>, </span>
<span id="cb932-2"><a href="functions.html#cb932-2"></a><span class="op">+</span><span class="st">                  &quot;third line.&quot;</span>)</span>
<span id="cb932-3"><a href="functions.html#cb932-3"></a><span class="op">&gt;</span><span class="st"> </span>small_novel</span></code></pre></div>
<pre><code>[1] &quot;First line&quot;                 
[2] &quot;Second somewhat longer line&quot;
[3] &quot;third line.&quot;                </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="functions.html#cb934-1"></a><span class="op">&gt;</span><span class="st"> </span>small_novel &lt;-<span class="st"> </span><span class="kw">paste</span>(small_novel, <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>)</span>
<span id="cb934-2"><a href="functions.html#cb934-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(small_novel)</span></code></pre></div>
<pre><code>[1] 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="functions.html#cb936-1"></a><span class="op">&gt;</span><span class="st"> </span>small_novel</span></code></pre></div>
<pre><code>[1] &quot;First line Second somewhat longer line third line.&quot;</code></pre>
<p>Now we do the same with the actual novel.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="functions.html#cb938-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span><span class="kw">paste</span>(moby_dick, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb938-2"><a href="functions.html#cb938-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(moby_dick)</span></code></pre></div>
<pre><code>[1] 1</code></pre>
<p>At this point <code>moby_dick</code> contains a single very long character string. Next we will separate this string into separate words and clean up the resulting vector a bit.</p>
</div>
<div id="more-string-processing-functions" class="section level2" number="7.30">
<h2 number="7.30"><span class="header-section-number">7.30</span> More String Processing Functions</h2>
<p>Common string processing tasks include changing case between upper and lower, extracting and/or replacing substrings of a string, trimming a string to a specified width, counting the number of characters in a string, etc.</p>
<div id="tolower-and-toupper" class="section level3" number="7.30.1">
<h3 number="7.30.1"><span class="header-section-number">7.30.1</span> <code>tolower</code> and <code>toupper</code></h3>
<p>R contains functions <code>tolower</code> and <code>toupper</code> which very simply change the case of all characters in a string.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="functions.html#cb940-1"></a><span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> &quot;aBCdefG12#&quot;</span></span>
<span id="cb940-2"><a href="functions.html#cb940-2"></a><span class="op">&gt;</span><span class="st"> </span>y &lt;-<span class="st"> </span>x</span>
<span id="cb940-3"><a href="functions.html#cb940-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tolower</span>(x)</span></code></pre></div>
<pre><code>[1] &quot;abcdefg12#&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="functions.html#cb942-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">toupper</span>(y)</span></code></pre></div>
<pre><code>[1] &quot;ABCDEFG12#&quot;</code></pre>
<p>If we are interested in frequencies of words in <em>Moby Dick</em>, converting all the text to the same case makes sense, so for example the word “the” at the beginning of a sentence is not counted differently than the same word in the middle of a sentence.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="functions.html#cb944-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span><span class="kw">tolower</span>(moby_dick)</span></code></pre></div>
</div>
<div id="nchar-and-strsplit" class="section level3" number="7.30.2">
<h3 number="7.30.2"><span class="header-section-number">7.30.2</span> <code>nchar</code> and <code>strsplit</code></h3>
<p>The function <code>nchar</code> counts the number of characters in a string or strings.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="functions.html#cb945-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">nchar</span>(<span class="st">&quot;dog&quot;</span>)</span></code></pre></div>
<pre><code>[1] 3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="functions.html#cb947-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">nchar</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;horse&quot;</span>, <span class="st">&quot;elephant&quot;</span>))</span></code></pre></div>
<pre><code>[1] 3 3 5 8</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="functions.html#cb949-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">nchar</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;horse&quot;</span>, <span class="st">&quot;elephant&quot;</span>, <span class="ot">NA</span>, <span class="st">&quot;goat&quot;</span>))</span></code></pre></div>
<pre><code>[1]  3  3  5  8 NA  4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="functions.html#cb951-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">nchar</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;horse&quot;</span>, <span class="st">&quot;elephant&quot;</span>, <span class="ot">NA</span>, <span class="st">&quot;goat&quot;</span>), <span class="dt">keepNA =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>[1] 3 3 5 8 2 4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="functions.html#cb953-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">nchar</span>(moby_dick)</span></code></pre></div>
<pre><code>[1] 1190309</code></pre>
<p>By default <code>nchar</code> returns NA for a missing value. If you want <code>nchar</code> to return 2 for a <code>NA</code> value, you can set <code>keepNA = TRUE</code>.<a href="references.html#fn55" class="footnote-ref" id="fnref55"><sup>55</sup></a></p>
<p>The function <code>strsplit</code> splits the elements of a character vector. The function returns a list, and often the <code>unlist</code> function is useful to convert the list into an atomic vector.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="functions.html#cb955-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;mail.msu.edu&quot;</span>, <span class="st">&quot;mail.google.com&quot;</span>, <span class="st">&quot;www.amazon.com&quot;</span>),</span>
<span id="cb955-2"><a href="functions.html#cb955-2"></a><span class="op">+</span><span class="st">          </span><span class="dt">split =</span> <span class="st">&quot;.&quot;</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[[1]]
[1] &quot;mail&quot; &quot;msu&quot;  &quot;edu&quot; 

[[2]]
[1] &quot;mail&quot;   &quot;google&quot; &quot;com&quot;   

[[3]]
[1] &quot;www&quot;    &quot;amazon&quot; &quot;com&quot;   </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="functions.html#cb957-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;mail.msu.edu&quot;</span>, <span class="st">&quot;mail.google.com&quot;</span>, <span class="st">&quot;www.amazon.com&quot;</span>),</span>
<span id="cb957-2"><a href="functions.html#cb957-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">split =</span> <span class="st">&quot;.&quot;</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>[1] &quot;mail&quot;   &quot;msu&quot;    &quot;edu&quot;    &quot;mail&quot;   &quot;google&quot;
[6] &quot;com&quot;    &quot;www&quot;    &quot;amazon&quot; &quot;com&quot;   </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="functions.html#cb959-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;pig&quot;</span>, <span class="st">&quot;horse&quot;</span>), </span>
<span id="cb959-2"><a href="functions.html#cb959-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">split =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>[1] &quot;d&quot;   &quot;g&quot;   &quot;cat&quot; &quot;pig&quot; &quot;h&quot;   &quot;rse&quot;</code></pre>
<p>Setting the argument <code>fixed</code> to <code>TRUE</code> tells R to match the value of <code>split</code> exactly when performing the split. The function can be much more powerful if the value of <code>split</code> is a <em>regular expression</em>, which can for example ask for splits at any vowels, etc. We will not go in depth on Regular Expressions here, but we will make some use of regular expressions on a case-by-case basis prior to that. Regular expressions are very powerful, so if this chapter interests you, we suggest researching regular expressions on your own (as always there are plenty of free resources online).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="functions.html#cb961-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;pig&quot;</span>, <span class="st">&quot;horse&quot;</span>, <span class="st">&quot;rabbit&quot;</span>), </span>
<span id="cb961-2"><a href="functions.html#cb961-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">split =</span> <span class="st">&quot;[aeiou]&quot;</span>))</span></code></pre></div>
<pre><code> [1] &quot;d&quot;  &quot;g&quot;  &quot;c&quot;  &quot;t&quot;  &quot;p&quot;  &quot;g&quot;  &quot;h&quot;  &quot;rs&quot; &quot;r&quot;  &quot;bb&quot;
[11] &quot;t&quot; </code></pre>
<p>The regular expression <code>[aeiou]</code> represents any of the letters a, e, i, o, u. In general a string of characters enclosed in square brackets indicates any one character in the string.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="functions.html#cb963-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;pig&quot;</span>, <span class="st">&quot;horse&quot;</span>, <span class="st">&quot;rabbit&quot;</span>), </span>
<span id="cb963-2"><a href="functions.html#cb963-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">split =</span> <span class="st">&quot;[aorb]&quot;</span>))</span></code></pre></div>
<pre><code> [1] &quot;d&quot;   &quot;g&quot;   &quot;c&quot;   &quot;t&quot;   &quot;pig&quot; &quot;h&quot;   &quot;&quot;    &quot;se&quot; 
 [9] &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;it&quot; </code></pre>
<p>The regular expression <code>[aorb]</code> represents any of the letters a, o, r, b.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="functions.html#cb965-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;a1c2b&quot;</span>, <span class="st">&quot;bbb2bc3f&quot;</span>), <span class="dt">split =</span> <span class="st">&quot;[1-9]&quot;</span>))</span></code></pre></div>
<pre><code>[1] &quot;a&quot;   &quot;c&quot;   &quot;b&quot;   &quot;bbb&quot; &quot;bc&quot;  &quot;f&quot;  </code></pre>
<p>The regular expression <code>[1-9]</code> represents any of the numbers 1, 2, 3, 4, 5, 6, 7, 8, 9.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="functions.html#cb967-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;aBc1fGh&quot;</span>, <span class="st">&quot;1TyzaaG&quot;</span>), <span class="dt">split =</span> <span class="st">&quot;[^a-z]&quot;</span>))</span></code></pre></div>
<pre><code>[1] &quot;a&quot;    &quot;c&quot;    &quot;f&quot;    &quot;h&quot;    &quot;&quot;     &quot;&quot;     &quot;yzaa&quot;</code></pre>
<p>The regular expression <code>[a-z]</code> represents any lower case letter. The caret <code>^</code> in front of <code>a-z</code> indicates “match any character <em>except</em> those in the following string” which in this case indicates “match any character that is NOT a lower case letter”.</p>
<p>Recall that the <code>moby_dick</code> vector now contains one long character string which includes the entire text of the novel, and that we would like to split it into separate words. We now know how to do this using <code>strsplit</code> and a regular expression. First a smaller example.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="functions.html#cb969-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the plain&quot;</span>), </span>
<span id="cb969-2"><a href="functions.html#cb969-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">split =</span> <span class="st">&quot;[^0-9A-Za-z]&quot;</span>))</span></code></pre></div>
<pre><code>[1] &quot;the&quot;    &quot;rain&quot;   &quot;in&quot;     &quot;Spain&quot;  &quot;stays&quot; 
[6] &quot;mainly&quot; &quot;in&quot;     &quot;the&quot;    &quot;plain&quot; </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="functions.html#cb971-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the plain&quot;</span>), </span>
<span id="cb971-2"><a href="functions.html#cb971-2"></a><span class="op">+</span><span class="st">                 </span><span class="dt">split =</span><span class="st">&quot; &quot;</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>[1] &quot;the&quot;    &quot;rain&quot;   &quot;in&quot;     &quot;Spain&quot;  &quot;stays&quot; 
[6] &quot;mainly&quot; &quot;in&quot;     &quot;the&quot;    &quot;plain&quot; </code></pre>
<p>Look at the regular expression. The caret says “match anything but” and then <code>0=9A-Za-z</code> says “any digit, any lower-case letter, and any upper-case letter.” So the whole expression (including the fact that it is the value of the argument <code>split</code>) says “match anything but any digit, any lower-case letter, or any upper-case letter”.</p>
<p>Now we apply this to <code>moby_dick</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="functions.html#cb973-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(moby_dick, <span class="dt">split =</span> <span class="st">&quot;[^0-9A-Za-z]&quot;</span>))</span></code></pre></div>
<p>Let’s see a bit of what we have.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="functions.html#cb974-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>]</span></code></pre></div>
<pre><code> [1] &quot;chapter&quot;    &quot;1&quot;          &quot;&quot;          
 [4] &quot;loomings&quot;   &quot;&quot;           &quot;call&quot;      
 [7] &quot;me&quot;         &quot;ishmael&quot;    &quot;&quot;          
[10] &quot;some&quot;       &quot;years&quot;      &quot;ago&quot;       
[13] &quot;&quot;           &quot;never&quot;      &quot;mind&quot;      
[16] &quot;how&quot;        &quot;long&quot;       &quot;precisely&quot; 
[19] &quot;&quot;           &quot;having&quot;     &quot;little&quot;    
[22] &quot;or&quot;         &quot;no&quot;         &quot;money&quot;     
[25] &quot;in&quot;         &quot;my&quot;         &quot;purse&quot;     
[28] &quot;&quot;           &quot;and&quot;        &quot;nothing&quot;   
[31] &quot;particular&quot; &quot;to&quot;         &quot;interest&quot;  
[34] &quot;me&quot;         &quot;on&quot;         &quot;shore&quot;     
[37] &quot;&quot;           &quot;i&quot;          &quot;thought&quot;   
[40] &quot;i&quot;          &quot;would&quot;      &quot;sail&quot;      
[43] &quot;about&quot;      &quot;a&quot;          &quot;little&quot;    
[46] &quot;and&quot;        &quot;see&quot;        &quot;the&quot;       
[49] &quot;watery&quot;     &quot;part&quot;      </code></pre>
<p>There is a small problem: Some of the “words” are blank. The following small example indicates why this happened.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="functions.html#cb976-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the plain&quot;</span>), <span class="dt">split =</span> <span class="st">&quot;[^0-9A-Za-z]&quot;</span>))</span></code></pre></div>
<pre><code> [1] &quot;the&quot;    &quot;rain&quot;   &quot;in&quot;     &quot;Spain&quot;  &quot;&quot;      
 [6] &quot;&quot;       &quot;&quot;       &quot;stays&quot;  &quot;mainly&quot; &quot;in&quot;    
[11] &quot;the&quot;    &quot;plain&quot; </code></pre>
<p>It is not too hard to remove the blank words.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="functions.html#cb978-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(moby_dick)</span></code></pre></div>
<pre><code>[1] 253993</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="functions.html#cb980-1"></a><span class="op">&gt;</span><span class="st"> </span>not.blanks &lt;-<span class="st"> </span><span class="kw">which</span>(moby_dick <span class="op">!=</span><span class="st"> &quot;&quot;</span>)</span>
<span id="cb980-2"><a href="functions.html#cb980-2"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span>moby_dick[not.blanks]</span>
<span id="cb980-3"><a href="functions.html#cb980-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">length</span>(moby_dick)</span></code></pre></div>
<pre><code>[1] 214889</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="functions.html#cb982-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>]</span></code></pre></div>
<pre><code> [1] &quot;chapter&quot;    &quot;1&quot;          &quot;loomings&quot;  
 [4] &quot;call&quot;       &quot;me&quot;         &quot;ishmael&quot;   
 [7] &quot;some&quot;       &quot;years&quot;      &quot;ago&quot;       
[10] &quot;never&quot;      &quot;mind&quot;       &quot;how&quot;       
[13] &quot;long&quot;       &quot;precisely&quot;  &quot;having&quot;    
[16] &quot;little&quot;     &quot;or&quot;         &quot;no&quot;        
[19] &quot;money&quot;      &quot;in&quot;         &quot;my&quot;        
[22] &quot;purse&quot;      &quot;and&quot;        &quot;nothing&quot;   
[25] &quot;particular&quot; &quot;to&quot;         &quot;interest&quot;  
[28] &quot;me&quot;         &quot;on&quot;         &quot;shore&quot;     
[31] &quot;i&quot;          &quot;thought&quot;    &quot;i&quot;         
[34] &quot;would&quot;      &quot;sail&quot;       &quot;about&quot;     
[37] &quot;a&quot;          &quot;little&quot;     &quot;and&quot;       
[40] &quot;see&quot;        &quot;the&quot;        &quot;watery&quot;    
[43] &quot;part&quot;       &quot;of&quot;         &quot;the&quot;       
[46] &quot;world&quot;      &quot;it&quot;         &quot;is&quot;        
[49] &quot;a&quot;          &quot;way&quot;       </code></pre>
<p>(In this example it would have been more efficient to replace</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="functions.html#cb984-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(moby_dick, <span class="dt">split =</span> <span class="st">&quot;[^0-9A-Za-z]&quot;</span>))</span></code></pre></div>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="functions.html#cb985-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick2 &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(moby_dick, <span class="dt">split =</span> <span class="st">&quot; &quot;</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>Then the second step of selecting the non-blank words would not have been necessary. But regular expressions will be essential going forward, so it was worthwhile using regular expressions even if they do not provide the most efficient method.)</p>
</div>
<div id="practice-problem-14" class="section level3" number="7.30.3">
<h3 number="7.30.3"><span class="header-section-number">7.30.3</span> Practice Problem</h3>
<p>Use <code>strsplit()</code> and regular expressions to split the following strings into their respective words (i.e. write a regular expression that will match the <code>-</code> and <code>.</code> character). Your output should be a vector (not a list).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="functions.html#cb986-1"></a><span class="op">&gt;</span><span class="st"> </span>strings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Once-upon&quot;</span>, <span class="st">&quot;a.time&quot;</span>, <span class="st">&quot;there&quot;</span>, <span class="st">&quot;was-a&quot;</span>, <span class="st">&quot;man.named&quot;</span>, <span class="st">&quot;Bob&quot;</span>)</span></code></pre></div>
</div>
<div id="nchar-again" class="section level3" number="7.30.4">
<h3 number="7.30.4"><span class="header-section-number">7.30.4</span> <code>nchar</code> Again</h3>
<p>Now that the vector <code>moby_dick</code> contains each word in the novel as a separate element, it is relatively easy to do some basic analyses. For example the <code>nchar</code> function can give us a count of the number of characters in each element of the vector, i.e., can give us the number of letters in each word in the novel.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="functions.html#cb987-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick_nchar &lt;-<span class="st"> </span><span class="kw">nchar</span>(moby_dick)</span>
<span id="cb987-2"><a href="functions.html#cb987-2"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick_nchar[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>]</span></code></pre></div>
<pre><code> [1]  7  1  8  4  2  7  4  5  3  5  4  3  4  9  6  6  2
[18]  2  5  2  2  5  3  7 10  2  8  2  2  5  1  7  1  5
[35]  4  5  1  6  3  3  3  6  4  2  3  5  2  2  1  3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="functions.html#cb989-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(moby_dick_nchar)</span></code></pre></div>
<pre><code>[1] 20</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="functions.html#cb991-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">nwords =</span> moby_dick_nchar), <span class="kw">aes</span>(<span class="dt">x =</span> nwords)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-2"><a href="functions.html#cb991-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-3"><a href="functions.html#cb991-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">ggtitle</span>(<span class="st">&quot;Number of letters in words in Moby Dick&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-4"><a href="functions.html#cb991-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-285-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="functions.html#cb992-1"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick_word_table &lt;-<span class="st"> </span><span class="kw">table</span>(moby_dick)</span>
<span id="cb992-2"><a href="functions.html#cb992-2"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick_word_table &lt;-<span class="st"> </span><span class="kw">sort</span>(moby_dick_word_table, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb992-3"><a href="functions.html#cb992-3"></a><span class="op">&gt;</span><span class="st"> </span>moby_dick_word_table[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>]</span></code></pre></div>
<pre><code>moby_dick
  the    of   and     a    to    in  that    it   his 
14175  6469  6325  4636  4539  4077  3045  2497  2495 
    i    he   but     s    as  with    is   was   for 
 2114  1876  1805  1737  1720  1692  1690  1627  1593 
  all  this    at    by whale   not  from   him    so 
 1515  1382  1304  1175  1150  1142  1072  1058  1053 
   on    be   one   you there   now   had  have    or 
 1040  1032   907   884   854   779   767   754   689 
 were  they  like    me  then which  what  some their 
  677   649   639   630   628   625   611   608   604 
 when    an   are    my    no 
  601   590   587   587   581 </code></pre>
</div>
<div id="practice-problem-15" class="section level3" number="7.30.5">
<h3 number="7.30.5"><span class="header-section-number">7.30.5</span> Practice Problem</h3>
<p>The goal of this exercise is to generate a wordcloud image of the 50 most frqeuent words in <em>Moby Dick</em> that we identifid above. To do this, we need the <code>wordcloud</code> package (you may also need to install the package <code>tm</code>). Look at the R documentation for the <code>wordcloud</code> function included in the <code>wordcloud</code> package and create a wordcloud image of the most popular 500 words in the novel. Here is what mine looks like</p>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-1.png" width="672" /></p>
</div>
<div id="substr-and-strtrim" class="section level3" number="7.30.6">
<h3 number="7.30.6"><span class="header-section-number">7.30.6</span> <code>substr</code> and <code>strtrim</code></h3>
<p>The <code>substr</code> function can be used to extract or replace substrings. The first argument is the string to be manipulated, and the second and third arguments specify the first and last elements of the string to be extracted or to be replaced.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="functions.html#cb994-1"></a><span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> &quot;Michigan&quot;</span></span>
<span id="cb994-2"><a href="functions.html#cb994-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">substr</span>(x, <span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>[1] &quot;ch&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="functions.html#cb996-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">substr</span>(x, <span class="dv">3</span>, <span class="dv">4</span>) &lt;-<span class="st"> &quot;CH&quot;</span></span>
<span id="cb996-2"><a href="functions.html#cb996-2"></a><span class="op">&gt;</span><span class="st"> </span>x</span></code></pre></div>
<pre><code>[1] &quot;MiCHigan&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="functions.html#cb998-1"></a><span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Ohio&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>)</span>
<span id="cb998-2"><a href="functions.html#cb998-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">substr</span>(x, <span class="dv">2</span>,<span class="dv">4</span>)</span></code></pre></div>
<pre><code>[1] &quot;hio&quot; &quot;ich&quot; &quot;lli&quot; &quot;isc&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="functions.html#cb1000-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">substr</span>(x, <span class="dv">2</span>, <span class="dv">4</span>) &lt;-<span class="st"> &quot;$#&amp;&quot;</span></span>
<span id="cb1000-2"><a href="functions.html#cb1000-2"></a><span class="op">&gt;</span><span class="st"> </span>x</span></code></pre></div>
<pre><code>[1] &quot;O$#&amp;&quot;      &quot;M$#&amp;igan&quot;  &quot;I$#&amp;nois&quot;  &quot;W$#&amp;onsin&quot;</code></pre>
<p>The <code>strtrim</code> function trims a character string to a specified length.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="functions.html#cb1002-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">strtrim</span>(<span class="st">&quot;Michigan&quot;</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>[1] &quot;M&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="functions.html#cb1004-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">strtrim</span>(<span class="st">&quot;Michigan&quot;</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>[1] &quot;Mich&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="functions.html#cb1006-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">strtrim</span>(<span class="st">&quot;Michigan&quot;</span>, <span class="dv">100</span>)</span></code></pre></div>
<pre><code>[1] &quot;Michigan&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="functions.html#cb1008-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">strtrim</span>(<span class="kw">c</span>(<span class="st">&quot;Ohio&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>[1] &quot;Ohi&quot; &quot;Mic&quot; &quot;Ill&quot; &quot;Wis&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="functions.html#cb1010-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">strtrim</span>(<span class="kw">c</span>(<span class="st">&quot;Ohio&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))</span></code></pre></div>
<pre><code>[1] &quot;Ohi&quot;    &quot;Mich&quot;   &quot;Illin&quot;  &quot;Wiscon&quot;</code></pre>
</div>
<div id="grep-and-related-functions" class="section level3" number="7.30.7">
<h3 number="7.30.7"><span class="header-section-number">7.30.7</span> <code>grep</code> and Related Functions</h3>
<p>The <code>grep</code> function searches for a specified pattern and returns either the locations where this pattern is found or the selected elements. The <code>grepl</code> function returns a logical vector rather than locations of elements.</p>
<p>Here are some examples. All use <code>fixed = TRUE</code> since at this point we are using fixed character strings rather than regular expressions.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="functions.html#cb1012-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;a&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the plain&quot;</span>), </span>
<span id="cb1012-2"><a href="functions.html#cb1012-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1] 1 2 4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="functions.html#cb1014-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;a&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the plain&quot;</span>), </span>
<span id="cb1014-2"><a href="functions.html#cb1014-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">fixed =</span> <span class="ot">TRUE</span>, <span class="dt">value =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1] &quot;the rain&quot;                
[2] &quot;in Spain    stays mainly&quot;
[3] &quot;the plain&quot;               </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="functions.html#cb1016-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;a&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, <span class="st">&quot;the plain&quot;</span>), </span>
<span id="cb1016-2"><a href="functions.html#cb1016-2"></a><span class="op">+</span><span class="st">       </span><span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1]  TRUE  TRUE FALSE  TRUE</code></pre>
<p>The <code>sub</code> and <code>gsub</code> functions replace a specified character string. The <code>sub</code> function only replaces the first occurrence, while <code>gsub</code> replaces all occurrences.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="functions.html#cb1018-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;?&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, </span>
<span id="cb1018-2"><a href="functions.html#cb1018-2"></a><span class="op">+</span><span class="st">                  &quot;the plain&quot;</span>), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1] &quot;the r?in&quot;                
[2] &quot;in Sp?in    st?ys m?inly&quot;
[3] &quot;in&quot;                      
[4] &quot;the pl?in&quot;               </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="functions.html#cb1020-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;?&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, </span>
<span id="cb1020-2"><a href="functions.html#cb1020-2"></a><span class="op">+</span><span class="st">                 &quot;the plain&quot;</span>), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1] &quot;the r?in&quot;                
[2] &quot;in Sp?in    stays mainly&quot;
[3] &quot;in&quot;                      
[4] &quot;the pl?in&quot;               </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="functions.html#cb1022-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;???&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, </span>
<span id="cb1022-2"><a href="functions.html#cb1022-2"></a><span class="op">+</span><span class="st">                    &quot;the plain&quot;</span>), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1] &quot;the r???in&quot;                    
[2] &quot;in Sp???in    st???ys m???inly&quot;
[3] &quot;in&quot;                            
[4] &quot;the pl???in&quot;                   </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="functions.html#cb1024-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;???&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;the rain&quot;</span>, <span class="st">&quot;in Spain    stays mainly&quot;</span>, <span class="st">&quot;in&quot;</span>, </span>
<span id="cb1024-2"><a href="functions.html#cb1024-2"></a><span class="op">+</span><span class="st">                   &quot;the plain&quot;</span>), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>[1] &quot;the r???in&quot;                
[2] &quot;in Sp???in    stays mainly&quot;
[3] &quot;in&quot;                        
[4] &quot;the pl???in&quot;               </code></pre>
</div>
</div>
<div id="exercises-8" class="section level2" number="7.31">
<h2 number="7.31"><span class="header-section-number">7.31</span> Exercises</h2>
<p><strong>Exercise Text Data</strong> Learning objectives: read and write text data; concatenate text with the <code>paste</code> function, analyze text with <code>nchar</code>; practice with functions; manipulate strings with <code>substr</code> and <code>strtrim</code>.</p>

<p>_# Rcpp</p>
<p>R is an interpreted language. The code interpretor runs each line of a script individually instead of compiling the entire file at once as in a compiled language like C++. This means R can be slower than compiled languages when completing some tasks. In this chapter, we show how to improve the performance of our R scripts by rewriting functions in C++<a href="references.html#fn56" class="footnote-ref" id="fnref56"><sup>56</sup></a>. Although R has an API for developers to move between R data structures and data structures in lower-level languages (C++, C, FORTRAN, etc.), an alternative is to use <code>Rcpp</code>. According to the <a href="http://www.rcpp.org/">official Rcpp website</a>, “Rcpp provides a powerful API on top of R, permitting direct interchange of rich R objects between R and C++.” It is a higher-level approach than using the aforementioned API directly. C++ functions can address gaps in R’s abilities including</p>
<ul>
<li>Vectorizing loops whose subsequent iterations depend on previous iterations.</li>
<li>Writing recursive functions with lower overhead. (Recursive functions are functions that call themselves, leading to millions of function calls.)</li>
<li>Using data structures and algorithms that R does not provide but that are in the C++ standard template library (STL) such as ordered maps and double-ended queues.</li>
</ul>
<p>In this chapter, we will cover an abbreviated/modified version of Hadley Wickham’s tutorial <a href="http://adv-r.had.co.nz/Rcpp.html%7D%7BHigh%20performance%20functions%20with%20Rcpp">High performance functions with Rcpp</a></p>
</div>
<div id="getting-started-with-rcpp" class="section level2" number="7.32">
<h2 number="7.32"><span class="header-section-number">7.32</span> Getting Started with Rcpp</h2>
<div id="installation" class="section level3" number="7.32.1">
<h3 number="7.32.1"><span class="header-section-number">7.32.1</span> Installation</h3>
<p>Before we install the <code>Rcpp</code> package, we need a working C++ compiler. To get the compiler:</p>
<ul>
<li>Windows: install Rtools from <a href="https://cran.r-project.org/bin/windows/Rtools/">here</a>.</li>
<li>Mac: install Xcode from the Mac App Store.</li>
<li>Linux: in the terminal (for Debian-based systems or similar) enter
<code>sudo apt-get install r-base dev</code>.</li>
</ul>
<p>Now we can install <code>Rcpp</code>. (Note that the <code>microbenchmark</code> package is needed for the examples in this chapter, so we’ll install that, too.)</p>
</div>
<div id="the-simplest-c-example" class="section level3" number="7.32.2">
<h3 number="7.32.2"><span class="header-section-number">7.32.2</span> The Simplest C++ Example</h3>
<p>It is common for textbooks to introduce a new programming language through the “Hello World” program.<a href="references.html#fn57" class="footnote-ref" id="fnref57"><sup>57</sup></a> If we wanted to write this simple program in C++, the code would look like this:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1026-1"><a href="functions.html#cb1026-1"></a>&gt; <span class="er">#include &lt;iostream&gt;</span></span>
<span id="cb1026-2"><a href="functions.html#cb1026-2"></a>+ </span>
<span id="cb1026-3"><a href="functions.html#cb1026-3"></a>+ <span class="dt">int</span> main()</span>
<span id="cb1026-4"><a href="functions.html#cb1026-4"></a>+ {</span>
<span id="cb1026-5"><a href="functions.html#cb1026-5"></a>+     <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Hello World!&quot;</span> &lt;&lt; <span class="bu">std::</span>endl;</span>
<span id="cb1026-6"><a href="functions.html#cb1026-6"></a>+ }</span></code></pre></div>
<p>Think about the C++ code above. How would you accomplish the same task in R? How are the programs similar in syntax and structure? How are they different? In the following section, we will rewrite this program in a format that can interface with R through <code>Rcpp</code>. Note that C++ is a compiled language, which means we cannot run the program line-by-line like we can with an R script.</p>
</div>
</div>
<div id="using-rcpp" class="section level2" number="7.33">
<h2 number="7.33"><span class="header-section-number">7.33</span> Using Rcpp</h2>
<div id="exporting-c-functions" class="section level3" number="7.33.1">
<h3 number="7.33.1"><span class="header-section-number">7.33.1</span> Exporting C++ Functions</h3>
<p>Let’s start out with that simple, obligatory “Hello World!” program in C++ that we will export to R. C++ files use the extension <code>*.cpp</code>. Through the RStudio menu, create a new C++ File (File <span class="math inline">\(&gt;\)</span> New File <span class="math inline">\(&gt;\)</span> C++ File). Note that the default C++ file contains the line <code>#include &lt;Rcpp.h&gt;</code>. In C++, these <code>include</code> files are header files that provide us with objects and functions that we can use within our C++ file. Although the program building process is different, there are some parallels between these header files and the packages we use in our R code. Note that unlike R, every line of code in a C++ file must end with a semicolon.</p>
<p>To verify that Rcpp is working correctly, let’s run the following code. Save the document as <code>hello.cpp</code>, and enter the following code:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1027-1"><a href="functions.html#cb1027-1"></a>&gt; <span class="er">#include &lt;Rcpp.h&gt;</span></span>
<span id="cb1027-2"><a href="functions.html#cb1027-2"></a>+ <span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1027-3"><a href="functions.html#cb1027-3"></a>+ </span>
<span id="cb1027-4"><a href="functions.html#cb1027-4"></a>+ <span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1027-5"><a href="functions.html#cb1027-5"></a>+ </span>
<span id="cb1027-6"><a href="functions.html#cb1027-6"></a>+ <span class="dt">void</span> hello(){</span>
<span id="cb1027-7"><a href="functions.html#cb1027-7"></a>+   Rprintf(<span class="st">&quot;Hello World!</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb1027-8"><a href="functions.html#cb1027-8"></a>+ }</span></code></pre></div>
<p>Let’s do a quick line-by line explanation:</p>
<ol style="list-style-type: decimal">
<li><code>#include &lt;Rcpp.h&gt;</code>: contains the definitions used by the Rcpp package.
<code>using namespace Rcpp;</code>: allows us to call functions from the Rcpp header file by writing <code>functionname</code> instead of <code>Rcpp::functionname</code>.
<code>// [[Rcpp::export]]</code>: an Rcpp attribute. Attributes are annotations that are added to C++ source files to indicate that C++ functions should be made available as R functions.
<code>void hello(){</code>: the declaration of the <code>hello</code> function, which has a return type <code>void</code> and no arguments, hence the empty parentheses. Note that the function content (definition) is all contained within the squiggly brackets.
<code>Rprintf("Hello World!\n");</code>: prints to the R console.</li>
</ol>
<p>Now, we can go to the RStudio Console and test our code with the following three lines and the expected output.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="functions.html#cb1028-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(Rcpp)</span>
<span id="cb1028-2"><a href="functions.html#cb1028-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">sourceCpp</span>(<span class="st">&quot;hello.cpp&quot;</span>)</span>
<span id="cb1028-3"><a href="functions.html#cb1028-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">hello</span>()</span></code></pre></div>
<pre><code>[1] &quot;Hello&quot;</code></pre>
<p>The <code>sourceCpp</code> function parsed our C++ file (“hello.cpp”) and looked for functions marked with the <code>Rcpp::export</code> attribute. A shared library was then built and the exported function (<code>hello()</code>) was made available as an R function in the current environment. The function simply printed “Hello World!” to our RStudio Console. Great! You have now written a C++ function using built-in C++ types and Rcpp wrapper types and then sourced them like an R script.</p>
</div>
<div id="inline-c-code" class="section level3" number="7.33.2">
<h3 number="7.33.2"><span class="header-section-number">7.33.2</span> Inline C++ Code</h3>
<p>Maintaining C++ code in it’s own source file provides several benefits including the ability to use C++ aware text-editing tools and straightforward mapping of compilation errors to lines in the source file. However, it’s also possible to do inline declaration and execution of C++ code.</p>
<p>There are several ways to accomplish this, including passing a code string to <code>sourceCpp()</code> or using the shorter-form <code>cppFunction()</code> or <code>evalCpp()</code> functions. Run the following code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="functions.html#cb1030-1"></a><span class="kw">library</span>(Rcpp)</span>
<span id="cb1030-2"><a href="functions.html#cb1030-2"></a></span>
<span id="cb1030-3"><a href="functions.html#cb1030-3"></a><span class="kw">cppFunction</span>(<span class="st">&quot;</span></span>
<span id="cb1030-4"><a href="functions.html#cb1030-4"></a><span class="st">  int add(int x, int y, int z) {</span></span>
<span id="cb1030-5"><a href="functions.html#cb1030-5"></a><span class="st">    int sum = x + y + z;</span></span>
<span id="cb1030-6"><a href="functions.html#cb1030-6"></a><span class="st">    return sum;</span></span>
<span id="cb1030-7"><a href="functions.html#cb1030-7"></a><span class="st">  }&quot;</span></span>
<span id="cb1030-8"><a href="functions.html#cb1030-8"></a>)</span>
<span id="cb1030-9"><a href="functions.html#cb1030-9"></a></span>
<span id="cb1030-10"><a href="functions.html#cb1030-10"></a><span class="kw">add</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>[1] 7</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="functions.html#cb1032-1"></a>a &lt;-<span class="st"> </span><span class="kw">add</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1032-2"><a href="functions.html#cb1032-2"></a>a</span></code></pre></div>
<pre><code>[1] 6</code></pre>
<p>When you run this code, Rcpp will compile the C++ code and construct an R function that connects to the compiled C++ function. We’re going to use this simple interface to learn how to write C++. C++ is a large language, and there’s no way to cover it all in the limited time we have. Instead, you’ll get the basics so that you can start writing useful functions to address bottlenecks in your R code.</p>
</div>
</div>
<div id="the-rcpp-interface" class="section level2" number="7.34">
<h2 number="7.34"><span class="header-section-number">7.34</span> The Rcpp Interface</h2>
<p>The following subsections will teach you the basics by translating simple R functions to their C++ equivalents. We’ll start simple with a function that has no inputs and a scalar output, and then get progressively more complicated:</p>
<ul>
<li>No input and scalar output</li>
<li>Scalar input and scalar output</li>
<li>Vector input and scalar output</li>
<li>Vector input and vector output</li>
<li>Matrix input and vector output</li>
<li>Matrix input and matrix output</li>
</ul>
</div>
<div id="no-input-and-scalar-output" class="section level2" number="7.35">
<h2 number="7.35"><span class="header-section-number">7.35</span> No input and scalar output</h2>
<p>Let’s start with a very simple function. It has no arguments and always returns the integer 1:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="functions.html#cb1034-1"></a>one &lt;-<span class="st"> </span><span class="cf">function</span>() 1L</span></code></pre></div>
<p>The equivalent C++ function is:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1035-1"><a href="functions.html#cb1035-1"></a>&gt; <span class="dt">int</span> one() {</span>
<span id="cb1035-2"><a href="functions.html#cb1035-2"></a>+   <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb1035-3"><a href="functions.html#cb1035-3"></a>+ }</span></code></pre></div>
<p>We can compile and use this from R with <code>cppFunction</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="functions.html#cb1036-1"></a><span class="kw">cppFunction</span>(<span class="st">&quot;</span></span>
<span id="cb1036-2"><a href="functions.html#cb1036-2"></a><span class="st">  int one() {</span></span>
<span id="cb1036-3"><a href="functions.html#cb1036-3"></a><span class="st">    return 1;</span></span>
<span id="cb1036-4"><a href="functions.html#cb1036-4"></a><span class="st">  }&quot;</span></span>
<span id="cb1036-5"><a href="functions.html#cb1036-5"></a>)</span></code></pre></div>
<p>This small function illustrates a number of important differences between R and C++:</p>
<ul>
<li>The syntax to create a function looks like the syntax to call a function; you don’t use assignment to create functions as you do in R.</li>
<li>You must declare the type of output the function returns. This function returns an int (a scalar integer). The classes for the most common types of R vectors are: NumericVector, IntegerVector, CharacterVector, and LogicalVector.</li>
<li>Scalars and vectors are different. The scalar equivalents of numeric, integer, character, and logical vectors are: double, int, String, and bool.</li>
<li>You must use an explicit return statement to return a value from a function.</li>
<li>Every statement is terminated by a semicolon.</li>
</ul>
<div id="scalar-input-and-scalar-output" class="section level3" number="7.35.1">
<h3 number="7.35.1"><span class="header-section-number">7.35.1</span> Scalar input and scalar output</h3>
<p>The next example function implements a scalar version of the <code>sign()</code> function which returns 1 if the input is positive, and -1 if it’s negative:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="functions.html#cb1037-1"></a>signR &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb1037-2"><a href="functions.html#cb1037-2"></a>    <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb1037-3"><a href="functions.html#cb1037-3"></a>        <span class="dv">1</span></span>
<span id="cb1037-4"><a href="functions.html#cb1037-4"></a>    } <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb1037-5"><a href="functions.html#cb1037-5"></a>        <span class="dv">0</span></span>
<span id="cb1037-6"><a href="functions.html#cb1037-6"></a>    } <span class="cf">else</span> {</span>
<span id="cb1037-7"><a href="functions.html#cb1037-7"></a>        <span class="dv">-1</span></span>
<span id="cb1037-8"><a href="functions.html#cb1037-8"></a>    }</span>
<span id="cb1037-9"><a href="functions.html#cb1037-9"></a>}</span>
<span id="cb1037-10"><a href="functions.html#cb1037-10"></a></span>
<span id="cb1037-11"><a href="functions.html#cb1037-11"></a><span class="kw">cppFunction</span>(<span class="st">&quot;</span></span>
<span id="cb1037-12"><a href="functions.html#cb1037-12"></a><span class="st">  int signC(int x) {</span></span>
<span id="cb1037-13"><a href="functions.html#cb1037-13"></a><span class="st">    if (x &gt; 0) {</span></span>
<span id="cb1037-14"><a href="functions.html#cb1037-14"></a><span class="st">      return 1;</span></span>
<span id="cb1037-15"><a href="functions.html#cb1037-15"></a><span class="st">    } else if (x == 0) {</span></span>
<span id="cb1037-16"><a href="functions.html#cb1037-16"></a><span class="st">      return 0;</span></span>
<span id="cb1037-17"><a href="functions.html#cb1037-17"></a><span class="st">    } else {</span></span>
<span id="cb1037-18"><a href="functions.html#cb1037-18"></a><span class="st">      return -1;</span></span>
<span id="cb1037-19"><a href="functions.html#cb1037-19"></a><span class="st">    }</span></span>
<span id="cb1037-20"><a href="functions.html#cb1037-20"></a><span class="st">  }&quot;</span></span>
<span id="cb1037-21"><a href="functions.html#cb1037-21"></a>)</span></code></pre></div>
<p>In the C++ version:</p>
<ul>
<li><p>We declare the type of each input in the same way we declare the type of the output. While this makes the code a little more verbose, it also makes it very obvious what type of input the function needs.</p></li>
<li><p>The <code>if</code> syntax is identical. While there are some big differences between R and C++, there are also lots of similarities! C++ also has a <code>while</code> statement that works the same way as R’s, e.g., as in R you can use <code>break</code> to exit the loop.</p></li>
</ul>
</div>
<div id="vector-input-and-scalar-output" class="section level3" number="7.35.2">
<h3 number="7.35.2"><span class="header-section-number">7.35.2</span> Vector input and scalar output</h3>
<p>One big difference between R and C++ is that the cost of loops is much lower in C++. For example, we could implement the <code>sum()</code> function in R using a loop. If you’ve been programming in R a while, you’ll probably have a visceral reaction to this function!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="functions.html#cb1038-1"></a>sumR &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb1038-2"><a href="functions.html#cb1038-2"></a>    total &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb1038-3"><a href="functions.html#cb1038-3"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)) {</span>
<span id="cb1038-4"><a href="functions.html#cb1038-4"></a>        total &lt;-<span class="st"> </span>total <span class="op">+</span><span class="st"> </span>x[i]</span>
<span id="cb1038-5"><a href="functions.html#cb1038-5"></a>    }</span>
<span id="cb1038-6"><a href="functions.html#cb1038-6"></a>    total</span>
<span id="cb1038-7"><a href="functions.html#cb1038-7"></a>}</span></code></pre></div>
<p>In C++, loops have very little overhead, so it’s fine to use them.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="functions.html#cb1039-1"></a><span class="kw">cppFunction</span>(<span class="st">&quot;</span></span>
<span id="cb1039-2"><a href="functions.html#cb1039-2"></a><span class="st">  double sumC(NumericVector x) {</span></span>
<span id="cb1039-3"><a href="functions.html#cb1039-3"></a><span class="st">    int n = x.size();</span></span>
<span id="cb1039-4"><a href="functions.html#cb1039-4"></a><span class="st">    double total = 0;</span></span>
<span id="cb1039-5"><a href="functions.html#cb1039-5"></a><span class="st">    for(int i = 0; i &lt; n; i++) {</span></span>
<span id="cb1039-6"><a href="functions.html#cb1039-6"></a><span class="st">      total += x[i];</span></span>
<span id="cb1039-7"><a href="functions.html#cb1039-7"></a><span class="st">    }</span></span>
<span id="cb1039-8"><a href="functions.html#cb1039-8"></a><span class="st">    return total;</span></span>
<span id="cb1039-9"><a href="functions.html#cb1039-9"></a><span class="st">  }&quot;</span></span>
<span id="cb1039-10"><a href="functions.html#cb1039-10"></a>)</span></code></pre></div>
<p>The C++ version is similar, but</p>
<ul>
<li><p>To find the length of the vector, we use the <code>.size()</code> method, which returns an integer. C++ methods are called with <code>.</code> (i.e., a period).</p></li>
<li><p>The <code>for</code> statement has a different syntax: <code>for(init; check; increment)</code>. This loop is initialized by creating a new variable called <code>i</code> with value 0. Before each iteration, we check that <code>i &lt; n</code>, and terminate the loop if it’s not. After each iteration, we increment the value of <code>i</code> by one, using the special prefix operator <code>++</code> which increases the value of <code>i</code> by 1.</p></li>
<li><p>In C++, vector indices start at 0. I’ll say this again because it’s so important: IN C++, VECTOR INDICES START AT 0! This is a very common source of bugs when converting R functions to C++.</p></li>
<li><p>Use <code>=</code> for assignment, not <code>&lt;-</code>.</p></li>
<li><p>C++ provides operators that modify in-place: <code>total += x[i]</code> is equivalent to <code>total = total + x[i]</code>. Similar in-place operators are <code>-=</code>, <code>*=;</code>, and <code>/=</code>.</p></li>
</ul>
<p>This is a good example of where C++ is much more efficient than R. As shown by the following microbenchmark, <code>sumC()</code> is competitive with the built-in (and highly optimized) <code>sum()</code>, while <code>sumR()</code> is several orders of magnitude slower. Note, you’ll need to install the microbenchmark package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="functions.html#cb1040-1"></a><span class="kw">library</span>(microbenchmark)</span>
<span id="cb1040-2"><a href="functions.html#cb1040-2"></a></span>
<span id="cb1040-3"><a href="functions.html#cb1040-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1000</span>)</span>
<span id="cb1040-4"><a href="functions.html#cb1040-4"></a><span class="kw">microbenchmark</span>(<span class="kw">sum</span>(x), <span class="kw">sumC</span>(x), <span class="kw">sumR</span>(x))</span></code></pre></div>
<pre><code>Unit: microseconds
    expr    min     lq   mean median     uq     max
  sum(x)  1.026  1.083  1.991  1.163  1.474   22.42
 sumC(x)  2.421  2.513 10.794  2.689  3.378  754.90
 sumR(x) 39.359 39.654 81.455 40.975 55.085 3181.98
 neval cld
   100  a 
   100  a 
   100   b</code></pre>
<p>The <code>microbenchmark()</code> function runs each function it’s passed 100 times and provides summary statistics for the multiple execution times. This is a very handy tool for testing various function implementations (as illustrated above).</p>
</div>
<div id="vector-input-and-vector-output" class="section level3" number="7.35.3">
<h3 number="7.35.3"><span class="header-section-number">7.35.3</span> Vector input and vector output</h3>
<p>Next we’ll create a function that computes the Euclidean distance between a value and a vector of values:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="functions.html#cb1042-1"></a>pdistR &lt;-<span class="st"> </span><span class="cf">function</span>(x, ys) {</span>
<span id="cb1042-2"><a href="functions.html#cb1042-2"></a>    <span class="kw">sqrt</span>((x <span class="op">-</span><span class="st"> </span>ys)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb1042-3"><a href="functions.html#cb1042-3"></a>}</span></code></pre></div>
<p>It’s not obvious that we want <code>x</code> to be a scalar from the function definition. We’d need to make that clear in the documentation. That’s not a problem in the C++ version because we have to be explicit about types:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="functions.html#cb1043-1"></a><span class="kw">cppFunction</span>(<span class="st">&quot;</span></span>
<span id="cb1043-2"><a href="functions.html#cb1043-2"></a><span class="st">  NumericVector pdistC(double x, NumericVector ys) {</span></span>
<span id="cb1043-3"><a href="functions.html#cb1043-3"></a><span class="st">    int n = ys.size();</span></span>
<span id="cb1043-4"><a href="functions.html#cb1043-4"></a><span class="st">    NumericVector out(n);</span></span>
<span id="cb1043-5"><a href="functions.html#cb1043-5"></a></span>
<span id="cb1043-6"><a href="functions.html#cb1043-6"></a><span class="st">    for(int i = 0; i &lt; n; i++) {</span></span>
<span id="cb1043-7"><a href="functions.html#cb1043-7"></a><span class="st">      out[i] = sqrt(pow(ys[i] - x, 2.0));</span></span>
<span id="cb1043-8"><a href="functions.html#cb1043-8"></a><span class="st">    }</span></span>
<span id="cb1043-9"><a href="functions.html#cb1043-9"></a><span class="st">    return out;</span></span>
<span id="cb1043-10"><a href="functions.html#cb1043-10"></a><span class="st">  }&quot;</span></span>
<span id="cb1043-11"><a href="functions.html#cb1043-11"></a>)</span></code></pre></div>
<p>This function introduces only a few new concepts:</p>
<ul>
<li>We create a new numeric vector of length n with a constructor: <code>NumericVector out(n)</code>. This and similar vector and matrix constrictors initialize the elements with zeros. Another useful way of making a vector is to copy an existing one: <code>NumericVector zs = clone(ys)</code>.</li>
<li>C++ uses <code>pow()</code>, not <code>^</code>, for exponentiation.</li>
</ul>
<p>Note that because the R version is fully vectorized, it’s already going to be fast. On my computer, it takes around 8 ms with a 1 million element y vector. The C++ function is twice as fast, <span class="math inline">\(\sim\)</span> 4 ms, but assuming it took you 10 minutes to write the C++ function, you’d need to run it <span class="math inline">\(\sim\)</span> 150,000 times to make rewriting worthwhile :-) The reason why the C++ function is faster is subtle, and relates to memory management. The R version needs to create an intermediate vector the same length as <code>y(x - ys)</code>, and allocating memory is an expensive operation. The C++ function avoids this overhead because it uses an intermediate scalar.</p>
</div>
<div id="matrix-input-and-vector-output" class="section level3" number="7.35.4">
<h3 number="7.35.4"><span class="header-section-number">7.35.4</span> Matrix input and vector output</h3>
<p>Each vector type has a matrix equivalent: <code>NumericMatrix</code>, <code>IntegerMatrix</code>, <code>CharacterMatrix</code>, and <code>LogicalMatrix</code>. Using them is straightforward. For example, we could create a function that reproduces <code>rowSums()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="functions.html#cb1044-1"></a><span class="kw">cppFunction</span>(<span class="st">&quot;</span></span>
<span id="cb1044-2"><a href="functions.html#cb1044-2"></a><span class="st">  NumericVector rowSumsC(NumericMatrix x) {</span></span>
<span id="cb1044-3"><a href="functions.html#cb1044-3"></a><span class="st">    int nrow = x.nrow(), ncol = x.ncol();</span></span>
<span id="cb1044-4"><a href="functions.html#cb1044-4"></a><span class="st">    NumericVector out(nrow);</span></span>
<span id="cb1044-5"><a href="functions.html#cb1044-5"></a></span>
<span id="cb1044-6"><a href="functions.html#cb1044-6"></a><span class="st">    for (int i = 0; i &lt; nrow; i++) {</span></span>
<span id="cb1044-7"><a href="functions.html#cb1044-7"></a><span class="st">      double total = 0;</span></span>
<span id="cb1044-8"><a href="functions.html#cb1044-8"></a><span class="st">      for (int j = 0; j &lt; ncol; j++) {</span></span>
<span id="cb1044-9"><a href="functions.html#cb1044-9"></a><span class="st">        total += x(i, j);</span></span>
<span id="cb1044-10"><a href="functions.html#cb1044-10"></a><span class="st">      }</span></span>
<span id="cb1044-11"><a href="functions.html#cb1044-11"></a><span class="st">      out[i] = total;</span></span>
<span id="cb1044-12"><a href="functions.html#cb1044-12"></a><span class="st">    }</span></span>
<span id="cb1044-13"><a href="functions.html#cb1044-13"></a><span class="st">    return out;</span></span>
<span id="cb1044-14"><a href="functions.html#cb1044-14"></a><span class="st">  }&quot;</span></span>
<span id="cb1044-15"><a href="functions.html#cb1044-15"></a>)</span>
<span id="cb1044-16"><a href="functions.html#cb1044-16"></a></span>
<span id="cb1044-17"><a href="functions.html#cb1044-17"></a>x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(<span class="dv">100</span>), <span class="dv">10</span>)</span>
<span id="cb1044-18"><a href="functions.html#cb1044-18"></a></span>
<span id="cb1044-19"><a href="functions.html#cb1044-19"></a><span class="kw">rowSums</span>(x)</span></code></pre></div>
<pre><code> [1] 385 520 311 484 419 648 513 743 600 427</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="functions.html#cb1046-1"></a><span class="kw">rowSumsC</span>(x)</span></code></pre></div>
<pre><code> [1] 385 520 311 484 419 648 513 743 600 427</code></pre>
<p>Let’s look at the main differences:</p>
<ul>
<li>In C++, you subset a matrix with <code>()</code>, not <code>[]</code>.</li>
<li>In C++, use <code>.nrow()</code> and <code>.ncol()</code> methods to get the dimensions of a matrix.</li>
</ul>
</div>
<div id="matrix-input-and-matrix-output" class="section level3" number="7.35.5">
<h3 number="7.35.5"><span class="header-section-number">7.35.5</span> Matrix input and matrix output</h3>
<p>See the Rcpp exercise.</p>
</div>
</div>
<div id="exercises-9" class="section level2" number="7.36">
<h2 number="7.36"><span class="header-section-number">7.36</span> Exercises</h2>
<p><strong>Exercise Rcpp</strong> Learning objectives: practice using <code>Rcpp</code> to run a C++ function through R; use <code>microbenchmark()</code> to compare function performance.</p>

<p>_# Databases and R</p>
<p>As we previously saw in Chapter <a href="data2.html#data2"><strong>??</strong></a>, <code>dplyr</code> is a fantastic tool for manipulating data inside the R environment. Up to this point, we have worked with data sets that easily fit within your computer’s memory. Is R capable of working with data sets that are too large to store on your computer? Fortunately R is more than capable of dealing with large data sets (or not so large data sets that are stored remotely in a database). Recently, developers at <code>RStudio</code> have been working on building tools for data scientists to use inside of R to work with databases. Currently there are numerous different ways to work with data from databases in R. In this chapter we will explore some of the many different packages used to query external databases from within R, and we will focus on using <code>dplyr</code> to perform our queries solely in R.</p>
</div>
<div id="sql-and-database-structure" class="section level2" number="7.37">
<h2 number="7.37"><span class="header-section-number">7.37</span> SQL and Database Structure</h2>
<p>In today’s world, there is an extremely large amount of electronic data. The actual amount of existing data is not quite known, as it is pretty much impossible to determine an exact amount. One estimate by IBM stated that 2.5 exabytes (2.5 billion gigabytes) of data were generated every day in 2012. Clearly, we need to have efficient ways to store such incredibly large amounts of data inside computers. In many cases, these data are stored in <em>relational databases</em>.</p>
<p>In simple terms, a database is a collection of similar files. In a relational database, there are numerous data-containing tables that are related to each other by some common field, known as a <em>key</em>. Each table consists of numerous rows and columns, very similar to the way a <code>tibble</code> or any other type of data frame is stored inside of R. One can imagine a database consisting of student records with two tables, one containing the address information of students (called <code>address</code>), and one containing email information of the students (called <code>email</code>). These two tables could perhaps be linked (or <em>joined</em>) together by a common field such as a student identification number. Thus one could join together the two tables to obtain email information and address information for any given student at the same time.</p>
<p>Data analysts and data scientists require a method to do tasks like that described above in databases. Fortunately, almost every relational database is manipulated and stored using <code>SQL</code>, which makes such queries possible.</p>
<div id="sql" class="section level3" number="7.37.1">
<h3 number="7.37.1"><span class="header-section-number">7.37.1</span> SQL</h3>
<p>SQL<a href="references.html#fn58" class="footnote-ref" id="fnref58"><sup>58</sup></a>, or Structured Query Language, is an incredibly useful tool for querying and managing relational databases. SQL is common to all major database management systems, such as Oracle, MariaDB, PostgreSQL, MySQL, SQLite, and SQL Server. Each system has slight differences in syntax for certain commands, but the overall basic structure is the same across all database management systems. In order to work with databases, at least a basic understanding of the SQL language is desirable. Here we will give a <em>brief</em> overview of the main structure of a SQL query. If you have minimal SQL background and desire to learn more about databases, we encourage you to use numerous free online resources to help gain experience in using SQL. Some of my favorites include tutorials from <a href="https://www.w3schools.com/sql/">W3Schools</a>, <a href="https://www.tutorialspoint.com/sql/index.htm">tutorialspoint</a>, and <a href="http://www.sqltutorial.org/">SQL Tutorial</a>. There are also numerous free online courses available (i.e. this <a href="https://lagunita.stanford.edu/courses/Engineering/db/2014_1/about">Stanford</a> course) that you can enroll in and gain experience in querying on sample databases.</p>
<div id="a-basic-query" class="section level4" number="7.37.1.1">
<h4 number="7.37.1.1"><span class="header-section-number">7.37.1.1</span> A Basic Query</h4>
<p>Let’s first explore a little bit of SQL syntax. A basic SQL query consists of three different parts:</p>
<ol style="list-style-type: decimal">
<li><code>SELECT</code>: used to select data from a database</li>
<li><code>FROM</code>: tells SQL what table to look at to get the data</li>
<li><code>WHERE</code>: used to filter out different records</li>
</ol>
<p>Using these three statements you are able to perform queries on the database to extract data from different tables. For example, consider the database mentioned previously consisting of student records. To obtain all the email addresses from the <code>email</code> table, our query would look like this</p>
<pre><code>SELECT email_address
FROM email</code></pre>
<p>If we only desired the email addresses of the student with <code>id = 001</code>, then we would add a condition using the <code>WHERE</code> clause:</p>
<pre><code>SELECT email_address
FROM email
WHERE student_id = &#39;001&#39;</code></pre>
<p>Queries of this basic form are used by database programmers numerous times a day in order to obtain needed information from large databases. There are <em>many</em> more features that can be added to this basic query form, including:</p>
<ol style="list-style-type: decimal">
<li><code>AND</code>: added to the <code>WHERE</code> clause, allows for multiple conditions at once</li>
<li><code>JOIN</code>: connect two tables based on a common feature</li>
<li><code>GROUP BY</code>: group data together according to a certain field to obtain statistics, counts, etc.</li>
</ol>
<p>Does this remind you of anything we previously studied? Maybe something in Chapter <a href="data2.html#data2"><strong>??</strong></a>? If so, you are correct! The manipulation of data sets in R using <code>dplyr</code> provides many of the same sort of manipulation tools used by SQL, and we will soon see how we can use <code>dplyr</code> directly to query external databases.</p>
<p><code>SQL</code> also has the ability to update the database, insert new records, and delete records from the database. This is done using the <code>UPDATE</code>, <code>INSERT</code>, and <code>DELETE</code> statements. Here are some simple examples for each of these statements:</p>
<pre><code>UPDATE email
SET email_address = &#39;doserjef@msu.edu&#39;
WHERE student_id = &#39;001&#39;

DELETE FROM email
WHERE email_address = &#39;doserjef@msu.edu&#39;

INSERT INTO email
VALUES (&#39;001&#39;, &#39;doserjef@msu.edu&#39;)</code></pre>
<p>Again, this is nowhere near a full introduction to the SQL language, but it will provide you with enough understanding to work with databases within the R framework. If you are interested in databases, we encourage you to seek out some of the additional resources mentioned at the beginning of this section.</p>
</div>
</div>
</div>
<div id="difficulties-of-working-with-large-datasets" class="section level2" number="7.38">
<h2 number="7.38"><span class="header-section-number">7.38</span> Difficulties of Working with Large Datasets</h2>
<p>The first step in using R with databases is to connect R to the database. This leads to many difficulties. As described by Edgar Ruiz, a solutions engineer at RStudio, when connecting to a database in R there is only a “small conduit” between R and the database that often prevents us from being able to work with the data as fast as we can work with local data frames. In order to work around this there have historically been two different options. The first option is to take data from the database in small chunks, save it in R memory, and then analyze it later. This is not desirable because you aren’t dealing with the data directly, so if the data in the database changes this will not be reflected in the data previously loaded into your R memory. A different option is to load <em>all</em> of the data into R. This allows you to see all of the data, but it takes forever to download and it essentially takes over the R session (and it has the same problems as option one regarding changes in the database).</p>
<p>The main problem with these methods is that they are trying to perform the computations locally in R as opposed to performing computations directly on the data in the database using the SQL Engine. Ideally, we want to be able to analyze the data in place. In other words, we want R to somehow send a SQL query over to the database, perform the query using the powerful SQL engine, and then have the database send back an R data frame that we can manipulate in R. This would allow us to avoid performing computations directly in R, which would improve program speed and reduce the amount of storage needed. In addition, we do not want to go back and forth between using R and SQL, as this can cause a lot of unnecessary confusion. As R programmers, we of course want to write solely R code. Fortunately, researchers at RStudio have increased the capabilities of the <code>dplyr</code> package to allow just that.</p>
</div>
<div id="using-dplyr-to-query-the-database" class="section level2" number="7.39">
<h2 number="7.39"><span class="header-section-number">7.39</span> Using <code>dplyr</code> to Query the Database</h2>
<p>The <code>dplyr</code> package has recently been updated to allow for better communications with external databases. Specifically, you, as the R programmer, can write code in <code>dplyr</code> acting on a database in the same manner in which you use <code>dplyr</code> to work with a data frame in the R environment. <code>dplyr</code> will then behind the scenes convert this R code into a SQL query, will send this query to the database, use the SQL engine to run the query on the data, and will return these data as a data frame in R.</p>
<p>This is the most efficient method for querying databases in R for three reasons:</p>
<ol style="list-style-type: decimal">
<li>We are pushing the computation to the database, allowing us to avoid bringing large amounts of data in the database into the R environment unless we specifically ask R to do it.</li>
<li>We can use piped code, which greatly enhances the readability of the code.</li>
<li>All the code is in R. This reduces the cognitive costs that are often associated when using two or more programming languages at the same time.</li>
</ol>
<p>Next we will go through an example using <code>SQLite</code> to detail exactly how queries on a sample database are performed.</p>
<div id="example-with-rsqlite" class="section level3" number="7.39.1">
<h3 number="7.39.1"><span class="header-section-number">7.39.1</span> Example with RSQLite</h3>
<p>SQLite is arguably the most widely used relational database management system throughout the world. We will first provide a demonstration using a SQLite database as it is relatively easy to install on your system compared to other database management systems. SQLite is different from most database management systems because you don’t have to set up a separate database server. This makes SQLite great for a demo, and surprisingly it can also be very powerful when working with many gigabytes of data. We will use a sample database provided by SQLite called <code>chinook</code> that contains data on store employees, customers, and the music they purchased.</p>
<p>First, go to <a href="http://www.sqlitetutorial.net/sqlite-sample-database/" class="uri">http://www.sqlitetutorial.net/sqlite-sample-database/</a> and download the <code>chinook</code> database into your R working directory so you can follow along with this example yourself.</p>
<p>Upon successful download, the first step we need to do is install/load the necessary packages for connecting to the external database. To help <code>dplyr</code> communicate with the SQL engine, install the <code>dbplyr</code> package using <code>install.packages("dbplyr")</code>. Next we need the <code>RSQLite</code> package for interfacing with the SQLite database. Install this by running <code>install.packages("RSQLite")</code> in the R console. Then load the packages, along with <code>dplyr</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="functions.html#cb1051-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb1051-2"><a href="functions.html#cb1051-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dbplyr)</span>
<span id="cb1051-3"><a href="functions.html#cb1051-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(RSQLite)</span></code></pre></div>
<p>We next use the <code>DBI</code> package to connect directly to the database. <code>DBI</code> is a backend package that provides a common interface for R to work with many different database management systems using the same code. This package does much of the communication from R to the database that occurs behind the scenes, and is an essential part of using <code>dplyr</code> to work with databases.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="functions.html#cb1052-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(DBI)</span>
<span id="cb1052-2"><a href="functions.html#cb1052-2"></a><span class="op">&gt;</span><span class="st"> </span>chinook &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="kw">SQLite</span>(), <span class="st">&quot;chinook.db&quot;</span>)</span></code></pre></div>
<p>This command creates a reference to the database, and tells R to connect to this database in a specific location (your location could change depending on where you save the <code>chinook.db</code> file). A similar approach could be used to connect to databases of other database management systems like Oracle, MySQL, PostgreSQL, and others. Most databases do not live in a file, but instead live on another server. This causes the above connection to be much more complex, but for now we will focus on this simple case.</p>
<p>Now lets look closer at the chinook database.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="functions.html#cb1053-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">src_dbi</span>(chinook)</span></code></pre></div>
<pre><code>src:  sqlite 3.22.0 [/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/chinook.db]
tbls: albums, artists, customers, employees, genres,
  invoice_items, invoices, media_types,
  playlist_track, playlists, sqlite_sequence,
  sqlite_stat1, tracks</code></pre>
<p>The above function displays the location of the database, as well as the tables contained in the database. You can see in the <code>chinook</code> database there are numerous tables regarding customers, employees, and the music that customers purchased. In total, there are 13 tables contained in this database.</p>
<p>Now that we know the structure of the database, we can perform some simple queries on the data using <code>dplyr</code> syntax. For now, let’s focus on the <code>employees</code> table.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="functions.html#cb1055-1"></a><span class="op">&gt;</span><span class="st"> </span>employees &lt;-<span class="st"> </span><span class="kw">tbl</span>(chinook, <span class="st">&quot;employees&quot;</span>)</span>
<span id="cb1055-2"><a href="functions.html#cb1055-2"></a><span class="op">&gt;</span><span class="st"> </span>employees</span></code></pre></div>
<pre><code># Source:   table&lt;employees&gt; [?? x 15]
# Database: sqlite 3.22.0
#   [/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/chinook.db]
  EmployeeId LastName FirstName Title ReportsTo
       &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt;
1          1 Adams    Andrew    Gene…        NA
2          2 Edwards  Nancy     Sale…         1
3          3 Peacock  Jane      Sale…         2
4          4 Park     Margaret  Sale…         2
5          5 Johnson  Steve     Sale…         2
6          6 Mitchell Michael   IT M…         1
7          7 King     Robert    IT S…         6
8          8 Callahan Laura     IT S…         6
# … with 10 more variables: BirthDate &lt;chr&gt;,
#   HireDate &lt;chr&gt;, Address &lt;chr&gt;, City &lt;chr&gt;,
#   State &lt;chr&gt;, Country &lt;chr&gt;, PostalCode &lt;chr&gt;,
#   Phone &lt;chr&gt;, Fax &lt;chr&gt;, Email &lt;chr&gt;</code></pre>
<p>Notice how the <code>employees</code> table looks mostly like a regular tibble, but has a couple added lines detailing its location as a remote table in a SQLite database.</p>
<p>Now lets use familiar <code>dplyr</code> commands to perform queries on the database</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="functions.html#cb1057-1"></a><span class="op">&gt;</span><span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1057-2"><a href="functions.html#cb1057-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(LastName, FirstName, Phone, Email) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1057-3"><a href="functions.html#cb1057-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(LastName)</span></code></pre></div>
<pre><code>Warning: `overscope_eval_next()` is deprecated as of rlang 0.2.0.
Please use `eval_tidy()` with a data mask instead.
This warning is displayed once per session.</code></pre>
<pre><code>Warning: `overscope_clean()` is deprecated as of rlang 0.2.0.
This warning is displayed once per session.</code></pre>
<pre><code># Source:     lazy query [?? x 4]
# Database:   sqlite 3.22.0
#   [/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/chinook.db]
# Ordered by: LastName
  LastName FirstName Phone          Email              
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;              
1 Adams    Andrew    +1 (780) 428-… andrew@chinookcorp…
2 Callahan Laura     +1 (403) 467-… laura@chinookcorp.…
3 Edwards  Nancy     +1 (403) 262-… nancy@chinookcorp.…
4 Johnson  Steve     1 (780) 836-9… steve@chinookcorp.…
5 King     Robert    +1 (403) 456-… robert@chinookcorp…
6 Mitchell Michael   +1 (403) 246-… michael@chinookcor…
7 Park     Margaret  +1 (403) 263-… margaret@chinookco…
8 Peacock  Jane      +1 (403) 262-… jane@chinookcorp.c…</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="functions.html#cb1061-1"></a><span class="op">&gt;</span><span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1061-2"><a href="functions.html#cb1061-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(Title <span class="op">==</span><span class="st"> &quot;Sales Support Agent&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1061-3"><a href="functions.html#cb1061-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(LastName, FirstName, Address) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1061-4"><a href="functions.html#cb1061-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(LastName)</span></code></pre></div>
<pre><code># Source:     lazy query [?? x 3]
# Database:   sqlite 3.22.0
#   [/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/chinook.db]
# Ordered by: LastName
  LastName FirstName Address         
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;           
1 Johnson  Steve     7727B 41 Ave    
2 Park     Margaret  683 10 Street SW
3 Peacock  Jane      1111 6 Ave SW   </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="functions.html#cb1063-1"></a><span class="op">&gt;</span><span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1063-2"><a href="functions.html#cb1063-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(ReportsTo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1063-3"><a href="functions.html#cb1063-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">numberAtLocation =</span> <span class="kw">n</span>())</span></code></pre></div>
<pre><code># Source:   lazy query [?? x 2]
# Database: sqlite 3.22.0
#   [/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/chinook.db]
  ReportsTo numberAtLocation
      &lt;int&gt;            &lt;int&gt;
1        NA                1
2         1                2
3         2                3
4         6                2</code></pre>
<p>You can see by using <code>dplyr</code> you are able to use the same syntax to query the database as you used to analyze data frames in Chapter <a href="data2.html#data2"><strong>??</strong></a>. The most important difference to again note is that when working with remote databases the R code is translated into SQL and executed in the database using the SQL engine, not in R. When doing this, <code>dplyr</code> is as “lazy” as possible as it never pulls data in R unless explicity asked. It collects everything you ask it to do and then sends it to the database all in one step. This is often a very useful feature when desiring to look at a certain group of records in a database. To understand this further, take a look at the following code, which at first you might think will output a <code>tibble</code> or <code>data frame</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="functions.html#cb1065-1"></a><span class="op">&gt;</span><span class="st"> </span>salesSupportAgents &lt;-<span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1065-2"><a href="functions.html#cb1065-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(Title <span class="op">==</span><span class="st"> &quot;Sales Support Agent&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1065-3"><a href="functions.html#cb1065-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(LastName, FirstName, Address) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1065-4"><a href="functions.html#cb1065-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(LastName) </span>
<span id="cb1065-5"><a href="functions.html#cb1065-5"></a><span class="op">&gt;</span><span class="st"> </span>salesSupportAgents</span></code></pre></div>
<pre><code># Source:     lazy query [?? x 3]
# Database:   sqlite 3.22.0
#   [/home/jeffdoser/Dropbox/teaching/for875/for875-20/textbook/chinook.db]
# Ordered by: LastName
  LastName FirstName Address         
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;           
1 Johnson  Steve     7727B 41 Ave    
2 Park     Margaret  683 10 Street SW
3 Peacock  Jane      1111 6 Ave SW   </code></pre>
<p>Notice the first two lines in the output. The source is described as a <code>lazy query</code> and the <code>salesSupportAgents</code> is still a database connection and not a local data frame. Because you did not specifically tell R that you wanted to bring the data directly into R, it did not do so. In order to bring the data directly into R in a local tibble you need to use the <code>collect()</code> function. Note that if you are asking the database to send back a lot of data, this could take a while.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="functions.html#cb1067-1"></a><span class="op">&gt;</span><span class="st"> </span>salesSupportAgents &lt;-<span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1067-2"><a href="functions.html#cb1067-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(Title <span class="op">==</span><span class="st"> &quot;Sales Support Agent&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1067-3"><a href="functions.html#cb1067-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(LastName, FirstName, Address) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1067-4"><a href="functions.html#cb1067-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(LastName) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1067-5"><a href="functions.html#cb1067-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">collect</span>()</span>
<span id="cb1067-6"><a href="functions.html#cb1067-6"></a><span class="op">&gt;</span><span class="st"> </span>salesSupportAgents</span></code></pre></div>
<pre><code># A tibble: 3 x 3
  LastName FirstName Address         
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;           
1 Johnson  Steve     7727B 41 Ave    
2 Park     Margaret  683 10 Street SW
3 Peacock  Jane      1111 6 Ave SW   </code></pre>
<p>As we’ve seen, for simple tasks, and even many complex tasks, <code>dplyr</code> syntax can be used to query external databases.</p>
</div>
<div id="dbplot" class="section level3" number="7.39.2">
<h3 number="7.39.2"><span class="header-section-number">7.39.2</span> <code>dbplot</code></h3>
<p>If we can use <code>dplyr</code> to analyze the data in a database, you may be wondering whether or not we can use <code>ggplot2</code> to graph the data in the database. Of course we can! In fact, the package <code>dbplot</code> is designed to process the calculations of a plot inside a database and output a <code>ggplot2</code> object. If not already installed on your system, make sure to install the <code>dbplot</code> package before continuing.</p>
<p>We can use the same <code>chinook</code> database from SQLite we were using above. Suppose we desire to see how many types of each employee there are in the database. We can produce a barplot to show this.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="functions.html#cb1069-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dbplot)</span>
<span id="cb1069-2"><a href="functions.html#cb1069-2"></a><span class="op">&gt;</span><span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1069-3"><a href="functions.html#cb1069-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">dbplot_bar</span>(Title)</span></code></pre></div>
<pre><code>Warning: Unquoting language objects with `!!!` is deprecated as of rlang 0.4.0.
Please use `!!` instead.

  # Bad:
  dplyr::select(data, !!!enquo(x))

  # Good:
  dplyr::select(data, !!enquo(x))    # Unquote single quosure
  dplyr::select(data, !!!enquos(x))  # Splice list of quosures

This warning is displayed once per session.</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-316-1.png" width="672" /></p>
<p>We first load the <code>dbplot</code> package. Next we produce the bar plot. Notice that we can continue to use the convenient <code>%&gt;%</code> character while producing graphs using <code>dbplot</code>, making the code easy to read. Since <code>dbplot</code> outputs a <code>ggplot2</code> object, we can further customize the graph using familiar functions from <code>ggplot2</code> (so long as the package is loaded).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="functions.html#cb1071-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</span>
<span id="cb1071-2"><a href="functions.html#cb1071-2"></a><span class="op">&gt;</span><span class="st"> </span>employees <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1071-3"><a href="functions.html#cb1071-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">dbplot_bar</span>(Title) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1071-4"><a href="functions.html#cb1071-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Employee Types&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1071-5"><a href="functions.html#cb1071-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">ylab</span>(<span class="st">&quot;Count&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1071-6"><a href="functions.html#cb1071-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-317-1.png" width="672" /></p>
</div>
<div id="using-google-bigquery" class="section level3" number="7.39.3">
<h3 number="7.39.3"><span class="header-section-number">7.39.3</span> Using Google BigQuery</h3>
<p>For a second example, we will utilize a database from Google BigQuery, Google’s fully managed low cost analytics data warehouse. The package <code>bigrquery</code> provides an R interface to Google BigQuery. If not already installed, install the package with our usual method.</p>
<p>We will use data from a great set of sample tables that BigQuery provides to its users. First we will look at the <code>shakespeare</code> table that contains a word index of the different works of Shakespeare. Thus, given the data in the table, let’s use <code>bigrquery</code>, <code>DBI</code>, and <code>dplyr</code> to determine the ten words that appear most often in Shakespeare’s works.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1072-1"><a href="functions.html#cb1072-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(bigrquery)</span>
<span id="cb1072-2"><a href="functions.html#cb1072-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(DBI)</span>
<span id="cb1072-3"><a href="functions.html#cb1072-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb1072-4"><a href="functions.html#cb1072-4"></a><span class="op">&gt;</span><span class="st"> </span>billing &lt;-<span class="st"> &quot;for875-databases&quot;</span></span>
<span id="cb1072-5"><a href="functions.html#cb1072-5"></a><span class="op">&gt;</span><span class="st"> </span>con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(</span>
<span id="cb1072-6"><a href="functions.html#cb1072-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">bigquery</span>(),</span>
<span id="cb1072-7"><a href="functions.html#cb1072-7"></a><span class="op">+</span><span class="st">   </span><span class="dt">project =</span> <span class="st">&quot;publicdata&quot;</span>,</span>
<span id="cb1072-8"><a href="functions.html#cb1072-8"></a><span class="op">+</span><span class="st">   </span><span class="dt">dataset =</span> <span class="st">&quot;samples&quot;</span>,</span>
<span id="cb1072-9"><a href="functions.html#cb1072-9"></a><span class="op">+</span><span class="st">   </span><span class="dt">billing =</span> billing</span>
<span id="cb1072-10"><a href="functions.html#cb1072-10"></a><span class="op">+</span><span class="st"> </span>)</span>
<span id="cb1072-11"><a href="functions.html#cb1072-11"></a><span class="op">&gt;</span><span class="st"> </span>shakespeare &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span></span>
<span id="cb1072-12"><a href="functions.html#cb1072-12"></a><span class="op">+</span><span class="st">   </span><span class="kw">tbl</span>(<span class="st">&quot;shakespeare&quot;</span>)</span></code></pre></div>
<pre><code>Auto-refreshing stale OAuth token.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="functions.html#cb1074-1"></a><span class="op">&gt;</span><span class="st"> </span>shakespeare <span class="op">%&gt;%</span></span>
<span id="cb1074-2"><a href="functions.html#cb1074-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(word) <span class="op">%&gt;%</span></span>
<span id="cb1074-3"><a href="functions.html#cb1074-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">sum</span>(word_count, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1074-4"><a href="functions.html#cb1074-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span></span>
<span id="cb1074-5"><a href="functions.html#cb1074-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code># Source:     lazy query [?? x 2]
# Database:   BigQueryConnection
# Ordered by: desc(n)
   word      n
   &lt;chr&gt; &lt;int&gt;
 1 the   25568
 2 I     21028
 3 and   19649
 4 to    17361
 5 of    16438
 6 a     13409
 7 you   12527
 8 my    11291
 9 in    10589
10 is     8735</code></pre>
<p>First we load the neceessary packages. We then provide the name of our project to the <code>billing</code> variable. In this case, I created a project called <code>for875-databases</code> for this course. The <code>con</code> variable establishes the connection to the database and the data that we want to look at. Notice the difference in connecting to the Google BigQuery database, which is stored remotely on Google’s servers, as compared to the previous example when connecting to a SQLite database stored on your computer’s hard drive. This example is much more realistic of the connections you would make when accessing external databases. The <code>bigquery()</code> statement tells DBI we will be working with a database from Google BigQuery. The project and dataset options tell DBI what database to look for inside of the Google BigQuery framework. We then supply the name of our project to the <code>billing</code> option to tell BigQuery what account to “bill” (this only costs money if you surpass the monthly limit given by Google).</p>
<p>If you run this code by yourself, you’ll notice that R will ask you to sign in to a google account (your MSU account), and then after you allow the <code>bigrquery</code> package to connect to your account, you will be able to run all the code without a problem.</p>
<p>From here we can establish a connection to a specific table by using the <code>tbl()</code> function as shown above. We can then use <code>dplyr</code> like we did previously to group the data by words, determine the count of each word, and then order it in decreasing order to obtain the top ten words in Shakespeare’s works. Notice that when you run this code you may obtain a message in red describing the total amount of bytes billed. This is how Google manages how much its users are querying and using its data. We’re just tinkering around here, so we won’t surpass the monthly limit on free queries.</p>
<p>This code again displays the benefits of the “lazy evaluation” that R employs. The <code>con</code> variable and <code>shakespeare</code> variable do not store the database or the specific table in R itself, instead they serve as references to the database where the specific data they are referencing is contained. Only when the <code>dplyr</code> query is written and called using the <code>collect()</code> function is any data from the database actually brought into R. R waits till the last possible second (i.e. is lazy) to perform any computations.</p>
<p>A second table in the <code>publicdata</code> project on Google BigQuery contains weather data from NOAA ranging from the years 1929 to 2010. Let’s first make a connection to this table and explore its structure.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="functions.html#cb1076-1"></a><span class="op">&gt;</span><span class="st"> </span>weather &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span></span>
<span id="cb1076-2"><a href="functions.html#cb1076-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">tbl</span>(<span class="st">&quot;gsod&quot;</span>)</span>
<span id="cb1076-3"><a href="functions.html#cb1076-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">dbListFields</span>(con, <span class="st">&quot;gsod&quot;</span>)</span></code></pre></div>
<pre><code> [1] &quot;station_number&quot;                    
 [2] &quot;wban_number&quot;                       
 [3] &quot;year&quot;                              
 [4] &quot;month&quot;                             
 [5] &quot;day&quot;                               
 [6] &quot;mean_temp&quot;                         
 [7] &quot;num_mean_temp_samples&quot;             
 [8] &quot;mean_dew_point&quot;                    
 [9] &quot;num_mean_dew_point_samples&quot;        
[10] &quot;mean_sealevel_pressure&quot;            
[11] &quot;num_mean_sealevel_pressure_samples&quot;
[12] &quot;mean_station_pressure&quot;             
[13] &quot;num_mean_station_pressure_samples&quot; 
[14] &quot;mean_visibility&quot;                   
[15] &quot;num_mean_visibility_samples&quot;       
[16] &quot;mean_wind_speed&quot;                   
[17] &quot;num_mean_wind_speed_samples&quot;       
[18] &quot;max_sustained_wind_speed&quot;          
[19] &quot;max_gust_wind_speed&quot;               
[20] &quot;max_temperature&quot;                   
[21] &quot;max_temperature_explicit&quot;          
[22] &quot;min_temperature&quot;                   
[23] &quot;min_temperature_explicit&quot;          
[24] &quot;total_precipitation&quot;               
[25] &quot;snow_depth&quot;                        
[26] &quot;fog&quot;                               
[27] &quot;rain&quot;                              
[28] &quot;snow&quot;                              
[29] &quot;hail&quot;                              
[30] &quot;thunder&quot;                           
[31] &quot;tornado&quot;                           </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="functions.html#cb1078-1"></a><span class="op">&gt;</span><span class="st"> </span>weather <span class="op">%&gt;%</span></span>
<span id="cb1078-2"><a href="functions.html#cb1078-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">select</span>(thunder, mean_wind_speed) <span class="op">%&gt;%</span></span>
<span id="cb1078-3"><a href="functions.html#cb1078-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code># Source:   lazy query [?? x 2]
# Database: BigQueryConnection
   thunder mean_wind_speed
   &lt;lgl&gt;             &lt;dbl&gt;
 1 FALSE              7   
 2 FALSE             14.5 
 3 FALSE             28.7 
 4 FALSE             15.5 
 5 FALSE              0   
 6 FALSE             15   
 7 FALSE             15   
 8 FALSE             21   
 9 FALSE              8.90
10 TRUE              13   </code></pre>
<p>First we establish a connection to the weather table. We then use the <code>dbListFields()</code> function from the <code>DBI</code> package to display the fields in the table. We then view the first 10 records in the table. We see that there are 31 different variables on information for the weather on a given day from 1929 to 2010. Let’s say we are interested in determining the total number of days where the <code>mean_temp &gt; 60</code> and <code>mean_wind_speed &gt; 10</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="functions.html#cb1080-1"></a><span class="op">&gt;</span><span class="st"> </span>weather <span class="op">%&gt;%</span></span>
<span id="cb1080-2"><a href="functions.html#cb1080-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(mean_temp <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span> <span class="op">&amp;</span><span class="st"> </span>mean_wind_speed <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb1080-3"><a href="functions.html#cb1080-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())</span></code></pre></div>
<pre><code># Source:   lazy query [?? x 1]
# Database: BigQueryConnection
    count
    &lt;int&gt;
1 6581146</code></pre>
<p>Further, suppose we are interested in determining how the average wind speed has changed from 1929 to 2010. We can use <code>dbplot</code> to plot the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="functions.html#cb1082-1"></a><span class="op">&gt;</span><span class="st"> </span>weather <span class="op">%&gt;%</span></span>
<span id="cb1082-2"><a href="functions.html#cb1082-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">dbplot_line</span>(year, <span class="dt">average_wind_speed =</span> <span class="kw">mean</span>(mean_wind_speed, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-322-1.png" width="672" /></p>
<p>Upon first glance at this plot, a naive student might think ``Wow! Wind speeds have decreased dramatically since the 1930s’’, and just accept this as true since that is what the graph shows. But since we are all data analysts at heart (otherwise you wouldn’t be taking this course!), we want to explore this further. We might ask why the wind was so high in the late 1920s and early 1930s? An average wind speed of above 12 miles per hour seems pretty high. Let’s explore the entries for all years in the 1930s and 1920s by looking at how many records there are with a mean wind speed for each year before 1940.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="functions.html#cb1083-1"></a><span class="op">&gt;</span><span class="st"> </span>weather <span class="op">%&gt;%</span></span>
<span id="cb1083-2"><a href="functions.html#cb1083-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(year <span class="op">&lt;</span><span class="st"> </span><span class="dv">1940</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(mean_wind_speed)) <span class="op">%&gt;%</span></span>
<span id="cb1083-3"><a href="functions.html#cb1083-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb1083-4"><a href="functions.html#cb1083-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">count =</span> <span class="kw">n</span>())</span></code></pre></div>
<pre><code># Source:   lazy query [?? x 2]
# Database: BigQueryConnection
    year count
   &lt;int&gt; &lt;int&gt;
 1  1929  2037
 2  1930  7101
 3  1933 17708
 4  1938 51770
 5  1931  9726
 6  1934 20334
 7  1935 26829
 8  1939 65623
 9  1936 50514
10  1937 83310
# … with more rows</code></pre>
<p>Interesting! We see that there are only 2037 records from 1929, while there are 65623 records from 1939. This suggests we could be experiencing a phenomenon known as <em>sampling bias</em> in which the 2037 records from 1929 are not a valid random representation of all the wind speeds occurring in 1929. Or potentially the wind was just much higher during that time due to other factors we aren’t exploring here. Determining the true cause of this pattern requires further investigation, which we leave to you if you so desire.</p>
</div>
</div>
<div id="changing-records-in-the-database" class="section level2" number="7.40">
<h2 number="7.40"><span class="header-section-number">7.40</span> Changing Records in the Database</h2>
<p><code>dplyr</code> is fantastic for retrieving data from databases and analyzing it using familiar functions. As detailed in this <a href="https://www.rstudio.com/resources/videos/best-practices-for-working-with-databases-webinar/">video</a>, using <code>dplyr</code> is considered a “best practice” when using databases in R because you only have to use one language, you don’t need to know any SQL, and you can use the lazy evaluation of R, among many other reasons. As a data analyst, a majority of work can be accomplished by using <code>dplyr</code> and other forms of queries against a database. But what if you need to do more than query the data in the database and you have to change some of the records? <code>dplyr</code> is not capable of inserting or deleting records in a database, and although updating recordings is possible with <code>dplyr</code>, Hadley Wickham strongly recommends against it, as <code>dplyr</code> is designed specifically for retrieving data. Thus, we need to use other options for updating/inserting/deleting records in a database. Unlike using <code>dplyr</code> this requires a more in depth knowledge of SQL. We will not discuss updating/inserting/deleting records in a database here, but you will briefly learn about methods to do this in this chapter’s exercise.</p>
</div>
<div id="r-studio-connections-pane" class="section level2" number="7.41">
<h2 number="7.41"><span class="header-section-number">7.41</span> R Studio Connections Pane</h2>
<p>If by this point in the book you haven’t already been convinced that RStudio is a fantastic IDE for running R then perhaps this will convince you. R Studio has a Connections Pane by default in the top right corner of your screen that makes it easy to connect to a variety of data sources, and better yet, explore the objects and data inside the connection. You can use it with a variety of different packages for working with databases in R, and it will also work with a variety of databases and other datasources (i.e. Spark). This Connections Pane is a great way of exploring the data in a data source once you are connected. If interested, the page <a href="https://db.rstudio.com/rstudio/connections/">here</a> which provides an overview of the connections pane and some other useful links of potential interest.</p>
</div>
<div id="further-resources" class="section level2" number="7.42">
<h2 number="7.42"><span class="header-section-number">7.42</span> Further Resources</h2>
<p>There are numerous other methods besides <code>dplyr</code> to work with databases in R that involve using more standard SQL queries. If you come from a SQL background and want to use these other methods, then explore the <a href="http://db.rstudio.com/">RStudio Databases using R page</a>. This website will be an essential resource for you if you get more involved with using databases within the R environment.</p>
</div>
<div id="exercises-10" class="section level2" number="7.43">
<h2 number="7.43"><span class="header-section-number">7.43</span> Exercises</h2>
<p><strong>Exercise Databases</strong> Learning objectives: connect to an external database; perform simple queries using <code>dplyr</code>; use data from a database in a Shiny app; learn how to perform changes (update/delete/insert) on a database</p>

<p>_# Digital Signal Processing</p>
<!-- Note to install warbleR on ubuntu, need to first install the following packages: sudo apt-get install fftw3 fftw3-dev pkg-config -->
<p>Signals are everywhere. And no, that is not an exaggeration. In today’s technology age, signals really are pervasive throughout most of the world. Humans and animals use audio signals to convey important information to conspecifics. Airplanes use signals in the air to obtain important information to ensure your safety on a flight. Cell phones are pretty much just one small digital signal processing device. They process our speech when we talk into the phone by removing background noise and echos that would distort the clearness of our sound. They obtain wifi signals to allow for us to search the web. They send text messages using signals. They use digital image processing to take really good pictures. They take a video of your dog when he’s doing something completely hilarious that you want to show your friend. The applications of digital signal processing (DSP) span numerous different fields, such as ecology, physics, communication, medicine, computer science, mathematics, and electrical engineering. Thus, having a basic understanding of DSP and it’s concepts can be very helpful, regardless of the field you decide to pursue.</p>
<p>In this chapter we will give a brief introduction to some central concepts in DSP and how we can explore these concepts using R. We will look at applications of DSP using some R packages designed for bioacoustic analysis. When doing digital signal processing, R is not typically the first computer language that comes to mind. <code>Matlab</code>, <code>Octave</code>, and <code>C/C++</code> are often considered to be some of the best languages for DSP. But R provides numerous different packages (especially for working with audio data) that make it competitive with these languages for digital signal processing. We will use the <code>signal</code> package to do some simple digital signal processing, and then will use the <code>tuneR</code>, <code>warbleR</code>, and <code>seewave</code> packages to work with audio data to show you more specific examples of how R can be used in different fields of digital signal processing.</p>
</div>
<div id="introduction-to-digital-signal-processing" class="section level2" number="7.44">
<h2 number="7.44"><span class="header-section-number">7.44</span> Introduction to Digital Signal Processing</h2>
<p>First let’s go over some basics of DSP before we delve into working with signals in R. <em>Digital Signal Processing</em> is the use of digital tools to perform different signal processing operations, such as the analysis, synthesis, and modification of signals. But what exactly constitutes a signal? A <em>signal</em> is anything that carries information. In other words, it is a quantity that varies with time, temperature, pressure, or any other independent variable. As described above, signals pervade our everyday life, and thus the study of their behavior, how they work, how we can manipulate them, and how we can extract information from them is extremely important.</p>
<p>There are two main types of signals: continuous time signals and discrete time signals. <em>Continuous Time Signals</em>, as you might suspect, are continuous. They are defined at all instances of time over a given period. These types of signals are commonly referred to as <em>analog</em> signals. An example of an analog signal would be a simple sine curve plotted in <a href="functions.html#fig:analogsignal">16</a>. Notice that the sine curve is defined for every value on the interval from 0 to 2<span class="math inline">\(\pi\)</span>. This is an analog signal.</p>
<div class="figure"><span id="fig:analogsignal"></span>
<img src="bookdown_files/figure-html/analogsignal-1.png" alt="Example of an analog signal: a simple sine curve" width="384" />
<p class="caption">
FIGURE 16: Example of an analog signal: a simple sine curve
</p>
</div>
<p><em>Discrete Time Signals</em> are not continuous. They are defined only at discrete times, and thus they are represented as a sequence of numbers (so by your experiences in R working with sequences of numbers you should already have an idea of how discrete signals are stored, how they can be manipulated, etc…). Figure @ref(fig:digital} is an example of the exact same sine curve as in Figure @ref{fig:analogsignal}, but in a discrete form. Notice how there are only values at specific points, and anywhere besides those points the signal is not defined. In a real-world application, these points would correspond to measurements of the signal.</p>
<div class="figure"><span id="fig:digital"></span>
<img src="bookdown_files/figure-html/digital-1.png" alt="Example of a discrete signal: a sine curve with some missing values" width="384" />
<p class="caption">
FIGURE 17: Example of a discrete signal: a sine curve with some missing values
</p>
</div>
<p>Notice the differences between the two graphs. The second graph is not defined at every point and is only defined at the points where a data point exists. This type of sampling will become important later in the chapter and in the exercise when we begin to work with sound data (which by the way takes the form of these simple sine curves we are working with here). There are many other shapes and forms of signals, but since we will later be focusing on audio data, and the sine curve is fundamental to any sort of sound, we for now will focus on working with a sine curve.</p>
<p>Signals have a wide variety of properties and characteristics that give each signal distinct behavior. The sine curve has two important characteristics. First, a sine curve is said to be <code>odd</code> since it satisfies the condition sin<span class="math inline">\((-t)\)</span> = -sin<span class="math inline">\((t)\)</span>. This is easy to recognize by looking at the graph of a sine curve as you see that it is symmetrical over the diagonal at the origin. In addition, a sine curve is a <em>periodic</em> signal. A periodic signal is a signal that repeats itself after a certain interval of time (called the Period). This is true of all real sine curves. Understanding the simple properties of signals like we have done with the sine curve is a useful tool in digital signal processing as it allows you to recognize simple patterns that may occur with the signal in which you are interested.</p>
<p>Now that we have a general understanding of what a signal is and how we can use it’s properties to learn about it’s behavior, let’s now focus on some of the most important concepts in digital signal processing, and how we can implement them in R. Here are three of the most central topics to DSP:</p>
<ol style="list-style-type: decimal">
<li><strong>Fourier Transforms</strong>: signal processing involves looking at the frequency representation of signals for both insight and computations.</li>
<li><strong>Noise</strong>: defined as any signal that is not desired. A huge part of signal processing is understanding how noise is affecting your data and how you can efficiently remove or manage it.</li>
<li><strong>Filters</strong>: allow you to remove out specific portions of a signal at once, or allow you to remove noise from certain signals.</li>
</ol>
<p>We will first briefly discuss working with noise and filters in R, and then we will work with Fourier Transforms in the context of audio data.</p>
<div id="sinusoidal-signals" class="section level3" number="7.44.1">
<h3 number="7.44.1"><span class="header-section-number">7.44.1</span> Sinusoidal Signals</h3>
<p>As mentioned previously, sinusoidal signals are extremely important for signal processing. We saw an example of a continuous sinusoid and a discrete sinusoid. Here we will quickly discuss the mathematics behind coding a sinuosoid signal.</p>
<p>A sine wave typically takes the following form:</p>
<p><span class="math display">\[
f(\theta) = (\alpha) \text{sin}(b(\theta - c)) + d
\]</span></p>
<p>The translations that you see above from the standard sine wave (sin(<span class="math inline">\(\theta\)</span>)) have particular terms. Here we give a quick summary of the terms in the above equation and their definitions:</p>
<ol style="list-style-type: decimal">
<li><strong>Period</strong>: the amount of time required to complete one full cycle of the sine wave. A standard sine wave has period <span class="math inline">\(2\pi\)</span>. The sine wave described above has period <span class="math inline">\(\frac{2\pi}{|b|}\)</span></li>
<li><strong>Frequency</strong>: the number of times a sine wave repeats itself within a single unit of time (which depends upon how the variable <span class="math inline">\(\theta\)</span> is defined). This is the reciprocal of the period so in our case this is <span class="math inline">\(\frac{|b|}{2\pi}\)</span>.</li>
<li><strong>Amplitude</strong>: the “height” of the sine wave, or more properly, the distance from the x-axis to the most positive point of the sine wave. The standard sine wave has an amplitude of 1. The amplitude is controlled by the <span class="math inline">\(\alpha\)</span> parameter, and thus our sine wave has amplitude <span class="math inline">\(\alpha\)</span>.</li>
<li><strong>Phase Shift</strong>: determines whether or not the sine wave passes through the point (0, 0). Our sine wave mentioned above is shifted to the right by the amount <span class="math inline">\(c\)</span> and shifted up by <span class="math inline">\(d\)</span>.</li>
</ol>
<p>Next we draw a few plots to show graphically how all these parameters influence the signal. We will graph these as digital signals.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="functions.html#cb1085-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb1085-2"><a href="functions.html#cb1085-2"></a><span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi, <span class="fl">.1</span>)</span>
<span id="cb1085-3"><a href="functions.html#cb1085-3"></a><span class="op">&gt;</span><span class="st"> </span>standard &lt;-<span class="st"> </span><span class="kw">sin</span>(x)</span>
<span id="cb1085-4"><a href="functions.html#cb1085-4"></a><span class="op">&gt;</span><span class="st"> </span>altered &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">sin</span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="dv">4</span></span>
<span id="cb1085-5"><a href="functions.html#cb1085-5"></a><span class="op">&gt;</span><span class="st"> </span>graphData &lt;-<span class="st"> </span><span class="kw">tibble</span>(x, standard, altered)</span>
<span id="cb1085-6"><a href="functions.html#cb1085-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> graphData, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1085-7"><a href="functions.html#cb1085-7"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> standard, <span class="dt">color =</span> <span class="st">&quot;sin(x)&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1085-8"><a href="functions.html#cb1085-8"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> altered, <span class="dt">color =</span> <span class="st">&quot;2*sin(3 * (x - 1)) + 4&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1085-9"><a href="functions.html#cb1085-9"></a><span class="op">+</span><span class="st">   </span><span class="kw">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;sin(x)&quot;</span>, <span class="st">&quot;2*sin(3 * (x - 1)) + 4&quot;</span>), </span>
<span id="cb1085-10"><a href="functions.html#cb1085-10"></a><span class="op">+</span><span class="st">                      </span><span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1085-11"><a href="functions.html#cb1085-11"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-1.png" width="672" /></p>
<p>Now that we understand the fundamentals of sinusoids, let’s see how we can work with noise and filters on sinusoids using R.</p>
</div>
</div>
<div id="noise-and-filters" class="section level2" number="7.45">
<h2 number="7.45"><span class="header-section-number">7.45</span> Noise and Filters</h2>
<p>Using filters to remove noise and obtain only the desired portions of signals is a huge part of signal processing. Here we will give a couple examples of the <em>many</em> different functions available in the <code>signal</code> package for DSP. The <code>signal</code> package is a set of signal processing functions that was originally written for more “standard” signal processing languages, Matlab and Octave, but was later translated into R. It provides an extensive set of functions including filtering functions, resampling routines, and interpolation functions. To follow along yourself, install the package with <code>install.packages("signal")</code>.</p>
<p>For a first example, consider the sinusoid generated below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="functions.html#cb1086-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(signal)</span>
<span id="cb1086-2"><a href="functions.html#cb1086-2"></a><span class="op">&gt;</span><span class="st"> </span>t &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">len =</span> <span class="dv">100</span>)</span>
<span id="cb1086-3"><a href="functions.html#cb1086-3"></a><span class="op">&gt;</span><span class="st"> </span>sig &lt;-<span class="st"> </span><span class="kw">sin</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>t)</span>
<span id="cb1086-4"><a href="functions.html#cb1086-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(t, sig)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1086-5"><a href="functions.html#cb1086-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-325-1.png" width="672" /></p>
<p>This is a simple sinusoid that has an amplitude of 1 and a frequency of 1. It is not likely that when obtaining a real-world signal you would get a perfect sinusoid without any noise. Let’s take this graph and add some noise to it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="functions.html#cb1087-1"></a><span class="op">&gt;</span><span class="st"> </span>noisySig &lt;-<span class="st"> </span><span class="kw">sin</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>t) <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span> <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(t))</span>
<span id="cb1087-2"><a href="functions.html#cb1087-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1087-3"><a href="functions.html#cb1087-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(t, noisySig), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-326-1.png" width="672" /></p>
<p>We add noise to the function by adding a random value (<code>0.25*rnorm(length(t)</code>) to each value in the signal. This is more typical of a real-world signal, as you can somewhat see the general shape (the signal you are interested in), but it is somewhat distorted as a result of noise. The <code>signal</code> package provides a long list of functions for filtering out noise. Here we will utilize the <code>butter</code> function to remove the noise from this signal in an attempt to obtain our original signal. This function generates a variable containing the Butterworth filter polynomial coefficients. The Butterworth filter is a good all-around filter that is often used in radio frequency filter applications. We then use the <code>filter</code> function from the <code>signal</code> package to apply the Butterworth filter to the data. Finally we produce a plot using <code>ggplot2</code> that shows the original signal without noise, the noisy signal, and the recovered signal.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="functions.html#cb1088-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)</span>
<span id="cb1088-2"><a href="functions.html#cb1088-2"></a><span class="op">&gt;</span><span class="st"> </span>butterFilter &lt;-<span class="st"> </span><span class="kw">butter</span>(<span class="dv">3</span>, <span class="fl">0.1</span>)</span>
<span id="cb1088-3"><a href="functions.html#cb1088-3"></a><span class="op">&gt;</span><span class="st"> </span>recoveredSig &lt;-<span class="st"> </span>signal<span class="op">::</span><span class="kw">filter</span>(butterFilter, noisySig)</span>
<span id="cb1088-4"><a href="functions.html#cb1088-4"></a><span class="op">&gt;</span><span class="st"> </span>allSignals &lt;-<span class="st"> </span><span class="kw">data_frame</span>(t, sig, noisySig, recoveredSig)</span></code></pre></div>
<pre><code>Warning: `data_frame()` is deprecated, use `tibble()`.
This warning is displayed once per session.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1090-1"><a href="functions.html#cb1090-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(allSignals, <span class="kw">aes</span>(t)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1090-2"><a href="functions.html#cb1090-2"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> sig, <span class="dt">color =</span> <span class="st">&quot;Original&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1090-3"><a href="functions.html#cb1090-3"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> noisySig, <span class="dt">color =</span> <span class="st">&quot;Noisy&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1090-4"><a href="functions.html#cb1090-4"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> recoveredSig, <span class="dt">color =</span> <span class="st">&quot;Recovered&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1090-5"><a href="functions.html#cb1090-5"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Signal&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-327-1.png" width="672" /></p>
<p>You can see that the recovered signal is not perfect, as there is still some noise in the signal, and the timing of the peaks in the signal is not exactly matched up with the original. But it is clear that we have nonetheless removed a large portion of the noise from the noisy signal. Mess around with the argument values in the <code>butter()</code> function in the above code. See what changing the parameters does to the recovered graph. You can also explore the wide variety of filter functions available in the <code>signal</code> package by exploring the package documentation <a href="https://cran.r-project.org/web/packages/signal/signal.pdf">here</a>.</p>
<p>For a second example, suppose we are interested in not only the signal, but also the noise. We will extract the low and high frequencies from a sample signal. Let’s start with a noisy signal</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="functions.html#cb1091-1"></a><span class="op">&gt;</span><span class="st"> </span>t &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">500</span></span>
<span id="cb1091-2"><a href="functions.html#cb1091-2"></a><span class="op">&gt;</span><span class="st"> </span>cleanSignal &lt;-<span class="st"> </span><span class="dv">50</span> <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(t <span class="op">*</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>pi<span class="op">/</span><span class="kw">length</span>(t))</span>
<span id="cb1091-3"><a href="functions.html#cb1091-3"></a><span class="op">&gt;</span><span class="st"> </span>noise &lt;-<span class="st"> </span><span class="dv">50</span> <span class="op">*</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(t <span class="op">*</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>pi<span class="op">/</span><span class="kw">length</span>(t) <span class="op">*</span><span class="st"> </span><span class="dv">12</span>)</span>
<span id="cb1091-4"><a href="functions.html#cb1091-4"></a><span class="op">&gt;</span><span class="st"> </span>originalSignal &lt;-<span class="st"> </span>cleanSignal <span class="op">+</span><span class="st"> </span>noise</span>
<span id="cb1091-5"><a href="functions.html#cb1091-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1091-6"><a href="functions.html#cb1091-6"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(t, originalSignal))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-328-1.png" width="672" /></p>
<p>Again, you can easily recognize the pattern is sinusoidal, but there is noise in the signal that you want to extract. Perhaps you are interested in where the noise is coming from and want to analyze the structure of the noise to figure this out. Thus, unlike the previous example, we want to extract the noise from the signal and not simply eliminate it. To do this we can again use the Butterworth filter.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1092-1"><a href="functions.html#cb1092-1"></a><span class="op">&gt;</span><span class="st"> </span>lowButter &lt;-<span class="st"> </span><span class="kw">butter</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">50</span>, <span class="dt">type =</span> <span class="st">&quot;low&quot;</span>)</span>
<span id="cb1092-2"><a href="functions.html#cb1092-2"></a><span class="op">&gt;</span><span class="st"> </span>low &lt;-<span class="st"> </span>signal<span class="op">::</span><span class="kw">filter</span>(lowButter, originalSignal)</span>
<span id="cb1092-3"><a href="functions.html#cb1092-3"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb1092-4"><a href="functions.html#cb1092-4"></a><span class="er">&gt;</span><span class="st"> </span>highButter &lt;-<span class="st"> </span><span class="kw">butter</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">25</span>, <span class="dt">type =</span> <span class="st">&quot;high&quot;</span>)</span>
<span id="cb1092-5"><a href="functions.html#cb1092-5"></a><span class="op">&gt;</span><span class="st"> </span>high &lt;-<span class="st"> </span>signal<span class="op">::</span><span class="kw">filter</span>(highButter, originalSignal)</span>
<span id="cb1092-6"><a href="functions.html#cb1092-6"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb1092-7"><a href="functions.html#cb1092-7"></a><span class="er">&gt;</span><span class="st"> </span>signals &lt;-<span class="st"> </span><span class="kw">data.frame</span>(originalSignal, low, high)</span>
<span id="cb1092-8"><a href="functions.html#cb1092-8"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb1092-9"><a href="functions.html#cb1092-9"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">ggplot</span>(signals, <span class="kw">aes</span>(t)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1092-10"><a href="functions.html#cb1092-10"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> originalSignal, <span class="dt">color =</span> <span class="st">&quot;Original&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1092-11"><a href="functions.html#cb1092-11"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> low, <span class="dt">color =</span> <span class="st">&quot;Signal&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1092-12"><a href="functions.html#cb1092-12"></a><span class="op">+</span><span class="st">   </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> high, <span class="dt">color =</span> <span class="st">&quot;Noise&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1092-13"><a href="functions.html#cb1092-13"></a><span class="op">+</span><span class="st">   </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Signal&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-329-1.png" width="672" /></p>
</div>
<div id="fourier-transforms-and-spectrograms" class="section level2" number="7.46">
<h2 number="7.46"><span class="header-section-number">7.46</span> Fourier Transforms and Spectrograms</h2>
<p>When working with signals you often have to consider whether or not you need to work in the <em>time domain</em> or the <em>frequency domain</em>. These two different domains can provide valuable information about a signal. The most popular way to explore signals in the frequency domain is to use Fourier Transforms. A <em>Fourier Transform</em> is a reversible mathematical transform developed by Joseph Fourier in the early 1800s. The transform breaks apart a time series into a sum of finite series of sine or cosine functions. This was a huge break through of it’s time, as Fourier argues that any signal can be broken down into a series of sine and cosine curves. This was a fantastic development and is still one of the most widely used tools in digital signal processing, which tells you how useful it truly is (and how brilliant Fourier was).</p>
<p>The Discrete Fourier Transform (DFT) is a specific form of the Fourier Transform applied to a time wave. The DFT allows you to switch from working in the time domain to the frequency domain by using the amplitude and the frequency of the signal to build the frequency spectrum of the original time wave.</p>
<p>To apply Fourier Transforms we use a window size. The length of the FT is controlled by the <em>window length</em>. Increasing the window size will increase frequency resolution, but this will also make the transform less accurate in terms of time as more signal will be selected for the transform. Thus there is a constant level of uncertainty between the time of the signal and the frequency of the signal<a href="references.html#fn59" class="footnote-ref" id="fnref59"><sup>59</sup></a>. Different windows can be used in a DFT depending on the application. There are numerous windows available within the <code>seewave</code> package (see Figure <a href="functions.html#fig:filters">18</a>).</p>
<div class="figure"><span id="fig:filters"></span>
<img src="bookdown_files/figure-html/filters-1.png" alt="Different available filters within the seewave package" width="672" />
<p class="caption">
FIGURE 18: Different available filters within the seewave package
</p>
</div>
<p>Computing a fourier transform on a whole sound or a single segment of the sound may not be enough information for what you desire. One great idea is to compute the DFT on successive sections along the entire sound signal. A window is “slided” along the signal and a DFT is computed at each of these slides. This process is called a <em>Short-Time Fourier Transform</em>. This method allows you to represent the signals in the frequency spectrum, while also maintaining most of the information from the time dimension (as Hannah Montana might say, it’s the <a href="https://www.youtube.com/watch?v=uVjRe8QXFHY">best of both worlds</a>).</p>
<p>We can plot the results of an STFT in what is called a <em>spectrogram</em>. The spectogram is so useful in bioacoustics, acoustics, and ecoacoustics (among others) because it allows you to represent three variables in a 2D plot, which avoids using a 3D representation that is genereally not appealing. The successive DFT are plotted against time with the relative amplitude of each sine function of each DFT represented by some color scale. In other words, the spectrogram has an x-axis of time, a y-axis of frequency, and the amplitude represented by the color scheme used inside the plot (which is usually included in a scale).</p>
<p>Let’s use a sample audio file provided by the <code>seewave</code> package and produce a spectrogram of it using the <code>spectro</code> function. R provides multiple functions like <code>spectro</code> that make the creation of spectrograms and Fourier Transforms extremely easy and logical, which is one of the many reasons to perform digital signal processing within the R environment.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="functions.html#cb1093-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(seewave)</span>
<span id="cb1093-2"><a href="functions.html#cb1093-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(tico)</span>
<span id="cb1093-3"><a href="functions.html#cb1093-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">spectro</span>(tico)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-330-1.png" width="100%" /></p>
<p>Let’s explore more of the parameters for this function to get a better understanding of how it is working. Type in <code>?spectro</code> in the R console. The <code>spectro()</code> function contains a lot of different arguments that allow you to control how the spectrogram is created. The <code>f</code> argument allows you to specify the sampling rate of your sound object. The <code>wl</code> option allows you to control the window length that is used when the successive DFTs are produced (aka the STFT). You can choose which window you want to use with the <code>wn</code> option. You can also specify the amount of <code>ovlp</code> between two successive windows with the <code>ovlp</code> argument. Let’s use some of these arguments and compare it to the standard spectrogram we previously produced.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="functions.html#cb1094-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">spectro</span>(tico, <span class="dt">f =</span> <span class="dv">22050</span>, <span class="dt">wl =</span> <span class="dv">1024</span>, <span class="dt">wn =</span> <span class="st">&quot;bartlett&quot;</span>, <span class="dt">ovlp =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-331-1.png" width="100%" /></p>
<p>You can immediately see that there are some slight differences between the spectrograms. The first spectrogram appears to be more precise than the second spectrogram. Explore these parameters yourself to get a better understanding of how these different properties impact the short-time fourier transform and the spectrogram.</p>
<p>One cool thing about the <code>spectro()</code> function is that it produces a graph, but it also stores the values along the three scales. If you save the call to a <code>spectro()</code> function, that variable will be a list containing the values along the time axis, values along the frequency axis, and the amplitude values of the FFT decompositions. These values can be accessed in familiar ways (<code>$time</code>, <code>$frequency</code>, <code>$amp</code>).</p>
<p>Now that you have a visualization of the sound, we will use the <code>tuneR</code> package to play the sound so you can see exactly how it matches up with the spectrogram. First install the <code>tuneR</code> package, which is another package great for working with sound and signals in R. Then use the <code>play</code> function to play back the <code>tico</code> sound. Note that the second argument in the <code>play</code> function is the <code>player</code> argument, which may or may not need to be defined depending on your operating system and what audio players are installed on your system. In my case, I am playing the sound through the <code>aplay</code> player on a machine running Linux.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="functions.html#cb1095-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(tuneR)</span>
<span id="cb1095-2"><a href="functions.html#cb1095-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">play</span>(tico, <span class="st">&quot;aplay&quot;</span>)</span></code></pre></div>
<p>The audio matches up perfectly with the spectrogram. Pretty cool!</p>
</div>
<div id="exercises-11" class="section level2" number="7.47">
<h2 number="7.47"><span class="header-section-number">7.47</span> Exercises</h2>
<p><strong>Exercise DSP</strong> Learning objectives: download, manipulate, and play sound files using R, produce spectrograms of audio files, use filters, use acoustic indices to analyze western New York soundscape data}</p>

<p>_# Graphics in R Part 2: <code>graphics</code> {#graphics}</p>
</div>
<div id="scatter-plots-1" class="section level2" number="7.48">
<h2 number="7.48"><span class="header-section-number">7.48</span> Scatter Plots</h2>
<p>Begin by considering a simple and classic data set sometimes called <em>Fisher’s Iris Data</em>. These data are available in R.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="functions.html#cb1096-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(iris)</span>
<span id="cb1096-2"><a href="functions.html#cb1096-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(iris)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   150 obs. of  5 variables:
 $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
 $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>The data contain measurements on petal and sepal length and width for <code>dim(iris)[1]</code> iris plants. The plants are from one of three species, and the species information is also included in the data frame. The data are commonly used to test classification methods, where the goal would be to correctly determine the species based on the four length and width measurements. To get a preliminary sense of how this might work, we can draw some scatter plots of length versus width. In <code>graphics</code>, making scatter plots is simple:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="functions.html#cb1098-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-334-1.png" width="672" /></p>
<p>We see the <code>plot()</code> function by default creates a basic scatterplot when we supply the function with values for the <code>x</code> and <code>y</code> arguments.</p>
<p>Looking at the scatter plot and thinking about the focus of finding a method to classify the species, two thoughts come to mind. First, the plot might be improved by shading in the points. And second, using different colors for the points corresponding to the three species would help.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="functions.html#cb1099-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> iris<span class="op">$</span>Species)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-335-1.png" width="672" /></p>
<p>The <code>pch =</code> argument is used to control the type of symbol used to represent the data points. <code>pch = 19</code> specifies a filled in circle for each data point. You can mess around with different numbers and you’ll see a wide variety of options. The <code>col = iris$Species</code> argument tells the <code>plot()</code> function to assign a different color to each unique value in the the <code>iris$Species</code> vector.<a href="references.html#fn60" class="footnote-ref" id="fnref60"><sup>60</sup></a> Notice however that there is no legend produced by default, so we don’t know which color represents each species. We can add a legend using the <code>legend()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1100-1"><a href="functions.html#cb1100-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> iris<span class="op">$</span>Species)</span>
<span id="cb1100-2"><a href="functions.html#cb1100-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1100-3"><a href="functions.html#cb1100-3"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-336-1.png" width="672" /></p>
<p>Let’s walk through the additional complexities one at a time:</p>
<ol style="list-style-type: decimal">
<li><code>x = 6.4, y = 4.4</code> specifies the location where the legend is drawn. Here I place it in a location where the box will not cover up any data points.</li>
<li><code>legend = levels(iris$Species)</code> specifies the names of the different categories that will appear in the legend.</li>
<li><code>col = 1:length(levels(iris$Species))</code> specifies the number of colors that are represented in the function. In this case, we use <code>length(levels(iris$Species))</code> to get the number of unique species in the data set, which turns out to be 3.</li>
<li><code>pch = 19</code> specifies the type of symbol to include in the legend.</li>
</ol>
<p>It may seem like there are a lot of arguments to specify to produce a legend and a simple scatter plot, but this also means we have a lot of control over the graph, which is very useful when you are trying to develop a publication-quality figure for your own work.</p>
<p>Now perhaps we want to use different shapes as well for the different species. To do this we assign different values for the <code>pch</code> argument to each species, and subsequently change the <code>pch</code> argument in the legend as well.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="functions.html#cb1101-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)[iris<span class="op">$</span>Species], <span class="dt">col =</span> iris<span class="op">$</span>Species)</span>
<span id="cb1101-2"><a href="functions.html#cb1101-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1101-3"><a href="functions.html#cb1101-3"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-337-1.png" width="672" /></p>
<div id="adding-lines-to-a-scatter-plot-1" class="section level3" number="7.48.1">
<h3 number="7.48.1"><span class="header-section-number">7.48.1</span> Adding lines to a scatter plot</h3>
<p>Next let’s add a fitted least squares line to the scatter plot. This can be done pretty easily using the <code>abline()</code> function to add a straight ine to the curve, and the <code>lm()</code> function to actually compute the least squares line</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="functions.html#cb1102-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)[iris<span class="op">$</span>Species], <span class="dt">col =</span> iris<span class="op">$</span>Species)</span>
<span id="cb1102-2"><a href="functions.html#cb1102-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1102-3"><a href="functions.html#cb1102-3"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>))</span>
<span id="cb1102-4"><a href="functions.html#cb1102-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">abline</span>(<span class="kw">lm</span>(iris<span class="op">$</span>Sepal.Width <span class="op">~</span><span class="st"> </span>iris<span class="op">$</span>Sepal.Length))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-338-1.png" width="672" /></p>
<p>For the iris data, it probably makes more sense to fit separate lines by species. Below we compute the linear model separately for each species, then use the <code>abline()</code> function to add each line to the graph. Note our use of logical subsetting to obtain separate data frames for each species.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="functions.html#cb1103-1"></a><span class="op">&gt;</span><span class="st"> </span>iris.setosa &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>, ]</span>
<span id="cb1103-2"><a href="functions.html#cb1103-2"></a><span class="op">&gt;</span><span class="st"> </span>iris.versicolor &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span>, ]</span>
<span id="cb1103-3"><a href="functions.html#cb1103-3"></a><span class="op">&gt;</span><span class="st"> </span>iris.virginica &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>, ]</span>
<span id="cb1103-4"><a href="functions.html#cb1103-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)[iris<span class="op">$</span>Species], <span class="dt">col =</span> iris<span class="op">$</span>Species)</span>
<span id="cb1103-5"><a href="functions.html#cb1103-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1103-6"><a href="functions.html#cb1103-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>))</span>
<span id="cb1103-7"><a href="functions.html#cb1103-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">abline</span>(<span class="kw">lm</span>(iris.setosa<span class="op">$</span>Sepal.Width <span class="op">~</span><span class="st"> </span>iris.setosa<span class="op">$</span>Sepal.Length), <span class="dt">col =</span> <span class="dv">1</span>)</span>
<span id="cb1103-8"><a href="functions.html#cb1103-8"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">abline</span>(<span class="kw">lm</span>(iris.versicolor<span class="op">$</span>Sepal.Width <span class="op">~</span><span class="st"> </span>iris.versicolor<span class="op">$</span>Sepal.Length), <span class="dt">col =</span> <span class="dv">2</span>)</span>
<span id="cb1103-9"><a href="functions.html#cb1103-9"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">abline</span>(<span class="kw">lm</span>(iris.virginica<span class="op">$</span>Sepal.Width <span class="op">~</span><span class="st"> </span>iris.virginica<span class="op">$</span>Sepal.Length), <span class="dt">col =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-339-1.png" width="672" /></p>
<p>Note that we could also do this using a <code>for</code> loop, which you will learn about soon in Chapter <a href="functions.html#functions"><strong>??</strong></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="functions.html#cb1104-1"></a><span class="op">&gt;</span><span class="st"> </span>iris.setosa &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>, ]</span>
<span id="cb1104-2"><a href="functions.html#cb1104-2"></a><span class="op">&gt;</span><span class="st"> </span>iris.versicolor &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span>, ]</span>
<span id="cb1104-3"><a href="functions.html#cb1104-3"></a><span class="op">&gt;</span><span class="st"> </span>iris.virginica &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>, ]</span>
<span id="cb1104-4"><a href="functions.html#cb1104-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)[iris<span class="op">$</span>Species], <span class="dt">col =</span> iris<span class="op">$</span>Species)</span>
<span id="cb1104-5"><a href="functions.html#cb1104-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1104-6"><a href="functions.html#cb1104-6"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>))</span>
<span id="cb1104-7"><a href="functions.html#cb1104-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species))) {</span>
<span id="cb1104-8"><a href="functions.html#cb1104-8"></a><span class="op">+</span><span class="st">   </span>curr.species &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)[i], ]</span>
<span id="cb1104-9"><a href="functions.html#cb1104-9"></a><span class="op">+</span><span class="st">   </span><span class="kw">abline</span>(<span class="kw">lm</span>(curr.species<span class="op">$</span>Sepal.Width <span class="op">~</span><span class="st"> </span>curr.species<span class="op">$</span>Sepal.Length), <span class="dt">col =</span> i)</span>
<span id="cb1104-10"><a href="functions.html#cb1104-10"></a><span class="op">+</span><span class="st"> </span>}</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-340-1.png" width="672" /></p>
<p>Another common use of line segments in a graphic is to connect the points in order. Although it is not clear why this helps in understanding the iris data, the technique is illustrated next. First we connect all lines regardless of species. This is done easily by specifying the argument <code>type = 'b'</code> in the <code>plot()</code> function<a href="references.html#fn61" class="footnote-ref" id="fnref61"><sup>61</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="functions.html#cb1105-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length, <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)[iris<span class="op">$</span>Species], <span class="dt">col =</span> iris<span class="op">$</span>Species, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb1105-2"><a href="functions.html#cb1105-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1105-3"><a href="functions.html#cb1105-3"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-341-1.png" width="672" /></p>
<p>Now we attempt to only connect the points within a given species. Doing this requires the use of the <code>lines()</code> function to draw three separate lines for each species<a href="references.html#fn62" class="footnote-ref" id="fnref62"><sup>62</sup></a> First we create a plot for the first species, and then subsequently use the <code>lines()</code> function to add each of the remaining two species to the plot. Notice that there are some additional arguments in the original <code>plot()</code> function that we have yet to cover. Don’t worry, we’ll talk about all this fun stuff in the next section :)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="functions.html#cb1106-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>], <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>], <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>, <span class="dt">xlim =</span> <span class="kw">range</span>(iris<span class="op">$</span>Sepal.Length), <span class="dt">ylim =</span> <span class="kw">range</span>(iris<span class="op">$</span>Sepal.Width), <span class="dt">xlab =</span> <span class="st">&quot;Sepal Length&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Sepal Width&quot;</span>)</span>
<span id="cb1106-2"><a href="functions.html#cb1106-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">lines</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span>], <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span>], <span class="dt">pch =</span> <span class="dv">18</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb1106-3"><a href="functions.html#cb1106-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">lines</span>(<span class="dt">x =</span> iris<span class="op">$</span>Sepal.Length[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>], <span class="dt">y =</span> iris<span class="op">$</span>Sepal.Width[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>], <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="dv">3</span>, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb1106-4"><a href="functions.html#cb1106-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">6.4</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(iris<span class="op">$</span>Species), </span>
<span id="cb1106-5"><a href="functions.html#cb1106-5"></a><span class="op">+</span><span class="st">        </span><span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(iris<span class="op">$</span>Species)), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-1.png" width="672" /></p>
</div>
</div>
<div id="labels-axes-text-etc.-1" class="section level2" number="7.49">
<h2 number="7.49"><span class="header-section-number">7.49</span> Labels, Axes, Text, etc.</h2>
<p>The default settings of <code>graphics</code> often produce useful graphics, but once a graphic is chosen for dissemination, the user will likely want to customize things like the title, axes, etc. In this section some tools for customization are presented. Most will be illustrated in the context of a data set on crime rates in the 50 states in the United States. These data were made available by Nathan Yau at <a href="http://flowingdata.com/2010/11/23/how-to-make-bubble-charts/" class="uri">http://flowingdata.com/2010/11/23/how-to-make-bubble-charts/</a>. The data include crime rates per 100,000 people for various crimes such as murder and robbery, and also include each state’s population. The crime rates are from the year 2005, while the population numbers are from the year 2008, but the difference in population between the years is not great, and the exact population is not particularly important for what we’ll do below.</p>
<p>First, read in the data, examine its structure, and produce a simple scatter plot of motor vehicle theft versus burglary.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="functions.html#cb1107-1"></a><span class="op">&gt;</span><span class="st"> </span>u.crime &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/crimeRatesByState2005.csv&quot;</span></span>
<span id="cb1107-2"><a href="functions.html#cb1107-2"></a><span class="op">&gt;</span><span class="st"> </span>crime &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.crime, <span class="dt">header=</span><span class="ot">TRUE</span>)</span>
<span id="cb1107-3"><a href="functions.html#cb1107-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(crime)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   50 obs. of  9 variables:
 $ state              : Factor w/ 50 levels &quot;Alabama &quot;,&quot;Alaska &quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
 $ murder             : num  8.2 4.8 7.5 6.7 6.9 3.7 2.9 4.4 5 6.2 ...
 $ Forcible_rate      : num  34.3 81.1 33.8 42.9 26 43.4 20 44.7 37.1 23.6 ...
 $ Robbery            : num  141.4 80.9 144.4 91.1 176.1 ...
 $ aggravated_assult  : num  248 465 327 387 317 ...
 $ burglary           : num  954 622 948 1085 693 ...
 $ larceny_theft      : num  2650 2599 2965 2711 1916 ...
 $ motor_vehicle_theft: num  288 391 924 262 713 ...
 $ population         : int  4627851 686293 6500180 2855390 36756666 4861515 3501252 873092 18328340 9685744 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="functions.html#cb1109-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-343-1.png" width="672" /></p>
<div id="labels-1" class="section level3" number="7.49.1">
<h3 number="7.49.1"><span class="header-section-number">7.49.1</span> Labels</h3>
<p>By default, axis labels are the values of the <code>x</code> and <code>y</code> values you supply to the <code>plot()</code> function. For making a publication-quality figure, we often want to further customize these labels, as well as potentially add a title to the graph. We can do this using the <code>xlab</code>, <code>ylab</code>, and <code>main</code> arguments in the <code>plot()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="functions.html#cb1110-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">pch =</span> <span class="dv">19</span>, </span>
<span id="cb1110-2"><a href="functions.html#cb1110-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlab =</span> <span class="st">&quot;Burglaries per 100,000 population&quot;</span>, </span>
<span id="cb1110-3"><a href="functions.html#cb1110-3"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylab =</span> <span class="st">&quot;Motor vehicle theft per 100,000 population&quot;</span>, </span>
<span id="cb1110-4"><a href="functions.html#cb1110-4"></a><span class="op">+</span><span class="st">      </span><span class="dt">main =</span> <span class="st">&quot;Burglaries vs motor vehicle theft for US states&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-344-1.png" width="672" /></p>
<p>Perhaps it may be easier to read the values on the y-axis if they were oritented horizontally instead of vertically. We can do this using the <code>las = 1</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="functions.html#cb1111-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">pch =</span> <span class="dv">19</span>, </span>
<span id="cb1111-2"><a href="functions.html#cb1111-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlab =</span> <span class="st">&quot;Burglaries per 100,000 population&quot;</span>, </span>
<span id="cb1111-3"><a href="functions.html#cb1111-3"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylab =</span> <span class="st">&quot;Motor vehicle theft per 100,000 population&quot;</span>, </span>
<span id="cb1111-4"><a href="functions.html#cb1111-4"></a><span class="op">+</span><span class="st">      </span><span class="dt">main =</span> <span class="st">&quot;Burglaries vs motor vehicle theft for US states&quot;</span>, </span>
<span id="cb1111-5"><a href="functions.html#cb1111-5"></a><span class="op">+</span><span class="st">      </span><span class="dt">las =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-345-1.png" width="672" /></p>
</div>
</div>
<div id="customizing-axes-1" class="section level2" number="7.50">
<h2 number="7.50"><span class="header-section-number">7.50</span> Customizing Axes</h2>
<p>The basic <code>plot()</code> function provides defaults for the axis limits, as well as for other axis features (i.e., the box around the plot). These, and other axis features such as tick marks, labels, and transformations, can all be customized. First, we use the <code>xlim</code> and <code>ylim</code> arguments to make the x and y axes start at zero and go to the maxium x and y values.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="functions.html#cb1112-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">pch =</span> <span class="dv">19</span>, </span>
<span id="cb1112-2"><a href="functions.html#cb1112-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlab =</span> <span class="st">&quot;Burglaries per 100,000 population&quot;</span>, </span>
<span id="cb1112-3"><a href="functions.html#cb1112-3"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylab =</span> <span class="st">&quot;Motor vehicle theft per 100,000 population&quot;</span>, </span>
<span id="cb1112-4"><a href="functions.html#cb1112-4"></a><span class="op">+</span><span class="st">      </span><span class="dt">main =</span> <span class="st">&quot;Burglaries vs motor vehicle theft for US states&quot;</span>, </span>
<span id="cb1112-5"><a href="functions.html#cb1112-5"></a><span class="op">+</span><span class="st">      </span><span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(crime<span class="op">$</span>burglary)), </span>
<span id="cb1112-6"><a href="functions.html#cb1112-6"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(crime<span class="op">$</span>motor_vehicle_theft)))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-346-1.png" width="672" /></p>
<p>Now we eliminate the axes and box automatically drawn by the <code>plot()</code> function, and subsequently add our own axes using the <code>axis()</code> function. We use most of the defaults provided by the <code>axis()</code> function, however, looking at the help page for <code>axis()</code> reveals a large amount of possibilities for customizing the axes in whatever way you desire.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="functions.html#cb1113-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">pch =</span> <span class="dv">19</span>, </span>
<span id="cb1113-2"><a href="functions.html#cb1113-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlab =</span> <span class="st">&quot;Burglaries per 100,000 population&quot;</span>, </span>
<span id="cb1113-3"><a href="functions.html#cb1113-3"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylab =</span> <span class="st">&quot;Motor vehicle theft per 100,000 population&quot;</span>, </span>
<span id="cb1113-4"><a href="functions.html#cb1113-4"></a><span class="op">+</span><span class="st">      </span><span class="dt">main =</span> <span class="st">&quot;Burglaries vs motor vehicle theft for US states&quot;</span>, </span>
<span id="cb1113-5"><a href="functions.html#cb1113-5"></a><span class="op">+</span><span class="st">      </span><span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, </span>
<span id="cb1113-6"><a href="functions.html#cb1113-6"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(crime<span class="op">$</span>burglary)), </span>
<span id="cb1113-7"><a href="functions.html#cb1113-7"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(crime<span class="op">$</span>motor_vehicle_theft)))</span>
<span id="cb1113-8"><a href="functions.html#cb1113-8"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>)</span>
<span id="cb1113-9"><a href="functions.html#cb1113-9"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-1.png" width="672" /></p>
<div id="text-point-size-and-color-1" class="section level3" number="7.50.1">
<h3 number="7.50.1"><span class="header-section-number">7.50.1</span> Text, Point Size, and Color</h3>
<p>Next we make point size proportional to population, change the color, and add a state label. First we make point size proportional to population size using the <code>symbols()</code> function. We can control the color of the points using the <code>bg</code> argument in the <code>symbols()</code> function. We then use the <code>text()</code> function to add labels to each point.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="functions.html#cb1114-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">symbols</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">pch =</span> <span class="dv">19</span>, </span>
<span id="cb1114-2"><a href="functions.html#cb1114-2"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlab =</span> <span class="st">&quot;Burglaries per 100,000 population&quot;</span>, </span>
<span id="cb1114-3"><a href="functions.html#cb1114-3"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylab =</span> <span class="st">&quot;Motor vehicle theft per 100,000 population&quot;</span>, </span>
<span id="cb1114-4"><a href="functions.html#cb1114-4"></a><span class="op">+</span><span class="st">      </span><span class="dt">main =</span> <span class="st">&quot;Burglaries vs motor vehicle theft for US states&quot;</span>, </span>
<span id="cb1114-5"><a href="functions.html#cb1114-5"></a><span class="op">+</span><span class="st">      </span><span class="dt">las =</span> <span class="dv">1</span>, </span>
<span id="cb1114-6"><a href="functions.html#cb1114-6"></a><span class="op">+</span><span class="st">      </span><span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(crime<span class="op">$</span>burglary)), </span>
<span id="cb1114-7"><a href="functions.html#cb1114-7"></a><span class="op">+</span><span class="st">      </span><span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(crime<span class="op">$</span>motor_vehicle_theft)), </span>
<span id="cb1114-8"><a href="functions.html#cb1114-8"></a><span class="op">+</span><span class="st">      </span><span class="dt">circles =</span> crime<span class="op">$</span>population, </span>
<span id="cb1114-9"><a href="functions.html#cb1114-9"></a><span class="op">+</span><span class="st">      </span><span class="dt">inches =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">bg=</span><span class="st">&quot;steelblue2&quot;</span>)</span>
<span id="cb1114-10"><a href="functions.html#cb1114-10"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>)</span>
<span id="cb1114-11"><a href="functions.html#cb1114-11"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">1</span>)</span>
<span id="cb1114-12"><a href="functions.html#cb1114-12"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">text</span>(crime<span class="op">$</span>burglary, crime<span class="op">$</span>motor_vehicle_theft, <span class="dt">labels=</span>crime<span class="op">$</span>state, <span class="dt">cex=</span><span class="fl">0.9</span>, <span class="dt">font=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-1.png" width="672" /></p>
<p>This graph is mind-numbingly busy, and is missing some notable things (i.e. legend). For now, we leave it up to you to add in a legend, make the graph less cluttered, fix the cutoff labels, etc. if you so desire.</p>
<p>You run an experiment to see if the number of alcoholic beverages a person has on average every day is related to weight. You collect 15 data points. Enter these data in R by creating vectors, and then reproduce the following plot.</p>
<table>
<thead>
<tr class="header">
<th align="right"># of Drinks</th>
<th align="right">Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.0</td>
<td align="right">150</td>
</tr>
<tr class="even">
<td align="right">3.0</td>
<td align="right">350</td>
</tr>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="right">0.5</td>
<td align="right">140</td>
</tr>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">200</td>
</tr>
<tr class="even">
<td align="right">1.0</td>
<td align="right">160</td>
</tr>
<tr class="odd">
<td align="right">0.0</td>
<td align="right">175</td>
</tr>
<tr class="even">
<td align="right">0.0</td>
<td align="right">140</td>
</tr>
<tr class="odd">
<td align="right">0.0</td>
<td align="right">167</td>
</tr>
<tr class="even">
<td align="right">1.0</td>
<td align="right">200</td>
</tr>
<tr class="odd">
<td align="right">4.0</td>
<td align="right">300</td>
</tr>
<tr class="even">
<td align="right">5.0</td>
<td align="right">321</td>
</tr>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">250</td>
</tr>
<tr class="even">
<td align="right">0.5</td>
<td align="right">187</td>
</tr>
<tr class="odd">
<td align="right">1.0</td>
<td align="right">190</td>
</tr>
</tbody>
</table>
<p><img src="bookdown_files/figure-html/unnamed-chunk-350-1.png" width="672" /></p>
</div>
</div>
<div id="other-types-of-graphics-1" class="section level2" number="7.51">
<h2 number="7.51"><span class="header-section-number">7.51</span> Other Types of Graphics</h2>
<p>Scatter and line plots, which have just been presented, are common but certainly not the only graphical displays in common use. Histograms, boxplots, and bar graphs, as well as more “mathematical” displays such as the graph of a function, are commonly used to represent data. Examples of each are presented below.</p>
<div id="histograms-1" class="section level3" number="7.51.1">
<h3 number="7.51.1"><span class="header-section-number">7.51.1</span> Histograms</h3>
<p>Simon Newcomb conducted several experiments to estimate the speed of light by measuring the time it took for light to travel from his laboratory to a mirror at the base of the Washington Monument, and then back to his lab. This is a distance of <span class="math inline">\(7.44373\)</span> km, and by dividing this distance by the measured time, an estimate for the speed of light is obtained.</p>
<p>The times are of course quite small, and to avoid working with very small numbers, the data are recoded to be the deviation from <span class="math inline">\(24800\)</span> nanoseconds. For example an observation coded as <span class="math inline">\(28\)</span> represents a time of <span class="math inline">\(24828\)</span> nanoseconds, while an observation coded as <span class="math inline">\(-44\)</span> represents a time of <span class="math inline">\(24756\)</span> nanoseconds.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="functions.html#cb1115-1"></a><span class="op">&gt;</span><span class="st"> </span>u.newcomb &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/Newcomb.csv&quot;</span></span>
<span id="cb1115-2"><a href="functions.html#cb1115-2"></a><span class="op">&gt;</span><span class="st"> </span>Newcomb &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.newcomb, <span class="dt">header=</span><span class="ot">TRUE</span>)</span>
<span id="cb1115-3"><a href="functions.html#cb1115-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(Newcomb)</span></code></pre></div>
<pre><code>  Time
1   28
2   26
3   33
4   24
5   34
6  -44</code></pre>
<p>To produce a simple histogram of these data in the <code>graphics</code> package, we can use the simple <code>hist()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="functions.html#cb1117-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">hist</span>(Newcomb<span class="op">$</span>Time)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-352-1.png" width="672" /></p>
<p>The function automatically specifies the binwidths for the data, however we can easily change this ourselves to something more suitable using the <code>breaks</code> argument. We also change the axis labels, y-axis label orientation, title, and color of the bins.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="functions.html#cb1118-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">hist</span>(Newcomb<span class="op">$</span>Time, <span class="dt">breaks =</span> <span class="dv">30</span>, <span class="dt">main =</span> <span class="st">&quot;Histogram&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-353-1.png" width="672" /></p>
</div>
<div id="boxplots-1" class="section level3" number="7.51.2">
<h3 number="7.51.2"><span class="header-section-number">7.51.2</span> Boxplots</h3>
<p>Next we consider some data from the gap minder data set to construct some box plots. These data are available in the <code>gapminder</code> package, which might need to be installed via <code>install.packages("gapminder")</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="functions.html#cb1119-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(gapminder)</span></code></pre></div>
<pre><code>
Attaching package: &#39;gapminder&#39;</code></pre>
<pre><code>The following object is masked _by_ &#39;.GlobalEnv&#39;:

    gapminder</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="functions.html#cb1122-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">boxplot</span>(gdpPercap <span class="op">~</span><span class="st"> </span>continent, <span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">&#39;lightblue&#39;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">xlab =</span> <span class="st">&quot;Continent&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;GDP Per-capita&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-354-1.png" width="672" /></p>
<p>Here’s the same set of boxplots, but with different colors and the boxes plotted horizontally rather than vertically</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="functions.html#cb1123-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">boxplot</span>(gdpPercap <span class="op">~</span><span class="st"> </span>continent, <span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">border =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">col =</span> <span class="st">&#39;lightblue&#39;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">xlab =</span> <span class="st">&quot;GDP Per-Capita&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Continent&quot;</span>, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-1.png" width="672" /></p>
<p>However, notice in the last two graphs the y-axis labels were running off the page. Using the <code>graphics</code> package, we have the ability to adjust all the dimensions and parameters of a plot by using the <code>par</code> function. Below we utilize the <code>par</code> function to extend the amount of space in the plot on the left side of the graph.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="functions.html#cb1124-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb1124-2"><a href="functions.html#cb1124-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">boxplot</span>(gdpPercap <span class="op">~</span><span class="st"> </span>continent, <span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">border =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">col =</span> <span class="st">&#39;lightblue&#39;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">xlab =</span> <span class="st">&quot;GDP Per-Capita&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Continent&quot;</span>, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-356-1.png" width="672" /></p>
</div>
<div id="bar-graphs-1" class="section level3" number="7.51.3">
<h3 number="7.51.3"><span class="header-section-number">7.51.3</span> Bar Graphs</h3>
<p>As part of a study, elementary school students were asked which was more important to them: good grades, popularity, or athletic ability. Here is a brief look at the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="functions.html#cb1125-1"></a><span class="op">&gt;</span><span class="st"> </span>u.goals &lt;-<span class="st"> &quot;https://www.finley-lab.com/files/data/StudentGoals.csv&quot;</span></span>
<span id="cb1125-2"><a href="functions.html#cb1125-2"></a><span class="op">&gt;</span><span class="st"> </span>StudentGoals &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.goals, <span class="dt">header=</span><span class="ot">TRUE</span>)</span>
<span id="cb1125-3"><a href="functions.html#cb1125-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(StudentGoals)</span></code></pre></div>
<pre><code>  Gender Grade Age  Race  Type School   Goals Grades
1    boy     5  11 White Rural    Elm  Sports      1
2    boy     5  10 White Rural    Elm Popular      2
3   girl     5  11 White Rural    Elm Popular      4
4   girl     5  11 White Rural    Elm Popular      2
5   girl     5  10 White Rural    Elm Popular      4
6   girl     5  11 White Rural    Elm Popular      4
  Sports Looks Money
1      2     4     3
2      1     4     3
3      3     1     2
4      3     4     1
5      2     1     3
6      2     1     3</code></pre>
<p>First, a simple bar graph of the most important goal chosen is drawn, followed by a stacked bar graph which also includes the student’s gender. We then add a side by side bar graph that includes the student’s gender.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="functions.html#cb1127-1"></a><span class="op">&gt;</span><span class="st"> </span>counts &lt;-<span class="st"> </span><span class="kw">table</span>(StudentGoals<span class="op">$</span>Goals)</span>
<span id="cb1127-2"><a href="functions.html#cb1127-2"></a><span class="op">&gt;</span><span class="st"> </span>counts</span></code></pre></div>
<pre><code>
 Grades Popular  Sports 
    247     141      90 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="functions.html#cb1129-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">barplot</span>(counts)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-358-1.png" width="672" /></p>
<p>Notice that to create a basic bar graph using the graphics package, we first take our variable of interest <code>StudentGoals$Goals</code> and put it in table format using the <code>table()</code> function. Next we produce a stacked bar graph that also includes the student’s gender. Then we subsequently add a side by side bar graph that includes the student’s gender.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="functions.html#cb1130-1"></a><span class="op">&gt;</span><span class="st"> </span>gender.counts &lt;-<span class="st"> </span><span class="kw">table</span>(StudentGoals<span class="op">$</span>Gender, StudentGoals<span class="op">$</span>Goals)</span>
<span id="cb1130-2"><a href="functions.html#cb1130-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">barplot</span>(gender.counts, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;lightblue&quot;</span>), <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Goals&quot;</span>)</span>
<span id="cb1130-3"><a href="functions.html#cb1130-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">row.names</span>(gender.counts), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;lightblue&quot;</span>), <span class="dt">pch =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-359-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="functions.html#cb1131-1"></a><span class="op">&gt;</span><span class="st"> </span>gender.counts &lt;-<span class="st"> </span><span class="kw">table</span>(StudentGoals<span class="op">$</span>Gender, StudentGoals<span class="op">$</span>Goals)</span>
<span id="cb1131-2"><a href="functions.html#cb1131-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">barplot</span>(gender.counts, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;lightblue&quot;</span>), <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&quot;Count&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Goals&quot;</span>, <span class="dt">beside =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1131-3"><a href="functions.html#cb1131-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">row.names</span>(gender.counts), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;lightblue&quot;</span>), <span class="dt">pch =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-360-1.png" width="672" /></p>
<p>In this example R counted the number of students who had each goal and used these counts as the height of the bars. Sometimes the data contain the bar heights as a variable. For example, we create a bar graph of India’s per capita GDP with separate bars for each year in the data<a href="references.html#fn63" class="footnote-ref" id="fnref63"><sup>63</sup></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="functions.html#cb1132-1"></a><span class="op">&gt;</span><span class="st"> </span>india &lt;-<span class="st"> </span><span class="kw">subset</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;India&quot;</span>)</span>
<span id="cb1132-2"><a href="functions.html#cb1132-2"></a><span class="op">&gt;</span><span class="st"> </span>gdp.india &lt;-<span class="st"> </span>india<span class="op">$</span>gdpPercap</span>
<span id="cb1132-3"><a href="functions.html#cb1132-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(gdp.india) &lt;-<span class="st"> </span>india<span class="op">$</span>year</span>
<span id="cb1132-4"><a href="functions.html#cb1132-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">barplot</span>(gdp.india, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;GDP Per Capita&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;India&#39;s per-capita GDP&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;steelblue2&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-361-1.png" width="672" /></p>
</div>
<div id="graphs-of-functions-1" class="section level3" number="7.51.4">
<h3 number="7.51.4"><span class="header-section-number">7.51.4</span> Graphs of Functions</h3>
<p>One way to create a plot of a mathematical function <span class="math inline">\(f\)</span> is to create a data frame with <span class="math inline">\(x\)</span> values in one column and <span class="math inline">\(f(x)\)</span> values in another column, and then draw a line plot.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="functions.html#cb1133-1"></a><span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>pi, pi, <span class="dt">len =</span> <span class="dv">1000</span>)</span>
<span id="cb1133-2"><a href="functions.html#cb1133-2"></a><span class="op">&gt;</span><span class="st"> </span>sin.x &lt;-<span class="st"> </span><span class="kw">sin</span>(x)</span>
<span id="cb1133-3"><a href="functions.html#cb1133-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(x, sin.x, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-362-1.png" width="672" /></p>
</div>
</div>
<div id="saving-graphics-1" class="section level2" number="7.52">
<h2 number="7.52"><span class="header-section-number">7.52</span> Saving Graphics</h2>
<p>We often want to export our graphics to use in an external document or share with colleagues. There are numerous functions available to export graphic files in different formats. Below we demonstrate the use of the <code>png()</code> function to export the image of the sin curve we created above.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="functions.html#cb1134-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">png</span>(<span class="st">&quot;sinCurve.png&quot;</span>)</span>
<span id="cb1134-2"><a href="functions.html#cb1134-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(x, sin.x, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>)</span>
<span id="cb1134-3"><a href="functions.html#cb1134-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">dev.off</span>()</span></code></pre></div>
<p>Inside the <code>png()</code> function, we specify the name the image is given when it is saved. There are also arguments to specify the width and height of the saved image. This function opens a png file where the image will be saved. There are analagous functions for other types of files (i.e. <code>pdf()</code>, <code>jpeg()</code>). The second line <code>plot(x, sin.x, type = 'l')</code> simply creates the plot we desire to save. The <code>dev.off()</code> function closes the png file.</p>
</div>
<div id="a-summary-of-useful-graphics-functions-and-arguments" class="section level2" number="7.53">
<h2 number="7.53"><span class="header-section-number">7.53</span> A Summary of Useful <code>graphics</code> Functions and Arguments</h2>
<p>Upon initial learning, making plots with the <code>graphics</code> package may seem overwhelming due to the variety of different functions and arguments that control different features of the image that is produced. However, after some practice, you will find that the <code>graphics</code> method of graphing gives you great flexibility in making your images just the way you like them. This flexibility and control is one of the main reasons we produce most of our visualizations using <code>graphics</code>.</p>
<p>Below we provide a summary of the major functions and arguments you may find helpful when working with the <code>graphics</code> package. This is certainly not an exhaustive list, but it does include functions and arguments we often use on a daily basis, so we think you’ll find it useful. One of the nice things about the <code>graphics</code> package is that many of these functions utilize the same arguments.</p>
<ol style="list-style-type: decimal">
<li><code>plot(x, y)</code>: the basic plotting function. Many of the graphs you produce will start with the <code>plot()</code> function. Here are some useful arguments (aside from x and y arguments to specify the data):
<ul>
<li><code>pch</code>: specify the type of point in a scatter plot. We often use <code>pch = 19</code>.</li>
<li><code>xlab</code> and <code>ylab</code>: specify the x and y axis labels</li>
<li><code>xlim</code> and <code>ylim</code>: specify the range of the x and y axes</li>
<li><code>type</code>: specify the type of the plot. By default it is <code>p</code>, can create a line plot with <code>type = 'l'</code> or a scatter plot with lines with <code>type = 'b'</code>.</li>
<li><code>main</code>: add a title to the plot</li>
<li><code>cex</code>, <code>cex.lab</code>, <code>cex.main</code>: change the sizes of the points, the size of the axis label text, and the size of the title text, respectively</li>
<li><code>col</code>: specify the color of the points/lines</li>
<li><code>axes</code>: if <code>TRUE</code> axes will be automatically drawn, if <code>FALSE</code> no axes will be drawn.</li>
</ul></li>
<li><code>legend(x, y, legend)</code>: add a legend to the graph specified by the location <code>(x, y)</code> with the text specified by the <code>legend</code> argument.</li>
<li><code>points(x, y)</code>: add points to an already existing plot. Arguments same as those of <code>plot()</code>.</li>
<li><code>lines(x, y)</code>: add lines to an already existing plot. Arguments same as those of <code>plot()</code>.</li>
<li><code>axis()</code>: specify the axes</li>
<li><code>text(x, y)</code>: add text to a plot at the location <code>(x, y)</code>.</li>
<li><code>par()</code>: function to change a wide variety of graphical parameters for finer control over the plot’s appearance.</li>
</ol>
<p>The functions listed above certainly do not cover the realm of plots you can produce using the <code>graphics</code> package, but having a good understanding of how to use these functions will give you a firm grip on making publication-quality plots in R.</p>
<p>For additional help, we find that the help pages for most <code>graphics</code> functions are quite helpful. The online documentation for the package available <a href="https://rdrr.io/r/graphics/graphics-package.html#heading-0">here</a> perhaps provides a more user friendly version of the help pages within R. There are also numerous books and online tutorials available for working with these functions, so a simple google search is often the best way to find additional help :)</p>
<div id="practice-problem-16" class="section level3" number="7.53.1">
<h3 number="7.53.1"><span class="header-section-number">7.53.1</span> Practice Problem</h3>
<p>Go to the help page for the <code>par()</code> function (use <code>help(par)</code> or <code>?par()</code>). Look at the plethora of different arguments that you can use to specialize your plot just the way you like it. List 5 arguments that we didn’t use in this chapter, describe what they do, then use them in a graph using the <code>iris</code> data set (you can use any of the variables in the data set and produce any type of graph you like).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stats.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown.pdf"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
